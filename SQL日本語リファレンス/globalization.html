<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>第 10 章 グローバリゼーション</title><link rel="stylesheet" type="text/css" href="mvl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="MySQL 5.6 リファレンスマニュアル"><link rel="up" href="index.html" title="MySQL 5.6 リファレンスマニュアル"><link rel="prev" href="language-structure.html" title="第 9 章 言語構造"><link rel="next" href="data-types.html" title="第 11 章 データ型">
<script language="javascript" type="text/javascript">
  function addOnload(theFunc)
  {
    var previous = window.onload;
    if (typeof window.onload != 'function')
    {
      window.onload = theFunc;
    }
    else
    {
      window.onload = function()
      {
        previous();
        theFunc();
      }
    }
  }

  addOnload(function()
  {
    var base = new Date(1442918127*1000);
    var now = new Date();
    var diff = ((now-base)/1000)/(24*3600);

    if (diff > 90) {
      var nodes = document.getElementsByClassName('titlepage');
      nodes[0].innerHTML = '<p style="border: 5px #ff0000 solid; padding: 5px; margin 5px">' +
        'This copy of the manual is more than 90 days old. We encourage you to download a ' +
        'new version from <a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
    }
  });
</script>
<noscript></noscript>
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 10 章 グローバリゼーション</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="language-structure.html">前</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="data-types.html">次へ</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="globalization"></a>第 10 章 グローバリゼーション</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="section"><a href="globalization.html#charset">10.1 文字セットのサポート</a></span></dt><dd><dl><dt><span class="section"><a href="globalization.html#charset-general">10.1.1 一般の文字セットおよび照合順序</a></span></dt><dt><span class="section"><a href="globalization.html#charset-mysql">10.1.2 MySQL での文字セットと照合順序</a></span></dt><dt><span class="section"><a href="globalization.html#charset-syntax">10.1.3 文字セットと照合順序の指定</a></span></dt><dt><span class="section"><a href="globalization.html#charset-connection">10.1.4 接続文字セットおよび照合順序</a></span></dt><dt><span class="section"><a href="globalization.html#charset-applications">10.1.5 アプリケーションの文字セットおよび照合順序の構成</a></span></dt><dt><span class="section"><a href="globalization.html#charset-errors">10.1.6 エラーメッセージの文字セット</a></span></dt><dt><span class="section"><a href="globalization.html#charset-collations">10.1.7 照合順序の問題</a></span></dt><dt><span class="section"><a href="globalization.html#charset-repertoire">10.1.8 文字列のレパートリー</a></span></dt><dt><span class="section"><a href="globalization.html#charset-operations">10.1.9 文字セットのサポートによる影響を受ける演算</a></span></dt><dt><span class="section"><a href="globalization.html#charset-unicode">10.1.10 Unicode のサポート</a></span></dt><dt><span class="section"><a href="globalization.html#charset-unicode-upgrading">10.1.11 以前の Unicode サポートから現在の Unicode サポートへのアップグレード</a></span></dt><dt><span class="section"><a href="globalization.html#charset-metadata">10.1.12 メタデータ用の UTF-8</a></span></dt><dt><span class="section"><a href="globalization.html#charset-conversion">10.1.13 カラム文字セットの変換</a></span></dt><dt><span class="section"><a href="globalization.html#charset-charsets">10.1.14 MySQL でサポートされる文字セットと照合順序</a></span></dt></dl></dd><dt><span class="section"><a href="globalization.html#error-message-language">10.2 エラーメッセージ言語の設定</a></span></dt><dt><span class="section"><a href="globalization.html#adding-character-set">10.3 文字セットの追加</a></span></dt><dd><dl><dt><span class="section"><a href="globalization.html#character-arrays">10.3.1 文字定義配列</a></span></dt><dt><span class="section"><a href="globalization.html#string-collating">10.3.2 複雑な文字セットの文字列照合のサポート</a></span></dt><dt><span class="section"><a href="globalization.html#multibyte-characters">10.3.3 複雑な文字セットのマルチバイト文字のサポート</a></span></dt></dl></dd><dt><span class="section"><a href="globalization.html#adding-collation">10.4 文字セットへの照合順序の追加</a></span></dt><dd><dl><dt><span class="section"><a href="globalization.html#charset-collation-implementations">10.4.1 照合順序の実装タイプ</a></span></dt><dt><span class="section"><a href="globalization.html#adding-collation-choosing-id">10.4.2 照合順序 ID の選択</a></span></dt><dt><span class="section"><a href="globalization.html#adding-collation-simple-8bit">10.4.3 8 ビットの文字セットへの単純な照合順序の追加</a></span></dt><dt><span class="section"><a href="globalization.html#adding-collation-unicode-uca">10.4.4 Unicode 文字セットへの UCA 照合順序の追加</a></span></dt></dl></dd><dt><span class="section"><a href="globalization.html#charset-configuration">10.5 文字セットの構成</a></span></dt><dt><span class="section"><a href="globalization.html#time-zone-support">10.6 MySQL Server でのタイムゾーンのサポート</a></span></dt><dd><dl><dt><span class="section"><a href="globalization.html#time-zone-upgrades">10.6.1 タイムゾーンの変更による現在の時間の維持</a></span></dt><dt><span class="section"><a href="globalization.html#time-zone-leap-seconds">10.6.2 タイムゾーンのうるう秒のサポート</a></span></dt></dl></dd><dt><span class="section"><a href="globalization.html#locale-support">10.7 MySQL Server のロケールサポート</a></span></dt></dl></div><a class="indexterm" name="idm139979107724896"></a><a class="indexterm" name="idm139979107723440"></a><a class="indexterm" name="idm139979107722096"></a><p>
    この章では、国際化 (各地域での使用に対応するための MySQL の機能) とローカライズ (特定の地域的な規則の選択) を含む、次のようなグローバリゼーションの問題を取り上げます。
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        SQL ステートメント内の文字セットに対する MySQL でのサポート。
      </p></li><li class="listitem"><p>
        さまざまな文字セットをサポートするようにサーバーを構成する方法。
      </p></li><li class="listitem"><p>
        エラーメッセージの言語の選択。
      </p></li><li class="listitem"><p>
        サーバーのタイムゾーンを設定し、接続ごとのタイムゾーンをサポートできるようにする方法。
      </p></li><li class="listitem"><p>
        曜日と月の名前に使用するロケールの選択。
      </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="charset"></a>10.1 文字セットのサポート</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="globalization.html#charset-general">10.1.1 一般の文字セットおよび照合順序</a></span></dt><dt><span class="section"><a href="globalization.html#charset-mysql">10.1.2 MySQL での文字セットと照合順序</a></span></dt><dt><span class="section"><a href="globalization.html#charset-syntax">10.1.3 文字セットと照合順序の指定</a></span></dt><dt><span class="section"><a href="globalization.html#charset-connection">10.1.4 接続文字セットおよび照合順序</a></span></dt><dt><span class="section"><a href="globalization.html#charset-applications">10.1.5 アプリケーションの文字セットおよび照合順序の構成</a></span></dt><dt><span class="section"><a href="globalization.html#charset-errors">10.1.6 エラーメッセージの文字セット</a></span></dt><dt><span class="section"><a href="globalization.html#charset-collations">10.1.7 照合順序の問題</a></span></dt><dt><span class="section"><a href="globalization.html#charset-repertoire">10.1.8 文字列のレパートリー</a></span></dt><dt><span class="section"><a href="globalization.html#charset-operations">10.1.9 文字セットのサポートによる影響を受ける演算</a></span></dt><dt><span class="section"><a href="globalization.html#charset-unicode">10.1.10 Unicode のサポート</a></span></dt><dt><span class="section"><a href="globalization.html#charset-unicode-upgrading">10.1.11 以前の Unicode サポートから現在の Unicode サポートへのアップグレード</a></span></dt><dt><span class="section"><a href="globalization.html#charset-metadata">10.1.12 メタデータ用の UTF-8</a></span></dt><dt><span class="section"><a href="globalization.html#charset-conversion">10.1.13 カラム文字セットの変換</a></span></dt><dt><span class="section"><a href="globalization.html#charset-charsets">10.1.14 MySQL でサポートされる文字セットと照合順序</a></span></dt></dl></div><a class="indexterm" name="idm139979107713520"></a><a class="indexterm" name="idm139979107712096"></a><a class="indexterm" name="idm139979107710864"></a><a class="indexterm" name="idm139979107709520"></a><p>
      MySQL では、さまざまな文字セットを使用してデータを格納し、さまざまな照合順序に従って比較を実行できます。サーバー、データベース、テーブル、およびカラムレベルで文字セットを指定できます。MySQL では、<code class="literal">MyISAM</code>、<code class="literal">MEMORY</code>、および <code class="literal">InnoDB</code> のストレージエンジンの文字セットの使用をサポートします。
    </p><p>
      この章では次のトピックについて説明します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          文字セットと照合順序とは。
        </p></li><li class="listitem"><p>
          文字セットの割り当てに対する複数レベルのデフォルトシステム。
        </p></li><li class="listitem"><p>
          文字セットと照合順序を指定するための構文。
        </p></li><li class="listitem"><p>
          影響を受ける関数と演算。
        </p></li><li class="listitem"><p>
          Unicode のサポート。
        </p></li><li class="listitem"><p>
          使用可能な文字セットと照合順序 (ノート付き)。
        </p></li></ul></div><p>
      文字セットの問題は、データストレージだけではなく、クライアントプログラムと MySQL Server との通信にも影響を与えます。デフォルトと異なる文字セットを使用してクライアントプログラムとサーバー間の通信を行う場合、どの文字セットを使用するのかを示す必要があります。たとえば、<code class="literal">utf8</code> Unicode 文字セットを使用するには、サーバー接続後に次のステートメントを発行してください。
    </p><pre class="programlisting">
SET NAMES 'utf8';
</pre><p>
      アプリケーションで使用する文字セットの構成と、クライアント/サーバー間の通信に関する文字セット関連の問題の詳細は、<a class="xref" href="globalization.html#charset-applications" title="10.1.5 アプリケーションの文字セットおよび照合順序の構成">セクション10.1.5「アプリケーションの文字セットおよび照合順序の構成」</a>および<a class="xref" href="globalization.html#charset-connection" title="10.1.4 接続文字セットおよび照合順序">セクション10.1.4「接続文字セットおよび照合順序」</a>を参照してください。
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-general"></a>10.1.1 一般の文字セットおよび照合順序</h3></div></div></div><p>
        <em class="firstterm">文字セット</em>とは、記号とエンコーディングのセットです。<em class="firstterm">照合順序</em>とは、文字セット内の文字を比較するためのルールを集めたものです。架空の文字セットを例にして、文字セットと照合順序の違いを見てみましょう。
      </p><p>
        <span class="quote">「<span class="quote"><code class="literal">A</code></span>」</span>、<span class="quote">「<span class="quote"><code class="literal">B</code></span>」</span>、<span class="quote">「<span class="quote"><code class="literal">a</code></span>」</span>、<span class="quote">「<span class="quote"><code class="literal">b</code></span>」</span>の 4 つのアルファベットがあるとします。それぞれの文字に <span class="quote">「<span class="quote"><code class="literal">A</code></span>」</span> = 0、<span class="quote">「<span class="quote"><code class="literal">B</code></span>」</span> = 1、<span class="quote">「<span class="quote"><code class="literal">a</code></span>」</span> = 2、<span class="quote">「<span class="quote"><code class="literal">b</code></span>」</span> = 3 の数字を割り当てます。文字<span class="quote">「<span class="quote"><code class="literal">A</code></span>」</span>は記号で、数字 0 は<span class="quote">「<span class="quote"><code class="literal">A</code></span>」</span>に対する<span class="bold"><strong>エンコーディング</strong></span>であり、4 つの文字とそのエンコーディングの組み合わせが<span class="bold"><strong>文字セット</strong></span>になります。
      </p><p>
        <span class="quote">「<span class="quote"><code class="literal">A</code></span>」</span>と<span class="quote">「<span class="quote"><code class="literal">B</code></span>」</span>の 2 つの文字列値を比較するとします。これを行うには、<span class="quote">「<span class="quote"><code class="literal">A</code></span>」</span>の 0、<span class="quote">「<span class="quote"><code class="literal">B</code></span>」</span>の 1 というエンコーディングを調べる方法がもっとも簡単です。0 は 1 より小さいので、<span class="quote">「<span class="quote"><code class="literal">A</code></span>」</span>は<span class="quote">「<span class="quote"><code class="literal">B</code></span>」</span>より小さいと見なします。今ここで行なったのは、文字セットに対する照合順序の適用です。照合順序はルールの集まりであり、この場合、ルールは<span class="quote">「<span class="quote">エンコーディングの比較</span>」</span>の 1 つだけになります。これは可能な照合順序のうちでもっとも単純なものであり、<em class="firstterm">バイナリ</em>照合順序と呼ばれています。
      </p><p>
        しかし、小文字と大文字が同等であることを表すにはどうなるのでしょうか。この場合、少なくとも次の 2 つのルールが必要です。(1) 小文字<span class="quote">「<span class="quote"><code class="literal">a</code></span>」</span>および<span class="quote">「<span class="quote"><code class="literal">b</code></span>」</span>を<span class="quote">「<span class="quote"><code class="literal">A</code></span>」</span>および<span class="quote">「<span class="quote"><code class="literal">B</code></span>」</span>と同等のものとして扱います。(2) 続いてそのエンコーディングを比較します。これは<em class="firstterm">大文字と小文字を区別しない</em>照合順序と呼ばれます。バイナリ照合順序よりも少し複雑になります。
      </p><p>
        実際には、ほとんどの文字セットには多数の文字があり、<span class="quote">「<span class="quote"><code class="literal">A</code></span>」</span>と<span class="quote">「<span class="quote"><code class="literal">B</code></span>」</span>だけではなくアルファベット全体が含まれます。複数のアルファベットが含まれる場合も、数千種類の文字や多くの特殊記号および句読点から構成される東洋書記体系の場合もあります。また実際には、ほとんどの照合順序は、大文字と小文字の区別だけでなく、アクセント符号 (<span class="quote">「<span class="quote">アクセント符号</span>」</span>とはドイツ語の<span class="quote">「<span class="quote"><code class="literal">Ö</code></span>」</span>に見られるような文字に付けられた符号です) を区別するかどうかに関するルールや、複数文字のマッピングのルール (2 つのドイツ語の照合順序の一方における<span class="quote">「<span class="quote"><code class="literal">Ö</code></span>」</span> = <span class="quote">「<span class="quote"><code class="literal">OE</code></span>」</span>というルールなど) など多くのルールを含んでいます。
      </p><p>
        MySQL では以下が可能です。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            さまざまな文字セットを使用して文字列を格納します。
          </p></li><li class="listitem"><p>
            さまざまな照合順序を使用して文字列を比較します。
          </p></li><li class="listitem"><p>
            文字セットまたは照合順序が異なる文字列を、同じサーバー、同じデータベース、または同じテーブル内にも混在させます。
          </p></li><li class="listitem"><p>
            どのレベルでも文字セットと照合順序を指定できるようにします。
          </p></li></ul></div><p>
        MySQL はこれらの点において、ほかのほとんどのデータベース管理システムに大きく差をつけています。ただし、これらの機能を効果的に使用するには、利用可能な文字セットと照合順序、各デフォルトの変更方法、および文字列演算子および関数の動作にこれらの機能が与える影響を知っておく必要があります。
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-mysql"></a>10.1.2 MySQL での文字セットと照合順序</h3></div></div></div><p>
        MySQL Server では複数の文字セットがサポートされています。利用可能な文字セットを一覧表示するには、<code class="literal">SHOW CHARACTER SET</code> ステートメントを使用します。リストの一部は次のとおりです。完全な情報については、<a class="xref" href="globalization.html#charset-charsets" title="10.1.14 MySQL でサポートされる文字セットと照合順序">セクション10.1.14「MySQL でサポートされる文字セットと照合順序」</a>を参照してください。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW CHARACTER SET;</code></strong>
+----------+-----------------------------+---------------------+--------+
| Charset  | Description                 | Default collation   | Maxlen |
+----------+-----------------------------+---------------------+--------+
| big5     | Big5 Traditional Chinese    | big5_chinese_ci     |      2 |
| dec8     | DEC West European           | dec8_swedish_ci     |      1 |
| cp850    | DOS West European           | cp850_general_ci    |      1 |
| hp8      | HP West European            | hp8_english_ci      |      1 |
| koi8r    | KOI8-R Relcom Russian       | koi8r_general_ci    |      1 |
| latin1   | cp1252 West European        | latin1_swedish_ci   |      1 |
| latin2   | ISO 8859-2 Central European | latin2_general_ci   |      1 |
| swe7     | 7bit Swedish                | swe7_swedish_ci     |      1 |
| ascii    | US ASCII                    | ascii_general_ci    |      1 |
| ujis     | EUC-JP Japanese             | ujis_japanese_ci    |      3 |
| sjis     | Shift-JIS Japanese          | sjis_japanese_ci    |      2 |
| hebrew   | ISO 8859-8 Hebrew           | hebrew_general_ci   |      1 |
| tis620   | TIS620 Thai                 | tis620_thai_ci      |      1 |
| euckr    | EUC-KR Korean               | euckr_korean_ci     |      2 |
| koi8u    | KOI8-U Ukrainian            | koi8u_general_ci    |      1 |
| gb2312   | GB2312 Simplified Chinese   | gb2312_chinese_ci   |      2 |
| greek    | ISO 8859-7 Greek            | greek_general_ci    |      1 |
| cp1250   | Windows Central European    | cp1250_general_ci   |      1 |
| gbk      | GBK Simplified Chinese      | gbk_chinese_ci      |      2 |
| latin5   | ISO 8859-9 Turkish          | latin5_turkish_ci   |      1 |
...
</pre><p>
        どの文字セットにも常に少なくとも 1 つの照合順序が対応しています。複数の照合順序が対応することもあります。文字セットの照合順序を一覧表示するには、<code class="literal">SHOW COLLATION</code> ステートメントを使用します。たとえば、<code class="literal">latin1</code> (cp1252 西ヨーロッパ言語) 文字セットの照合順序を表示するには、このステートメントを使用して、名前が <code class="literal">latin1</code> で始まる照合順序を探します。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW COLLATION LIKE 'latin1%';</code></strong>
+---------------------+---------+----+---------+----------+---------+
| Collation           | Charset | Id | Default | Compiled | Sortlen |
+---------------------+---------+----+---------+----------+---------+
| latin1_german1_ci   | latin1  |  5 |         |          |       0 |
| latin1_swedish_ci   | latin1  |  8 | Yes     | Yes      |       1 |
| latin1_danish_ci    | latin1  | 15 |         |          |       0 |
| latin1_german2_ci   | latin1  | 31 |         | Yes      |       2 |
| latin1_bin          | latin1  | 47 |         | Yes      |       1 |
| latin1_general_ci   | latin1  | 48 |         |          |       0 |
| latin1_general_cs   | latin1  | 49 |         |          |       0 |
| latin1_spanish_ci   | latin1  | 94 |         |          |       0 |
+---------------------+---------+----+---------+----------+---------+
</pre><p>
        <code class="literal">latin1</code> の照合順序の意味は次のとおりです。
      </p><div class="informaltable"><table summary="この表には、上の例で説明した、latin1 文字セットの照合順序が一覧表示され、各照合順序の意味が示されています。" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">照合順序</th><th scope="col">意味</th></tr></thead><tbody><tr><td scope="row"><code class="literal">latin1_german1_ci</code></td><td>ドイツ語 DIN-1</td></tr><tr><td scope="row"><code class="literal">latin1_swedish_ci</code></td><td>スウェーデン語/フィンランド語</td></tr><tr><td scope="row"><code class="literal">latin1_danish_ci</code></td><td>デンマーク語/ノルウェー語</td></tr><tr><td scope="row"><code class="literal">latin1_german2_ci</code></td><td>ドイツ語 DIN-2</td></tr><tr><td scope="row"><code class="literal">latin1_bin</code></td><td><code class="literal">latin1</code> エンコーディングに基づくバイナリ</td></tr><tr><td scope="row"><code class="literal">latin1_general_ci</code></td><td>マルチリンガル (西ヨーロッパ言語)</td></tr><tr><td scope="row"><code class="literal">latin1_general_cs</code></td><td>マルチリンガル (ISO 西ヨーロッパ言語)、大文字と小文字を区別</td></tr><tr><td scope="row"><code class="literal">latin1_spanish_ci</code></td><td>現代スペイン語</td></tr></tbody></table></div><p>
        照合順序には次のような一般的な特徴があります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            2 つの異なる文字セットで、同じ照合順序を共有できません。
          </p></li><li class="listitem"><p>
            各文字セットには、<span class="emphasis"><em>デフォルト照合順序</em></span>が 1 つ存在します。たとえば、<code class="literal">latin1</code> のデフォルト照合順序は <code class="literal">latin1_swedish_ci</code> です。<code class="literal">SHOW CHARACTER SET</code> の出力には、表示されている各文字セットのデフォルト照合順序が示されます。
          </p></li><li class="listitem"><p>
            照合順序名には、関連する文字セットの名前で始まる、通常は言語名を含む、<code class="literal">_ci</code> (大文字と小文字を区別しない)、<code class="literal">_cs</code> (大文字と小文字を区別する)、<code class="literal">_bin</code> (バイナリ) のいずれかで終わる、という規則が適用されます。
          </p></li></ul></div><p>
        文字セットに複数の照合順序が存在する場合、どの照合順序が所定のアプリケーションにもっとも適しているかが明確でないことがあります。正しくない照合順序を選択しないようにするには、代表的なデータ値で比較を行い、特定の照合順序で期待どおりに値がソートされることを確認すると役立ちます。
      </p><p>
        <a class="ulink" href="http://www.collation-charts.org/" target="_top">Collation-Charts.Org</a> は、ある照合順序と別の照合順序との比較を示す有用な情報サイトです。
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-syntax"></a>10.1.3 文字セットと照合順序の指定</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="globalization.html#charset-server">10.1.3.1 サーバー文字セットおよび照合順序</a></span></dt><dt><span class="section"><a href="globalization.html#charset-database">10.1.3.2 データベース文字セットおよび照合順序</a></span></dt><dt><span class="section"><a href="globalization.html#charset-table">10.1.3.3 テーブル文字セットおよび照合順序</a></span></dt><dt><span class="section"><a href="globalization.html#charset-column">10.1.3.4 カラム文字セットおよび照合順序</a></span></dt><dt><span class="section"><a href="globalization.html#charset-literal">10.1.3.5 文字列リテラルの文字セットおよび照合順序</a></span></dt><dt><span class="section"><a href="globalization.html#charset-national">10.1.3.6 各国文字セット</a></span></dt><dt><span class="section"><a href="globalization.html#charset-examples">10.1.3.7 文字セットと照合順序の割り当ての例</a></span></dt><dt><span class="section"><a href="globalization.html#charset-compatibility">10.1.3.8 ほかの DBMS との互換性</a></span></dt></dl></div><p>
        サーバー、データベース、テーブル、カラムの 4 つのレベルで、文字セットと照合順序のデフォルト設定が用意されています。以降のセクションの説明は複雑に思われますが、実際、複数レベルのデフォルト設定によって自然で明白な結果が得られることがわかっています。
      </p><p>
        <code class="literal">CHARACTER SET</code> は文字セットを指定する句で使用します。<code class="literal">CHARSET</code> は、<code class="literal">CHARACTER SET</code> のシノニムとして使用できます。
      </p><p>
        文字セットの問題は、データストレージだけではなく、クライアントプログラムと MySQL Server との通信にも影響を与えます。デフォルトと異なる文字セットを使用してクライアントプログラムとサーバー間の通信を行う場合、どの文字セットを使用するのかを示す必要があります。たとえば、<code class="literal">utf8</code> Unicode 文字セットを使用するには、サーバー接続後に次のステートメントを発行してください。
      </p><pre class="programlisting">
SET NAMES 'utf8';
</pre><p>
        クライアント/サーバー間の通信に関する文字セット関連の問題の詳細は、<a class="xref" href="globalization.html#charset-connection" title="10.1.4 接続文字セットおよび照合順序">セクション10.1.4「接続文字セットおよび照合順序」</a>を参照してください。
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-server"></a>10.1.3.1 サーバー文字セットおよび照合順序</h4></div></div></div><p>
          MySQL Server にはサーバー文字セットとサーバー照合順序があります。これらは、コマンド行またはオプションファイルで、サーバーの起動時に設定し、実行時に変更できます。
        </p><p>
          サーバー文字セットおよび照合順序は最初、<span class="command"><strong>mysqld</strong></span> の起動時に使用するオプションに依存します。文字セットに <code class="option">--character-set-server</code> を使用できます。これに加え、照合順序に <code class="option">--collation-server</code> を追加できます。文字セットを指定しない場合は、<code class="option">--character-set-server=latin1</code> を指定した場合と同じになります。文字セット (たとえば <code class="literal">latin1</code>) だけを指定して照合順序を指定しない場合は、<code class="option">--character-set-server=latin1</code> <code class="option">--collation-server=latin1_swedish_ci</code> を指定した場合と同じになります。これは <code class="literal">latin1_swedish_ci</code> が <code class="literal">latin1</code> のデフォルト照合順序であるためです。したがって、次の 3 つのコマンドを実行した結果はいずれも同じになります。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysqld</code></strong>
shell&gt; <strong class="userinput"><code>mysqld --character-set-server=latin1</code></strong>
shell&gt; <strong class="userinput"><code>mysqld --character-set-server=latin1 \</code></strong>
           <strong class="userinput"><code>--collation-server=latin1_swedish_ci</code></strong>
</pre><p>
          設定を変更する手段の 1 つは再コンパイルです。ソースから構築するときに、デフォルトのサーバー文字セットおよび照合順序を変更するには、<span class="command"><strong>CMake</strong></span> の <code class="option">DEFAULT_CHARSET</code> および <code class="option">DEFAULT_COLLATION</code> オプションを使用します。例:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>cmake . -DDEFAULT_CHARSET=latin1</code></strong>
</pre><p>
          または:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>cmake . -DDEFAULT_CHARSET=latin1 \</code></strong>
           <strong class="userinput"><code>-DDEFAULT_COLLATION=latin1_german1_ci</code></strong>
</pre><p>
          <span class="command"><strong>mysqld</strong></span> と <span class="command"><strong>CMake</strong></span> の両方は、文字セットと照合順序の組み合わせが有効であることを検証します。組み合わせが有効でない場合、各プログラムによってエラーメッセージが表示され、強制終了されます。
        </p><p>
          サーバー文字セットおよび照合順序は、データベース文字セットおよび照合順序が <code class="literal">CREATE DATABASE</code> ステートメントで指定されていない場合にデフォルト値として使用されます。これらにほかの用途はありません。
        </p><p>
          現在のサーバー文字セットおよび照合順序は、<code class="literal">character_set_server</code> および <code class="literal">collation_server</code> システム変数の値で判別できます。これらの変数は実行時に変更できます。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-database"></a>10.1.3.2 データベース文字セットおよび照合順序</h4></div></div></div><p>
          各データベースにはデータベース文字セットとデータベース照合順序があります。<code class="literal">CREATE DATABASE</code> および <code class="literal">ALTER DATABASE</code> ステートメントには、データベース文字セットおよび照合順序を指定するためのオプション句があります。
        </p><pre class="programlisting">
CREATE DATABASE <em class="replaceable"><code>db_name</code></em>
    [[DEFAULT] CHARACTER SET <em class="replaceable"><code>charset_name</code></em>]
    [[DEFAULT] COLLATE <em class="replaceable"><code>collation_name</code></em>]

ALTER DATABASE <em class="replaceable"><code>db_name</code></em>
    [[DEFAULT] CHARACTER SET <em class="replaceable"><code>charset_name</code></em>]
    [[DEFAULT] COLLATE <em class="replaceable"><code>collation_name</code></em>]
</pre><p>
          <code class="literal">SCHEMA</code> というキーワードは <code class="literal">DATABASE</code> の代わりに使用できます。
        </p><p>
          すべてのデータベースオプションは、データベースディレクトリ内の <code class="filename">db.opt</code> というテキストファイルに格納されます。
        </p><p>
          <code class="literal">CHARACTER SET</code> および <code class="literal">COLLATE</code> 句を使用すると、文字セットと照合順序が異なる複数のデータベースを同一の MySQL Server に作成できます。
        </p><p>
          例:
        </p><pre class="programlisting">
CREATE DATABASE <em class="replaceable"><code>db_name</code></em> CHARACTER SET latin1 COLLATE latin1_swedish_ci;
</pre><p>
          MySQL では、データベース文字セットとデータベース照合順序が次のように選択されます。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">CHARACTER SET <em class="replaceable"><code>X</code></em></code> と <code class="literal">COLLATE <em class="replaceable"><code>Y</code></em></code> の両方が指定されている場合、文字セット <em class="replaceable"><code>X</code></em> と照合順序 <em class="replaceable"><code>Y</code></em> が使用されます。
            </p></li><li class="listitem"><p>
              <code class="literal">CHARACTER SET <em class="replaceable"><code>X</code></em></code> は指定されているが <code class="literal">COLLATE</code> は指定されていない場合、文字セット <em class="replaceable"><code>X</code></em> とそのデフォルト照合順序が使用されます。各文字セットのデフォルトの照合順序を確認するには、<code class="literal">SHOW COLLATION</code> ステートメントを使用します。
            </p></li><li class="listitem"><p>
              <code class="literal">COLLATE <em class="replaceable"><code>Y</code></em></code> は指定されているが <code class="literal">CHARACTER SET</code> は指定されていない場合、<em class="replaceable"><code>Y</code></em> に関連付けられた文字セットと照合順序 <em class="replaceable"><code>Y</code></em> が使用されます。
            </p></li><li class="listitem"><p>
              これ以外の場合は、サーバー文字セットとサーバー照合順序が使用されます。
            </p></li></ul></div><p>
          デフォルトのデータベースに対する文字セットと照合順序は、<code class="literal">character_set_database</code> および <code class="literal">collation_database</code> システム変数の値から判別できます。デフォルトのデータベースが変わるたびに、サーバーはこれらの変数を設定します。デフォルトのデータベースがない場合、変数は、<code class="literal">character_set_server</code> および <code class="literal">collation_server</code> という対応するサーバーレベルのシステム変数と同値になります。
        </p><p>
          特定のデータベースのデフォルト文字セットおよび照合順序を確認するには、次のステートメントを使用します。
        </p><pre class="programlisting">
USE <em class="replaceable"><code>db_name</code></em>;
SELECT @@character_set_database, @@collation_database;
</pre><p>
          また、デフォルトのデータベースを変更しないで値を表示するには、次のステートメントを使用します。
        </p><pre class="programlisting">
SELECT DEFAULT_CHARACTER_SET_NAME, DEFAULT_COLLATION_NAME
FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME = '<em class="replaceable"><code>db_name</code></em>';
</pre><p>
          データベース文字セットおよび照合順序は、サーバー操作の次の側面に影響します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">CREATE TABLE</code> ステートメントでは、テーブル文字セットおよび照合順序が指定されていない場合、データベース文字セットおよび照合順序がテーブル定義のデフォルト値として使用されます。これをオーバーライドするには、<code class="literal">CHARACTER SET</code> および <code class="literal">COLLATE</code> テーブルオプションを明示的に指定します。
            </p></li><li class="listitem"><p>
              <code class="literal">CHARACTER SET</code> 句を含まない <code class="literal">LOAD DATA</code> ステートメントでは、サーバーは、<code class="literal">character_set_database</code> システム変数によって示された文字セットを使用して、ファイル内の情報を解釈します。これをオーバーライドするには、<code class="literal">CHARACTER SET</code> 句を明示的に指定します。
            </p></li><li class="listitem"><p>
              ストアドルーチン (ストアドプロシージャーおよびストアドファンクション) では、<code class="literal">CHARACTER SET</code> 属性も <code class="literal">COLLATE</code> 属性も宣言に含まれていない文字データパラメータの文字セットおよび照合順序として、ルーチンの作成時に有効なデータベース文字セットおよび照合順序が使用されます。これをオーバーライドするには、<code class="literal">CHARACTER SET</code> および <code class="literal">COLLATE</code> 属性を明示的に指定します。
            </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-table"></a>10.1.3.3 テーブル文字セットおよび照合順序</h4></div></div></div><p>
          各テーブルにはテーブル文字セットとテーブル照合順序があります。<code class="literal">CREATE TABLE</code> および <code class="literal">ALTER TABLE</code> ステートメントには、テーブル文字セットおよび照合順序を指定するためのオプション句があります。
        </p><pre class="programlisting">
CREATE TABLE <em class="replaceable"><code>tbl_name</code></em> (<em class="replaceable"><code>column_list</code></em>)
    [[DEFAULT] CHARACTER SET <em class="replaceable"><code>charset_name</code></em>]
    [COLLATE <em class="replaceable"><code>collation_name</code></em>]]

ALTER TABLE <em class="replaceable"><code>tbl_name</code></em>
    [[DEFAULT] CHARACTER SET <em class="replaceable"><code>charset_name</code></em>]
    [COLLATE <em class="replaceable"><code>collation_name</code></em>]
</pre><p>
          例:
        </p><pre class="programlisting">
CREATE TABLE t1 ( ... )
CHARACTER SET latin1 COLLATE latin1_danish_ci;
</pre><p>
          MySQL では、テーブル文字セットとテーブル照合順序が次のように選択されます。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">CHARACTER SET <em class="replaceable"><code>X</code></em></code> と <code class="literal">COLLATE <em class="replaceable"><code>Y</code></em></code> の両方が指定されている場合、文字セット <em class="replaceable"><code>X</code></em> と照合順序 <em class="replaceable"><code>Y</code></em> が使用されます。
            </p></li><li class="listitem"><p>
              <code class="literal">CHARACTER SET <em class="replaceable"><code>X</code></em></code> は指定されているが <code class="literal">COLLATE</code> は指定されていない場合、文字セット <em class="replaceable"><code>X</code></em> とそのデフォルト照合順序が使用されます。各文字セットのデフォルトの照合順序を確認するには、<code class="literal">SHOW COLLATION</code> ステートメントを使用します。
            </p></li><li class="listitem"><p>
              <code class="literal">COLLATE <em class="replaceable"><code>Y</code></em></code> は指定されているが <code class="literal">CHARACTER SET</code> は指定されていない場合、<em class="replaceable"><code>Y</code></em> に関連付けられた文字セットと照合順序 <em class="replaceable"><code>Y</code></em> が使用されます。
            </p></li><li class="listitem"><p>
              これ以外の場合は、データベース文字セットとデータベース照合順序が使用されます。
            </p></li></ul></div><p>
          個々のカラム定義でカラム文字セットおよび照合順序が指定されていない場合は、テーブル文字セットおよび照合順序がカラム定義のデフォルト値として使用されます。テーブル文字セットおよび照合順序は MySQL の拡張機能です。このような機能は標準 SQL には存在しません。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-column"></a>10.1.3.4 カラム文字セットおよび照合順序</h4></div></div></div><p>
          各<span class="quote">「<span class="quote">文字</span>」</span>カラム (<code class="literal">CHAR</code>、<code class="literal">VARCHAR</code>、または <code class="literal">TEXT</code> 型のカラム) にはカラム文字セットとカラム照合順序があります。<code class="literal">CREATE TABLE</code> および <code class="literal">ALTER TABLE</code> のカラム定義構文には、カラム文字セットおよび照合順序を指定するためのオプション句があります。
        </p><pre class="programlisting">
<em class="replaceable"><code>col_name</code></em> {CHAR | VARCHAR | TEXT} (<em class="replaceable"><code>col_length</code></em>)
    [CHARACTER SET <em class="replaceable"><code>charset_name</code></em>]
    [COLLATE <em class="replaceable"><code>collation_name</code></em>]
</pre><p>
          これらの句は、<code class="literal">ENUM</code> および <code class="literal">SET</code> カラムにも使用できます。
        </p><pre class="programlisting">
<em class="replaceable"><code>col_name</code></em> {ENUM | SET} (<em class="replaceable"><code>val_list</code></em>)
    [CHARACTER SET <em class="replaceable"><code>charset_name</code></em>]
    [COLLATE <em class="replaceable"><code>collation_name</code></em>]
</pre><p>
          例:
        </p><pre class="programlisting">
CREATE TABLE t1
(
    col1 VARCHAR(5)
      CHARACTER SET latin1
      COLLATE latin1_german1_ci
);

ALTER TABLE t1 MODIFY
    col1 VARCHAR(5)
      CHARACTER SET latin1
      COLLATE latin1_swedish_ci;
</pre><p>
          MySQL では、カラム文字セットとカラム照合順序が次のように選択されます。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">CHARACTER SET <em class="replaceable"><code>X</code></em></code> と <code class="literal">COLLATE <em class="replaceable"><code>Y</code></em></code> の両方が指定されている場合、文字セット <em class="replaceable"><code>X</code></em> と照合順序 <em class="replaceable"><code>Y</code></em> が使用されます。
            </p><pre class="programlisting">
CREATE TABLE t1
(
    col1 CHAR(10) CHARACTER SET utf8 COLLATE utf8_unicode_ci
) CHARACTER SET latin1 COLLATE latin1_bin;
</pre><p>
              カラムに対して文字セットと照合順序が指定されているので、これらが使用されます。このカラムには、文字セット <code class="literal">utf8</code> と照合順序 <code class="literal">utf8_unicode_ci</code> があります。
            </p></li><li class="listitem"><p>
              <code class="literal">CHARACTER SET <em class="replaceable"><code>X</code></em></code> は指定されているが <code class="literal">COLLATE</code> は指定されていない場合、文字セット <em class="replaceable"><code>X</code></em> とそのデフォルト照合順序が使用されます。
            </p><pre class="programlisting">
CREATE TABLE t1
(
    col1 CHAR(10) CHARACTER SET utf8
) CHARACTER SET latin1 COLLATE latin1_bin;
</pre><p>
              カラムに対して文字セットは指定されていますが、照合順序は指定されていません。このカラムには、文字セット <code class="literal">utf8</code> と、<code class="literal">utf8</code> のデフォルトの照合順序である <code class="literal">utf8_general_ci</code> があります。各文字セットのデフォルトの照合順序を確認するには、<code class="literal">SHOW COLLATION</code> ステートメントを使用します。
            </p></li><li class="listitem"><p>
              <code class="literal">COLLATE <em class="replaceable"><code>Y</code></em></code> は指定されているが <code class="literal">CHARACTER SET</code> は指定されていない場合、<em class="replaceable"><code>Y</code></em> に関連付けられた文字セットと照合順序 <em class="replaceable"><code>Y</code></em> が使用されます。
            </p><pre class="programlisting">
CREATE TABLE t1
(
    col1 CHAR(10) COLLATE utf8_polish_ci
) CHARACTER SET latin1 COLLATE latin1_bin;
</pre><p>
              カラムに対して照合順序は指定されていますが、文字セットは指定されていません。このカラムには照合順序 <code class="literal">utf8_polish_ci</code> があり、この照合順序に関連付けられた文字セットである <code class="literal">utf8</code> があります。
            </p></li><li class="listitem"><p>
              これ以外の場合は、テーブル文字セットとテーブル照合順序が使用されます。
            </p><pre class="programlisting">
CREATE TABLE t1
(
    col1 CHAR(10)
) CHARACTER SET latin1 COLLATE latin1_bin;
</pre><p>
              カラムに対して文字セットも照合順序も指定されていないので、テーブルのデフォルトが使用されます。このカラムには、文字セット <code class="literal">latin1</code> と照合順序 <code class="literal">latin1_bin</code> があります。
            </p></li></ul></div><p>
          <code class="literal">CHARACTER SET</code> および <code class="literal">COLLATE</code> 句は標準 SQL です。
        </p><p>
          <code class="literal">ALTER TABLE</code> を使用して、ある文字セットから別の文字セットにカラムを変換する場合、MySQL はデータ値をマップしようとしますが、文字セットに互換性がない場合、データの損失が生じる可能性があります。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-literal"></a>10.1.3.5 文字列リテラルの文字セットおよび照合順序</h4></div></div></div><p>
          各文字列リテラルには文字セットと照合順序があります。
        </p><p>
          文字列リテラルでは、オプションとして文字セットイントロデューサと <code class="literal">COLLATE</code> 句を指定できます。
        </p><a class="indexterm" name="idm139979107447168"></a><a class="indexterm" name="idm139979107444976"></a><pre class="programlisting">
[_<em class="replaceable"><code>charset_name</code></em>]'<em class="replaceable"><code>string</code></em>' [COLLATE <em class="replaceable"><code>collation_name</code></em>]
</pre><p>
          例:
        </p><pre class="programlisting">
SELECT '<em class="replaceable"><code>string</code></em>';
SELECT _latin1'<em class="replaceable"><code>string</code></em>';
SELECT _latin1'<em class="replaceable"><code>string</code></em>' COLLATE latin1_danish_ci;
</pre><p>
          単純なステートメント <code class="literal">SELECT '<em class="replaceable"><code>string</code></em>'</code> に対して、文字列には <code class="literal">character_set_connection</code> および <code class="literal">collation_connection</code> システム変数で定義された文字セットと照合順序が適用されます。
        </p><p>
          <code class="literal">_<em class="replaceable"><code>charset_name</code></em></code> 式は正式には<span class="emphasis"><em>イントロデューサ</em></span>と呼ばれます。これは、<span class="quote">「<span class="quote">後続する文字列が文字セット <em class="replaceable"><code>X</code></em> を使用する</span>」</span>ことをパーサーに通知します。わかりにくいので強調しておきますが、イントロデューサは、<code class="literal">CONVERT()</code> が行うようなイントロデューサ文字セットへの文字列の変換は行いません。パディングが行われる可能性がありますが、文字列の値は変更しません。イントロデューサは単なる信号です。イントロデューサは、標準の 16 進リテラルおよび数値の 16 進リテラル表記 (<code class="literal">x'<em class="replaceable"><code>literal</code></em>'</code> および <code class="literal">0x<em class="replaceable"><code>nnnn</code></em></code>) の前でも、ビットフィールドリテラル表記 (<code class="literal">b'<em class="replaceable"><code>literal</code></em>'</code> および <code class="literal">0b<em class="replaceable"><code>nnnn</code></em></code>) の前でも有効です。
        </p><p>
          例:
        </p><pre class="programlisting">
SELECT _latin1 x'AABBCC';
SELECT _latin1 0xAABBCC;
SELECT _latin1 b'1100011';
SELECT _latin1 0b1100011;
</pre><p>
          MySQL では、リテラルの文字セットおよび照合順序が次のように決定されます。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <em class="replaceable"><code>_X</code></em> と <code class="literal">COLLATE <em class="replaceable"><code>Y</code></em></code> の両方が指定されている場合、文字セット <em class="replaceable"><code>X</code></em> と照合順序 <em class="replaceable"><code>Y</code></em> が使用されます。
            </p></li><li class="listitem"><p>
              <em class="replaceable"><code>_X</code></em> は指定されているが、<code class="literal">COLLATE</code> が指定されていない場合、文字セット <em class="replaceable"><code>X</code></em> とそのデフォルト照合順序が使用されます。各文字セットのデフォルトの照合順序を確認するには、<code class="literal">SHOW COLLATION</code> ステートメントを使用します。
            </p></li><li class="listitem"><p>
              これ以外の場合は、<code class="literal">character_set_connection</code> および <code class="literal">collation_connection</code> システム変数で指定される文字セットと照合順序が使用されます。
            </p></li></ul></div><p>
          例:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              文字列に <code class="literal">latin1</code> 文字セットと <code class="literal">latin1_german1_ci</code> 照合順序が指定されている場合
            </p><pre class="programlisting">
SELECT _latin1'Müller' COLLATE latin1_german1_ci;
</pre></li><li class="listitem"><p>
              文字列に <code class="literal">latin1</code> 文字セットとそのデフォルト照合順序 (つまり、<code class="literal">latin1_swedish_ci</code>) が指定されている場合
            </p><pre class="programlisting">
SELECT _latin1'Müller';
</pre></li><li class="listitem"><p>
              文字列に接続デフォルト文字セットおよび照合順序が指定されている場合
            </p><pre class="programlisting">
SELECT 'Müller';
</pre></li></ul></div><p>
          文字セットイントロデューサと <code class="literal">COLLATE</code> 句は、標準 SQL 仕様に基づいて実装されています。
        </p><p>
          イントロデューサは後続の文字列の文字セットを指定しますが、現在のところ、その文字列内でパーサーがエスケープ処理を実行する方法までは変更しません。エスケープは常に、<code class="literal">character_set_connection</code> で指定された文字セットに従ってパーサーが解釈します。
        </p><p>
          次の例は、イントロデューサが存在する場合でも、<code class="literal">character_set_connection</code> を使用して、エスケープ処理が行われることを示します。例では、<code class="literal">SET NAMES</code> (<a class="xref" href="globalization.html#charset-connection" title="10.1.4 接続文字セットおよび照合順序">セクション10.1.4「接続文字セットおよび照合順序」</a>で説明しているように、<code class="literal">character_set_connection</code> を変更します) を使用し、正確な文字列の内容を確認できるように <code class="literal">HEX()</code> 関数を使用して結果の文字列を表示します。
        </p><p>
          例 1:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET NAMES latin1;</code></strong>
Query OK, 0 rows affected (0.01 sec)

mysql&gt; <strong class="userinput"><code>SELECT HEX('à\n'), HEX(_sjis'à\n');</code></strong>
+------------+-----------------+
| HEX('à\n') | HEX(_sjis'à\n') |
+------------+-----------------+
| E00A       | E00A            |
+------------+-----------------+
1 row in set (0.00 sec)
</pre><p>
          ここでは、<span class="quote">「<span class="quote"><code class="literal">à</code></span>」</span> (16 進値 <code class="literal">E0</code>) のあとに、改行のエスケープシーケンスである<span class="quote">「<span class="quote"><code class="literal">\n</code></span>」</span>が続いています。このエスケープシーケンスは、<code class="literal">latin1</code> の <code class="literal">character_set_connection</code> 値を使用して解釈され、リテラルの改行 (16 進値 <code class="literal">0A</code>) を生成します。これは 2 番目の文字列にも行われます。つまり、<code class="literal">_sjis</code> のイントロデューサはパーサーのエスケープ処理に影響を及ぼしません。
        </p><p>
          例 2:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET NAMES sjis;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT HEX('à\n'), HEX(_latin1'à\n');</code></strong>
+------------+-------------------+
| HEX('à\n') | HEX(_latin1'à\n') |
+------------+-------------------+
| E05C6E     | E05C6E            |
+------------+-------------------+
1 row in set (0.04 sec)
</pre><p>
          ここでは、<code class="literal">character_set_connection</code> は <code class="literal">sjis</code> です。この文字セットでは、<span class="quote">「<span class="quote"><code class="literal">à</code></span>」</span>のあとに<span class="quote">「<span class="quote"><code class="literal">\</code></span>」</span> (16 進値 <code class="literal">05</code> および <code class="literal">5C</code>) が続いたシーケンスは、有効なマルチバイト文字になります。したがって、文字列の最初の 2 バイトは、単一の <code class="literal">sjis</code> 文字として解釈され、<span class="quote">「<span class="quote"><code class="literal">\</code></span>」</span>はエスケープ文字として解釈されません。後続の<span class="quote">「<span class="quote"><code class="literal">n</code></span>」</span> (16 進値 <code class="literal">6E</code>) はエスケープシーケンスの一部としては解釈されません。これは 2 番目の文字列にも当てはまります。<code class="literal">_latin1</code> のイントロデューサはエスケープ処理に影響を及ぼしません。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-national"></a>10.1.3.6 各国文字セット</h4></div></div></div><p>
          標準 SQL では、<code class="literal">NCHAR</code> または <code class="literal">NATIONAL CHAR</code> は、<code class="literal">CHAR</code> カラムで事前定義された文字セットを使用するように指定する方法として定義されています。MySQL 5.6 では、<code class="literal">utf8</code> を事前定義された文字セットとして使用します。たとえば、次のデータ型宣言は同等です。
        </p><pre class="programlisting">
CHAR(10) CHARACTER SET utf8
NATIONAL CHARACTER(10)
NCHAR(10)
</pre><p>
          次も同様です。
        </p><pre class="programlisting">
VARCHAR(10) CHARACTER SET utf8
NATIONAL VARCHAR(10)
NCHAR VARCHAR(10)
NATIONAL CHARACTER VARYING(10)
NATIONAL CHAR VARYING(10)
</pre><p>
          <code class="literal">N'<em class="replaceable"><code>literal</code></em>'</code> (または <code class="literal">n'<em class="replaceable"><code>literal</code></em>'</code>) を使用すると、各国文字セットの文字列を作成できます。次のステートメントは同等です。
        </p><pre class="programlisting">
SELECT N'some text';
SELECT n'some text';
SELECT _utf8'some text';
</pre><p>
          4.1 以前のバージョンから MySQL 5.6 への文字セットのアップグレードに関する情報については、<em class="citetitle">MySQL 3.23、4.0、4.1 リファレンスマニュアル</em>を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-examples"></a>10.1.3.7 文字セットと照合順序の割り当ての例</h4></div></div></div><p>
          MySQL でどのようにしてデフォルトの文字セットおよび照合順序の値が決定されるかを、次の例で示します。
        </p><p>
          <span class="bold"><strong>例 1: テーブルおよびカラムの定義</strong></span>
        </p><pre class="programlisting">
CREATE TABLE t1
(
    c1 CHAR(10) CHARACTER SET latin1 COLLATE latin1_german1_ci
) DEFAULT CHARACTER SET latin2 COLLATE latin2_bin;
</pre><p>
          ここでは <code class="literal">latin1</code> 文字セットと <code class="literal">latin1_german1_ci</code> 照合順序がカラムに指定されています。この定義は明確であり、簡単明瞭です。なお、<code class="literal">latin1</code> カラムを <code class="literal">latin2</code> テーブルに格納することに問題はありません。
        </p><p>
          <span class="bold"><strong>例 2: テーブルおよびカラムの定義</strong></span>
        </p><pre class="programlisting">
CREATE TABLE t1
(
    c1 CHAR(10) CHARACTER SET latin1
) DEFAULT CHARACTER SET latin1 COLLATE latin1_danish_ci;
</pre><p>
          ここでは、<code class="literal">latin1</code> 文字セットとデフォルト照合順序がカラムに指定されています。当然のようですが、デフォルトの照合順序はテーブルレベルからは取得されません。<code class="literal">latin1</code> のデフォルト照合順序は常に <code class="literal">latin1_swedish_ci</code> なので、カラム <code class="literal">c1</code> には <code class="literal">latin1_danish_ci</code> ではなく <code class="literal">latin1_swedish_ci</code> の照合順序が設定されます。
        </p><p>
          <span class="bold"><strong>例 3: テーブルおよびカラムの定義</strong></span>
        </p><pre class="programlisting">
CREATE TABLE t1
(
    c1 CHAR(10)
) DEFAULT CHARACTER SET latin1 COLLATE latin1_danish_ci;
</pre><p>
          ここでは、デフォルト文字セットとデフォルト照合順序がカラムに指定されています。この状況では、MySQL はテーブルレベルをチェックして、カラムの文字セットおよび照合順序を特定します。したがって、カラム <code class="literal">c1</code> の文字セットは <code class="literal">latin1</code>、照合順序は <code class="literal">latin1_danish_ci</code> となります。
        </p><p>
          <span class="bold"><strong>例 4: データベース、テーブル、およびカラムの定義</strong></span>
        </p><pre class="programlisting">
CREATE DATABASE d1
    DEFAULT CHARACTER SET latin2 COLLATE latin2_czech_ci;
USE d1;
CREATE TABLE t1
(
    c1 CHAR(10)
);
</pre><p>
          文字セットと照合順序を指定せずにカラムを作成します。テーブルレベルの文字セットと照合順序も指定しません。この状況では、MySQL は、データベースレベルをチェックして、テーブル設定を特定します。その後、この設定がカラム設定になります。したがって、カラム <code class="literal">c1</code> の文字セットは <code class="literal">latin2</code>、照合順序は <code class="literal">latin2_czech_ci</code> となります。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-compatibility"></a>10.1.3.8 ほかの DBMS との互換性</h4></div></div></div><p>
          MaxDB との互換性について、次の 2 つのステートメントは同じです。
        </p><pre class="programlisting">
CREATE TABLE t1 (f1 CHAR(<em class="replaceable"><code>N</code></em>) UNICODE);
CREATE TABLE t1 (f1 CHAR(<em class="replaceable"><code>N</code></em>) CHARACTER SET ucs2);
</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-connection"></a>10.1.4 接続文字セットおよび照合順序</h3></div></div></div><a class="indexterm" name="idm139979107330992"></a><a class="indexterm" name="idm139979107329056"></a><p>
        複数の文字セットおよび照合順序のシステム変数は、サーバーとのクライアントの通信に関係しています。これらのいくつかは、これまでのセクションですでに説明されています。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバー文字セットおよび照合順序は、<code class="literal">character_set_server</code> および <code class="literal">collation_server</code> システム変数の値です。
          </p></li><li class="listitem"><p>
            デフォルトのデータベースの文字セットおよび照合順序は、<code class="literal">character_set_database</code> および <code class="literal">collation_database</code> システム変数の値です。
          </p></li></ul></div><p>
        その他の文字セットおよび照合順序システム変数は、クライアントとサーバー間の接続のトラフィックの処理に関わっています。どのクライアントも接続関連の文字セットおよび照合順序システム変数を持っています。
      </p><p>
        <span class="quote">「<span class="quote">接続</span>」</span>は、サーバーに接続するときに作成するものです。クライアントは接続を介して、SQL ステートメント (クエリーなど) をサーバーに送信します。サーバーは接続を介して、結果セットやエラーメッセージなどの応答をクライアントに送信します。これによって、次のようなクライアント接続を扱う文字セットおよび照合順序に関する疑問が生じますが、これらはシステム変数の点から回答できます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            クライアントから送信されるときに、ステートメントはどの文字セットで送信されますか。
          </p><p>
            サーバーは、<code class="literal">character_set_client</code> システム変数値を、クライアントが送信するステートメントの文字セットにします。
          </p></li><li class="listitem"><p>
            ステートメントを受信したあとで、サーバーはこれをどの文字セットに変換しますか。
          </p><p>
            これには、サーバーは <code class="literal">character_set_connection</code> および <code class="literal">collation_connection</code> システム変数値を使用します。クライアントから送信されたステートメントは、<code class="literal">character_set_client</code> から <code class="literal">character_set_connection</code> に変換されます (<code class="literal">_latin1</code> や <code class="literal">_utf8</code> などのイントロデューサがある文字列リテラルを除きます)。<code class="literal">collation_connection</code> はリテラル文字列の比較で重要です。カラム値のある文字列の比較には、<code class="literal">collation_connection</code> は重要視されません。なぜなら、カラムには独自の照合順序があり、この照合順序が優先されるからです。
          </p></li><li class="listitem"><p>
            結果セットまたはエラーメッセージをクライアントに返送する前に、サーバーはこれらをどの文字セットに変換しますか。
          </p><p>
            <code class="literal">character_set_results</code> システム変数値は、サーバーがクライアントにクエリー結果を返信するときに使用する文字セットを示します。これには、カラム値などの結果データと、カラム名やエラーメッセージなどの結果メタデータが含まれます。
          </p></li></ul></div><p>
        クライアントは、これらの変数の設定を微調整することも、デフォルトに従うこともできます (この場合は、このセクションの残りをスキップできます)。デフォルトを使用しない場合、<span class="emphasis"><em>サーバーへの接続ごとに</em></span>文字設定を変更する必要があります。
      </p><p>
        2 つのステートメントは、接続関連の文字セット変数にグループとして影響します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">SET NAMES '<em class="replaceable"><code>charset_name</code></em>' [COLLATE '<em class="replaceable"><code>collation_name</code></em>']</code>
          </p><p>
            <code class="literal">SET NAMES</code> は、クライアントからサーバーへの SQL ステートメントの送信に使用される文字セットを示します。したがって、<code class="literal">SET NAMES 'cp1251'</code> は、<span class="quote">「<span class="quote">このクライアントから今後受信するメッセージが文字セット <code class="literal">cp1251</code> で送信される</span>」</span>ことを、サーバーに知らせます。また、クライアントに結果を返信するときにサーバーが使用する文字セットも指定します。(たとえば、<code class="literal">SELECT</code> ステートメントを使用する場合に、カラム値に使用する文字セットを指定します。)
          </p><p>
            <code class="literal">SET NAMES '<em class="replaceable"><code>charset_name</code></em>'</code> ステートメントは次の 3 つのステートメントと同等です。
          </p><pre class="programlisting">
SET character_set_client = <em class="replaceable"><code>charset_name</code></em>;
SET character_set_results = <em class="replaceable"><code>charset_name</code></em>;
SET character_set_connection = <em class="replaceable"><code>charset_name</code></em>;
</pre><p>
            <code class="literal">character_set_connection</code> を <em class="replaceable"><code>charset_name</code></em> に設定すると、<code class="literal">collation_connection</code> も暗黙的に <em class="replaceable"><code>charset_name</code></em> のデフォルト照合順序に設定されます。この照合順序を明示的に設定する必要はありません。特定の照合順序を指定するには、オプションの <code class="literal">COLLATE</code> 句を使用します。
          </p><pre class="programlisting">
SET NAMES '<em class="replaceable"><code>charset_name</code></em>' COLLATE '<em class="replaceable"><code>collation_name</code></em>'
</pre></li><li class="listitem"><p>
            <code class="literal">SET CHARACTER SET <em class="replaceable"><code>charset_name</code></em></code>
          </p><p>
            <code class="literal">SET CHARACTER SET</code> は <code class="literal">SET NAMES</code> に似ていますが、<code class="literal">character_set_connection</code> と <code class="literal">collation_connection</code> を <code class="literal">character_set_database</code> と <code class="literal">collation_database</code> に設定します。<code class="literal">SET CHARACTER SET <em class="replaceable"><code>charset_name</code></em></code> ステートメントは次の 3 つのステートメントと同等です。
          </p><pre class="programlisting">
SET character_set_client = <em class="replaceable"><code>charset_name</code></em>;
SET character_set_results = <em class="replaceable"><code>charset_name</code></em>;
SET collation_connection = @@collation_database;
</pre><p>
            <code class="literal">collation_connection</code> を設定すると、<code class="literal">character_set_connection</code> も、関連付けられた文字セットに暗黙的に設定されます (<code class="literal">SET character_set_connection = @@character_set_database</code> の実行と同等です)。<code class="literal">character_set_connection</code> を明示的に設定する必要はありません。
          </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          <code class="literal">ucs2</code>、<code class="literal">utf16</code>、<code class="literal">utf16le</code>、および <code class="literal">utf32</code> をクライアント文字セットとして使用することはできません。つまり、これらは <code class="literal">SET NAMES</code> または <code class="literal">SET CHARACTER SET</code> には機能しません。
        </p></div><p>
        MySQL クライアントプログラム <code class="literal">mysql</code>、<code class="literal">mysqladmin</code>、<code class="literal">mysqlcheck</code>、<code class="literal">mysqlimport</code>、および <code class="literal">mysqlshow</code> は、次のように、使用するデフォルトの文字セットを特定します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            ほかの情報が欠如している場合、プログラムは、コンパイル時のデフォルトの文字セット (通常は <code class="literal">latin1</code>) を使用します。
          </p></li><li class="listitem"><p>
            プログラムは、オペレーティングシステム設定 (たとえば、Unix システムでは <code class="literal">LANG</code> や <code class="literal">LC_ALL</code> ローカル環境変数の値、Windows システムではコードページ設定) に基づいて、使用する文字セットを自動検出できます。ロケールが OS から利用できるシステムの場合、クライアントはコンパイル時のデフォルトを使用するのではなく、このロケールを使用してデフォルトの文字セットを設定します。たとえば、<code class="literal">LANG</code> を <code class="literal">ru_RU.KOI8-R</code> に設定すると、<code class="literal">koi8r</code> 文字セットが使用されます。したがってユーザーは、MySQL クライアントが使用できるように、自身の環境内でロケールを構成できます。
          </p><p>
            OS 文字セットは、正確に一致するものがない場合は、もっとも近い MySQL 文字セットにマップされます。一致した文字セットをサポートしていない場合、クライアントはコンパイルイ時のデフォルトを使用します。たとえば、<code class="literal">ucs2</code> は接続文字セットとしてはサポートされていません。
          </p><p>
            C アプリケーションは、サーバーに接続する前に次のように <code class="literal">mysql_options()</code> を呼び出すことによって、OS 設定に基づいて文字セットの自動検出を使用できます。
          </p><pre class="programlisting">
mysql_options(mysql,
              MYSQL_SET_CHARSET_NAME,
              MYSQL_AUTODETECT_CHARSET_NAME);
</pre></li><li class="listitem"><p>
            プログラムは <code class="option">--default-character-set</code> オプションをサポートしており、ユーザーはこのオプションを使用すると文字セットを明示的に指定でき、クライアントがそれ以外のどのデフォルトを指定していても、それをオーバーライドできます。
          </p></li></ul></div><p>
        クライアントはサーバーに接続するときに、使用する文字セットの名前を送信します。サーバーはこの名前を使用して、<code class="literal">character_set_client</code>、<code class="literal">character_set_results</code>、および <code class="literal">character_set_connection</code> システム変数を設定します。実際には、サーバーは文字セット名を使用して <code class="literal">SET NAMES</code> 操作を実行します。
      </p><p>
        <span class="command"><strong>mysql</strong></span> クライアントの場合、デフォルトとは別の文字セットを使用するには、起動するたびに、<code class="literal">SET NAMES</code> を明示的に実行できます。より簡単に同じ結果を得るには、<code class="option">--default-character-set</code> オプション設定を <span class="command"><strong>mysql</strong></span> コマンド行またはオプションファイルに追加します。たとえば、次のオプションファイル設定は、<span class="command"><strong>mysql</strong></span> を呼び出すたびに、<code class="literal">koi8r</code> に設定された 3 つの接続関連の文字セット変数を変更します。
      </p><pre class="programlisting">
[mysql]
default-character-set=koi8r
</pre><p>
        自動再接続を有効にして <span class="command"><strong>mysql</strong></span> クライアントを使用している場合は (推奨しません)、<code class="literal">SET NAMES</code> ではなく <code class="literal">charset</code> コマンドを使用することをお勧めします。例:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>charset utf8</code></strong>
Charset changed
</pre><p>
        <code class="literal">charset</code> コマンドは、<code class="literal">SET NAMES</code> ステートメントを発行し、接続の切断後に再接続するときに <span class="command"><strong>mysql</strong></span> が使用するデフォルトの文字セットも変更します。
      </p><p>
        例: <code class="literal">column1</code> が <code class="literal">CHAR(5) CHARACTER SET latin2</code> として定義されているとします。<code class="literal">SET NAMES</code> または <code class="literal">SET CHARACTER SET</code> を指定しない場合、<code class="literal">SELECT column1 FROM t</code> に対して、サーバーは、接続時にクライアントが指定した文字セットを使用して、<code class="literal">column1</code> のすべての値を送り返します。反対に、<code class="literal">SET NAMES 'latin1'</code> または <code class="literal">SET CHARACTER SET latin1</code> を <code class="literal">SELECT</code> ステートメントを発行する前に指定した場合、サーバーは結果を返信する直前に、<code class="literal">latin2</code> の値を <code class="literal">latin1</code> に変換します。両方の文字セットに存在しない文字がある場合、変換の損失が大きくなる可能性があります。
      </p><p>
        サーバーに結果セットまたはエラーメッセージの変換を実行させない場合は、<code class="literal">character_set_results</code> を <code class="literal">NULL</code> または <code class="literal">binary</code> に設定してください。
      </p><pre class="programlisting">
SET character_set_results = NULL;
</pre><p>
        接続に適用する文字セットおよび照合順序システム変数の値を確認するには、次のステートメントを使用してください。
      </p><pre class="programlisting">
SHOW VARIABLES LIKE 'character_set%';
SHOW VARIABLES LIKE 'collation%';
</pre><p>
        MySQL アプリケーションを実行する環境も考慮する必要があります。<a class="xref" href="globalization.html#charset-applications" title="10.1.5 アプリケーションの文字セットおよび照合順序の構成">セクション10.1.5「アプリケーションの文字セットおよび照合順序の構成」</a>を参照してください。
      </p><p>
        文字セットおよびエラーメッセージの詳細は、<a class="xref" href="globalization.html#charset-errors" title="10.1.6 エラーメッセージの文字セット">セクション10.1.6「エラーメッセージの文字セット」</a>を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-applications"></a>10.1.5 アプリケーションの文字セットおよび照合順序の構成</h3></div></div></div><a class="indexterm" name="idm139979107205280"></a><p>
        デフォルトの MySQL 文字セットおよび照合順序 (<code class="literal">latin1</code>、<code class="literal">latin1_swedish_ci</code>) を使用してデータを格納するアプリケーションの場合、特別な構成は必要ありません。別の文字セットまたは照合順序を使用したデータストレージが必要なアプリケーションの場合は、次の複数の方法で、文字セット情報を構成できます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            データベースごとに文字設定を指定します。たとえば、あるデータベースを使用するアプリケーションでは <code class="literal">utf8</code> が必要で、別のデータベースを使用するアプリケーションでは <code class="literal">sjis</code> が必要な場合があります。
          </p></li><li class="listitem"><p>
            サーバーの起動時に文字設定を指定します。これにより、サーバーは、ほかの調整を行わないすべてのアプリケーションに、所定の設定を使用します。
          </p></li><li class="listitem"><p>
            ソースから MySQL を構築する場合は、構成時に文字設定を指定します。これにより、サーバーはすべてのアプリケーションに対して所定の設定を使用し、サーバーの起動時に指定する必要がなくなります。
          </p></li></ul></div><p>
        異なるアプリケーションで別々の文字設定が必要な場合は、データベースごとの手法で十分対応できます。ほとんどまたはすべてのアプリケーションで同じ文字セットを使用する場合は、サーバーの起動時または構成時に文字設定を指定する方法がもっとも便利です。
      </p><p>
        データベースごとの手法またはサーバー起動の手法では、設定によって、データストレージの文字セットが制御されます。アプリケーションはまた、次の手順で説明するように、クライアントとサーバー間の通信に使用する文字セットをサーバーに知らせる必要もあります。
      </p><p>
        ここで示す例では、<code class="literal">utf8</code> 文字セットと <code class="literal">utf8_general_ci</code> 照合順序を使用することを想定しています。
      </p><p>
        <span class="bold"><strong>データベースごとに文字設定を指定します。</strong></span>テーブルで所定のデフォルトの文字セットおよび照合順序をデータストレージに使用するようなデータベースを作成するには、次のような <code class="literal">CREATE DATABASE</code> ステートメントを使用します。
      </p><pre class="programlisting">
CREATE DATABASE mydb
  DEFAULT CHARACTER SET utf8
  DEFAULT COLLATE utf8_general_ci;
</pre><p>
        データベース内に作成されたテーブルは、すべての文字カラムに対してデフォルトで <code class="literal">utf8</code> と <code class="literal">utf8_general_ci</code> を使用します。
      </p><p>
        データベースを使用するアプリケーションは、接続するたびに、サーバーへの接続を構成する必要もあります。これは、接続後に <code class="literal">SET NAMES 'utf8'</code> ステートメントを実行することによって行えます。このステートメントは、接続方法 (<span class="command"><strong>mysql</strong></span> クライアント、PHP スクリプトなど) とは無関係に使用できます。
      </p><p>
        場合によっては、必要な文字セットを別の方法で使用するように接続を構成できます。たとえば、<span class="command"><strong>mysql</strong></span> を使用して行われた接続の場合、<code class="option">--default-character-set=utf8</code> コマンド行オプションを指定すると、<code class="literal">SET NAMES 'utf8'</code> と同じ効果を得ることができます。
      </p><p>
        クライアント接続の構成の詳細は、<a class="xref" href="globalization.html#charset-connection" title="10.1.4 接続文字セットおよび照合順序">セクション10.1.4「接続文字セットおよび照合順序」</a>を参照してください。
      </p><p>
        データベースのデフォルトの文字セットまたは照合順序を変更する場合、データベースのデフォルトを使用するストアドルーチンを削除して、新しいデフォルトを使用するように再作成する必要があります。(ストアドルーチンでは、文字セットまたは照合順序が明示的に指定されていない場合、文字データ型を伴う変数は、データベースのデフォルトを使用します。<a class="xref" href="sql-syntax.html#create-procedure" title="13.1.15 CREATE PROCEDURE および CREATE FUNCTION 構文">セクション13.1.15「CREATE PROCEDURE および CREATE FUNCTION 構文」</a>を参照してください。)
      </p><p>
        <span class="bold"><strong>サーバーの起動時に文字設定を指定します。</strong></span>サーバーの起動時に文字セットおよび照合順序を選択するには、<code class="option">--character-set-server</code> および <code class="option">--collation-server</code> オプションを使用します。たとえば、オプションファイルでオプションを指定するには、次の行を含めます。
      </p><pre class="programlisting">
[mysqld]
character-set-server=utf8
collation-server=utf8_general_ci
</pre><p>
        これらの設定は、サーバー全体に適用され、任意のアプリケーションによって作成されたデータベースのデフォルトおよびこれらのデータベース内に作成されたテーブルのデフォルトとして適用されます。
      </p><p>
        前述のように、アプリケーションは引き続き、接続したあとで <code class="literal">SET NAMES</code> または同等のステートメントを使用して、その接続を構成する必要があります。<code class="option">--init_connect="SET NAMES 'utf8'"</code> オプションでサーバーを起動して、接続するクライアントごとに <code class="literal">SET NAMES</code> を自動的に実行させることができます。ただし、<code class="literal">SUPER</code> 権限を持つユーザーには <code class="literal">init_connect</code> 値は実行されないので、これによって一貫しない結果が生じます。
      </p><p>
        <span class="bold"><strong>MySQL の構成時に文字設定を指定します。</strong></span>ソースから MySQL を構成および構築するときに、文字セットおよび照合順序を選択するには、<span class="command"><strong>CMake</strong></span> で <code class="option">DEFAULT_CHARSET</code> および <code class="option">DEFAULT_COLLATION</code> オプションを使用します。
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>cmake . -DDEFAULT_CHARSET=utf8 \</code></strong>
           <strong class="userinput"><code>-DDEFAULT_COLLATION=utf8_general_ci</code></strong>
</pre><p>
        この結果構成されたサーバーは、データベースおよびテーブルのデフォルトと、クライアント接続のデフォルトとして、<code class="literal">utf8</code> および <code class="literal">utf8_general_ci</code> を使用します。<code class="option">--character-set-server</code> と <code class="option">--collation-server</code> を使用して、サーバー起動時にこれらのデフォルトを指定する必要はありません。また、アプリケーションがサーバーに接続したあとで <code class="literal">SET NAMES</code> または同等のステートメントを使用して、その接続を構成する必要もありません。
      </p><p>
        アプリケーション用に MySQL 文字セットを構成する方法とは無関係に、これらのアプリケーションが実行する環境も考慮する必要があります。エディタで作成したファイルから取得された UTF-8 テキストを使用してステートメントを送信する場合、ファイルのエンコーディングが正しく、オペレーティングシステムで正しく処理されるように、環境のロケールを UTF-8 に設定してファイルを編集する必要があります。端末ウィンドウ内から <span class="command"><strong>mysql</strong></span> クライアントを使用する場合、UTF-8 を使用するようにこのウィンドウを構成する必要があります。そのようにしないと、文字が正しく表示されない可能性があります。Web 環境で実行するスクリプトの場合、このスクリプトは、MySQL Server とやり取りできるように文字のエンコーディングを正しく処理する必要があり、ページ内容の表示方法をブラウザが認識できるようにエンコーディングを正しく指定したページを生成する必要があります。たとえば、次の <code class="literal">&lt;meta&gt;</code> タグを <code class="literal">&lt;head&gt;</code> 要素内に含められます。
      </p><pre class="programlisting">
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-errors"></a>10.1.6 エラーメッセージの文字セット</h3></div></div></div><p>
        このセクションでは、サーバーがエラーメッセージを構築しクライアントに返信する場合にどのように文字セットを使用するかについて説明します。エラーメッセージの (文字セットではなく) 言語の詳細は、<a class="xref" href="globalization.html#error-message-language" title="10.2 エラーメッセージ言語の設定">セクション10.2「エラーメッセージ言語の設定」</a>を参照してください。
      </p><p>
        MySQL 5.6 では、サーバーは、UTF-8 を使用してエラーメッセージを構築し、<code class="literal">character_set_results</code> システム変数で指定された文字セットでクライアントに返信します。
      </p><p>
        サーバーは次のようにエラーメッセージを構築します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            メッセージテンプレートで UTF-8 が使用されます。
          </p></li><li class="listitem"><p>
            メッセージテンプレートのパラメータが、特定のエラーの発生に適用される値に置き換えられます。
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                テーブル名やカラム名などの識別子は、UTF-8 を内部で使用するので、そのままコピーされます。
              </p></li><li class="listitem"><p>
                文字 (非バイナリ) 文字列値は、その文字セットから UTF-8 に変換されます。
              </p></li><li class="listitem"><p>
                バイナリ文字列値は、<code class="literal">0x20</code> から <code class="literal">0x7E</code> の範囲のバイトについてはそのままコピーされ、この範囲外のバイトについては <code class="literal">\x</code> 16 進エンコーディングを使用してコピーされます。たとえば、<code class="literal">0x41CF9F</code> を <code class="literal">VARBINARY</code> 一意カラムに挿入しようとしたときに重複キーエラーが発生した場合、この結果生成されるエラーメッセージでは UTF-8 が使用され、一部のバイトは 16 進数でエンコードされます。
              </p><pre class="programlisting">
Duplicate entry 'A\xC3\x9F' for key 1
</pre></li></ul></div></li></ul></div><p>
        メッセージの構築後、これをクライアントに返すために、サーバーはこのメッセージを UTF-8 から、<code class="literal">character_set_results</code> システム変数によって指定された文字セットに変換します。<code class="literal">character_set_results</code> に <code class="literal">NULL</code> または <code class="literal">binary</code> の値がある場合、変換は行われません。変数値が <code class="literal">utf8</code> である場合にも、これが元のエラーメッセージの文字セットに一致するので、変換は行われません。
      </p><p>
        <code class="literal">character_set_results</code> で表すことができない文字の場合、変換中に一部のエンコーディングが行われることがあります。エンコーディングは、Unicode コードポイント値を使用します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Basic Multilingual Plane (BMP) 範囲 (<code class="literal">0x0000</code> から <code class="literal">0xFFFF</code>) 内の文字は、<code class="literal">\<em class="replaceable"><code>nnnn</code></em></code> 表記を使用して書き込まれます。
          </p></li><li class="listitem"><p>
            BMP 範囲外 (<code class="literal">0x01000</code> から <code class="literal">0x10FFFF</code>) の文字は、<code class="literal">\+<em class="replaceable"><code>nnnnnn</code></em></code> 表記を使用して書き込まれます。
          </p></li></ul></div><p>
        クライアントは、<code class="literal">character_set_results</code> を設定して、エラーメッセージを受信するときの文字セットを制御できます。この変数は直接設定することも、<code class="literal">SET NAMES</code> などの手段で間接的に設定することもできます。<code class="literal">character_set_results</code> の詳細は、<a class="xref" href="globalization.html#charset-connection" title="10.1.4 接続文字セットおよび照合順序">セクション10.1.4「接続文字セットおよび照合順序」</a>を参照してください。
      </p><p>
        クライアントにエラーメッセージを返信する前に <code class="literal">character_set_results</code> に変換する間に行われるエンコーディングの結果、以前のバージョン (MySQL 5.5 より前のバージョン) とは異なるメッセージ内容になることがあります。たとえば、<code class="literal">ペ</code> (カタカナのペ) という名前のテーブルを削除しようとしたときにエラーが発生し、<code class="literal">character_set_results</code> が、この文字を含まない <code class="literal">latin1</code> などの文字セットである場合、クライアントに送信される結果のメッセージには、次のようにエンコードされたテーブル名が表示されます。
      </p><pre class="programlisting">
ERROR 1051 (42S02): Unknown table '\30DA'
</pre><p>
        MySQL 5.5 より前では、次のように名前はエンコードされません。
      </p><pre class="programlisting">
ERROR 1051 (42S02): Unknown table 'ペ'
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-collations"></a>10.1.7 照合順序の問題</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="globalization.html#charset-collation-names">10.1.7.1 照合順序名</a></span></dt><dt><span class="section"><a href="globalization.html#charset-collate">10.1.7.2 SQL ステートメントでの COLLATE の使用</a></span></dt><dt><span class="section"><a href="globalization.html#charset-collate-precedence">10.1.7.3 COLLATE 句の優先順位</a></span></dt><dt><span class="section"><a href="globalization.html#charset-collation-charset">10.1.7.4 照合順序と文字セットとの適切な対応</a></span></dt><dt><span class="section"><a href="globalization.html#charset-collation-expressions">10.1.7.5 式の照合順序</a></span></dt><dt><span class="section"><a href="globalization.html#charset-binary-collations">10.1.7.6 _bin および binary 照合順序</a></span></dt><dt><span class="section"><a href="globalization.html#charset-binary-op">10.1.7.7 BINARY 演算子</a></span></dt><dt><span class="section"><a href="globalization.html#charset-collation-effect">10.1.7.8 照合順序の効果の例</a></span></dt><dt><span class="section"><a href="globalization.html#charset-collation-information-schema">10.1.7.9 照合順序と INFORMATION_SCHEMA 検索</a></span></dt></dl></div><p>
        以降のセクションでは、文字セットの照合順序のさまざまな側面について説明します。
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-collation-names"></a>10.1.7.1 照合順序名</h4></div></div></div><a class="indexterm" name="idm139979107104960"></a><p>
          MySQL 照合順序名は次のルールに従います。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">_ci</code> で終わる名前は大文字と小文字を区別しない照合順序を示します。
            </p></li><li class="listitem"><p>
              <code class="literal">_cs</code> で終わる名前は、大文字と小文字を区別する照合順序を示します。
            </p></li><li class="listitem"><p>
              <code class="literal">_bin</code> で終わる名前はバイナリ照合順序を示します。文字の比較は、文字バイナリコード値に従って行われます。
            </p></li><li class="listitem"><p>
              Unicode 照合順序名には、照合順序が従う Unicode 照合アルゴリズム (UCA) のバージョンを示すバージョン番号が含まれることがあります。名前にバージョン番号が含まれない UCA ベースの照合順序は、バージョン 4.0.0 UCA 重みキー (<a class="ulink" href="http://www.unicode.org/Public/UCA/4.0.0/allkeys-4.0.0.txt" target="_top">http://www.unicode.org/Public/UCA/4.0.0/allkeys-4.0.0.txt</a>) を使用します。<code class="literal">utf8_unicode_520_ci</code> などの照合順序名は、UCA 5.2.0 重みキー (<a class="ulink" href="http://www.unicode.org/Public/UCA/5.2.0/allkeys.txt" target="_top">http://www.unicode.org/Public/UCA/5.2.0/allkeys.txt</a>) に基づきます。
            </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-collate"></a>10.1.7.2 SQL ステートメントでの COLLATE の使用</h4></div></div></div><p>
          <code class="literal">COLLATE</code> 句では、比較に対するデフォルト照合順序が何であれ、オーバーライドできます。SQL ステートメントのさまざまな個所で <code class="literal">COLLATE</code> を使用できます。次にいくつかの例を示します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">ORDER BY</code> を指定した場合
            </p><pre class="programlisting">
SELECT k
FROM t1
ORDER BY k COLLATE latin1_german2_ci;
</pre></li><li class="listitem"><p>
              <code class="literal">AS</code> を指定した場合
            </p><pre class="programlisting">
SELECT k COLLATE latin1_german2_ci AS k1
FROM t1
ORDER BY k1;
</pre></li><li class="listitem"><p>
              <code class="literal">GROUP BY</code> を指定した場合
            </p><pre class="programlisting">
SELECT k
FROM t1
GROUP BY k COLLATE latin1_german2_ci;
</pre></li><li class="listitem"><p>
              集計関数を指定した場合
            </p><pre class="programlisting">
SELECT MAX(k COLLATE latin1_german2_ci)
FROM t1;
</pre></li><li class="listitem"><p>
              <code class="literal">DISTINCT</code> を指定した場合
            </p><pre class="programlisting">
SELECT DISTINCT k COLLATE latin1_german2_ci
FROM t1;
</pre></li><li class="listitem"><p>
              <code class="literal">WHERE</code> を指定した場合
            </p><pre class="programlisting">
     SELECT *
     FROM t1
     WHERE _latin1 'Müller' COLLATE latin1_german2_ci = k;
</pre><pre class="programlisting">
     SELECT *
     FROM t1
     WHERE k LIKE _latin1 'Müller' COLLATE latin1_german2_ci;
</pre></li><li class="listitem"><p>
              <code class="literal">HAVING</code> を指定した場合
            </p><pre class="programlisting">
SELECT k
FROM t1
GROUP BY k
HAVING k = _latin1 'Müller' COLLATE latin1_german2_ci;
</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-collate-precedence"></a>10.1.7.3 COLLATE 句の優先順位</h4></div></div></div><p>
          <code class="literal">COLLATE</code> 句は優先順位が高いため (<code class="literal">||</code> より上位)、次の 2 つの式は同等です。
        </p><pre class="programlisting">
x || y COLLATE z
x || (y COLLATE z)
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-collation-charset"></a>10.1.7.4 照合順序と文字セットとの適切な対応</h4></div></div></div><p>
          各文字セットには 1 つ以上の照合順序があり、各照合順序は 1 つの文字セットにのみ関連付けられています。したがって、次のステートメントではエラーメッセージが表示されます。<code class="literal">latin2_bin</code> 照合順序は <code class="literal">latin1</code> 文字セットに対して有効ではないからです。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT _latin1 'x' COLLATE latin2_bin;</code></strong>
ERROR 1253 (42000): COLLATION 'latin2_bin' is not valid
for CHARACTER SET 'latin1'
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-collation-expressions"></a>10.1.7.5 式の照合順序</h4></div></div></div><p>
          大多数のステートメントでは、MySQL がどの照合順序を使用して比較演算を行うかは明確になっています。たとえば、次の場合、照合順序がカラム <code class="literal">charset_name</code> の照合順序であることは明らかです。
        </p><pre class="programlisting">
SELECT x FROM T ORDER BY x;
SELECT x FROM T WHERE x = x;
SELECT DISTINCT x FROM T;
</pre><p>
          ただし、複数のオペランドがあると、あいまいさが生じることがあります。例:
        </p><pre class="programlisting">
SELECT x FROM T WHERE x = 'Y';
</pre><p>
          カラム <code class="literal">x</code> の照合順序を使用して比較したほうがよいでしょうか、それとも文字列リテラル <code class="literal">'Y'</code> の照合順を使用して比較したほうがよいででしょうか。<code class="literal">x</code> と <code class="literal">'Y'</code> の両方に照合順序がありますが、どちらの照合順序が優先されるでしょうか。
        </p><p>
          標準 SQL では、<span class="quote">「<span class="quote">強制性</span>」</span>ルールと呼ばれていた方法で上記の問題を解決しています。MySQL は次のように強制性値を割り当てます。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              明示的な <code class="literal">COLLATE</code> 句の強制性は 0 です。(強制性がまったくありません。)
            </p></li><li class="listitem"><p>
              照合順序の異なる 2 つの文字列を連結すると強制性は 1 になります。
            </p></li><li class="listitem"><p>
              カラムまたはストアドルーチンのパラメータまたはローカル変数の照合順序の強制性は 2 です。
            </p></li><li class="listitem"><p>
              <span class="quote">「<span class="quote">システム定数</span>」</span> (<code class="literal">USER()</code> または <code class="literal">VERSION()</code> などの関数で返される文字列) の強制性は 3 です。
            </p></li><li class="listitem"><p>
              リテラルの照合順序の強制性は 4 です。
            </p></li><li class="listitem"><p>
              <code class="literal">NULL</code> または <code class="literal">NULL</code> から派生した式の強制性 5 です。
            </p></li></ul></div><p>
          MySQL は、次のルールとともに強制性値を使用して、あいまいさを解決します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              強制性値がもっとも低い照合順序を使用します。
            </p></li><li class="listitem"><p>
              両方の側で強制性が同じ場合は、次のようになります。
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  両方の側が Unicode であるか、両方の側が Unicode ではない場合は、エラーになります。
                </p></li><li class="listitem"><p>
                  どちらかの側に Unicode 文字セットがあり、もう一方の側に Unicode 以外の文字セットがある場合、Unicode 文字セットの側が優先され、Unicode 以外の側に自動文字セット変換が適用されます。たとえば、次のステートメントはエラーを返しません。
                </p><pre class="programlisting">
SELECT CONCAT(utf8_column, latin1_column) FROM t1;
</pre><p>
                  これは、<code class="literal">utf8</code> の文字セットと、<code class="literal">utf8_column</code> と同じ照合順序を含む結果を返します。連結する前に、<code class="literal">latin1_column</code> の値は自動的に、<code class="literal">utf8</code> に変換されます。
                </p></li><li class="listitem"><p>
                  同じ文字セットのオペランドだが、<code class="literal">_bin</code> 照合順序と <code class="literal">_ci</code> または <code class="literal">_cs</code> 照合順序が混在したオペランドを使用した演算の場合、<code class="literal">_bin</code> 照合順序が使用されます。これは、対象がデータ型でなく照合順序である点を除けば、非バイナリ文字列とバイナリ文字列が混在した演算でオペランドがバイナリ文字列に評価される方法に似ています。
                </p></li></ul></div></li></ul></div><p>
          自動変換機能は SQL 標準には含まれていません。ただし、どの文字セットも (サポートされている文字に関して) Unicode の<span class="quote">「<span class="quote">サブセット</span>」</span>であることが SQL 標準のドキュメントに記載されています。<span class="quote">「<span class="quote">スーパーセットに適用されるものはサブセットにも適用される</span>」</span>というよく知られた原則があるので、Unicode の照合順序は Unicode 以外の文字列との比較にも適用できると考えられます。
        </p><p>
          例:
        </p><div class="informaltable"><table summary="次の表に、比較と、それぞれの比較に使用される照合順序を一覧表示します。" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">比較</th><th scope="col">使用される照合順序</th></tr></thead><tbody><tr><td scope="row"><code class="literal">column1 = 'A'</code></td><td><code class="literal">column1</code> の照合順序を使用します</td></tr><tr><td scope="row"><code class="literal">column1 = 'A' COLLATE x</code></td><td><code class="literal">'A' COLLATE x</code> の照合順序を使用します</td></tr><tr><td scope="row"><code class="literal">column1 COLLATE x = 'A' COLLATE y</code></td><td>エラー</td></tr></tbody></table></div><p>
          <code class="literal">COERCIBILITY()</code> 関数を使用すると、文字列式の強制性を特定できます。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT COERCIBILITY('A' COLLATE latin1_swedish_ci);</code></strong>
        -&gt; 0
mysql&gt; <strong class="userinput"><code>SELECT COERCIBILITY(VERSION());</code></strong>
        -&gt; 3
mysql&gt; <strong class="userinput"><code>SELECT COERCIBILITY('A');</code></strong>
        -&gt; 4
</pre><p>
          <a class="xref" href="functions.html#information-functions" title="12.14 情報関数">セクション12.14「情報関数」</a>を参照してください。
        </p><p>
          式 <code class="literal">CONCAT(1, 'abc')</code> での引数 <code class="literal">1</code> に対して行われる変換など、数値または時間値の文字列への暗黙の変換の場合、その結果は、<code class="literal">character_set_connection</code> および <code class="literal">collation_connection</code> システム変数で指定された文字セットおよび照合順序を持つ文字 (非バイナリ) 列になります。<a class="xref" href="functions.html#type-conversion" title="12.2 式評価での型変換">セクション12.2「式評価での型変換」</a>を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-binary-collations"></a>10.1.7.6 _bin および binary 照合順序</h4></div></div></div><p>
          このセクションでは、非バイナリ文字列の <code class="literal">_bin</code> 照合順序が、バイナリ文字列の <code class="literal">binary</code> <span class="quote">「<span class="quote">照合順序</span>」</span>とどのように異なるかについて説明します。
        </p><p>
          非バイナリ文字列 (<code class="literal">CHAR</code>、<code class="literal">VARCHAR</code>、および <code class="literal">TEXT</code> データ型に格納) には、文字セットと照合順序があります。特定の文字セットには複数の照合順序が対応していることがあり、そのそれぞれが、セット内の文字の具体的なソートおよび比較順序を定義しています。これらの中の 1 つが文字セットのバイナリ照合順序であり、その照合順序名の中には <code class="literal">_bin</code> サフィクスがあります。たとえば、<code class="literal">latin1</code> と <code class="literal">utf8</code> には、<code class="literal">latin1_bin</code> および <code class="literal">utf8_bin</code> という名前のバイナリ照合順序があります。
        </p><p>
          バイナリ文字列 (<code class="literal">BINARY</code>、<code class="literal">VARBINARY</code>、および <code class="literal">BLOB</code> データ型に格納) には、非バイナリ文字列にあるような文字セットや照合順序はありません。(<code class="literal">CHARSET()</code> と <code class="literal">COLLATION()</code> 関数はどちらも、バイナリ文字列に適用されると <code class="literal">binary</code> の値を返します。)バイナリ文字列はバイトのシーケンスであり、これらのバイトの数値がソート順序を決定します。
        </p><p>
          <code class="literal">_bin</code> 照合順序は、いくつかの点で <code class="literal">binary</code> 照合順序と異なります。
        </p><p>
          <span class="bold"><strong>ソートおよび比較の単位。</strong></span>バイナリ文字列は、バイトのシーケンスです。ソートおよび比較は、常に数値のバイト値に基づきます。非バイナリ文字列は文字のシーケンスであり、これはマルチバイトであることもあります。非バイナリ文字列の照合順序は、文字値のソートおよび比較の順序を定義します。<code class="literal">_bin</code> 照合順序の場合、この順序は文字のバイナリコード値にのみ基づきます (これは、<code class="literal">_bin</code> 照合順序では複数バイトの文字の可能性を考慮に入れる必要がある点を除き、バイナリ文字列の順序に似ています)。ほかの照合順序の場合、文字の順序は、大文字と小文字の区別などのその他の要素を考慮に入れることがあります。
        </p><p>
          <span class="bold"><strong>文字セットの変換。</strong></span>非バイナリ文字列には文字セットがあり、多くの場合、文字列に <code class="literal">_bin</code> 照合順序があるときでも、別の文字セットに変換されます。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              別の文字セットを持つほかのカラムから、カラム値を割り当てる場合:
            </p><pre class="programlisting">
UPDATE t1 SET utf8_bin_column=latin1_column;
INSERT INTO t1 (latin1_column) SELECT utf8_bin_column FROM t2;
</pre></li><li class="listitem"><p>
              文字列リテラルを使用して、<code class="literal">INSERT</code> または <code class="literal">UPDATE</code> のカラム値を割り当てる場合:
            </p><pre class="programlisting">
SET NAMES latin1;
INSERT INTO t1 (utf8_bin_column) VALUES ('string-in-latin1');
</pre></li><li class="listitem"><p>
              サーバーからクライアントに結果を送信する場合:
            </p><pre class="programlisting">
SET NAMES latin1;
SELECT utf8_bin_column FROM t2;
</pre></li></ul></div><p>
          バイナリ文字列カラムの場合、変換は行われません。前述の場合、文字列値はバイトのようにコピーされます。
        </p><p>
          <span class="bold"><strong>大文字と小文字の変換。</strong></span>照合順序は文字の大文字と小文字に関する情報をもたらすので、非バイナリ文字列内の文字は大文字と小文字を変換できます。これは、順序で大文字と小文字の区別を無視する <code class="literal">_bin</code> 照合順序の場合でも該当します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET NAMES latin1 COLLATE latin1_bin;</code></strong>
Query OK, 0 rows affected (0.02 sec)

mysql&gt; <strong class="userinput"><code>SELECT LOWER('aA'), UPPER('zZ');</code></strong>
+-------------+-------------+
| LOWER('aA') | UPPER('zZ') |
+-------------+-------------+
| aa          | ZZ          |
+-------------+-------------+
1 row in set (0.13 sec)
</pre><p>
          大文字と小文字という概念は、バイナリ文字列内のバイトには適用されません。大文字と小文字の変換を行うには、文字列を非バイナリ文字列に変換する必要があります。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET NAMES binary;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT LOWER('aA'), LOWER(CONVERT('aA' USING latin1));</code></strong>
+-------------+-----------------------------------+
| LOWER('aA') | LOWER(CONVERT('aA' USING latin1)) |
+-------------+-----------------------------------+
| aA          | aa                                |
+-------------+-----------------------------------+
1 row in set (0.00 sec)
</pre><p>
          <span class="bold"><strong>比較での後続スペースの処理。</strong></span>非バイナリ文字列には、<code class="literal">_bin</code> 照合順序を含むすべての照合順序に対する <code class="literal">PADSPACE</code> 動作があります。後続スペースは比較で意味がありません。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET NAMES utf8 COLLATE utf8_bin;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT 'a ' = 'a';</code></strong>
+------------+
| 'a ' = 'a' |
+------------+
|          1 |
+------------+
1 row in set (0.00 sec)
</pre><p>
          バイナリ文字列では、後続スペースを含むすべての文字が比較で重要になります。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET NAMES binary;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT 'a ' = 'a';</code></strong>
+------------+
| 'a ' = 'a' |
+------------+
|          0 |
+------------+
1 row in set (0.00 sec)
</pre><p>
          <span class="bold"><strong>挿入および取り出しでの後続スペースの処理。</strong></span><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code> 列には非バイナリ文字列が格納されます。<em class="replaceable"><code>N</code></em> 文字より短い値は、挿入時にスペースで拡張されます。取り出しの場合、後続スペースは削除されます。
        </p><p>
          <code class="literal">BINARY(<em class="replaceable"><code>N</code></em>)</code> 列にはバイナリ文字列が格納されます。<em class="replaceable"><code>N</code></em> バイトより短い値は、挿入時に <code class="literal">0x00</code> バイトで拡張されます。取り出しの場合、何も削除されず、宣言された長さの値が常に返されます。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (</code></strong>
    -&gt; <strong class="userinput"><code>  a CHAR(10) CHARACTER SET utf8 COLLATE utf8_bin,</code></strong>
    -&gt; <strong class="userinput"><code>  b BINARY(10)</code></strong>
    -&gt; <strong class="userinput"><code>);</code></strong>
Query OK, 0 rows affected (0.09 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO t1 VALUES ('a','a');</code></strong>
Query OK, 1 row affected (0.01 sec)

mysql&gt; <strong class="userinput"><code>SELECT HEX(a), HEX(b) FROM t1;</code></strong>
+--------+----------------------+
| HEX(a) | HEX(b)               |
+--------+----------------------+
| 61     | 61000000000000000000 |
+--------+----------------------+
1 row in set (0.04 sec)
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-binary-op"></a>10.1.7.7 BINARY 演算子</h4></div></div></div><p>
          <code class="literal">BINARY</code> 演算子は、それに続く文字列をバイナリ文字列にキャストします。これは、比較を文字ごとでなくバイトごとに強制的に実行させる簡単な方法です。また、<code class="literal">BINARY</code> では末尾の空白文字が重要になります。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT 'a' = 'A';</code></strong>
        -&gt; 1
mysql&gt; <strong class="userinput"><code>SELECT BINARY 'a' = 'A';</code></strong>
        -&gt; 0
mysql&gt; <strong class="userinput"><code>SELECT 'a' = 'a ';</code></strong>
        -&gt; 1
mysql&gt; <strong class="userinput"><code>SELECT BINARY 'a' = 'a ';</code></strong>
        -&gt; 0
</pre><p>
          <code class="literal">BINARY <em class="replaceable"><code>str</code></em></code> は <code class="literal">CAST(<em class="replaceable"><code>str</code></em> AS BINARY)</code> の略でもあります。
        </p><p>
          文字カラム定義内の <code class="literal">BINARY</code> 属性には別の効果があります。<code class="literal">BINARY</code> 属性で定義された文字カラムには、カラム文字セットのバイナリ照合順序が割り当てられます。すべての文字セットにバイナリ照合順序があります。たとえば、<code class="literal">latin1</code> 文字セットのバイナリ照合順序は <code class="literal">latin1_bin</code> です。このためテーブルのデフォルト文字セットが <code class="literal">latin1</code> の場合、次の 2 つのカラム定義は同等になります。
        </p><pre class="programlisting">
CHAR(10) BINARY
CHAR(10) CHARACTER SET latin1 COLLATE latin1_bin
</pre><p>
          <code class="literal">BINARY</code> のカラム属性としての効果は、MySQL 4.1 より前の効果とは異なります。以前は、<code class="literal">BINARY</code> は、バイナリ文字列として扱われたカラムになっていました。バイナリ文字列は、文字セットや照合順序がないバイトの文字列であり、バイナリ照合順序を持つ非バイナリ文字列とは異なります。どちらのタイプの文字列についても、比較は文字列単位の数値に基づいて行われますが、非バイナリ文字列については、単位は文字であり、文字セットによってはマルチバイト文字をサポートします。<a class="xref" href="data-types.html#binary-varbinary" title="11.4.2 BINARY および VARBINARY 型">セクション11.4.2「BINARY および VARBINARY 型」</a>を参照してください。
        </p><p>
          <code class="literal">CHAR</code>、<code class="literal">VARCHAR</code>、または <code class="literal">TEXT</code> カラムの定義で <code class="literal">CHARACTER SET binary</code> を使用すると、このカラムはバイナリデータ型として扱われます。たとえば、次のペアになった定義は同等です。
        </p><pre class="programlisting">
CHAR(10) CHARACTER SET binary
BINARY(10)

VARCHAR(10) CHARACTER SET binary
VARBINARY(10)

TEXT CHARACTER SET binary
BLOB
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-collation-effect"></a>10.1.7.8 照合順序の効果の例</h4></div></div></div><p>
          <span class="bold"><strong>例 1: ドイツ語のウムラウトのソート</strong></span>
        </p><p>
          テーブル <code class="literal">T</code> のカラム <code class="literal">X</code> に次の <code class="literal">latin1</code> カラムの値が設定されているとします。
        </p><pre class="programlisting">
Muffler
Müller
MX Systems
MySQL
</pre><p>
          さらに、次のステートメントを使用してカラムの値を取得するとします。
        </p><pre class="programlisting">
SELECT X FROM T ORDER BY X COLLATE <em class="replaceable"><code>collation_name</code></em>;
</pre><p>
          次の表に、別の照合順序で <code class="literal">ORDER BY</code> を使用した場合に得られる値の順序を示します。
        </p><div class="informaltable"><table summary="この表では、これまでに説明した照合順序の効果の例を示します。表には、ORDER BY を使用するときに、3 つの照合順序 (latin1_swedish_ci、 latin1_german1_ci、latin1_german2_ci) で得られる値の順序が示されます。" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col"><code class="literal">latin1_swedish_ci</code></th><th scope="col"><code class="literal">latin1_german1_ci</code></th><th scope="col"><code class="literal">latin1_german2_ci</code></th></tr></thead><tbody><tr><td scope="row">Muffler</td><td>Muffler</td><td>Müller</td></tr><tr><td scope="row">MX Systems</td><td>Müller</td><td>Muffler</td></tr><tr><td scope="row">Müller</td><td>MX Systems</td><td>MX Systems</td></tr><tr><td scope="row">MySQL</td><td>MySQL</td><td>MySQL</td></tr></tbody></table></div><p>
          この例でソート順の違いを生じさせている文字は、頭に 2 つの点が付いた U (<code class="literal">ü</code>) であり、これはドイツ語で<span class="quote">「<span class="quote">U ウムラウト</span>」</span>と呼ばれているものです。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              最初のカラムには、スウェーデン語/フィンランド語の照合ルールを使用した <code class="literal">SELECT</code> の結果が示されています。この照合ルールによると、U ウムラウトは Y とソート順が一致します。
            </p></li><li class="listitem"><p>
              2 番目のカラムには、German DIN-1 ルールを使用した <code class="literal">SELECT</code> の結果が示されています。この照合ルールによると、U ウムラウトは U とソート順が一致します。
            </p></li><li class="listitem"><p>
              3 番目のカラムには、German DIN-2 ルールを使用した <code class="literal">SELECT</code> の結果が示されています。この照合ルールによると、U ウムラウトは UE とソート順が一致します。
            </p></li></ul></div><p>
          <span class="bold"><strong>例 2: ドイツ語のウムラウトの検索</strong></span>
        </p><p>
          使用される文字セットと照合順序だけが異なる次の 3 つのテーブルがあるとします。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET NAMES utf8;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE TABLE german1 (</code></strong>
    -&gt; <strong class="userinput"><code>  c CHAR(10)</code></strong>
    -&gt; <strong class="userinput"><code>) CHARACTER SET latin1 COLLATE latin1_german1_ci;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE TABLE german2 (</code></strong>
    -&gt; <strong class="userinput"><code>  c CHAR(10)</code></strong>
    -&gt; <strong class="userinput"><code>) CHARACTER SET latin1 COLLATE latin1_german2_ci;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE TABLE germanutf8 (</code></strong>
    -&gt; <strong class="userinput"><code>  c CHAR(10)</code></strong>
    -&gt; <strong class="userinput"><code>) CHARACTER SET utf8 COLLATE utf8_unicode_ci;</code></strong>
</pre><p>
          各テーブルには次の 2 つのレコードが含まれます。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>INSERT INTO german1 VALUES ('Bar'), ('Bär');</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO german2 VALUES ('Bar'), ('Bär');</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO germanutf8 VALUES ('Bar'), ('Bär');</code></strong>
</pre><p>
          上記の照合順序の 2 つには <code class="literal">A = Ä</code> の等式が含まれ、1 つにはこのような等式はありません (<code class="literal">latin1_german2_ci</code>)。そのため、比較では次の結果が得られます。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM german1 WHERE c = 'Bär';</code></strong>
+------+
| c    |
+------+
| Bar  |
| Bär  |
+------+
mysql&gt; <strong class="userinput"><code>SELECT * FROM german2 WHERE c = 'Bär';</code></strong>
+------+
| c    |
+------+
| Bär  |
+------+
mysql&gt; <strong class="userinput"><code>SELECT * FROM germanutf8 WHERE c = 'Bär';</code></strong>
+------+
| c    |
+------+
| Bar  |
| Bär  |
+------+
</pre><p>
          これはバグではなく、<code class="literal">latin1_german1_ci</code> と <code class="literal">utf8_unicode_ci</code> のソートプロパティーの結果です (示されたソートは、German DIN 5007 標準に従って行われています)。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-collation-information-schema"></a>10.1.7.9 照合順序と INFORMATION_SCHEMA 検索</h4></div></div></div><a class="indexterm" name="idm139979106859968"></a><a class="indexterm" name="idm139979106857792"></a><p>
          <code class="literal">INFORMATION_SCHEMA</code> テーブルでの文字列カラムには <code class="literal">utf8_general_ci</code> の照合順序があり、これは大文字と小文字を区別しません。ただし、<code class="literal">INFORMATION_SCHEMA</code> 文字列カラムでの検索には、ファイルシステムでの大文字と小文字の区別も影響します。データベースやテーブルの名前など、ファイルシステムで表されるオブジェクトに対応する値については、ファイルシステムで大文字と小文字を区別する場合は、検索で大文字と小文字が区別されることがあります。このセクションでは、必要に応じて、この問題を解決する方法を説明します。Bug #34921 も参照してください。
        </p><p>
          クエリーで、<code class="literal">test</code> データベースに対し <code class="literal">SCHEMATA.SCHEMA_NAME</code> カラムを検索するとします。Linux では、ファイルシステムで大文字と小文字を区別するので、<code class="literal">SCHEMATA.SCHEMA_NAME</code> の <code class="literal">'test'</code> との比較は一致しますが、<code class="literal">'TEST'</code> との比較は一致しません。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA</code></strong>
    -&gt; <strong class="userinput"><code>WHERE SCHEMA_NAME = 'test';</code></strong>
+-------------+
| SCHEMA_NAME |
+-------------+
| test        |
+-------------+
1 row in set (0.01 sec)

mysql&gt; <strong class="userinput"><code>SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA</code></strong>
    -&gt; <strong class="userinput"><code>WHERE SCHEMA_NAME = 'TEST';</code></strong>
Empty set (0.00 sec)
</pre><p>
          Windows または OS X では、ファイルシステムで大文字と小文字を区別しないので、比較は <code class="literal">'test'</code> と <code class="literal">'TEST'</code> の両方と一致します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA</code></strong>
    -&gt; <strong class="userinput"><code>WHERE SCHEMA_NAME = 'test';</code></strong>
+-------------+
| SCHEMA_NAME |
+-------------+
| test        |
+-------------+
1 row in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA</code></strong>
    -&gt; <strong class="userinput"><code>WHERE SCHEMA_NAME = 'TEST';</code></strong>
+-------------+
| SCHEMA_NAME |
+-------------+
| TEST        |
+-------------+
1 row in set (0.00 sec)
</pre><p>
          <code class="literal">lower_case_table_names</code> システム変数の値はこのコンテキストでは違いをもたらしません。
        </p><p>
          ファイルシステム内でデータベースオブジェクトを検索するときに、<code class="literal">INFORMATION_SCHEMA</code> クエリーで <code class="literal">utf8_general_ci</code> 照合順序が使用されていないために、このような処理が行われます。これは、MySQL での <code class="literal">INFORMATION_SCHEMA</code> 検索に対して実装された最適化の結果です。これらの最適化の詳細は、<a class="xref" href="optimization.html#information-schema-optimization" title="8.2.4 INFORMATION_SCHEMA クエリーの最適化">セクション8.2.4「INFORMATION_SCHEMA クエリーの最適化」</a>を参照してください。
        </p><p>
          <code class="literal">INFORMATION_SCHEMA</code> は <span class="quote">「<span class="quote">仮想</span>」</span>データベースであり、ファイルシステムには表されないので、<code class="literal">INFORMATION_SCHEMA</code> 文字列カラム内で <code class="literal">INFORMATION_SCHEMA</code> 自体を参照する値を検索する場合、<code class="literal">utf8_general_ci</code> 照合順序を使用します。たとえば、<code class="literal">SCHEMATA.SCHEMA_NAME</code> との比較は、プラットフォームに関係なく、<code class="literal">'information_schema'</code> または <code class="literal">'INFORMATION_SCHEMA'</code> に一致します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA</code></strong>
    -&gt; <strong class="userinput"><code>WHERE SCHEMA_NAME = 'information_schema';</code></strong>
+--------------------+
| SCHEMA_NAME        |
+--------------------+
| information_schema |
+--------------------+
1 row in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA</code></strong>
    -&gt; <strong class="userinput"><code>WHERE SCHEMA_NAME = 'INFORMATION_SCHEMA';</code></strong>
+--------------------+
| SCHEMA_NAME        |
+--------------------+
| information_schema |
+--------------------+
1 row in set (0.00 sec)
</pre><p>
          <code class="literal">INFORMATION_SCHEMA</code> カラムでの文字列演算の結果が予想と異なる場合、回避策は、明示的な <code class="literal">COLLATE</code> 句を使用して、適切な照合順序を強制的に使用することです (<a class="xref" href="globalization.html#charset-collate" title="10.1.7.2 SQL ステートメントでの COLLATE の使用">セクション10.1.7.2「SQL ステートメントでの COLLATE の使用」</a>)。たとえば、大文字と小文字を区別しない検索を実行するには、<code class="literal">INFORMATION_SCHEMA</code> カラム名とともに <code class="literal">COLLATE</code> を使用します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA</code></strong>
    -&gt; <strong class="userinput"><code>WHERE SCHEMA_NAME COLLATE utf8_general_ci = 'test';</code></strong>
+-------------+
| SCHEMA_NAME |
+-------------+
| test        |
+-------------+
1 row in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA</code></strong>
    -&gt; <strong class="userinput"><code>WHERE SCHEMA_NAME COLLATE utf8_general_ci = 'TEST';</code></strong>
| SCHEMA_NAME |
+-------------+
| test        |
+-------------+
1 row in set (0.00 sec)
</pre><p>
          <code class="literal">UPPER()</code> または <code class="literal">LOWER()</code> 関数を使用することもできます。
        </p><pre class="programlisting">
WHERE UPPER(SCHEMA_NAME) = 'TEST'
WHERE LOWER(SCHEMA_NAME) = 'test'
</pre><p>
          大文字と小文字を区別するファイルシステムのプラットフォームでも、大文字と小文字を区別しない比較を実行できますが、前述のように、必ずしも常に正しい処理になるとはかぎりません。このようなプラットフォームでは、大文字と小文字だけが異なる名前の複数のオブジェクトが存在する可能性があります。たとえば、<code class="literal">city</code>、<code class="literal">CITY</code>、および <code class="literal">City</code> という名前のテーブルがすべて同時に存在することが可能です。検索でこれらのすべての名前に一致するか、1 つだけに一致するかを検討し、それに応じてクエリーを作成します。
        </p><pre class="programlisting">
WHERE TABLE_NAME COLLATE utf8_bin = 'City'
WHERE TABLE_NAME COLLATE utf8_general_ci = 'city'
WHERE UPPER(TABLE_NAME) = 'CITY'
WHERE LOWER(TABLE_NAME) = 'city'
</pre><p>
          これらのうち最初の比較 (<code class="literal">utf8_bin</code> 使用) では大文字と小文字を区別します。ほかの比較では区別しません。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-repertoire"></a>10.1.8 文字列のレパートリー</h3></div></div></div><a class="indexterm" name="idm139979106802944"></a><a class="indexterm" name="idm139979106800832"></a><p>
        文字セットの<em class="firstterm">レパートリー</em>とは、そのセット内の文字の集合です。
      </p><p>
        文字列式にはレパートリー属性があり、その値は次の 2 つです。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">ASCII</code>: <code class="literal">U+0000</code> から <code class="literal">U+007F</code> の Unicode 範囲内の文字だけを式に含めることができます。
          </p></li><li class="listitem"><p>
            <code class="literal">UNICODE</code>: <code class="literal">U+0000</code> から <code class="literal">U+FFFF</code> の Unicode 範囲内の文字を式に含めることができます。
          </p></li></ul></div><p>
        <code class="literal">ASCII</code> 範囲は <code class="literal">UNICODE</code> 範囲のサブセットであるので、<code class="literal">ASCII</code> レパートリーの文字列は、<code class="literal">UNICODE</code> レパートリーの文字列の文字セットに、または <code class="literal">ASCII</code> のスーパーセットである文字セットに、情報を失うことなく安全に変換できます。(すべての MySQL 文字セットは、スウェーデン語のアクセント符号付き文字に一部の句読点文字を再使用する <code class="literal">swe7</code> を除き、<code class="literal">ASCII</code> のスーパーセットです。)MySQL から<span class="quote">「<span class="quote">照合順序の不正な混在</span>」</span>エラーが返されるような多くの場合でも、レパートリーを使用すると、式内の文字セットを変換できます。
      </p><p>
        次の説明では、式とそのレパートリーの例を挙げ、レパートリーの使用によって、文字列式の評価がどのように変わるかを示します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            文字列定数のレパートリーは、文字列の内容に応じて異なります。
          </p><pre class="programlisting">
SET NAMES utf8; SELECT 'abc';
SELECT _utf8'def';
SELECT N'MySQL';
</pre><p>
            前述のそれぞれの場合では文字セットは <code class="literal">utf8</code> ですが、実際には ASCII 範囲外の文字は 1 つも文字列に含まれていないので、そのレパートリーは <code class="literal">UNICODE</code> ではなく <code class="literal">ASCII</code> です。
          </p></li><li class="listitem"><p>
            <code class="literal">ascii</code> 文字セットを含むカラムには、その文字セットのために、<code class="literal">ASCII</code> レパートリーがあります。次のテーブルでは、<code class="literal">c1</code> には <code class="literal">ASCII</code> レパートリーがあります。
          </p><pre class="programlisting">
CREATE TABLE t1 (c1 CHAR(1) CHARACTER SET ascii);
</pre><p>
            次の例では、レパートリーがないときにエラーが発生する場合に、レパートリーによってどのように結果が求められるようになるかを示しています。
          </p><pre class="programlisting">
CREATE TABLE t1 (
  c1 CHAR(1) CHARACTER SET latin1,
  c2 CHAR(1) CHARACTER SET ascii
);
INSERT INTO t1 VALUES ('a','b');
SELECT CONCAT(c1,c2) FROM t1;
</pre><p>
            レパートリーがない場合、次のエラーが発生します。
          </p><pre class="programlisting">
ERROR 1267 (HY000): Illegal mix of collations (latin1_swedish_ci,IMPLICIT)
and (ascii_general_ci,IMPLICIT) for operation 'concat'
</pre><p>
            レパートリーを使用すると、サブセットからスーパーセットへ (<code class="literal">ascii</code> から <code class="literal">latin1</code> へ) の変換を行うことができ、結果が返されます。
          </p><pre class="programlisting">
+---------------+
| CONCAT(c1,c2) |
+---------------+
| ab            |
+---------------+
</pre></li><li class="listitem"><p>
            1 つの文字列引数を持つ関数は、その引数のレパートリーを継承します。<code class="literal">UPPER(_utf8'<em class="replaceable"><code>abc</code></em>')</code> の場合、引数に <code class="literal">ASCII</code> レパートリーがあるので、その結果には <code class="literal">ASCII</code> レパートリーが存在します。
          </p></li><li class="listitem"><p>
            文字列を返すが、文字列引数を持たず、結果文字セットとして <code class="literal">character_set_connection</code> を使用する関数の場合、結果のレパートリーは、<code class="literal">character_set_connection</code> が <code class="literal">ascii</code> である場合は <code class="literal">ASCII</code> に、それ以外の場合は <code class="literal">UNICODE</code> になります。
          </p><pre class="programlisting">
FORMAT(<em class="replaceable"><code>numeric_column</code></em>, 4);
</pre><p>
            レパートリーを使用するかどうかによって、MySQL が次の例をどのように評価するかが変わります。
          </p><pre class="programlisting">
SET NAMES ascii;
CREATE TABLE t1 (a INT, b VARCHAR(10) CHARACTER SET latin1);
INSERT INTO t1 VALUES (1,'b');
SELECT CONCAT(FORMAT(a, 4), b) FROM t1;
</pre><p>
            レパートリーがない場合、次のエラーが発生します。
          </p><pre class="programlisting">
ERROR 1267 (HY000): Illegal mix of collations (ascii_general_ci,COERCIBLE)
and (latin1_swedish_ci,IMPLICIT) for operation 'concat'
</pre><p>
            レパートリーを使用すると、次のように結果が返されます。
          </p><pre class="programlisting">
+-------------------------+
| CONCAT(FORMAT(a, 4), b) |
+-------------------------+
| 1.0000b                 |
+-------------------------+
</pre></li><li class="listitem"><p>
            2 つ以上の文字列引数を持つ関数は、結果のレパートリーとして、<span class="quote">「<span class="quote">もっとも範囲の広い</span>」</span>引数レパートリーを使用します (<code class="literal">UNICODE</code> は <code class="literal">ASCII</code> よりも範囲が広くなります)。次の <code class="literal">CONCAT()</code> 呼び出しを考えてみます。
          </p><pre class="programlisting">
CONCAT(_ucs2 0x0041, _ucs2 0x0042)
CONCAT(_ucs2 0x0041, _ucs2 0x00C2)
</pre><p>
            最初の呼び出しでは、両方の引数が <code class="literal">ascii</code> 文字セットの範囲内にあるので、レパートリーは <code class="literal">ASCII</code> です。2 番目の呼び出しでは、2 番目の引数が <code class="literal">ascii</code> 文字セット範囲外にあるので、レパートリーは <code class="literal">UNICODE</code> です。
          </p></li><li class="listitem"><p>
            関数の戻り値のレパートリーは、結果の文字セットおよび照合順序に影響する引数のレパートリーにのみ基づいて定められます。
          </p><pre class="programlisting">
IF(column1 &lt; column2, 'smaller', 'greater')
</pre><p>
            結果のレパートリーは、2 つの文字列引数 (2 番目の引数と 3 番目の引数) がどちらも <code class="literal">ASCII</code> レパートリーなので、<code class="literal">ASCII</code> です。最初の引数は、式で文字列値を使用する場合でも、結果のレパートリーにとっては重要ではありません。
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-operations"></a>10.1.9 文字セットのサポートによる影響を受ける演算</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="globalization.html#charset-result">10.1.9.1 結果文字列</a></span></dt><dt><span class="section"><a href="globalization.html#charset-convert">10.1.9.2 CONVERT() と CAST()</a></span></dt><dt><span class="section"><a href="globalization.html#charset-show">10.1.9.3 SHOW ステートメントと INFORMATION_SCHEMA</a></span></dt></dl></div><p>
        このセクションでは、文字セット情報を考慮した演算について説明します。
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-result"></a>10.1.9.1 結果文字列</h4></div></div></div><p>
          MySQL には、文字列を返す多数の演算子と関数があります。このセクションでは、そのような文字列の文字セットと照合順序について説明します。
        </p><p>
          文字列の入力を取得して文字列の結果を出力として返す単純な関数では、出力の文字セットおよび照合順序は、主要な入力値の文字セットおよび照合順序と同じです。たとえば、<code class="literal">UPPER(<em class="replaceable"><code>X</code></em>)</code> は、文字セットおよび照合順序が <em class="replaceable"><code>X</code></em> と同じ文字列を返します。同じことは、<code class="literal">INSTR()</code>、<code class="literal">LCASE()</code>、<code class="literal">LOWER()</code>、<code class="literal">LTRIM()</code>、<code class="literal">MID()</code>、<code class="literal">REPEAT()</code>、<code class="literal">REPLACE()</code>、<code class="literal">REVERSE()</code>、<code class="literal">RIGHT()</code>、<code class="literal">RPAD()</code>、<code class="literal">RTRIM()</code>、<code class="literal">SOUNDEX()</code>、<code class="literal">SUBSTRING()</code>、<code class="literal">TRIM()</code>、<code class="literal">UCASE()</code>、および <code class="literal">UPPER()</code> についても当てはまります。
        </p><p>
          注: <code class="literal">REPLACE()</code> 関数はほかのどの関数とも異なり、文字列入力の照合順序を無視し、大文字と小文字が区別される比較を毎回実行します。
        </p><p>
          入力文字列または関数の結果がバイナリ文字列の場合、その文字列には文字セットも照合順序もありません。これは <code class="literal">CHARSET()</code> と <code class="literal">COLLATION()</code> 関数を使ってチェックできます。両関数とも、引数がバイナリ文字列であることを示す <code class="literal">binary</code> を返します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT CHARSET(BINARY 'a'), COLLATION(BINARY 'a');</code></strong>
+---------------------+-----------------------+
| CHARSET(BINARY 'a') | COLLATION(BINARY 'a') |
+---------------------+-----------------------+
| binary              | binary                |
+---------------------+-----------------------+
</pre><p>
          複数の文字列入力を組み合わせて単一の文字列出力を返す演算では、結果の照合順序の特定に次の標準 SQL の<span class="quote">「<span class="quote">アグリゲーションルール</span>」</span>が適用されます。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              明示的な <code class="literal">COLLATE <em class="replaceable"><code>X</code></em></code> が行われた場合、<em class="replaceable"><code>X</code></em> を使用します。
            </p></li><li class="listitem"><p>
              明示的な <code class="literal">COLLATE <em class="replaceable"><code>X</code></em></code> と <code class="literal">COLLATE <em class="replaceable"><code>Y</code></em></code> が行われた場合、エラーが発生します。
            </p></li><li class="listitem"><p>
              上記以外の場合ですべての照合順序が <em class="replaceable"><code>X</code></em> であるときは、<em class="replaceable"><code>X</code></em> を使用します。
            </p></li><li class="listitem"><p>
              その他の場合、結果に照合順序はありません。
            </p></li></ul></div><p>
          たとえば、<code class="literal">CASE ... WHEN a THEN b WHEN b THEN c COLLATE <em class="replaceable"><code>X</code></em> END</code> と指定されている場合、結果の照合順序は <em class="replaceable"><code>X</code></em> になります。同じことは、<code class="literal">UNION</code>、<code class="literal">||</code>、<code class="literal">CONCAT()</code>、<code class="literal">ELT()</code>、<code class="literal">GREATEST()</code>、<code class="literal">IF()</code>、および <code class="literal">LEAST()</code> にも当てはまります。
        </p><p>
          文字データに変換する演算の場合、この演算の結果得られる文字列の文字セットと照合順序は、<code class="literal">character_set_connection</code> と <code class="literal">collation_connection</code> システム変数値によって定義されています。このことは、<code class="literal">CAST()</code>、<code class="literal">CONV()</code>、<code class="literal">FORMAT()</code>、<code class="literal">HEX()</code>、および <code class="literal">SPACE()</code> にのみ当てはまります。
        </p><p>
          文字列関数で返される結果の文字セットまたは照合順序について不確かな場合は、<code class="literal">CHARSET()</code> または <code class="literal">COLLATION()</code> 関数を使用して調べることができます。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CHARSET(USER()), COLLATION(USER());</code></strong>
+----------------+-----------------+-------------------+
| USER()         | CHARSET(USER()) | COLLATION(USER()) |
+----------------+-----------------+-------------------+
| test@localhost | utf8            | utf8_general_ci   |
+----------------+-----------------+-------------------+
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-convert"></a>10.1.9.2 CONVERT() と CAST()</h4></div></div></div><p>
          <code class="literal">CONVERT()</code> を使用すると、異なる文字セット間でデータを変換できます。構文は次のとおりです。
        </p><pre class="programlisting">
CONVERT(<em class="replaceable"><code>expr</code></em> USING <em class="replaceable"><code>transcoding_name</code></em>)
</pre><p>
          MySQL では、トランスコーディング名は対応する文字セット名と同じです。
        </p><p>
          例:
        </p><pre class="programlisting">
SELECT CONVERT(_latin1'Müller' USING utf8);
INSERT INTO utf8table (utf8column)
    SELECT CONVERT(latin1field USING utf8) FROM latin1table;
</pre><p>
          <code class="literal">CONVERT(... USING ...)</code> は、標準 SQL の仕様に基づき実装されています。
        </p><p>
          <code class="literal">CAST()</code> を使用し、文字列を別の文字セットに変換することもできます。構文は次のとおりです。
        </p><pre class="programlisting">
CAST(<em class="replaceable"><code>character_string</code></em> AS <em class="replaceable"><code>character_data_type</code></em> CHARACTER SET <em class="replaceable"><code>charset_name</code></em>)
</pre><p>
          例:
        </p><pre class="programlisting">
SELECT CAST(_latin1'test' AS CHAR CHARACTER SET utf8);
</pre><p>
          <code class="literal">CHARACTER SET</code> を指定せずに <code class="literal">CAST()</code> を使用した場合、文字セットと照合順序は <code class="literal">character_set_connection</code> および <code class="literal">collation_connection</code> システム変数で定義されます。<code class="literal">CHARACTER SET X</code> を指定して <code class="literal">CAST()</code> を使用した場合、文字セットは<code class="literal">X</code>、照合順序は <code class="literal">X</code> のデフォルト照合順序になります。
        </p><p>
          <code class="literal">CONVERT()</code> または <code class="literal">CAST()</code> 呼び出し内では <code class="literal">COLLATE</code> 句を使用できませんが、呼び出し外では使用できます。たとえば、<code class="literal">CAST(... COLLATE ...)</code> は無効ですが、<code class="literal">CAST(...) COLLATE ...</code> は有効です。
        </p><pre class="programlisting">
SELECT CAST(_latin1'test' AS CHAR CHARACTER SET utf8) COLLATE utf8_bin;
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-show"></a>10.1.9.3 SHOW ステートメントと INFORMATION_SCHEMA</h4></div></div></div><p>
          複数の <code class="literal">SHOW</code> ステートメントから文字セットの追加情報が得られます。これらには <code class="literal">SHOW CHARACTER SET</code>、<code class="literal">SHOW COLLATION</code>、<code class="literal">SHOW CREATE DATABASE</code>、<code class="literal">SHOW CREATE TABLE</code>、および <code class="literal">SHOW COLUMNS</code> が含まれます。ここでは、これらのステートメントについて簡単に説明します。詳細は、<a class="xref" href="sql-syntax.html#show" title="13.7.5 SHOW 構文">セクション13.7.5「SHOW 構文」</a>を参照してください。
        </p><p>
          <code class="literal">INFORMATION_SCHEMA</code> には、<code class="literal">SHOW</code> ステートメントで表示されるものに類似した情報を含む複数のテーブルが含まれます。たとえば、<code class="literal">CHARACTER_SETS</code> および <code class="literal">COLLATIONS</code> テーブルには、<code class="literal">SHOW CHARACTER SET</code> および <code class="literal">SHOW COLLATION</code> で表示される情報が含まれます。<a class="xref" href="information-schema.html" title="第 21 章 INFORMATION_SCHEMA テーブル">第21章「<i>INFORMATION_SCHEMA テーブル</i>」</a>を参照してください。
        </p><p>
          <code class="literal">SHOW CHARACTER SET</code> ステートメントは使用可能な文字セットをすべて表示します。一致する文字セット名を指定するには、オプションの <code class="literal">LIKE</code> 句を使用します。例:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW CHARACTER SET LIKE 'latin%';</code></strong>
+---------+-----------------------------+-------------------+--------+
| Charset | Description                 | Default collation | Maxlen |
+---------+-----------------------------+-------------------+--------+
| latin1  | cp1252 West European        | latin1_swedish_ci |      1 |
| latin2  | ISO 8859-2 Central European | latin2_general_ci |      1 |
| latin5  | ISO 8859-9 Turkish          | latin5_turkish_ci |      1 |
| latin7  | ISO 8859-13 Baltic          | latin7_general_ci |      1 |
+---------+-----------------------------+-------------------+--------+
</pre><p>
          <code class="literal">SHOW COLLATION</code> からの出力には、使用可能なすべての文字セットが含まれます。一致する照合順序名を指定するには、オプションの <code class="literal">LIKE</code> 句を使用します。例:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW COLLATION LIKE 'latin1%';</code></strong>
+-------------------+---------+----+---------+----------+---------+
| Collation         | Charset | Id | Default | Compiled | Sortlen |
+-------------------+---------+----+---------+----------+---------+
| latin1_german1_ci | latin1  |  5 |         |          |       0 |
| latin1_swedish_ci | latin1  |  8 | Yes     | Yes      |       0 |
| latin1_danish_ci  | latin1  | 15 |         |          |       0 |
| latin1_german2_ci | latin1  | 31 |         | Yes      |       2 |
| latin1_bin        | latin1  | 47 |         | Yes      |       0 |
| latin1_general_ci | latin1  | 48 |         |          |       0 |
| latin1_general_cs | latin1  | 49 |         |          |       0 |
| latin1_spanish_ci | latin1  | 94 |         |          |       0 |
+-------------------+---------+----+---------+----------+---------+
</pre><p>
          <code class="literal">SHOW CREATE DATABASE</code> は、所定のデータベースを作成する <code class="literal">CREATE DATABASE</code> ステートメントを表示します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW CREATE DATABASE test;</code></strong>
+----------+-----------------------------------------------------------------+
| Database | Create Database                                                 |
+----------+-----------------------------------------------------------------+
| test     | CREATE DATABASE `test` /*!40100 DEFAULT CHARACTER SET latin1 */ |
+----------+-----------------------------------------------------------------+
</pre><p>
          <code class="literal">COLLATE</code> 句が表示されていなければ、文字セットのデフォルト照合順序が適用されます。
        </p><p>
          <code class="literal">SHOW CREATE TABLE</code> は類似していますが、所定のテーブルを作成する <code class="literal">CREATE TABLE</code> ステートメントを表示します。カラム定義は文字セット仕様を指定し、テーブルオプションは文字セット情報を含んでいます。
        </p><p>
          <code class="literal">SHOW COLUMNS</code> ステートメントは <code class="literal">SHOW FULL COLUMNS</code> として呼び出された場合、テーブルのカラムの照合順序を表示します。<code class="literal">CHAR</code>、<code class="literal">VARCHAR</code>、または <code class="literal">TEXT</code> データ型を含むカラムには照合順序があります。数値型およびほかの非文字型には照合順序はありません (<code class="literal">Collation</code> 値として <code class="literal">NULL</code> で示されます)。例:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW FULL COLUMNS FROM person\G</code></strong>
*************************** 1. row ***************************
     Field: id
      Type: smallint(5) unsigned
 Collation: NULL
      Null: NO
       Key: PRI
   Default: NULL
     Extra: auto_increment
Privileges: select,insert,update,references
   Comment:
*************************** 2. row ***************************
     Field: name
      Type: char(60)
 Collation: latin1_swedish_ci
      Null: NO
       Key:
   Default:
     Extra:
Privileges: select,insert,update,references
   Comment:

</pre><p>
          文字セットは表示の中にはなく、照合順序名で示されます。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-unicode"></a>10.1.10 Unicode のサポート</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="globalization.html#charset-unicode-ucs2">10.1.10.1 ucs2 文字セット (UCS-2 Unicode エンコーディング)</a></span></dt><dt><span class="section"><a href="globalization.html#charset-unicode-utf16">10.1.10.2 utf16 文字セット (UTF-16 Unicode エンコーディング)</a></span></dt><dt><span class="section"><a href="globalization.html#charset-unicode-utf16le">10.1.10.3 utf16le 文字セット (UTF-16LE Unicode エンコーディング)</a></span></dt><dt><span class="section"><a href="globalization.html#charset-unicode-utf32">10.1.10.4 utf32 文字セット (UTF-32 Unicode エンコーディング)</a></span></dt><dt><span class="section"><a href="globalization.html#charset-unicode-utf8">10.1.10.5 utf8 文字セット (3 バイト UTF-8 Unicode エンコーディング)</a></span></dt><dt><span class="section"><a href="globalization.html#charset-unicode-utf8mb3">10.1.10.6 utf8mb3 文字セット (utf8 のエイリアス)</a></span></dt><dt><span class="section"><a href="globalization.html#charset-unicode-utf8mb4">10.1.10.7 utf8mb4 文字セット (4 バイトの UTF-8 Unicode エンコーディング)</a></span></dt></dl></div><p>
        Unicode サポートの (MySQL 4.1 での) 初期実装には、Unicode データを格納するための次の 2 つの文字セットが含まれていました。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">ucs2</code>。文字ごとに 16 ビットを使用する Unicode 文字セットの UCS-2 エンコーディング。
          </p></li><li class="listitem"><p>
            <code class="literal">utf8</code>。文字ごとに 1 から 3 バイトを使用する Unicode 文字セットの UTF-8 エンコーディング。
          </p></li></ul></div><p>
        これらの 2 つの文字セットは、Unicode バージョン 3.0 の Basic Multilingual Plane (BMP) の文字をサポートします。BMP 文字には次の 3 つの特性があります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            これらのコード値は 0 から 65535 (または <code class="literal">U+0000</code> ..<code class="literal">U+FFFF</code>) です。
          </p></li><li class="listitem"><p>
            これらは、<code class="literal">ucs2</code> と同様に、16 ビット固定の単語でエンコードできます。
          </p></li><li class="listitem"><p>
            これらは、<code class="literal">utf8</code> と同様に、8、16、または 24 ビットでエンコードできます。
          </p></li><li class="listitem"><p>
            主要言語のほとんどすべての文字には、これらで十分です。
          </p></li></ul></div><p>
        前述の文字セットではサポートされていない文字には、BMP の範囲外にある補助文字が含まれます。BMP の範囲外の文字は、REPLACEMENT CHARACTER と見なされ、Unicode 文字セットへの変換時に、<code class="literal">'?'</code> に変換されます。
      </p><p>
        MySQL 5.6 での Unicode のサポートには補助文字が含まれるので、範囲がより広いため、より多くのスペースを占める新しい文字セットが必要になります。次の表では、以前の Unicode サポートと現在の Unicode サポートの機能を簡単に比較しています。
      </p><div class="informaltable"><table summary="次の表では、MySQL 5.5 よりも前の MySQL Unicode サポートと、MySQL 5.5 以降の Unicode のサポートとの比較を示しています。" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">MySQL 5.5 より前</th><th scope="col">MySQL 5.5 以降</th></tr></thead><tbody><tr><td scope="row">すべての Unicode 3.0 文字</td><td>すべての Unicode 5.0 および 6.0 文字</td></tr><tr><td scope="row">補助文字なし</td><td>補助文字あり</td></tr><tr><td scope="row"><code class="literal">ucs2</code> 文字セット、BMP のみ</td><td>変更なし</td></tr><tr><td scope="row">3 バイトまでの <code class="literal">utf8</code> 文字セット、BMP のみ</td><td>変更なし</td></tr><tr><td scope="row"> </td><td>4 バイトまでの新しい <code class="literal">utf8mb4</code> 文字セット、BMP または補助</td></tr><tr><td scope="row"> </td><td>新しい <code class="literal">utf16</code> 文字セット、BMP または補助</td></tr><tr><td scope="row"> </td><td>新しい <code class="literal">utf16le</code> 文字セット、BMP または補助 (5.6.1 以降)</td></tr><tr><td scope="row"> </td><td>新しい <code class="literal">utf32</code> 文字セット、BMP または補助</td></tr></tbody></table></div><p>
        これらの変更には上位互換性があります。新しい文字セットを使用する場合、アプリケーションの非互換性の問題が生じる可能性があります。<a class="xref" href="globalization.html#charset-unicode-upgrading" title="10.1.11 以前の Unicode サポートから現在の Unicode サポートへのアップグレード">セクション10.1.11「以前の Unicode サポートから現在の Unicode サポートへのアップグレード」</a>を参照してください。さらにこのセクションでは、<code class="literal">utf8</code> から (4 バイトの) <code class="literal">utf8mb4</code> 文字セットに変換する方法と、そのときに適用される可能性がある制約について説明します。
      </p><p>
        MySQL 5.6 は、次の Unicode 文字セットをサポートします。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">ucs2</code>。文字ごとに 16 ビットを使用する Unicode 文字セットの UCS-2 エンコーディング。
          </p></li><li class="listitem"><p>
            <code class="literal">utf16</code>。Unicode 文字セットの UTF-16 エンコーディング。<code class="literal">ucs2</code> に似ていますが、補助文字用の拡張機能があります。
          </p></li><li class="listitem"><p>
            <code class="literal">utf16le</code>。Unicode 文字セットの UTF-16LE エンコーディング。<code class="literal">utf16</code> と似ていますが、ビッグエンディアンではなくリトルエンディアンです。
          </p></li><li class="listitem"><p>
            <code class="literal">utf32</code>。文字ごとに 32 ビットを使用した Unicode 文字セットの UTF-32 エンコーディング。
          </p></li><li class="listitem"><p>
            <code class="literal">utf8</code>。文字ごとに 1 から 3 バイトを使用する Unicode 文字セットの UTF-8 エンコーディング。
          </p></li><li class="listitem"><p>
            <code class="literal">utf8mb4</code>。文字ごとに 1 から 4 バイトを使用した Unicode 文字セットの UTF-8 エンコーディング。
          </p></li></ul></div><p>
        <code class="literal">ucs2</code> および <code class="literal">utf8</code> は BMP 文字をサポートします。<code class="literal">utf8mb4</code>、<code class="literal">utf16</code>、<code class="literal">utf16le</code>、および <code class="literal">utf32</code> は、BMP および補助文字をサポートします。
      </p><p>
        類似した一連の照合順序を、ほとんどの Unicode 文字セットで使用できます。たとえば、それぞれにはデンマーク語の照合順序があり、その名前は <code class="literal">ucs2_danish_ci</code>、<code class="literal">utf16_danish_ci</code>、<code class="literal">utf32_danish_ci</code>、<code class="literal">utf8_danish_ci</code>、および <code class="literal">utf8mb4_danish_ci</code> です。例外は <code class="literal">utf16le</code> であり、2 つの照合順序しかありません。<a class="xref" href="globalization.html#charset-unicode-sets" title="10.1.14.1 Unicode 文字セット">セクション10.1.14.1「Unicode 文字セット」</a>にはすべての Unicode 照合順序が一覧表示されており、補助文字の照合順序プロパティーについても説明しています。
      </p><p>
        多くの補助文字は東アジアの言語のものですが、MySQL 5.6 で追加するサポートは、Unicode 文字セットでのより多くの日本語と中国語の文字に対するサポートであり、新しい日本語および中国語の文字セットのサポートではありません。
      </p><p>
        UCS-2、UTF-16、および UTF-32 の MySQL での実装は、ビッグエンディアンのバイト順で文字を格納し、値の先頭にバイト順マーク (BOM) を使用しません。ほかのデータベースシステムでは、リトルエンディアンのバイト順または BOM を使用していることもあります。このような場合、これらのシステムと MySQL の間でデータを転送するときに、値の変換を実行する必要があります。UTF-16LE の実装はリトルエンディアンです。
      </p><p>
        MySQL は UTF-8 値に BOM を使用しません。
      </p><p>
        Unicode を使用したサーバーと通信する必要があるクライアントアプリケーションは、たとえば <code class="literal">SET NAMES 'utf8'</code> ステートメントを発行することによって、クライアント文字セットをそれに従って設定する必要があります。<code class="literal">ucs2</code>、<code class="literal">utf16</code>、<code class="literal">utf16le</code>、および <code class="literal">utf32</code> は、クライアント文字セットとして使用できません。つまり、これらは <code class="literal">SET NAMES</code> または <code class="literal">SET CHARACTER SET</code> で機能しません。(<a class="xref" href="globalization.html#charset-connection" title="10.1.4 接続文字セットおよび照合順序">セクション10.1.4「接続文字セットおよび照合順序」</a>を参照してください。)
      </p><p>
        以降のセクションでは、MySQL における Unicode 文字セットについてさらに詳しく説明します。
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-unicode-ucs2"></a>10.1.10.1 ucs2 文字セット (UCS-2 Unicode エンコーディング)</h4></div></div></div><a class="indexterm" name="idm139979106533376"></a><p>
          UCS-2 では、すべての文字が 2 バイトの Unicode コードで表され、もっとも重要なバイトは 1 番目のバイトです。例: <code class="literal">LATIN CAPITAL LETTER A</code> にはコード <code class="literal">0x0041</code> があり、これは 2 バイトのシーケンス (<code class="literal">0x00 0x41</code>) として格納されます。<code class="literal">CYRILLIC SMALL LETTER YERU</code> (Unicode <code class="literal">0x044B</code>) は、2 バイトシーケンス (<code class="literal">0x04 0x4B</code>) として格納されます。Unicode 文字とそのコードについては、<a class="ulink" href="http://www.unicode.org/" target="_top">Unicode ホームページ</a>を参照してください。
        </p><p>
          MySQL では、<code class="literal">ucs2</code> 文字セットは、Unicode BMP 文字の 16 ビット固定長のエンコーディングです。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-unicode-utf16"></a>10.1.10.2 utf16 文字セット (UTF-16 Unicode エンコーディング)</h4></div></div></div><a class="indexterm" name="idm139979106523040"></a><p>
          <code class="literal">utf16</code> 文字セットは、補助文字のエンコーディングを可能にする拡張機能を備えた <code class="literal">ucs2</code> 文字セットです。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              BMP 文字の場合、<code class="literal">utf16</code> と <code class="literal">ucs2</code> には、同じコード値、同じエンコーディング、同じ長さという同一のストレージ特性があります。
            </p></li><li class="listitem"><p>
              補助文字の場合、<code class="literal">utf16</code> には、32 ビットを使用する文字を表すための特殊シーケンスがあります。これは、<span class="quote">「<span class="quote">サロゲート</span>」</span>メカニズムと呼ばれます。<code class="literal">0xffff</code> より大きな数値の場合、10 ビットを確保して、これらを <code class="literal">0xd800</code> に追加し、最初の 16 ビット語に配置します。さらに 10 ビットを確保して、これらを <code class="literal">0xdc00</code> に追加し、次の 16 ビット語に配置します。この結果、すべての補助文字に 32 ビットが必要になります。このうち最初の 16 ビットは <code class="literal">0xd800</code> と <code class="literal">0xdbff</code> の間の数値であり、残りの 16 ビットは <code class="literal">0xdc00</code> と <code class="literal">0xdfff</code> の間の数値になります。Unicode 4.0 ドキュメントの「<a class="ulink" href="http://unicode.org/versions/Unicode4.0.0/ch15.pdf" target="_top">15.5 Surrogates Area</a>」に例が記載されています。
            </p></li></ul></div><p>
          <code class="literal">utf16</code> はサロゲートをサポートし、<code class="literal">ucs2</code> をサポートしていないので、<code class="literal">utf16</code> でのみ適用される妥当性チェックがあります。下位サロゲートがなければ上位サロゲートを挿入できず、逆も同様です。例:
        </p><pre class="programlisting">
INSERT INTO t (ucs2_column) VALUES (0xd800); /* legal */
INSERT INTO t (utf16_column)VALUES (0xd800); /* illegal */
</pre><p>
          技術的に有効であるが真の Unicode ではない文字 (つまり、Unicode が<span class="quote">「<span class="quote">未割り当てコードポイント</span>」</span>または<span class="quote">「<span class="quote">個人使用</span>」</span>文字、さらには <code class="literal">0xffff</code> のように<span class="quote">「<span class="quote">不正</span>」</span>と見なす文字) に対する妥当性チェックはありません。たとえば、<code class="literal">U+F8FF</code> は Apple のロゴなので、これは有効です。
        </p><pre class="programlisting">
INSERT INTO t (utf16_column)VALUES (0xf8ff); /* legal */
</pre><p>
          このような文字は、すべてのユーザーに対し同じ意味を持たせることは期待できません。
        </p><p>
          MySQL は、最悪の場合 (文字が 4 バイトを必要とする場合) に対応する必要があるので、<code class="literal">utf16</code> カラムまたはインデックスの最大長は、<code class="literal">ucs2</code> カラムまたはインデックスの最大長の半分しかありません。たとえば、MySQL 5.6 では、<code class="literal">MEMORY</code> テーブルインデックスキーの最大長は、3072 バイトなので、これらのステートメントは、<code class="literal">ucs2</code> および <code class="literal">utf16</code> カラムに対し、最大許容長のインデックスを持つテーブルを作成します。
        </p><pre class="programlisting">
CREATE TABLE tf (s1 VARCHAR(1536) CHARACTER SET ucs2) ENGINE=MEMORY;
CREATE INDEX i ON tf (s1);
CREATE TABLE tg (s1 VARCHAR(768) CHARACTER SET utf16) ENGINE=MEMORY;
CREATE INDEX i ON tg (s1);
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-unicode-utf16le"></a>10.1.10.3 utf16le 文字セット (UTF-16LE Unicode エンコーディング)</h4></div></div></div><a class="indexterm" name="idm139979106491616"></a><p>
          これは、<code class="literal">utf16</code> と同じですが、ビッグエンディアンではなくリトルエンディアンです。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-unicode-utf32"></a>10.1.10.4 utf32 文字セット (UTF-32 Unicode エンコーディング)</h4></div></div></div><a class="indexterm" name="idm139979106487472"></a><p>
          <code class="literal">utf32</code> 文字セットは固定長です (<code class="literal">ucs2</code> と同様で、<code class="literal">utf16</code> とは異なります)。<code class="literal">utf32</code> はすべての文字に 32 ビットを使用し、<code class="literal">ucs2</code> (すべての文字に 16 ビットを使用します) とも、<code class="literal">utf16</code> (一部の文字に 16 ビットを、ほかの文字に 32 ビットを使用します) とも異なります。
        </p><p>
          <code class="literal">utf32</code> は、<code class="literal">ucs2</code> の 2 倍のスペース、<code class="literal">utf16</code> よりも多くのスペースを必要としますが、<code class="literal">utf32</code> には、ストレージについて予測可能であるという <code class="literal">ucs2</code> と同じ利点があります。<code class="literal">utf32</code> に必要なバイト数は文字数の 4 倍になります。また、<code class="literal">utf16</code> とは異なり、<code class="literal">utf32</code> でのエンコーディングにはトリックはないので、格納された値はコード値と等しくなります。
        </p><p>
          後者の利点がどのように役立つかを説明するために、<code class="literal">utf32</code> コード値のときに <code class="literal">utf8mb4</code> 値を求める方法を示した例を挙げます。
        </p><pre class="programlisting">
/* Assume code value = 100cc LINEAR B WHEELED CHARIOT */
CREATE TABLE tmp (utf32_col CHAR(1) CHARACTER SET utf32,
                  utf8mb4_col CHAR(1) CHARACTER SET utf8mb4);
INSERT INTO tmp VALUES (0x000100cc,NULL);
UPDATE tmp SET utf8mb4_col = utf32_col;
SELECT HEX(utf32_col),HEX(utf8mb4_col) FROM tmp;
</pre><p>
          MySQL では、未割り当ての Unicode 文字または個人使用領域の文字の追加について広く許容しています。実際、<code class="literal">utf32</code> の妥当性チェックは 1 つしかありません。<code class="literal">0x10ffff</code> よりも大きなコード値はありません。たとえば次の場合は不正です。
        </p><pre class="programlisting">
INSERT INTO t (utf32_column) VALUES (0x110000); /* illegal */
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-unicode-utf8"></a>10.1.10.5 utf8 文字セット (3 バイト UTF-8 Unicode エンコーディング)</h4></div></div></div><a class="indexterm" name="idm139979106466288"></a><p>
          UTF-8 (8 ビット単位の Unicode Transformation Format) は Unicode データを格納する別の方法です。これは、1 から 4 バイトを使用するエンコーディングシーケンスについて記述した RFC 3629 に従って実装されています。(UTF-8 エンコーディングの以前の標準である RFC 2279 では、1 から 6 バイトを使用する UTF-8 シーケンスについて記述しています。RFC 3629 は RFC 2279 を無効にするため、5 と 6 バイトのシーケンスはすでに使用されていません。)
        </p><p>
          UTF-8 の概念は、長さの異なるバイトシーケンスを使用してさまざまな Unicode 文字をエンコードするというものです。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              基本的なラテン文字、数字、句読点は 1 バイトを使用します。
            </p></li><li class="listitem"><p>
              拡張ラテン文字 (チルダ、長音符号、アキュート、グラーヴェ、およびほかのアクセント符号)、キリル文字、ギリシャ語、アルメニア語、ヘブライ語、アラビア語、シリア語などのほとんどのヨーロッパおよび中東のスクリプト文字は、2 バイトシーケンスに収まります。
            </p></li><li class="listitem"><p>
              韓国語、中国語、および日本語の表意文字は、3 バイトまたは 4 バイトのシーケンスを使用します。
            </p></li></ul></div><p>
          MySQL 5.6 の <code class="literal">utf8</code> 文字セットは 5.6 以前と同じであり、特性もまったく同じです。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              補助文字のサポートなし (BMP 文字のみ)。
            </p></li><li class="listitem"><p>
              マルチバイト文字ごとに最大 3 バイト。
            </p></li></ul></div><a class="indexterm" name="idm139979106455632"></a><a class="indexterm" name="idm139979106454144"></a><p>
          <code class="literal">utf8</code> では <code class="literal">ucs2</code> とちょうど同じ文字セットを使用できます。つまり、レパートリーも同じです。
        </p><p>
          <span class="bold"><strong>ヒント</strong></span>: スペースを UTF-8 で保存する場合は、<code class="literal">CHAR</code> ではなく <code class="literal">VARCHAR</code> を使用してください。そのようにしないと、MySQL では <code class="literal">CHAR CHARACTER SET utf8</code> カラムに対して 3 バイトを確保する必要があります。これは、可能性のある最大長が 3 バイトであるためです。たとえば、MySQL は <code class="literal">CHAR(10) CHARACTER SET utf8</code> カラムに対して 30 バイトを確保する必要があります。
        </p><p>
          データ型のストレージの詳細は、<a class="xref" href="data-types.html#storage-requirements" title="11.7 データ型のストレージ要件">セクション11.7「データ型のストレージ要件」</a>を参照してください。<code class="literal">COMPACT</code> 行フォーマットを使用する <code class="literal">InnoDB</code> テーブルが UTF-8 <code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code> カラムを内部で処理する方法を含め、<code class="literal">InnoDB</code> 物理行ストレージの詳細は、<a class="xref" href="innodb-storage-engine.html#innodb-physical-record" title="14.2.13.7 物理的な行構造">セクション14.2.13.7「物理的な行構造」</a>を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-unicode-utf8mb3"></a>10.1.10.6 utf8mb3 文字セット (utf8 のエイリアス)</h4></div></div></div><a class="indexterm" name="idm139979106437840"></a><p>
          MySQL の今後のバージョンでは、<code class="literal">utf8</code> が 4 バイトの <code class="literal">utf8</code> になり、3 バイトの <code class="literal">utf8</code> を指定するときに <code class="literal">utf8mb3</code> を示す必要が生じる可能性があります。マスターサーバーとスレーブサーバーの MySQL のバージョンが異なるときにレプリケーションで生じる将来の問題を回避するために、ユーザーは、<code class="literal">CHARACTER SET</code> 句で <code class="literal">utf8mb3</code> を、<code class="literal">COLLATE</code> 句で <code class="literal">utf8mb3_<em class="replaceable"><code>collation_substring</code></em></code> を指定できます。ここで、<em class="replaceable"><code>collation_substring</code></em> は <code class="literal">bin</code>、<code class="literal">czech_ci</code>、<code class="literal">danish_ci</code>、<code class="literal">esperanto_ci</code>、<code class="literal">estonian_ci</code> などです。例:
        </p><pre class="programlisting">
CREATE TABLE t (s1 CHAR(1) CHARACTER SET utf8mb3;
SELECT * FROM t WHERE s1 COLLATE utf8mb3_general_ci = 'x';
DECLARE x VARCHAR(5) CHARACTER SET utf8mb3 COLLATE utf8mb3_danish_ci;
SELECT CAST('a' AS CHAR CHARACTER SET utf8) COLLATE utf8_czech_ci;
</pre><p>
          MySQL は即座に、エイリアス内の <code class="literal">utf8mb3</code> のインスタンスを、<code class="literal">utf8</code> に変換するので、<code class="literal">SHOW CREATE TABLE</code>、<code class="literal">SELECT CHARACTER_SET_NAME FROM INFORMATION_SCHEMA.COLUMNS</code>、<code class="literal">SELECT COLLATION_NAME FROM INFORMATION_SCHEMA.COLUMNS</code> などのステートメントでは、真の名前、<code class="literal">utf8</code>、または <code class="literal">utf8_<em class="replaceable"><code>collation_substring</code></em></code> がユーザーに表示されます。
        </p><p>
          <code class="literal">utf8mb3</code> エイリアスは、<code class="literal">CHARACTER SET</code> 句と、ほかの特定の場所でのみ有効です。たとえば、次の場合は有効です。
        </p><pre class="programlisting">
mysqld --character-set-server=utf8mb3
SET NAMES 'utf8mb3'; /* and other SET statements that have similar effect */
SELECT _utf8mb3 'a';
</pre><p>
          照合順序が基づいている Unicode 照合アルゴリズムのバージョンを示すバージョン番号を含む照合順序名 (<code class="literal"><em class="replaceable"><code>utf8</code></em>_unicode_520_ci</code> など) を表す、対応する <code class="literal">utf8</code> 照合順序の <code class="literal">utf8mb3</code> エイリアスはありません。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-unicode-utf8mb4"></a>10.1.10.7 utf8mb4 文字セット (4 バイトの UTF-8 Unicode エンコーディング)</h4></div></div></div><a class="indexterm" name="idm139979106410544"></a><p>
          <code class="literal">utf8</code> という名前の文字セットは、文字あたり最大 3 バイトを使用し、BMP 文字だけを含みます。<code class="literal">utf8mb4</code> 文字セットは、文字ごとに最大 4 バイトを使用し、補助文字をサポートします。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              BMP 文字の場合、<code class="literal">utf8</code> と <code class="literal">utf8mb4</code> のストレージ特性は同一で、コード値、エンコーディング、長さが同じです。
            </p></li><li class="listitem"><p>
              補助文字については、<code class="literal">utf8</code> はこの文字をまったく格納できませんが、<code class="literal">utf8mb4</code> は文字の格納に 4 バイトを必要とします。<code class="literal">utf8</code> はこの文字をまったく格納しないので、<code class="literal">utf8</code> カラムには補助文字がなく、<code class="literal">utf8</code> データを古いバージョンの MySQL からアップグレードするときに、文字の変換やデータの損失について心配する必要はありません。
            </p></li></ul></div><p>
          <code class="literal">utf8mb4</code> は <code class="literal">utf8</code> のスーパーセットであるので、次の連結のような演算の場合、その結果には <code class="literal">utf8mb4</code> の文字セットと <code class="literal">utf8mb4_col</code> の照合順序が含まれます。
        </p><pre class="programlisting">
SELECT CONCAT(utf8_col, utf8mb4_col);
</pre><p>
          同様に、次の <code class="literal">WHERE</code> 句内の比較は、<code class="literal">utf8mb4_col</code> の照合順序に従って行われます。
        </p><pre class="programlisting">
SELECT * FROM utf8_tbl, utf8mb4_tbl
WHERE utf8_tbl.utf8_col = utf8mb4_tbl.utf8mb4_col;
</pre><p>
          <span class="bold"><strong>ヒント</strong></span>: スペースを UTF-8 で保存する場合は、<code class="literal">CHAR</code> ではなく <code class="literal">VARCHAR</code> を使用してください。そのようにしないと、MySQL では <code class="literal">CHAR CHARACTER SET utf8</code> (または <code class="literal">utf8mb4</code>) カラムに対して 3 (または 4) バイトを確保する必要があります。これは、可能性のある最大長が 3 (または 4) バイトであるためです。たとえば、MySQL は <code class="literal">CHAR(10) CHARACTER SET utf8mb4</code> カラムに対して 40 バイトを確保する必要があります。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-unicode-upgrading"></a>10.1.11 以前の Unicode サポートから現在の Unicode サポートへのアップグレード</h3></div></div></div><p>
        このセクションでは、古い MySQL リリースから MySQL 5.6 にアップグレードするときに起きる可能性のある、Unicode サポートに関する問題について説明します。また、MySQL 5.6 から古いリリースにダウングレードするためのガイドラインも示します。
      </p><p>
        ほとんどの点で MySQL 5.6 にアップグレードしても、Unicode の使用法について問題が生じることはほとんどありませんが、非互換性の可能性のあるいくつかの領域があります。主な対象領域は次のとおりです。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            可変長文字データ型 (<code class="literal">VARCHAR</code> 型と <code class="literal">TEXT</code> 型) の場合、文字の最大長は、<code class="literal">utf8mb4</code> カラムのほうが <code class="literal">utf8</code> カラムよりも短くなります。
          </p></li><li class="listitem"><p>
            すべての文字データ型 (<code class="literal">CHAR</code> 型、<code class="literal">VARCHAR</code> 型、および <code class="literal">TEXT</code> 型) で、インデックスを付けることができる文字の最大数は、<code class="literal">utf8mb4</code> カラムのほうが <code class="literal">utf8</code> カラムよりも少なくなります。
          </p></li></ul></div><p>
        このため、<code class="literal">utf8</code> から <code class="literal">utf8mb4</code> にテーブルをアップグレードして補助文字サポートを利用する場合、一部のカラムまたはインデックス定義を変更する必要が生じることがあります。
      </p><p>
        テーブルは、<code class="literal">ALTER TABLE</code> を使用することにより、<code class="literal">utf8</code> から <code class="literal">utf8mb4</code> に変換できます。テーブルがもともと次のように定義されていたとします。
      </p><pre class="programlisting">
CREATE TABLE t1 (
  col1 CHAR(10) CHARACTER SET utf8 COLLATE utf8_unicode_ci NOT NULL,
  col2 CHAR(10) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL
) CHARACTER SET utf8;
</pre><p>
        次のステートメントは、<code class="literal">utf8mb4</code> を使用するように <code class="literal">t1</code> を変換します。
      </p><pre class="programlisting">
ALTER TABLE t1
  DEFAULT CHARACTER SET utf8mb4,
  MODIFY col1 CHAR(10)
    CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  MODIFY col2 CHAR(10)
    CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL;
</pre><p>
        テーブルの内容については、<code class="literal">utf8</code> から <code class="literal">utf8mb4</code> への変換で問題は起こりません。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            BMP 文字の場合、<code class="literal">utf8</code> と <code class="literal">utf8mb4</code> のストレージ特性は同一で、コード値、エンコーディング、長さが同じです。
          </p></li><li class="listitem"><p>
            補助文字については、<code class="literal">utf8</code> はこの文字をまったく格納できませんが、<code class="literal">utf8mb4</code> は文字の格納に 4 バイトを必要とします。<code class="literal">utf8</code> はこの文字をまったく格納しないので、<code class="literal">utf8</code> カラムには補助文字がなく、<code class="literal">utf8</code> データを古いバージョンの MySQL からアップグレードするときに、文字の変換やデータの損失について心配する必要はありません。
          </p></li></ul></div><p>
        テーブル構造については、<code class="literal">utf8</code> から <code class="literal">utf8mb4</code> への変換時に、カラムまたはインデックスキーの最大長が<span class="emphasis"><em>バイト</em></span>の点では変更されないという問題が生じます。そのため、文字の最大長が 3 ではなく 4 なので、<span class="emphasis"><em>文字</em></span>の点ではこれはより小さくなります。<code class="literal">CHAR</code>、<code class="literal">VARCHAR</code>、および <code class="literal">TEXT</code> データ型の場合、MySQL テーブルを変換するときに、次の点に注意してください。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">utf8</code> カラムのすべての定義を調べて、それらがストレージエンジンの最大長を超えていないことを確認します。
          </p></li><li class="listitem"><p>
            <code class="literal">utf8</code> カラムのすべてのインデックスを調べて、それらがストレージエンジンの最大長を超えていないことを確認します。最大値は、ストレージエンジンの機能強化によって変更されることがあります。
          </p></li></ul></div><p>
        前述の条件が当てはまる場合は、カラムまたはインデックスの定義された長さを減らすか、<code class="literal">utf8mb4</code> ではなく <code class="literal">utf8</code> を使用し続ける必要があります。
      </p><p>
        次に、構造的な変更が必要な例をいくつか示します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">TINYTEXT</code> カラムは、最大 255 バイトを保持できるので、3 バイトの文字は 85 個まで、4 バイトの文字は 63 個まで保持できます。<code class="literal">utf8</code> を使用する <code class="literal">TINYTEXT</code> カラムがあるが、63 個以上の文字を含められることが必要だとします。データ型も <code class="literal">TEXT</code> などのより長い型に変更しないかぎり、これを <code class="literal">utf8mb4</code> に変換できません。
          </p><p>
            同様に非常に長い <code class="literal">VARCHAR</code> カラムは、<code class="literal">utf8</code> から <code class="literal">utf8mb4</code> に変換する場合は、より長い <code class="literal">TEXT</code> 型のいずれかに変更する必要があります。
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> には、<code class="literal"><a class="link" href="glossary.html#glos_compact_row_format" title="コンパクト行フォーマット">COMPACT</a></code> または <code class="literal"><a class="link" href="glossary.html#glos_redundant_row_format" title="冗長行フォーマット">REDUNDANT</a></code> 行フォーマットを使用するテーブル用に 767 バイトの最大インデックス長があり、<code class="literal">utf8</code> または <code class="literal">utf8mb4</code> カラムの場合、それぞれ最大 255 または 191 個の文字にインデックスを付けることができます。現在、インデックスが 191 個の文字より長い <code class="literal">utf8</code> カラムがある場合、インデックスを付ける文字数を減らす必要があります。
          </p><p>
            <code class="literal"><a class="link" href="glossary.html#glos_compact_row_format" title="コンパクト行フォーマット">COMPACT</a></code> または <code class="literal"><a class="link" href="glossary.html#glos_redundant_row_format" title="冗長行フォーマット">REDUNDANT</a></code> 行フォーマットを使用する <code class="literal">InnoDB</code> テーブルでは、次のカラムおよびインデックス定義が有効です。
          </p><pre class="programlisting">
col1 VARCHAR(500) CHARACTER SET utf8, INDEX (col1(255))
</pre><p>
            代わりに <code class="literal">utf8mb4</code> を使用するには、インデックスをより小さくする必要があります。
          </p><pre class="programlisting">
col1 VARCHAR(500) CHARACTER SET utf8mb4, INDEX (col1(191))
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
              <code class="literal"><a class="link" href="glossary.html#glos_compressed_row_format" title="圧縮行フォーマット">COMPRESSED</a></code> または <code class="literal"><a class="link" href="glossary.html#glos_dynamic_row_format" title="動的行フォーマット">DYNAMIC</a></code> 行フォーマットを使用する <code class="literal">InnoDB</code> テーブルの場合、<code class="literal">innodb_large_prefix</code> オプションを有効にすると、767 バイトより長い<a class="link" href="glossary.html#glos_index_prefix" title="インデックスプリフィクス">インデックスキープリフィクス</a> (最大 3072 バイト) を許容できます。このようなテーブルの作成には、<code class="literal">innodb_file_format=barracuda</code> および <code class="literal">innodb_file_per_table=true</code> のオプション値も必要になります。)この場合、<code class="literal">innodb_large_prefix</code> オプションを有効にすると、<code class="literal">utf8</code> または <code class="literal">utf8mb4</code> カラムに対しそれぞれ最大 1024 または 768 個の文字にインデックスを付けることができます。関連情報については、<a class="xref" href="innodb-storage-engine.html#innodb-restrictions" title="14.6.7 InnoDB テーブル上の制限">セクション14.6.7「InnoDB テーブル上の制限」</a>を参照してください。
            </p></div></li></ul></div><p>
        前述の変更のタイプは、非常に長いカラムまたはインデックスを持つ場合にのみ必要になる可能性が高くなります。それ以外の場合は、<code class="literal">utf8</code> から <code class="literal">utf8mb4</code> に問題なくテーブルを変換できます。これを行うには、5.6 に適切にアップグレードしたあとで、このセクションですでに述べたように <code class="literal">ALTER TABLE</code> を使用します。
      </p><p>
        次の項目は、非互換性の可能性のあるほかの領域についてまとめたものです。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            4 バイトの UTF-8 (<code class="literal">utf8mb4</code>) のパフォーマンスは、3 バイトの UTF-8 (<code class="literal">utf8</code>) のパフォーマンスより低下します。このペナルティーを望まない場合は、<code class="literal">utf8</code> を引き続き使用してください。
          </p></li><li class="listitem"><p>
            <code class="literal">SET NAMES 'utf8mb4'</code> では、接続文字セットに対して 4 バイトの文字セットを使用する必要があります。4 バイト文字がサーバーから送信されていないかぎり、問題は起こりません。それ以外の場合は、文字ごとに最大 3 バイトの受信を要求するアプリケーションで問題が発生する可能性があります。反対に、4 バイトの文字の送信を要求するアプリケーションは、その文字がサーバーで認識されることを確認する必要があります。
          </p></li><li class="listitem"><p>
            アプリケーションは、<code class="literal">utf16</code>、<code class="literal">utf16le</code>、または <code class="literal">utf32</code> 文字データを認識しない古いサーバーにこれらのデータを送信できません。
          </p></li><li class="listitem"><p>
            レプリケーションでは、補助文字をサポートする文字セットがマスターで使用される場合、すべてのスレーブでもこれらの文字を認識する必要があります。MySQL 5.6 マスターから古いスレーブに複製しようとしたときに、<code class="literal">utf8</code> データはスレーブで <code class="literal">utf8</code> と認識され、正しく複製されます。ただし、<code class="literal">utf8mb4</code>、<code class="literal">utf16</code>、<code class="literal">utf16le</code>、または <code class="literal">utf32</code> データは送信できません。
          </p><p>
            また、テーブルにマスターとスレーブについて異なる定義がある場合、予想外の結果を招くことがあるという一般的な原則に留意してください。たとえば、インデックスキー長の制限が異なると、マスターで <code class="literal">utf8</code> を使用し、スレーブで <code class="literal">utf8mb4</code> を使用することは危険です。
          </p></li></ul></div><p>
        MySQL 5.6 にアップグレードしてあり、古いリリースにダウングレードすることにした場合、次の考慮事項が該当します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">ucs2</code> および <code class="literal">utf8</code> データで問題が生じていない必要があります。
          </p></li><li class="listitem"><p>
            <code class="literal">utf8mb4</code>、<code class="literal">utf16</code>、<code class="literal">utf16le</code>、または <code class="literal">utf32</code> 文字セットを参照するすべての定義は、古いサーバーで認識されません。
          </p></li><li class="listitem"><p>
            <code class="literal">utf8mb4</code> 文字セットを参照するオブジェクト定義の場合、データ内に 4 バイト文字が存在しないかぎり、MySQL 5.6 で <span class="command"><strong>mysqldump</strong></span> を使用してこれらをダンプし、<code class="literal">utf8mb4</code> のインスタンスを <code class="literal">utf8</code> に変更するようにダンプファイルを編集し、このファイルを古いサーバーにリロードできます。古いサーバーは、ダンプファイルオブジェクト定義内の <code class="literal">utf8</code> を認識し、(3 バイトの) <code class="literal">utf8</code> 文字セットを使用する新しいオブジェクトを作成します。
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-metadata"></a>10.1.12 メタデータ用の UTF-8</h3></div></div></div><p>
        <em class="firstterm">メタデータ</em>は<span class="quote">「<span class="quote">データに関するデータ</span>」</span>です。データベースについて<span class="emphasis"><em>記述している</em></span>すべてのものがメタデータであり、データベースの<span class="emphasis"><em>内容</em></span>ではありません。したがって、カラム名、データベース名、ユーザー名、バージョン名、および <code class="literal">SHOW</code> の文字列結果のほとんどがメタデータです。<code class="literal">INFORMATION_SCHEMA</code> 内のテーブルは定義上、データベースオブジェクトに関する情報を含んでいるので、これは、このテーブルの内容にも当てはまります。
      </p><p>
        メタデータの表現は次の要件を満たしている必要があります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            すべてのメタデータで文字セットが一致している必要があります。それ以外の場合、<code class="literal">INFORMATION_SCHEMA</code> 内のテーブルに対する <code class="literal">SHOW</code> ステートメントも <code class="literal">SELECT</code> ステートメントも正しく機能しません。これらの演算結果の同一カラム内の各行で文字セットが異なるからです。
          </p></li><li class="listitem"><p>
            メタデータはすべての言語のすべての文字が含まれている必要があります。そうでない場合、ユーザーはそれぞれの言語を使用してカラムとテーブルに名前を付けることはできません。
          </p></li></ul></div><p>
        両方の要件を満たすために、MySQL では、Unicode 文字セット、つまり UTF-8 でメタデータを格納します。アクセント符号付きの文字またはラテン語以外の文字を使用しなければ、混乱が生じることはありません。ただし、使用した場合は、メタデータの文字セットが UTF-8 であることを認識する必要があります。
      </p><p>
        このメタデータ要件は、<code class="literal">USER()</code>、<code class="literal">CURRENT_USER()</code>、<code class="literal">SESSION_USER()</code>、<code class="literal">SYSTEM_USER()</code>、<code class="literal">DATABASE()</code>、および <code class="literal">VERSION()</code> の関数の戻り値で、UTF-8 文字セットがデフォルトで使用されることを意味します。
      </p><p>
        サーバーは、<code class="literal">character_set_system</code> システム変数をメタデータ文字セットの名前に設定します。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'character_set_system';</code></strong>
+----------------------+-------+
| Variable_name        | Value |
+----------------------+-------+
| character_set_system | utf8  |
+----------------------+-------+
</pre><p>
        Unicode を使用してメタデータを格納しても、サーバーが、カラムのヘッダーや <code class="literal">DESCRIBE</code> 関数の結果を、デフォルトで <code class="literal">character_set_system</code> 文字セットで返すことには<span class="emphasis"><em>なりません</em></span>。<code class="literal">SELECT column1 FROM t</code> を使用すると、<code class="literal">character_set_results</code> システム変数の値 (デフォルト値は <code class="literal">latin1</code>) で特定される文字セットで、名前 <code class="literal">column1</code> 自体がサーバーからクライアントに返されます。別の文字セットでメタデータの結果をサーバーに返させる場合は、<code class="literal">SET NAMES</code> ステートメントを使用してサーバーに文字セット変換を強制的に実行させてください。<code class="literal">SET NAMES</code> は <code class="literal">character_set_results</code> および関連するほかのシステム変数を設定します。(<a class="xref" href="globalization.html#charset-connection" title="10.1.4 接続文字セットおよび照合順序">セクション10.1.4「接続文字セットおよび照合順序」</a>を参照してください。)また、サーバーから結果を受け取ったあとで、クライアントプログラムが変換を実行できます。クライアントが変換を実行するとより効率的ですが、このオプションは、すべてのクライアントが常に使用できるとはかぎりません。
      </p><p>
        <code class="literal">character_set_results</code> が <code class="literal">NULL</code> に設定されている場合、変換は実行されず、サーバーはオリジナルの文字セット (<code class="literal">character_set_system</code> によって指定されたセット) を使用してメタデータを返します。
      </p><p>
        サーバーからクライアントに返されるエラーメッセージは、メタデータと同様に自動的にクライアントの文字セットに変換されます。
      </p><p>
        たとえば、<code class="literal">USER()</code> 関数を比較または割り当てのために単一のステートメント内で使用している場合、問題はありません。MySQL が自動的に変換を実行します。
      </p><pre class="programlisting">
SELECT * FROM t1 WHERE USER() = latin1_column;
</pre><p>
        これが機能するのは、<code class="literal">latin1_column</code> の内容が UTF-8 に自動的に変換されてから比較が行われるからです。
      </p><pre class="programlisting">
INSERT INTO t1 (latin1_column) SELECT USER();
</pre><p>
        これが機能するのは、<code class="literal">USER()</code> の内容が <code class="literal">latin1</code> に自動的に変換されてから割り当てが行われるからです。
      </p><p>
        自動変換機能は SQL 標準には含まれていません。ただし、どの文字セットも (サポートされている文字に関して) Unicode の<span class="quote">「<span class="quote">サブセット</span>」</span>であることが SQL 標準のドキュメントに記載されています。<span class="quote">「<span class="quote">スーパーセットに適用されるものはサブセットにも適用される</span>」</span>というよく知られた原則があるので、Unicode の照合順序は Unicode 以外の文字列との比較にも適用できると考えられます。文字列の強制力の詳細は、<a class="xref" href="globalization.html#charset-collation-expressions" title="10.1.7.5 式の照合順序">セクション10.1.7.5「式の照合順序」</a>を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-conversion"></a>10.1.13 カラム文字セットの変換</h3></div></div></div><p>
        特定の文字セットを使用するようにバイナリ文字列または非バイナリ文字列カラムを変換するには、<code class="literal">ALTER TABLE</code> を使用します。正しく変換が行われるには、次の条件のいずれかを適用する必要があります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            カラムにバイナリデータ型 (<code class="literal">BINARY</code>、<code class="literal">VARBINARY</code>、<code class="literal">BLOB</code>) がある場合、含まれるすべての値は、単一の文字セット (カラムの変換後の文字セット) を使用してエンコードされる必要があります。バイナリカラムを使用して複数の文字セットで情報を格納する場合、MySQL はどの値がどの文字セットを使用するかを認識できず、データを正確に変換できません。
          </p></li><li class="listitem"><p>
            カラムに非バイナリデータ型 (<code class="literal">CHAR</code>、<code class="literal">VARCHAR</code>、<code class="literal">TEXT</code>) がある場合、その内容は、カラムの文字セットでエンコードする必要があり、ほかの文字セットは使用できません。内容が別の文字セットでエンコードされている場合、最初にバイナリデータ型を使用するようにカラムを変換してから、使用する文字セットで非バイナリカラムに変換できます。
          </p></li></ul></div><p>
        <code class="literal">VARBINARY(50)</code> として定義された <code class="literal">col1</code> という名前のテーブル <code class="literal">t</code> にバイナリカラムがあるとします。カラム内の情報が、単一の文字セットを使用してエンコードされているとすると、このカラムを、その文字セットを含む非バイナリカラムに変換できます。たとえば、<code class="literal">col1</code> に <code class="literal">greek</code> 文字セットの文字を表すバイナリデータが含まれる場合、次のように変換できます。
      </p><pre class="programlisting">
ALTER TABLE t MODIFY col1 VARCHAR(50) CHARACTER SET greek;
</pre><p>
        元のカラムに <code class="literal">BINARY(50)</code> の型がある場合、これを <code class="literal">CHAR(50)</code> に変換できますが、その結果得られる値は、末尾が <code class="literal">0x00</code> バイトでパディングされ、これが望ましくない場合があります。これらのバイトを削除するには、<code class="literal">TRIM()</code> 関数を使用します。
      </p><pre class="programlisting">
UPDATE t SET col1 = TRIM(TRAILING 0x00 FROM col1);
</pre><p>
        テーブル <code class="literal">t</code> に <code class="literal">CHAR(50) CHARACTER SET latin1</code> として定義された <code class="literal">col1</code> という名前の非バイナリ列があるが、<code class="literal">utf8</code> を使用するようにこれを変換し、多くの言語の値を格納できるようにするとします。次のステートメントでこれを実行できます。
      </p><pre class="programlisting">
ALTER TABLE t MODIFY col1 CHAR(50) CHARACTER SET utf8;
</pre><p>
        両方の文字セットにない文字がカラムに含まれている場合、変換の損失が大きくなることがあります。
      </p><p>
        MySQL 4.1 より前の古いテーブルがある場合、実際にはサーバーのデフォルトの文字セットと異なる文字セットでエンコードされた値が、非バイナリカラムに含まれるという特殊な状況が起こります。たとえば、MySQL のデフォルト文字セットが <code class="literal">latin1</code> であっても、アプリケーションは <code class="literal">sjis</code> 値をカラムに格納します。適切な文字セットを使用するために、カラムを変換することは可能ですが、追加ステップが必要になります。たとえば、サーバーのデフォルト文字セットが <code class="literal">latin1</code> で、<code class="literal">col1</code> は <code class="literal">CHAR(50)</code> と定義されているにもかかわらず、内容は <code class="literal">sjis</code> 値であるとします。最初のステップでは、バイナリデータ型にカラムを変換することで、文字変換を実行しないで既存の文字セット情報を取り除きます。
      </p><pre class="programlisting">
ALTER TABLE t MODIFY col1 BLOB;
</pre><p>
        次のステップでは、適切な文字セットを使用して、非バイナリデータ型にカラムを変換します。
      </p><pre class="programlisting">
ALTER TABLE t MODIFY col1 CHAR(50) CHARACTER SET sjis;
</pre><p>
        この手順では、MySQL 4.1 以降にアップグレードしたあと、テーブルが <code class="literal">INSERT</code> や <code class="literal">UPDATE</code> などのステートメントで変更されていない必要があります。その場合、MySQL は <code class="literal">latin1</code> を使用してカラムに新しい値を格納し、そのカラムは <code class="literal">sjis</code> 値と <code class="literal">latin1</code> 値を同時に含んでおり、正確に変換できません。
      </p><p>
        最初にカラムを作成するときに属性を指定した場合、<code class="literal">ALTER TABLE</code> を使用してテーブルを変更しているときにも属性を指定する必要があります。たとえば、<code class="literal">NOT NULL</code> と明示的な <code class="literal">DEFAULT</code> 値を指定した場合、<code class="literal">ALTER TABLE</code> ステートメントでも指定する必要があります。指定しない場合、結果のカラム定義にはこれらの属性が含まれません。
      </p><p>
        テーブル内のすべての文字カラムを変換するには、<code class="literal">ALTER TABLE ... CONVERT TO CHARACTER SET <em class="replaceable"><code>charset</code></em></code> ステートメントが役立つことがあります。<a class="xref" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE 構文">セクション13.1.7「ALTER TABLE 構文」</a>を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-charsets"></a>10.1.14 MySQL でサポートされる文字セットと照合順序</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="globalization.html#charset-unicode-sets">10.1.14.1 Unicode 文字セット</a></span></dt><dt><span class="section"><a href="globalization.html#charset-we-sets">10.1.14.2 西ヨーロッパの文字セット</a></span></dt><dt><span class="section"><a href="globalization.html#charset-ce-sets">10.1.14.3 中央ヨーロッパの文字セット</a></span></dt><dt><span class="section"><a href="globalization.html#charset-se-me-sets">10.1.14.4 南ヨーロッパおよび中東の文字セット</a></span></dt><dt><span class="section"><a href="globalization.html#charset-baltic-sets">10.1.14.5 バルト語の文字セット</a></span></dt><dt><span class="section"><a href="globalization.html#charset-cyrillic-sets">10.1.14.6 キリル文字の文字セット</a></span></dt><dt><span class="section"><a href="globalization.html#charset-asian-sets">10.1.14.7 アジアの文字セット</a></span></dt></dl></div><p>
        MySQL では、30 を超える文字セットに対して 70 を超える照合順序がサポートされています。このセクションでは MySQL がどの文字セットをサポートするかを示します。関連する文字セットのグループごとに、1 つのサブセクションがあります。文字セットごとに、許容される照合順序が一覧表示されます。
      </p><p>
        <code class="literal">SHOW CHARACTER SET</code> ステートメント使用すると、使用可能な文字セットとそのデフォルト照合順序を常に表示できます。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW CHARACTER SET;</code></strong>
+----------+-----------------------------+---------------------+
| Charset  | Description                 | Default collation   |
+----------+-----------------------------+---------------------+
| big5     | Big5 Traditional Chinese    | big5_chinese_ci     |
| dec8     | DEC West European           | dec8_swedish_ci     |
| cp850    | DOS West European           | cp850_general_ci    |
| hp8      | HP West European            | hp8_english_ci      |
| koi8r    | KOI8-R Relcom Russian       | koi8r_general_ci    |
| latin1   | cp1252 West European        | latin1_swedish_ci   |
| latin2   | ISO 8859-2 Central European | latin2_general_ci   |
| swe7     | 7bit Swedish                | swe7_swedish_ci     |
| ascii    | US ASCII                    | ascii_general_ci    |
| ujis     | EUC-JP Japanese             | ujis_japanese_ci    |
| sjis     | Shift-JIS Japanese          | sjis_japanese_ci    |
| hebrew   | ISO 8859-8 Hebrew           | hebrew_general_ci   |
| tis620   | TIS620 Thai                 | tis620_thai_ci      |
| euckr    | EUC-KR Korean               | euckr_korean_ci     |
| koi8u    | KOI8-U Ukrainian            | koi8u_general_ci    |
| gb2312   | GB2312 Simplified Chinese   | gb2312_chinese_ci   |
| greek    | ISO 8859-7 Greek            | greek_general_ci    |
| cp1250   | Windows Central European    | cp1250_general_ci   |
| gbk      | GBK Simplified Chinese      | gbk_chinese_ci      |
| latin5   | ISO 8859-9 Turkish          | latin5_turkish_ci   |
| armscii8 | ARMSCII-8 Armenian          | armscii8_general_ci |
| utf8     | UTF-8 Unicode               | utf8_general_ci     |
| ucs2     | UCS-2 Unicode               | ucs2_general_ci     |
| cp866    | DOS Russian                 | cp866_general_ci    |
| keybcs2  | DOS Kamenicky Czech-Slovak  | keybcs2_general_ci  |
| macce    | Mac Central European        | macce_general_ci    |
| macroman | Mac West European           | macroman_general_ci |
| cp852    | DOS Central European        | cp852_general_ci    |
| latin7   | ISO 8859-13 Baltic          | latin7_general_ci   |
| utf8mb4  | UTF-8 Unicode               | utf8mb4_general_ci  |
| cp1251   | Windows Cyrillic            | cp1251_general_ci   |
| utf16    | UTF-16 Unicode              | utf16_general_ci    |
| utf16le  | UTF-16LE Unicode            | utf16le_general_ci  |
| cp1256   | Windows Arabic              | cp1256_general_ci   |
| cp1257   | Windows Baltic              | cp1257_general_ci   |
| utf32    | UTF-32 Unicode              | utf32_general_ci    |
| binary   | Binary pseudo charset       | binary              |
| geostd8  | GEOSTD8 Georgian            | geostd8_general_ci  |
| cp932    | SJIS for Windows Japanese   | cp932_japanese_ci   |
| eucjpms  | UJIS for Windows Japanese   | eucjpms_japanese_ci |
+----------+-----------------------------+---------------------+
</pre><p>
        文字セットに複数の照合順序が存在する場合、どの照合順序が所定のアプリケーションにもっとも適しているかが明確でないことがあります。正しくない照合順序を選択しないようにするには、代表的なデータ値で比較を行い、特定の照合順序で期待どおりに値がソートされることを確認すると役立ちます。
      </p><p>
        <a class="ulink" href="http://www.collation-charts.org/" target="_top">Collation-Charts.Org</a> は、ある照合順序と別の照合順序との比較を示す有用な情報サイトです。
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-unicode-sets"></a>10.1.14.1 Unicode 文字セット</h4></div></div></div><p>
          MySQL 5.6 は、次の Unicode 文字セットをサポートします。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">ucs2</code>。文字ごとに 16 ビットを使用する Unicode 文字セットの UCS-2 エンコーディング。
            </p></li><li class="listitem"><p>
              <code class="literal">utf16</code>。Unicode 文字セットの UTF-16 エンコーディング。<code class="literal">ucs2</code> に似ていますが、補助文字用の拡張機能があります。
            </p></li><li class="listitem"><p>
              <code class="literal">utf16le</code>。Unicode 文字セットの UTF-16LE エンコーディング。<code class="literal">utf16</code> と似ていますが、ビッグエンディアンではなくリトルエンディアンです。
            </p></li><li class="listitem"><p>
              <code class="literal">utf32</code>。文字ごとに 32 ビットを使用した Unicode 文字セットの UTF-32 エンコーディング。
            </p></li><li class="listitem"><p>
              <code class="literal">utf8</code>。文字ごとに 1 から 3 バイトを使用する Unicode 文字セットの UTF-8 エンコーディング。
            </p></li><li class="listitem"><p>
              <code class="literal">utf8mb4</code>。文字ごとに 1 から 4 バイトを使用した Unicode 文字セットの UTF-8 エンコーディング。
            </p></li></ul></div><p>
          <code class="literal">ucs2</code> および <code class="literal">utf8</code> は、Basic Multilingual Plane (BMP) 文字をサポートします。<code class="literal">utf8mb4</code>、<code class="literal">utf16</code>、<code class="literal">utf16le</code>、および <code class="literal">utf32</code> は BMP と補助文字をサポートします。<code class="literal">utf16le</code> は MySQL 5.6.1 で追加されました。
        </p><p>
          これらの文字セットを使用すると、約 650 の言語でテキストを格納できます。このセクションでは、Unicode 文字セットごとに利用可能な照合順序を示し、それらを区別するプロパティーについて説明します。文字セットの一般的な情報については、<a class="xref" href="globalization.html#charset-unicode" title="10.1.10 Unicode のサポート">セクション10.1.10「Unicode のサポート」</a>を参照してください。
        </p><p>
          類似した一連の照合順序を、ほとんどの Unicode 文字セットで使用できます。これらは次のリストに表示されます。ここで <em class="replaceable"><code>xxx</code></em> は文字セット名を表します。たとえば、<code class="literal"><em class="replaceable"><code>xxx</code></em>_danish_ci</code> はデンマーク語の照合順序を表し、具体的には <code class="literal">ucs2_danish_ci</code>、<code class="literal">utf16_danish_ci</code>、<code class="literal">utf32_danish_ci</code>、<code class="literal">utf8_danish_ci</code>、および <code class="literal">utf8mb4_danish_ci</code> の名前を構成します。
        </p><p>
          <code class="literal">utf16le</code> に対する照合順序のサポートはさらに限定されます。使用可能な唯一の照合順序は、<code class="literal">utf16le_general_ci</code> と <code class="literal">utf16le_bin</code> です。これらは、<code class="literal">utf16_general_ci</code> と <code class="literal">utf16_bin</code> に似ています。
        </p><p>
          このセクションで後述するように、Unicode 照合順序名には、照合順序が基づいている Unicode 照合順序アルゴリズムのバージョンを示すバージョン番号も含まれる場合があります (たとえば <code class="literal"><em class="replaceable"><code>xxx</code></em>_unicode_520_ci</code>)。このような照合順序の場合、対応する <code class="literal">utf8</code> 照合順序の <code class="literal">utf8mb3</code> エイリアスはありません。<a class="xref" href="globalization.html#charset-unicode-utf8mb3" title="10.1.10.6 utf8mb3 文字セット (utf8 のエイリアス)">セクション10.1.10.6「utf8mb3 文字セット (utf8 のエイリアス)」</a>を参照してください。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_bin</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_croatian_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_czech_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_danish_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_esperanto_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_estonian_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_general_ci</code> (デフォルト)
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_german2_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_general_mysql500_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_hungarian_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_icelandic_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_latvian_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_lithuanian_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_persian_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_polish_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_roman_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_romanian_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_sinhala_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_slovak_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_slovenian_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_spanish_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_spanish2_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_swedish_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_turkish_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_unicode_ci</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>xxx</code></em>_vietnamese_ci</code>
            </p></li></ul></div><a class="indexterm" name="idm139979106075584"></a><p>
          MySQL は、<a class="ulink" href="http://www.unicode.org/reports/tr10/" target="_top">http://www.unicode.org/reports/tr10/</a> で説明している Unicode 照合順序アルゴリズム (UCA) に従って <code class="literal"><em class="replaceable"><code>xxx</code></em>_unicode_ci</code> 照合順序を実装します。照合順序は、バージョン 4.0.0 UCA 重みキー (<a class="ulink" href="http://www.unicode.org/Public/UCA/4.0.0/allkeys-4.0.0.txt" target="_top">http://www.unicode.org/Public/UCA/4.0.0/allkeys-4.0.0.txt</a>) を使用します。現在、<code class="literal"><em class="replaceable"><code>xxx</code></em>_unicode_ci</code> 照合順序は、Unicode 照合順序アルゴリズムを一部だけサポートします。中にはまだサポートされていない文字もあります。また、結合マークは完全にはサポートされていません。これは主に、ベトナム語、ヨルバ語、ナバホ語などの一部のより小さな言語に影響します。組み合わされた文字は、文字列比較では、単一の Unicode 文字で書き込まれた同じ文字とは異なると見なされ、2 つの文字は長さが異なると考えられます (たとえば、<code class="literal">CHAR_LENGTH()</code> 関数で返されたものや、結果セットのメタデータにおけるもの)。
        </p><p>
          <code class="literal"><em class="replaceable"><code>xxx</code></em>_unicode_ci</code> での順序付けが各言語で適切に機能しない場合にのみ、MySQL は言語固有の Unicode 照合順序を実装します。言語固有の照合順序は UCA ベースです。これらは、追加の言語の調整ルールを使用して、<code class="literal"><em class="replaceable"><code>xxx</code></em>_unicode_ci</code> から派生されます。
        </p><p>
          4.0.0 以降の UCA バージョンに基づく照合順序では、照合順序名の中にバージョンが含まれます。したがって、<code class="literal"><em class="replaceable"><code>xxx</code></em>_unicode_520_ci</code> 照合順序は、UCA 5.2.0 重みキー (<a class="ulink" href="http://www.unicode.org/Public/UCA/5.2.0/allkeys.txt" target="_top">http://www.unicode.org/Public/UCA/5.2.0/allkeys.txt</a>) に基づきます。
        </p><p>
          <code class="literal">LOWER()</code> および <code class="literal">UPPER()</code> は、その引数の照合順序に従って、大文字と小文字の変換を実行します。4.0.0 より新しい Unicode バージョンでのみ大文字バージョンと小文字バージョンがある文字は、新しい UCA バージョンを使用する照合順序が引数にある場合にのみ、これらの機能によって変換されます。
        </p><p>
          Unicode 文字セットの場合、<code class="literal"><em class="replaceable"><code>xxx</code></em>_general_ci</code> 照合順序を使用して実行する演算は、<code class="literal"><em class="replaceable"><code>xxx</code></em>_unicode_ci</code> 照合順序のものよりも高速です。たとえば、<code class="literal">utf8_general_ci</code> 照合順序の比較は、<code class="literal">utf8_unicode_ci</code> の比較よりも高速ですが、精度は少し低くなります。この理由は、<code class="literal">utf8_unicode_ci</code> では、ある文字がほかの文字の組み合わせに等しいものと見なされる拡張形式などのマッピングをサポートしているためです。たとえば、ドイツ語とほかのいくつかの言語では、<span class="quote">「<span class="quote"><code class="literal">ß</code></span>」</span>は<span class="quote">「<span class="quote"><code class="literal">ss</code></span>」</span>と同じです。<code class="literal">utf8_unicode_ci</code> は、短縮形式と無視可能な文字もサポートします。<code class="literal">utf8_general_ci</code> は、拡張形式、短縮形式、無視可能な文字をサポートしない従来の照合順序です。文字間で 1 対 1 の比較しかできません。
        </p><p>
          さらに説明するために、次の等式は <code class="literal">utf8_general_ci</code> と <code class="literal">utf8_unicode_ci</code> の両方で構成されています (比較または検索を行うときのこの効果については、<a class="xref" href="globalization.html#charset-collation-effect" title="10.1.7.8 照合順序の効果の例">セクション10.1.7.8「照合順序の効果の例」</a>を参照してください)。
        </p><pre class="programlisting">
Ä = A
Ö = O
Ü = U
</pre><p>
          照合順序間の違いは、次の式が <code class="literal">utf8_general_ci</code> に当てはまるという点です。
        </p><pre class="programlisting">
ß = s
</pre><p>
          一方、次の式は、ドイツ語 DIN-1 順序 (辞書順序とも呼ばれます) をサポートする <code class="literal">utf8_unicode_ci</code> に当てはまります。
        </p><pre class="programlisting">
ß = ss
</pre><p>
          MySQL が <code class="literal">utf8</code> 文字セットに対する言語固有の照合順序を実行するのは、<code class="literal">utf8_unicode_ci</code> による順序付けが言語に対してうまく機能しないときだけです。たとえば、<code class="literal">utf8_unicode_ci</code> は、ドイツ語辞書順序とフランス語には適切に機能するので、特殊な <code class="literal">utf8</code> 照合順序を作成する必要はありません。
        </p><p>
          <code class="literal">utf8_general_ci</code> も、ドイツ語とフランス語の両方にとって十分ですが、<span class="quote">「<span class="quote"><code class="literal">ß</code></span>」</span>が<span class="quote">「<span class="quote"><code class="literal">s</code></span>」</span>に等しく、<span class="quote">「<span class="quote"><code class="literal">ss</code></span>」</span>に等しくない点が異なります。これがアプリケーションで許容可能な場合は、<code class="literal">utf8_general_ci</code> のほうが高速なので、こちらを使用する必要があります。これが許容できない場合 (たとえば、ドイツ語辞書順序が必要な場合) は、<code class="literal">utf8_unicode_ci</code> のほうがより正確なので、こちらを使用してください。
        </p><p>
          ドイツ語 DIN-2 (電話帳) 順序が必要な場合は、<code class="literal">utf8_german2_ci</code> 照合順序を使用してください。これは次の文字セットを等しいものと見なします。
        </p><pre class="programlisting">
Ä = Æ = AE
Ö = Œ = OE
Ü = UE
ß = ss
</pre><p>
          <code class="literal">utf8_german2_ci</code> は、<code class="literal">latin1_german2_ci</code> に似ていますが、後者は、<span class="quote">「<span class="quote"><code class="literal">Æ</code></span>」</span>を<span class="quote">「<span class="quote"><code class="literal">AE</code></span>」</span>に、または<span class="quote">「<span class="quote"><code class="literal">Œ</code></span>」</span>を<span class="quote">「<span class="quote"><code class="literal">OE</code></span>」</span>に等しいものとは見なしません。<code class="literal">utf8_general_ci</code> で十分であるので、ドイツ語辞書順序のための <code class="literal">latin1_german_ci</code> に対応する <code class="literal">utf8_german_ci</code> はありません。
        </p><p>
          <code class="literal"><em class="replaceable"><code>xxx</code></em>_swedish_ci</code> には、スウェーデン語のルールが含まれます。たとえば、スウェーデン語には、ドイツ語やフランス語を使用するユーザーでは予期しないような次の関係があります。
        </p><pre class="programlisting">
Ü = Y &lt; Ö
</pre><p>
          <code class="literal"><em class="replaceable"><code>xxx</code></em>_spanish_ci</code> および <code class="literal"><em class="replaceable"><code>xxx</code></em>_spanish2_ci</code> 照合順序は、それぞれ現代のスペイン語と伝統的なスペイン語に対応しています。どちらの照合順序でも、<span class="quote">「<span class="quote"><code class="literal">ñ</code></span>」</span> (n チルダ) は、<span class="quote">「<span class="quote"><code class="literal">n</code></span>」</span>と<span class="quote">「<span class="quote"><code class="literal">o</code></span>」</span>の間の独立した文字です。さらに、伝統的なスペイン語の場合、<span class="quote">「<span class="quote"><code class="literal">ch</code></span>」</span>は、<span class="quote">「<span class="quote"><code class="literal">c</code></span>」</span>と<span class="quote">「<span class="quote"><code class="literal">d</code></span>」</span>の間の独立した文字であり、<span class="quote">「<span class="quote"><code class="literal">ll</code></span>」</span>は、<span class="quote">「<span class="quote"><code class="literal">l</code></span>」</span>と<span class="quote">「<span class="quote"><code class="literal">m</code></span>」</span>の間の独立した文字です。
        </p><p>
          <code class="literal"><em class="replaceable"><code>xxx</code></em>_spanish2_ci</code> 照合順序は、アストゥリアス語およびガリーシア語にも使用できます。
        </p><p>
          <code class="literal"><em class="replaceable"><code>xxx</code></em>_danich_ci</code> 照合順序は、ノルウェー語にも使用できます。
        </p><p>
          <code class="literal"><em class="replaceable"><code>xxx</code></em>_roman_ci</code> 照合順序では、<code class="literal">I</code> と <code class="literal">J</code> は等しいと見なされ、<code class="literal">U</code> と <code class="literal">V</code> は等しいと見なされます。
        </p><p>
          <code class="literal"><em class="replaceable"><code>xxx</code></em>_croatian_ci</code> 照合順序は、<code class="literal">Č</code>、<code class="literal">Ć</code>、<code class="literal">Dž</code>、<code class="literal">Đ</code>、<code class="literal">Lj</code>、<code class="literal">Nj</code>、<code class="literal">Š</code>、<code class="literal">Ž</code> のクロアチア語の文字を調整します。
        </p><p>
          <span class="quote">「<span class="quote">バイナリ</span>」</span> (<code class="literal"><em class="replaceable"><code>xxx</code></em>_bin</code>) 照合順序を除くすべての Unicode 照合順序に対し、MySQL は文字の照合重みを探すようにテーブルルックアップを実行します。この重みは、<code class="literal">WEIGHT_STRING()</code> 関数を使用して表示できます。(<a class="xref" href="functions.html#string-functions" title="12.5 文字列関数">セクション12.5「文字列関数」</a>を参照してください。)文字がテーブル内にない場合 (たとえば、<span class="quote">「<span class="quote">新しい</span>」</span>文字であるため)、照合重み判定がより複雑になります。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              一般的な照合順序 (<code class="literal"><em class="replaceable"><code>xxx</code></em>_general_ci</code>) での BMP 文字の場合、重み = コードポイント。
            </p></li><li class="listitem"><p>
              UCA 照合順序 (たとえば、<code class="literal"><em class="replaceable"><code>xxx</code></em>_unicode_ci</code> と言語固有の照合順序) での BMP 文字の場合、次のアルゴリズムが適用されます。
            </p><pre class="programlisting">
if (code &gt;= 0x3400 &amp;&amp; code &lt;= 0x4DB5)
  base= 0xFB80; /* CJK Ideograph Extension */
else if (code &gt;= 0x4E00 &amp;&amp; code &lt;= 0x9FA5)
  base= 0xFB40; /* CJK Ideograph */
else
  base= 0xFBC0; /* All other characters */
aaaa= base +  (code &gt;&gt; 15);
bbbb= (code &amp; 0x7FFF) | 0x8000;
</pre><p>
              結果は、<code class="literal">aaaa</code> に <code class="literal">bbbb</code> が続いた 2 つの照合要素のシーケンスになります。例:
            </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT HEX(WEIGHT_STRING(_ucs2 0x04CF COLLATE ucs2_unicode_ci));</code></strong>
+----------------------------------------------------------+
| HEX(WEIGHT_STRING(_ucs2 0x04CF COLLATE ucs2_unicode_ci)) |
+----------------------------------------------------------+
| FBC084CF                                                 |
+----------------------------------------------------------+
</pre><p>
              したがって、<code class="literal">U+04cf CYRILLIC SMALL LETTER PALOCHKA</code> は、すべての UCA 4.0.0 照合順序で、<code class="literal">U+04c0 CYRILLIC LETTER PALOCHKA</code> より大きくなります。UCA 5.2.0 照合順序では、すべての palochka は一緒にソートされます。
            </p></li><li class="listitem"><p>
              一般的な照合順序の補助文字の場合、重みは <code class="literal">0xfffd REPLACEMENT CHARACTER</code> の重みです。UCA 4.0.0 照合順序の補助文字の場合、照合重みは <code class="literal">0xfffd</code> です。つまり、MySQL では、すべての補助文字は互いに等しく、ほとんどすべての BMP 文字より大きくなります。
            </p><p>
              デザレット文字と <code class="literal">COUNT(DISTINCT)</code> を使用した例:
            </p><pre class="programlisting">
CREATE TABLE t (s1 VARCHAR(5) CHARACTER SET utf32 COLLATE utf32_unicode_ci);
INSERT INTO t VALUES (0xfffd);   /* REPLACEMENT CHARACTER */
INSERT INTO t VALUES (0x010412); /* DESERET CAPITAL LETTER BEE */
INSERT INTO t VALUES (0x010413); /* DESERET CAPITAL LETTER TEE */
SELECT COUNT(DISTINCT s1) FROM t;
</pre><p>
              結果は 2 です。これは、MySQL <code class="literal"><em class="replaceable"><code>xxx</code></em>_unicode_ci</code> 照合順序で、置換文字は <code class="literal">0x0dc6</code> の重みを持ちますが、デザレット B とデザレット T はどちらも、<code class="literal">0xfffd</code> の重みを持つからです。(<code class="literal">utf32_general_ci</code> 照合順序が代わりに使用された場合、この照合順序ではすべての 3 文字が <code class="literal">0xfffd</code> の重みを持つので、結果は 1 になります。)
            </p><p>
              くさび形文字と <code class="literal">WEIGHT_STRING()</code> を使用した例:
            </p><pre class="programlisting">
/*
The four characters in the INSERT string are
00000041  # LATIN CAPITAL LETTER A
0001218F  # CUNEIFORM SIGN KAB
000121A7  # CUNEIFORM SIGN KISH
00000042  # LATIN CAPITAL LETTER B
*/
CREATE TABLE t (s1 CHAR(4) CHARACTER SET utf32 COLLATE utf32_unicode_ci);
INSERT INTO t VALUES (0x000000410001218f000121a700000042);
SELECT HEX(WEIGHT_STRING(s1)) FROM t;
</pre><p>
              結果は次のようになります。
            </p><pre class="programlisting">
0E33 FFFD FFFD 0E4A
</pre><p>
              <code class="literal">0E33</code> と <code class="literal">0E4A</code> は、<a class="ulink" href="ftp://www.unicode.org/Public/UCA/4.0.0/allkeys-4.0.0.txt" target="_top">UCA 4.0.0</a> の主要な重みです。<code class="literal">FFFD</code> は KAB の重みであり、KISH の重みでもあります。
            </p><p>
              すべての補助文字が互いに同じであるというルールは、最適ではありませんが、問題を引き起こすとは考えられません。これらの文字は非常に珍しく、マルチ文字文字列全体が補助文字から構成されることは非常にまれです。日本では、補助文字はあいまいな漢字表意文字であるので、一般的なユーザーは、いずれにしてもそれらの順序を気にしません。実際には、MySQL のルールに従って行をソートし、二次的にコードポイント値でソートする場合、次のようにすることが簡単です。
            </p><pre class="programlisting">
ORDER BY s1 COLLATE utf32_unicode_ci, s1 COLLATE utf32_bin
</pre></li><li class="listitem"><p>
              4.0.0 以降の UCA バージョンに基づいた補助文字の場合 (たとえば、<code class="literal"><em class="replaceable"><code>xxx</code></em>_unicode_520_ci</code>)、必ずしもすべての補助文字が同じ照合順序重みを持つとはかぎりません。一部には、UCA <code class="filename">allkeys.txt</code> ファイルからの明示的な重みがあります。それ以外には、このアルゴリズムから計算された重みがあります。
            </p><pre class="programlisting">
aaaa= base +  (code &gt;&gt; 15);
bbbb= (code &amp; 0x7FFF) | 0x8000;
</pre></li></ul></div><p>
          <span class="bold"><strong><code class="literal">utf16_bin</code> 照合順序</strong></span>
        </p><a class="indexterm" name="idm139979105954336"></a><p>
          <span class="quote">「<span class="quote">文字のコード値による順序付け</span>」</span>と<span class="quote">「<span class="quote">文字のバイナリ表現による順序付け</span>」</span>と間には違いがあります。これは、サロゲートのために、<code class="literal">utf16_bin</code> でのみ表示される違いです。
        </p><p>
          <code class="literal">utf16_bin</code> (<code class="literal">utf16</code> のバイナリ照合順序) が、<span class="quote">「<span class="quote">文字ごと</span>」</span>ではなく<span class="quote">「<span class="quote">バイトごと</span>」</span>のバイナリ比較であったとします。その場合は、<code class="literal">utf16_bin</code> での文字の順序は <code class="literal">utf8_bin</code> での順序とは異なります。たとえば、次の表には 2 つの珍しい文字が示されています。最初の文字は <code class="literal">E000</code>-<code class="literal">FFFF</code> の範囲にあるので、サロゲートより大きくなりますが、補助文字より小さくなります。2 番目の文字は補助文字です。
        </p><pre class="programlisting">
Code point  Character                    utf8         utf16
----------  ---------                    ----         -----
0FF9D       HALFWIDTH KATAKANA LETTER N  EF BE 9D     FF 9D
10384       UGARITIC LETTER DELTA        F0 90 8E 84  D8 00 DF 84
</pre><p>
          表の 2 つの文字は、<code class="literal">0xff9d</code> &lt; <code class="literal">0x10384</code> であるので、コードポイント値による順序になります。また、<code class="literal">0xef</code> &lt; <code class="literal">0xf0</code> なので、<code class="literal">utf8</code> 値による順序になります。ただし、<code class="literal">0xff</code> &gt; <code class="literal">0xd8</code> なので、バイトごとの比較を使用する場合は、<code class="literal">utf16</code> 値による順序にはなりません。
        </p><p>
          したがって、MySQL の <code class="literal">utf16_bin</code> 照合順序は<span class="quote">「<span class="quote">バイトごと</span>」</span>にはなりません。<span class="quote">「<span class="quote">コードポイントによる</span>」</span>順序になります。MySQL は、<code class="literal">utf16</code> での補助文字エンコーディングを認識すると、文字のコードポイント値に変換してから比較します。したがって、<code class="literal">utf8_bin</code> と <code class="literal">utf16_bin</code> の順序付けは同じになります。これは、UCS_BASIC 照合順序の SQL:2008 標準の要件に一致します。<span class="quote">「<span class="quote">UCS_BASIC は、ソートされている文字列の文字の Unicode スカラー値によって、順序付け全体が決定される照合順序です。これは UCS 文字レパートリーに適用できます。すべての文字レパートリーは、UCS レパートリーのサブセットなので、UCS_BASIC 照合順序は、すべての文字セットに適用できる可能性があります。ノート 11: 文字の Unicode スカラー値は、符号なしの整数として扱われるそのコードポイントです。</span>」</span>
        </p><p>
          文字セットが <code class="literal">ucs2</code> である場合、比較はバイトごとになりますが、いずれにしても、<code class="literal">ucs2</code> 文字列にはサロゲートを含めないでください。
        </p><p>
          MySQL 5.6.5 で <code class="literal"><em class="replaceable"><code>xxx</code></em>_general_mysql500_ci</code> 照合順序が追加されました。これらは、元の <code class="literal"><em class="replaceable"><code>xxx</code></em>_general_ci</code> 照合順序の 5.1.24 以前の順序付けを維持し、MySQL 5.1.24 より前に作成されたテーブルのアップグレードを許可します。詳細は、<a class="xref" href="installing.html#checking-table-incompatibilities" title="2.11.3 テーブルまたはインデックスの再構築が必要かどうかのチェック">セクション2.11.3「テーブルまたはインデックスの再構築が必要かどうかのチェック」</a>および<a class="xref" href="installing.html#rebuilding-tables" title="2.11.4 テーブルまたはインデックスの再作成または修復">セクション2.11.4「テーブルまたはインデックスの再作成または修復」</a>を参照してください。
        </p><p>
          MySQL での Unicode 照合順序の追加情報については、Collation-Charts.Org (<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#utf8" target="_top">utf8</a>) を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-we-sets"></a>10.1.14.2 西ヨーロッパの文字セット</h4></div></div></div><p>
          西ヨーロッパの文字セットには、大部分の西ヨーロッパ言語 (フランス語、スペイン語、カタロニア語、バスク語、ポルトガル語、イタリア語、アルバニア語、オランダ語、ドイツ語、デンマーク語、スウェーデン語、ノルウェー語、フィンランド語、フェロー語、アイスランド語、アイルランド語、スコットランド語、英語など) が含まれます。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">ascii</code> (US ASCII) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">ascii_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">ascii_general_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">cp850</code> (DOS 西ヨーロッパ言語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">cp850_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">cp850_general_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">dec8</code> (DEC 西ヨーロッパ言語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">dec8_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">dec8_swedish_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">hp8</code> (HP 西ヨーロッパ言語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">hp8_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">hp8_english_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">latin1</code> (cp1252 西ヨーロッパ言語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">latin1_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">latin1_danish_ci</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">latin1_general_ci</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">latin1_general_cs</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">latin1_german1_ci</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">latin1_german2_ci</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">latin1_spanish_ci</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">latin1_swedish_ci</code> (デフォルト)
                </p></li></ul></div><p>
              <code class="literal">latin1</code> はデフォルト文字セットです。MySQL の <code class="literal">latin1</code> は Windows <code class="literal">cp1252</code> 文字セットと同じです。つまり、これは公式の <code class="literal">ISO 8859-1</code> または IANA (Internet Assigned Numbers Authority) <code class="literal">latin1</code> と同じですが、IANA <code class="literal">latin1</code> が、<code class="literal">0x80</code> と <code class="literal">0x9f</code> の間のコードポイントを<span class="quote">「<span class="quote">未定義</span>」</span>として扱うのに対し、<code class="literal">cp1252</code>、および MySQL の <code class="literal">latin1</code> はこれらの位置の文字を割り当てる点が異なることを示します。たとえば <code class="literal">0x80</code> はユーロの記号です。<code class="literal">cp1252</code> の<span class="quote">「<span class="quote">定義されていない</span>」</span>エントリでは、MySQL は <code class="literal">0x81</code> を Unicode <code class="literal">0x0081</code> に、<code class="literal">0x8d</code> を<code class="literal">0x008d</code> に、<code class="literal">0x8f</code> を<code class="literal">0x008f</code> に、<code class="literal">0x90</code> を<code class="literal">0x0090</code> に、<code class="literal">0x9d</code> を<code class="literal">0x009d</code> に変換します。
            </p><p>
              <code class="literal">latin1_swedish_ci</code> 照合順序は、大部分の MySQL カスタマが使用しているデフォルトです。スウェーデン語/フィンランド語の照合順序ルールに基づいているとされていますが、スウェーデン人やフィンランド人の中にはこの意見に賛同しないユーザーもいます。
            </p><p>
              <code class="literal">latin1_german1_ci</code> と <code class="literal">latin1_german2_ci</code> 照合順序は DIN-1 および DIN-2 標準に基づきます。ここで、DIN は <span class="foreignphrase"><em class="foreignphrase">Deutsches Institut für Normung</em></span> (ANSI のドイツ版) を表しています。DIN-1 は<span class="quote">「<span class="quote">辞書の照合順序</span>」</span>と呼ばれ、DIN-2 は<span class="quote">「<span class="quote">電話帳の照合順序</span>」</span>と呼ばれています。比較、または検索を行うときのこの効果の例については、<a class="xref" href="globalization.html#charset-collation-effect" title="10.1.7.8 照合順序の効果の例">セクション10.1.7.8「照合順序の効果の例」</a>を参照してください。
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">latin1_german1_ci</code> (辞書) ルール:
                </p><pre class="programlisting">
Ä = A
Ö = O
Ü = U
ß = s
</pre></li><li class="listitem"><p>
                  <code class="literal">latin1_german2_ci</code> (電話帳) ルール:
                </p><pre class="programlisting">
Ä = AE
Ö = OE
Ü = UE
ß = ss
</pre></li></ul></div><p>
              <code class="literal">latin1_spanish_ci</code> 照合順序では、<span class="quote">「<span class="quote"><code class="literal">ñ</code></span>」</span> (n チルダ) は、<span class="quote">「<span class="quote"><code class="literal">n</code></span>」</span>と<span class="quote">「<span class="quote"><code class="literal">o</code></span>」</span>の間の独立した文字です。
            </p></li><li class="listitem"><p>
              <code class="literal">macroman</code> (Mac 西ヨーロッパ言語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">macroman_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">macroman_general_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">swe7</code> (7 ビットスウェーデン語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">swe7_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">swe7_swedish_ci</code> (デフォルト)
                </p></li></ul></div></li></ul></div><p>
          MySQL での西ヨーロッパ言語照合順序の追加情報については、Collation-Charts.Org (<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#ascii" target="_top">ascii</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#cp850" target="_top">cp850</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#dec8" target="_top">dec8</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#hp8" target="_top">hp8</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#latin1" target="_top">latin1</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#macroman" target="_top">macroman</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#swe7" target="_top">swe7</a>) を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-ce-sets"></a>10.1.14.3 中央ヨーロッパの文字セット</h4></div></div></div><p>
          MySQL ではチェコ、スロバキア、ハンガリー、ルーマニア、スロベニア、クロアチア、ポーランド、セルビア (ラテン) で使用される文字セットも一部サポートされています。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">cp1250</code> (Windows 中央ヨーロッパ言語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">cp1250_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">cp1250_croatian_ci</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">cp1250_czech_cs</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">cp1250_general_ci</code> (デフォルト)
                </p></li><li class="listitem"><p>
                  <code class="literal">cp1250_polish_ci</code>
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">cp852</code> (DOS 中央ヨーロッパ言語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">cp852_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">cp852_general_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">keybcs2</code> (DOS Kamenicky Czech-Slovak) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">keybcs2_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">keybcs2_general_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">latin2</code> (ISO 8859-2 中央ヨーロッパ言語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">latin2_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">latin2_croatian_ci</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">latin2_czech_cs</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">latin2_general_ci</code> (デフォルト)
                </p></li><li class="listitem"><p>
                  <code class="literal">latin2_hungarian_ci</code>
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">macce</code> (Mac 中央ヨーロッパ言語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">macce_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">macce_general_ci</code> (デフォルト)
                </p></li></ul></div></li></ul></div><p>
          MySQL での中央ヨーロッパ言語照合順序の追加情報については、Collation-Charts.Org (<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#cp1250" target="_top">cp1250</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#cp852" target="_top">cp852</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#keybcs2" target="_top">keybcs2</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#latin2" target="_top">latin2</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#macce" target="_top">macce</a>) を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-se-me-sets"></a>10.1.14.4 南ヨーロッパおよび中東の文字セット</h4></div></div></div><p>
          MySQL では南ヨーロッパや中東、アルメニア語、アラビア語、グルジア語、ギリシャ語、ヘブライ語、トルコ語の文字セットがサポートされています。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">armscii8</code> (ARMSCII-8 アルメニア語) 照合順序: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">armscii8_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">armscii8_general_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">cp1256</code> (Windows アラビア語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">cp1256_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">cp1256_general_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">geostd8</code> (GEOSTD8 グルジア語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">geostd8_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">geostd8_general_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">greek</code> (ISO 8859-7 ギリシャ語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">greek_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">greek_general_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">hebrew</code> (ISO 8859-8 ヘブライ語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">hebrew_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">hebrew_general_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">latin5</code> (ISO 8859-9 トルコ語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">latin5_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">latin5_turkish_ci</code> (デフォルト)
                </p></li></ul></div></li></ul></div><p>
          MySQL での南ヨーロッパ言語および中東言語照合順序の追加情報については、Collation-Charts.Org (<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#armscii8" target="_top">armscii8</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#cp1256" target="_top">cp1256</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#geostd8" target="_top">geostd8</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#greek" target="_top">greek</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#hebrew" target="_top">hebrew</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#latin5" target="_top">latin5</a>) を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-baltic-sets"></a>10.1.14.5 バルト語の文字セット</h4></div></div></div><p>
          バルト語に含まれる文字セットにはエストニア語、ラトビア語、リトアニア言語が含まれます。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">cp1257</code> (Windows バルト語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">cp1257_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">cp1257_general_ci</code> (デフォルト)
                </p></li><li class="listitem"><p>
                  <code class="literal">cp1257_lithuanian_ci</code>
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">latin7</code> (ISO 8859-13 バルト語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">latin7_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">latin7_estonian_cs</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">latin7_general_ci</code> (デフォルト)
                </p></li><li class="listitem"><p>
                  <code class="literal">latin7_general_cs</code>
                </p></li></ul></div></li></ul></div><p>
          MySQL でのバルト語照合順序の追加情報については、Collation-Charts.Org (<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#cp1257" target="_top">cp1257</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#latin7" target="_top">latin7</a>) を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-cyrillic-sets"></a>10.1.14.6 キリル文字の文字セット</h4></div></div></div><p>
          ベラルーシ語、ブルガリア語、ロシア語、ウクライナ語、セルビア語 (キリル) とともに使用するキリル文字の文字セットおよび照合順序を以下に示します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">cp1251</code> (Windows キリル文字) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">cp1251_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">cp1251_bulgarian_ci</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">cp1251_general_ci</code> (デフォルト)
                </p></li><li class="listitem"><p>
                  <code class="literal">cp1251_general_cs</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">cp1251_ukrainian_ci</code>
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">cp866</code> (DOS ロシア語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">cp866_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">cp866_general_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">koi8r</code> (KOI8-R Relcom Russian) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">koi8r_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">koi8r_general_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">koi8u</code> (KOI8-U ウクライナ語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">koi8u_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">koi8u_general_ci</code> (デフォルト)
                </p></li></ul></div></li></ul></div><p>
          MySQL でのキリル文字照合順序の追加情報については、Collation-Charts.Org (<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#cp1251" target="_top">cp1251</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#cp866" target="_top">cp866</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#koi8r" target="_top">koi8r</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#koi8u" target="_top">koi8u</a>) を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="charset-asian-sets"></a>10.1.14.7 アジアの文字セット</h4></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="globalization.html#charset-cp932">10.1.14.7.1 cp932 文字セット</a></span></dt></dl></div><p>
          サポートされているアジアの文字セットには、中国語、日本語、韓国語、タイ語が含まれています。これらは複雑な場合があります。たとえば、中国語の文字セットは数千種類の文字に対応している必要があります。<code class="literal">cp932</code> および <code class="literal">sjis</code> 文字セットの追加情報については、<a class="xref" href="globalization.html#charset-cp932" title="10.1.14.7.1 cp932 文字セット">セクション10.1.14.7.1「cp932 文字セット」</a>を参照してください。
        </p><p>
          MySQL でのアジアの文字セットのサポートに関連したよくある質問および問題に対する回答については、<a class="xref" href="faqs.html#faqs-cjk" title="A.11 MySQL 5.6 FAQ: MySQL の中国語、日本語、および韓国語の文字セット">セクションA.11「MySQL 5.6 FAQ: MySQL の中国語、日本語、および韓国語の文字セット」</a>を参照してください。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">big5</code> (Big5 繁体字中国語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">big5_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">big5_chinese_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">cp932</code> (SJIS for Windows 日本語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">cp932_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">cp932_japanese_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">eucjpms</code> (UJIS for Windows 日本語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">eucjpms_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">eucjpms_japanese_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">euckr</code> (EUC-KR 韓国語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">euckr_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">euckr_korean_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">gb2312</code> (GB2312 簡体字中国語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">gb2312_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">gb2312_chinese_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">gbk</code> (GBK 簡体字中国語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">gbk_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">gbk_chinese_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">sjis</code> (Shift-JIS 日本語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">sjis_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">sjis_japanese_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">tis620</code> (TIS620 タイ語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">tis620_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">tis620_thai_ci</code> (デフォルト)
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">ujis</code> (EUC-JP 日本語) 照合順序:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">ujis_bin</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">ujis_japanese_ci</code> (デフォルト)
                </p></li></ul></div></li></ul></div><p>
          <code class="literal">big5_chinese_ci</code> 照合順序は画数でソートします。
        </p><p>
          MySQL でのアジア言語照合順序の追加情報については、Collation-Charts.Org (<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#big5" target="_top">big5</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#cp932" target="_top">cp932</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#eucjpms" target="_top">eucjpms</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#euckr" target="_top">euckr</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#gb2312" target="_top">gb2312</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#gbk" target="_top">gbk</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#sjis" target="_top">sjis</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#tis620" target="_top">tis620</a>、<a class="ulink" href="http://www.collation-charts.org/mysql60/by-charset.html#ujis" target="_top">ujis</a>) を参照してください。
        </p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="charset-cp932"></a>10.1.14.7.1 cp932 文字セット</h5></div></div></div><p>
            <span class="bold"><strong><code class="literal">cp932</code> が必要な理由</strong></span>
          </p><p>
            MySQL では <code class="literal">sjis</code> 文字セットは IANA で定義される <code class="literal">Shift_JIS</code> 文字セットに対応しており、これらは JIS X0201 および JIS X0208 文字セットをサポートしています。(<a class="ulink" href="http://www.iana.org/assignments/character-sets" target="_top">http://www.iana.org/assignments/character-sets</a> を参照してください。)
          </p><p>
            ただし、記述用語としての<span class="quote">「<span class="quote">SHIFT JIS</span>」</span>の意味は非常にあいまいになっており、さまざまなベンダーが定義した <code class="literal">Shift_JIS</code> に対する拡張も含める場合もあります。
          </p><p>
            たとえば、日本語 Windows 環境で使用される<span class="quote">「<span class="quote">SHIFT JIS</span>」</span>は、Microsoft による <code class="literal">Shift_JIS</code> の拡張であり、正式な名称は <code class="literal">Microsoft Windows Codepage : 932</code> または <code class="literal">cp932</code> です。<code class="literal">Shift_JIS</code> でサポートされる文字に加え、<code class="literal">cp932</code> では、NEC 特殊文字、NEC 選定 IBM 拡張文字、IBM 選定文字などの拡張文字をサポートします。
          </p><p>
            多くの日本語ユーザーは、これらの拡張文字を使用するときに問題に直面してきました。これらの問題は次の要因によって生じていました。
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                MySQL が自動的に文字セットの変換を行なっていること。
              </p></li><li class="listitem"><p>
                文字セットが Unicode (<code class="literal">ucs2</code>) を使用して変換されていること。
              </p></li><li class="listitem"><p>
                <code class="literal">sjis</code> 文字セットが、これらの拡張文字の変換をサポートしていないこと。
              </p></li><li class="listitem"><p>
                いわゆる<span class="quote">「<span class="quote">SHIFT JIS</span>」</span>から Unicode への変換には複数の変換ルールが存在し、文字によっては、変換ルールに従って別々に Unicode に変換される場合があること。MySQL ではこれらの変換ルールのうち、1 つしかサポートしていません (詳細は後述します)。
              </p></li></ul></div><p>
            MySQL の <code class="literal">cp932</code> 文字セットは、これらの問題を解決するように設計されています。
          </p><p>
            MySQL が文字セットの変換をサポートするので、異なる変換ルールを持つ IANA の <code class="literal">Shift_JIS</code> と <code class="literal">cp932</code> を 2 つの異なる文字セットに区分することが重要になります。
          </p><p>
            <span class="bold"><strong><code class="literal">cp932</code> と <code class="literal">sjis</code> との相違点</strong></span>
          </p><p>
            <code class="literal">cp932</code> 文字セットは次の点で <code class="literal">sjis</code> と異なります。
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">cp932</code> は、NEC 特殊文字、NEC 選定 IBM 拡張文字、IBM 選定文字をサポートします。
              </p></li><li class="listitem"><p>
                一部の <code class="literal">cp932</code> 文字には、2 つの異なるコードポイントがあり、両方とも同一の Unicode コードポイントに変換されます。Unicode から <code class="literal">cp932</code> に戻すときに、どちらかのコードポイントを選択する必要があります。この<span class="quote">「<span class="quote">ラウンドトリップ変換</span>」</span>については、Microsoft が推奨するルールが使用されます。(<a class="ulink" href="http://support.microsoft.com/kb/170559/EN-US/" target="_top">http://support.microsoft.com/kb/170559/EN-US/</a>を参照してください。)
              </p><p>
                この変換ルールは次のように機能します。
              </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    文字が JIS X 0208 文字と NEC 特殊文字の両方に存在する場合には、JIS X 0208 のコードポイントを使用します。
                  </p></li><li class="listitem"><p>
                    文字が NEC 特殊文字と IBM 選定文字の両方に存在する場合には、NEC 特殊文字のコードポイントを使用します。
                  </p></li><li class="listitem"><p>
                    文字が IBM 選定文字と NEC 選定 IBM 拡張文字の両方に存在する場合は、IBM 拡張文字のコードポイントを使用します。
                  </p></li></ul></div><p>
                <a class="ulink" href="http://www.microsoft.com/globaldev/reference/dbcs/932.htm" target="_top">http://www.microsoft.com/globaldev/reference/dbcs/932.htm</a> に示す表には、<code class="literal">cp932</code> 文字の Unicode 値に関する情報が記載されています。<code class="literal">cp932</code> の表で下に 4 桁の数字が表示されている項目については、その数字は対応する Unicode (<code class="literal">ucs2</code>) エンコーディングを表します。下線付きの 2 桁の値のある表項目では、これらの 2 桁の値で始まる一定範囲の <code class="literal">cp932</code> 文字があります。このような表項目をクリックすると、これらの桁の値で始まる <code class="literal">cp932</code> 文字対する各 Unicode 値を示したページが表示されます。
              </p><p>
                詳細は次のリンクを参照してください。それぞれ、次の文字セットのエンコーディングに対応します。
              </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    NEC 特殊文字:
                  </p><pre class="programlisting">
<a class="ulink" href="http://www.microsoft.com/globaldev/reference/dbcs/932/932_87.htm" target="_top">http://www.microsoft.com/globaldev/reference/dbcs/932/932_87.htm</a>
</pre></li><li class="listitem"><p>
                    NEC 選定 IBM 拡張文字:
                  </p><pre class="programlisting">
<a class="ulink" href="http://www.microsoft.com/globaldev/reference/dbcs/932/932_ED.htm" target="_top">http://www.microsoft.com/globaldev/reference/dbcs/932/932_ED.htm</a>
<a class="ulink" href="http://www.microsoft.com/globaldev/reference/dbcs/932/932_EE.htm" target="_top">http://www.microsoft.com/globaldev/reference/dbcs/932/932_EE.htm</a>
</pre></li><li class="listitem"><p>
                    IBM 選定文字:
                  </p><pre class="programlisting">
<a class="ulink" href="http://www.microsoft.com/globaldev/reference/dbcs/932/932_FA.htm" target="_top">http://www.microsoft.com/globaldev/reference/dbcs/932/932_FA.htm</a>
<a class="ulink" href="http://www.microsoft.com/globaldev/reference/dbcs/932/932_FB.htm" target="_top">http://www.microsoft.com/globaldev/reference/dbcs/932/932_FB.htm</a>
<a class="ulink" href="http://www.microsoft.com/globaldev/reference/dbcs/932/932_FC.htm" target="_top">http://www.microsoft.com/globaldev/reference/dbcs/932/932_FC.htm</a>
</pre></li></ul></div></li><li class="listitem"><p>
                <code class="literal">cp932</code> は、<code class="literal">eucjpms</code> と組み合わせて使用することで、ユーザー定義の文字の変換をサポートし、<code class="literal">sjis</code>/<code class="literal">ujis</code> の変換での問題に対応します。詳細は、<a class="ulink" href="http://www.sljfaq.org/afaq/encodings.html" target="_top">http://www.sljfaq.org/afaq/encodings.html</a>を参照してください。
              </p></li></ul></div><p>
            一部の文字については、<code class="literal">ucs2</code> との間の変換は、<code class="literal">sjis</code> と <code class="literal">cp932</code> との場合と異なります。次の表に、これらの違いを示します。
          </p><p>
            <code class="literal">ucs2</code> への変換:
          </p><div class="informaltable"><table summary="次の表は、sjis/cp932 値を一覧表示し、sjis から ucs2 への変換と cp932 から ucs2 への変換との違いを示します。" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col"><code class="literal">sjis</code>/<code class="literal">cp932</code> 値</th><th scope="col"><code class="literal">sjis</code> -&gt; <code class="literal">ucs2</code> の変換</th><th scope="col"><code class="literal">cp932</code> -&gt; <code class="literal">ucs2</code> の変換</th></tr></thead><tbody><tr><td scope="row">5C</td><td>005C</td><td>005C</td></tr><tr><td scope="row">7E</td><td>007E</td><td>007E</td></tr><tr><td scope="row">815C</td><td>2015</td><td>2015</td></tr><tr><td scope="row">815F</td><td>005C</td><td>FF3C</td></tr><tr><td scope="row">8160</td><td>301C</td><td>FF5E</td></tr><tr><td scope="row">8161</td><td>2016</td><td>2225</td></tr><tr><td scope="row">817C</td><td>2212</td><td>FF0D</td></tr><tr><td scope="row">8191</td><td>00A2</td><td>FFE0</td></tr><tr><td scope="row">8192</td><td>00A3</td><td>FFE1</td></tr><tr><td scope="row">81CA</td><td>00AC</td><td>FFE2</td></tr></tbody></table></div><p>
            <code class="literal">ucs2</code> からの変換:
          </p><div class="informaltable"><table summary="次の表は、ucs2 値を一覧表示し、ucs2 から sjis への変換と ucs2 から cp932 への変換との違いを示します。" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col"><code class="literal">ucs2</code> 値</th><th scope="col"><code class="literal">ucs2</code> -&gt; <code class="literal">sjis</code> の変換</th><th scope="col"><code class="literal">ucs2</code> -&gt; <code class="literal">cp932</code> の変換</th></tr></thead><tbody><tr><td scope="row">005C</td><td>815F</td><td>5C</td></tr><tr><td scope="row">007E</td><td>7E</td><td>7E</td></tr><tr><td scope="row">00A2</td><td>8191</td><td>3F</td></tr><tr><td scope="row">00A3</td><td>8192</td><td>3F</td></tr><tr><td scope="row">00AC</td><td>81CA</td><td>3F</td></tr><tr><td scope="row">2015</td><td>815C</td><td>815C</td></tr><tr><td scope="row">2016</td><td>8161</td><td>3F</td></tr><tr><td scope="row">2212</td><td>817C</td><td>3F</td></tr><tr><td scope="row">2225</td><td>3F</td><td>8161</td></tr><tr><td scope="row">301C</td><td>8160</td><td>3F</td></tr><tr><td scope="row">FF0D</td><td>3F</td><td>817C</td></tr><tr><td scope="row">FF3C</td><td>3F</td><td>815F</td></tr><tr><td scope="row">FF5E</td><td>3F</td><td>8160</td></tr><tr><td scope="row">FFE0</td><td>3F</td><td>8191</td></tr><tr><td scope="row">FFE1</td><td>3F</td><td>8192</td></tr><tr><td scope="row">FFE2</td><td>3F</td><td>81CA</td></tr></tbody></table></div><p>
            日本語文字セットのユーザーは、<code class="option">--character-set-client-handshake</code> (または <code class="option">--skip-character-set-client-handshake</code>) を使用すると大きな効果が得られることに注意してください。<a class="xref" href="server-administration.html#server-options" title="5.1.3 サーバーコマンドオプション">セクション5.1.3「サーバーコマンドオプション」</a>を参照してください。
          </p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="error-message-language"></a>10.2 エラーメッセージ言語の設定</h2></div></div></div><a class="indexterm" name="idm139979105514128"></a><a class="indexterm" name="idm139979105511984"></a><a class="indexterm" name="idm139979105509920"></a><a class="indexterm" name="idm139979105507856"></a><p>
      デフォルトで、<span class="command"><strong>mysqld</strong></span> はエラーメッセージを英語で生成しますが、チョコ語、デンマーク語、オランダ語、エストニア語、フランス語、ドイツ語、ギリシャ語、ハンガリー語、イタリア語、日本語、韓国語、ノルウェー語、ノルウェー語 (ニーノシュク)、ポーランド語、ポルトガル語、ルーマニア語、ロシア語、スロバキア語、スペイン語、スウェーデン語のほかの言語でも表示できます。
    </p><p>
      このセクションの説明を使用して、サーバーでエラーメッセージに使用する言語を選択できます。
    </p><p>
      MySQL 5.6 では、サーバーは、次の 2 つの場所でエラーメッセージファイルを検索します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">lc_messages_dir</code> と <code class="literal">lc_messages</code> (後者は言語名に変換されます) の 2 つのシステム変数値から構築されたディレクトリでファイルを検索しようとします。次のコマンドを使用してサーバーを起動するとします。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysqld --lc_messages_dir=/usr/share/mysql --lc_messages=fr_FR</code></strong>
</pre><p>
          この場合、<span class="command"><strong>mysqld</strong></span> は、ロケール <code class="literal">fr_FR</code> を言語 <code class="literal">french</code> にマップし、<code class="filename">/usr/share/mysql/french</code> ディレクトリでエラーファイルを検索します。
        </p></li><li class="listitem"><p>
          前述のように構築されたディレクトリでメッセージファイルが見つからない場合、サーバーは、<code class="literal">lc_messages</code> 値を無視し、検索する場所として <code class="literal">lc_messages_dir</code> 値だけを使用します。
        </p></li></ul></div><p>
      <code class="literal">lc_messages_dir</code> システム変数は、グローバル値だけを含み、読み取り専用です。<code class="literal">lc_messages</code> は、グローバル値とセッション値を含み実行時に変更できるので、サーバーの実行中にエラーメッセージ言語を変更でき、個々のクライアントはそれぞれ、そのセッション <code class="literal">lc_messages</code> 値を別のロケール名に変更することによって、異なるエラーメッセージ言語を使用できます。たとえば、サーバーがエラーメッセージに <code class="literal">fr_FR</code> ロケールを使用している場合、クライアントは、次のステートメントを実行すると、英語でエラーメッセージを受信できます。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET lc_messages = 'en_US';</code></strong>
</pre><p>
      デフォルトでは、言語ファイルは、MySQL ベースディレクトリ下の <code class="filename">share/mysql/<em class="replaceable"><code>LANGUAGE</code></em></code> ディレクトリにあります。
    </p><p>
      エラーメッセージの (言語ではなく) 文字セットの変更の詳細は、<a class="xref" href="globalization.html#charset-errors" title="10.1.6 エラーメッセージの文字セット">セクション10.1.6「エラーメッセージの文字セット」</a>を参照してください。
    </p><p>
      「<a class="ulink" href="http://dev.mysql.com/doc/internals/en/error-messages.html" target="_top">MySQL Internals: Error Messages</a>」で入手できる MySQL Internals マニュアルの手順を使用すると、サーバーで生成されるエラーメッセージの内容を変更できます。エラーメッセージの内容を変更する場合は、MySQL のより新しいバージョンにアップグレードするごとに必ず変更を繰り返してください。
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="adding-character-set"></a>10.3 文字セットの追加</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="globalization.html#character-arrays">10.3.1 文字定義配列</a></span></dt><dt><span class="section"><a href="globalization.html#string-collating">10.3.2 複雑な文字セットの文字列照合のサポート</a></span></dt><dt><span class="section"><a href="globalization.html#multibyte-characters">10.3.3 複雑な文字セットのマルチバイト文字のサポート</a></span></dt></dl></div><a class="indexterm" name="idm139979105478208"></a><a class="indexterm" name="idm139979105476096"></a><p>
      このセクションでは、MySQL に文字セットを追加する手順について説明します。適切な手順は、文字セットが単純か複雑かによって異なります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          ソートに特別な文字列照合ルーチンを必要とせず、マルチバイト文字のサポートを必要としない文字セットが、単純な文字セットです。
        </p></li><li class="listitem"><p>
          これらのどちらかの機能が必要な文字セットが、複雑な文字セットです。
        </p></li></ul></div><p>
      たとえば、<code class="literal">greek</code> と <code class="literal">swe7</code> は単純な文字セットですが、<code class="literal">big5</code> と <code class="literal">czech</code> は複雑な文字セットです。
    </p><p>
      次の手順を使用するには、MySQL ソース配布が必要です。この手順では、<em class="replaceable"><code>MYSET</code></em> は追加する文字セットの名前を表します。
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          <em class="replaceable"><code>MYSET</code></em> の <code class="literal">&lt;charset&gt;</code> 要素を <code class="filename">sql/share/charsets/Index.xml</code> ファイルに追加します。ファイル内既存の内容を、新しい内容を追加するためのガイドとして使用します。<code class="literal">latin1</code> <code class="literal">&lt;charset&gt;</code> 要素のリストの一部を以下に示します。
        </p><pre class="programlisting">
&lt;charset name="latin1"&gt;
  &lt;family&gt;Western&lt;/family&gt;
  &lt;description&gt;cp1252 West European&lt;/description&gt;
  ...
  &lt;collation name="latin1_swedish_ci" id="8" order="Finnish, Swedish"&gt;
    &lt;flag&gt;primary&lt;/flag&gt;
    &lt;flag&gt;compiled&lt;/flag&gt;
  &lt;/collation&gt;
  &lt;collation name="latin1_danish_ci" id="15" order="Danish"/&gt;
  ...
  &lt;collation name="latin1_bin" id="47" order="Binary"&gt;
    &lt;flag&gt;binary&lt;/flag&gt;
    &lt;flag&gt;compiled&lt;/flag&gt;
  &lt;/collation&gt;
  ...
&lt;/charset&gt;
</pre><p>
          <code class="literal">&lt;charset&gt;</code> 要素は、文字セットのすべての照合順序を一覧表示します。これらには少なくも、バイナリ照合順序とデフォルト (プライマリ) 照合順序が含まれます。デフォルト照合順序は多くの場合、<code class="literal">general_ci</code> (一般、大文字と小文字を区別) のサフィクスを使用して名前が付けられます。バイナリ照合順序をデフォルト照合順序にすることは可能ですが、通常、これらは異なります。デフォルト照合順序には <code class="literal">primary</code> フラグを付ける必要があります。バイナリ照合順序には <code class="literal">binary</code> フラグを付ける必要があります。
        </p><p>
          それぞれの照合順序に一意の ID 番号を割り当てる必要があります。1024 から 2047 の ID 範囲は、ユーザー定義の照合順序に予約されています。現在使用されている照合順序 ID の最大値を検索するには、次のクエリーを使用します。
        </p><pre class="programlisting">
SELECT MAX(ID) FROM INFORMATION_SCHEMA.COLLATIONS;
</pre></li><li class="listitem"><p>
          このステップは、追加しているのが単純な文字セットか、複雑な文字セットかにより異なります。単純な文字セットには、構成ファイルだけが必要ですが、複雑な文字セットには、照合順序関数またはマルチバイト関数あるいはその両方を定義する C ソースファイルが必要です。
        </p><p>
          単純な文字セットの場合、文字セットプロパティーについて記した構成ファイル (<code class="filename"><em class="replaceable"><code>MYSET</code></em>.xml</code>) を作成します。<code class="filename">sql/share/charsets</code> ディレクトリにこのファイルを作成します。このファイルの土台として <code class="filename">latin1.xml</code> のコピーを使用できます。ファイルの構文は非常に単純です。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              コメントは、通常の XML コメント (<code class="literal">&lt;!-- <em class="replaceable"><code>text</code></em> --&gt;</code>) として記述されます。
            </p></li><li class="listitem"><p>
              <code class="literal">&lt;map&gt;</code> 配列要素内の単語は、任意の数の空白によって区切られます。
            </p></li><li class="listitem"><p>
              <code class="literal">&lt;map&gt;</code> 配列要素内の各単語は、16 進形式の数値で表す必要があります。
            </p></li><li class="listitem"><p>
              <code class="literal">&lt;ctype&gt;</code> 要素の <code class="literal">&lt;map&gt;</code> 配列要素には 257 語が含まれます。そのあとのほかの <code class="literal">&lt;map&gt;</code> 配列要素には 256 語が含まれます。<a class="xref" href="globalization.html#character-arrays" title="10.3.1 文字定義配列">セクション10.3.1「文字定義配列」</a>を参照してください。
            </p></li><li class="listitem"><p>
              <code class="filename">Index.xml</code> 内の文字セットに対して <code class="literal">&lt;charset&gt;</code> 要素に一覧表示された照合順序ごとに、文字の順序を定義する <code class="literal">&lt;collation&gt;</code> 要素を <code class="filename"><em class="replaceable"><code>MYSET</code></em>.xml</code> に含める必要があります。
            </p></li></ul></div><p>
          複雑な文字セットの場合、文字セットプロパティーについて記述し、文字セットに対する演算を適切に実行するために必要なサポートルーチンを定義した C ソースファイルを作成します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="filename">strings</code> ディレクトリに <code class="filename">ctype-<em class="replaceable"><code>MYSET</code></em>.c</code> ファイルを作成します。既存の <code class="filename">ctype-*.c</code> ファイルのいずれか (<code class="filename">ctype-big5.c</code> など) を調べて、定義する必要のあるものを確認します。ファイル内の配列には、<code class="literal">ctype_<em class="replaceable"><code>MYSET</code></em></code>、<code class="literal">to_lower_<em class="replaceable"><code>MYSET</code></em></code> などの名前を付ける必要があります。これらは、単純な文字セットの配列に対応します。<a class="xref" href="globalization.html#character-arrays" title="10.3.1 文字定義配列">セクション10.3.1「文字定義配列」</a>を参照してください。
            </p></li><li class="listitem"><p>
              <code class="filename">Index.xml</code> 内の文字セットに対して <code class="literal">&lt;charset&gt;</code> 要素に一覧表示された <code class="literal">&lt;collation&gt;</code> 要素ごとに、<code class="filename">ctype-<em class="replaceable"><code>MYSET</code></em>.c</code> ファイルが照合順序の実装を提供する必要があります。
            </p></li><li class="listitem"><p>
              文字セットで文字列照合関数が必要な場合は、<a class="xref" href="globalization.html#string-collating" title="10.3.2 複雑な文字セットの文字列照合のサポート">セクション10.3.2「複雑な文字セットの文字列照合のサポート」</a>を参照してください。
            </p></li><li class="listitem"><p>
              文字セットでマルチバイト文字のサポートが必要な場合は、<a class="xref" href="globalization.html#multibyte-characters" title="10.3.3 複雑な文字セットのマルチバイト文字のサポート">セクション10.3.3「複雑な文字セットのマルチバイト文字のサポート」</a>を参照してください。
            </p></li></ul></div></li><li class="listitem"><p>
          構成情報を変更します。<em class="replaceable"><code>MYSYS</code></em> の情報を追加するためのガイドとして、既存の構成情報を使用します。ここでの例では、文字セットにデフォルト照合順序とバイナリ照合順序があることを想定していますが、<em class="replaceable"><code>MYSET</code></em> に追加の照合順序がある場合には、さらに多くの行が必要になります。
        </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>
              <code class="filename">mysys/charset-def.c</code> を編集し、新しい文字セットの照合順序を<span class="quote">「<span class="quote">登録</span>」</span>します。
            </p><p>
              <span class="quote">「<span class="quote">宣言</span>」</span>セクションに次の行を追加します。
            </p><pre class="programlisting">
#ifdef HAVE_CHARSET_<em class="replaceable"><code>MYSET</code></em>
extern CHARSET_INFO my_charset_<em class="replaceable"><code>MYSET</code></em>_general_ci;
extern CHARSET_INFO my_charset_<em class="replaceable"><code>MYSET</code></em>_bin;
#endif
</pre><p>
              <span class="quote">「<span class="quote">登録</span>」</span>セクションに次の行を追加します。
            </p><pre class="programlisting">
#ifdef HAVE_CHARSET_<em class="replaceable"><code>MYSET</code></em>
  add_compiled_collation(&amp;my_charset_<em class="replaceable"><code>MYSET</code></em>_general_ci);
  add_compiled_collation(&amp;my_charset_<em class="replaceable"><code>MYSET</code></em>_bin);
#endif
</pre></li><li class="listitem"><p>
              文字セットが <code class="filename">ctype-<em class="replaceable"><code>MYSET</code></em>.c</code> を使用する場合、<code class="filename">strings/CMakeLists.txt</code> を編集して、<code class="filename">ctype-<em class="replaceable"><code>MYSET</code></em>.c</code> を <code class="literal">STRINGS_SOURCES</code> 変数の定義に追加します。
            </p></li><li class="listitem"><p>
              <code class="filename">cmake/character_sets.cmake</code> を編集します。
            </p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>
                  アルファベット順で <code class="literal">CHARSETS_AVAILABLE</code> の値に <em class="replaceable"><code>MYSET</code></em> を追加します。
                </p></li><li class="listitem"><p>
                  アルファベット順で <code class="literal">CHARSETS_COMPLEX</code> の値に <em class="replaceable"><code>MYSET</code></em> を追加します。これは単純な文字セットにも必要です。ない場合は、<span class="command"><strong>CMake</strong></span> は <code class="option">-DDEFAULT_CHARSET=<em class="replaceable"><code>MYSET</code></em></code> を認識しません。
                </p></li></ol></div></li></ol></div></li><li class="listitem"><p>
          再構成し、再コンパイルし、テストします。
        </p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="character-arrays"></a>10.3.1 文字定義配列</h3></div></div></div><p>
        それぞれの単純な文字セットには、<code class="filename">sql/share/charsets</code> ディレクトリに置かれた構成ファイルがあります。<em class="replaceable"><code>MYSYS</code></em> という名前の文字セットの場合、ファイルには <code class="filename"><em class="replaceable"><code>MYSET</code></em>.xml</code> の名前が付けられます。これは、<code class="literal">&lt;map&gt;</code> 配列要素を使用して、文字セットプロパティーを一覧表示します。<code class="literal">&lt;map&gt;</code> 要素は、これらの要素内に表示されます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">&lt;ctype&gt;</code> は文字ごとに属性を定義します。
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;lower&gt;</code> と <code class="literal">&lt;upper&gt;</code> は、小文字と大文字を一覧表示します。
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;unicode&gt;</code> は、8 ビット文字値を Unicode 値にマップします。
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;collation&gt;</code> 要素は、比較とソートでの文字の順序を、照合順序ごとに 1 つの要素で示します。文字コード自体が順序を提供するので、バイナリ照合順序には <code class="literal">&lt;map&gt;</code> 要素は不要です。
          </p></li></ul></div><p>
        <code class="filename">strings</code> ディレクトリ内の <code class="filename">ctype-<em class="replaceable"><code>MYSET</code></em>.c</code> ファイルに実装された複雑な文字セットには、<code class="literal">ctype_<em class="replaceable"><code>MYSET</code></em>[]</code>、<code class="literal">to_lower_<em class="replaceable"><code>MYSET</code></em>[]</code> などの対応する配列があります。すべての複雑な文字セットがすべての配列を持つわけではありません。例については、既存の <code class="filename">ctype-*.c</code> ファイルも参照してください。追加情報については、<code class="filename">strings</code> ディレクトリ内の <code class="filename">CHARSET_INFO.txt</code> ファイルを参照してください。
      </p><p>
        ほとんどの配列には、文字値でインデックスが付けられ、256 個の要素があります。<code class="literal">&lt;ctype&gt;</code> 配列には、文字値 + 1 でインデックスが付けられ、257 個の要素があります。これは、<code class="literal">EOF</code> を処理するための従来の規則です。
      </p><p>
        <code class="literal">&lt;ctype&gt;</code> 配列要素は、ビット値です。各要素は、文字セット内の単一の文字の属性について記述します。各属性は、<code class="filename">include/m_ctype.h</code> での定義に従って、ビットマスクに関連付けられます。
      </p><pre class="programlisting">
#define _MY_U   01      /* Upper case */
#define _MY_L   02      /* Lower case */
#define _MY_NMR 04      /* Numeral (digit) */
#define _MY_SPC 010     /* Spacing character */
#define _MY_PNT 020     /* Punctuation */
#define _MY_CTR 040     /* Control character */
#define _MY_B   0100    /* Blank */
#define _MY_X   0200    /* heXadecimal digit */
</pre><p>
        所定の文字の <code class="literal">&lt;ctype&gt;</code> 値は、その文字について記述した適用可能なビットマスク値の結合である必要があります。たとえば、<code class="literal">'A'</code> は 16 進数 (<code class="literal">_MY_X</code>) と同様に大文字 (<code class="literal">_MY_U</code>) であるので、その <code class="literal">ctype</code> 値は次のように定義する必要があります。
      </p><pre class="programlisting">
ctype['A'+1] = _MY_U | _MY_X = 01 | 0200 = 0201
</pre><p>
        <code class="filename">m_ctype.h</code> のビットマスク値は 8 進数値ですが、<code class="filename"><em class="replaceable"><code>MYSET</code></em>.xml</code> 内の <code class="literal">&lt;ctype&gt;</code> 配列の要素は 16 進値として書き込む必要があります。
      </p><p>
        <code class="literal">&lt;lower&gt;</code> と <code class="literal">&lt;upper&gt;</code> 配列は、文字セットの各メンバーに対応した小文字と大文字を保持します。例:
      </p><pre class="programlisting">
lower['A'] should contain 'a'
upper['a'] should contain 'A'
</pre><p>
        各 <code class="literal">&lt;collation&gt;</code> 配列は、比較およびソートでどのように文字を順序付けする必要があるかを示します。MySQL は、この情報の値に基づいて文字をソートします。場合によっては、これは <code class="literal">&lt;upper&gt;</code> 配列と同じであり、ソートで大文字と小文字が区別されないことになります。さらに複雑なソートルールについては (複雑な文字セットの場合)、<a class="xref" href="globalization.html#string-collating" title="10.3.2 複雑な文字セットの文字列照合のサポート">セクション10.3.2「複雑な文字セットの文字列照合のサポート」</a>での文字列照合の説明を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="string-collating"></a>10.3.2 複雑な文字セットの文字列照合のサポート</h3></div></div></div><a class="indexterm" name="idm139979105348528"></a><a class="indexterm" name="idm139979105346416"></a><p>
        <em class="replaceable"><code>MYSET</code></em> という名前の単純な文字セットの場合、ソートルールは、<code class="literal">&lt;collation&gt;</code> 要素内の <code class="literal">&lt;map&gt;</code> 配列要素を使用して、<code class="filename"><em class="replaceable"><code>MYSET</code></em>.xml</code> 構成ファイルで指定されます。言語に関するソートルールが非常に複雑で、単純な配列では扱えない場合、<code class="filename">strings</code> ディレクトリ内の <code class="filename">ctype-<em class="replaceable"><code>MYSET</code></em>.c</code> ソースファイルで文字列照合関数を定義する必要があります。
      </p><p>
        既存の文字セットからは、これらの関数がどのように実装されているかを示す最適なドキュメントおよび例が得られます。<code class="literal">big5</code>、<code class="literal">czech</code>、<code class="literal">gbk</code>、<code class="literal">sjis</code>、<code class="literal">tis160</code> 文字セットのファイルなど、<code class="filename">strings</code> ディレクトリ内の <code class="filename">ctype-*.c</code> ファイルを調べます。<code class="literal">MY_COLLATION_HANDLER</code> 構造を見て、どのように使用されているかを確認します。追加情報については、<code class="filename">strings</code> ディレクトリ内の <code class="filename">CHARSET_INFO.txt</code> ファイルも参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="multibyte-characters"></a>10.3.3 複雑な文字セットのマルチバイト文字のサポート</h3></div></div></div><a class="indexterm" name="idm139979105329712"></a><a class="indexterm" name="idm139979105327600"></a><p>
        マルチバイト文字を含む <em class="replaceable"><code>MYSET</code></em> という名前の新しい文字セットのサポートを追加する場合、<code class="filename">strings</code> ディレクトリ内の <code class="filename">ctype-<em class="replaceable"><code>MYSET</code></em>.c</code> ソースファイルのマルチバイト文字関数を使用する必要があります。
      </p><p>
        既存の文字セットからは、これらの関数がどのように実装されているかを示す最適なドキュメントおよび例が得られます。<code class="literal">euc_kr</code>、<code class="literal">gb2312</code>、<code class="literal">gbk</code>、<code class="literal">sjis</code>、<code class="literal">ujis</code> 文字セットのファイルなど、<code class="filename">strings</code> ディレクトリ内の <code class="filename">ctype-*.c</code> ファイルを調べます。<code class="literal">MY_CHARSET_HANDLER</code> 構造を見て、どのように使用されているかを確認します。追加情報については、<code class="filename">strings</code> ディレクトリ内の <code class="filename">CHARSET_INFO.txt</code> ファイルも参照してください。
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="adding-collation"></a>10.4 文字セットへの照合順序の追加</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="globalization.html#charset-collation-implementations">10.4.1 照合順序の実装タイプ</a></span></dt><dt><span class="section"><a href="globalization.html#adding-collation-choosing-id">10.4.2 照合順序 ID の選択</a></span></dt><dt><span class="section"><a href="globalization.html#adding-collation-simple-8bit">10.4.3 8 ビットの文字セットへの単純な照合順序の追加</a></span></dt><dt><span class="section"><a href="globalization.html#adding-collation-unicode-uca">10.4.4 Unicode 文字セットへの UCA 照合順序の追加</a></span></dt></dl></div><a class="indexterm" name="idm139979105313328"></a><p>
      照合順序は、文字列を比較およびソートする方法を定義した一連のルールです。MySQL でのそれぞれの照合順序は、単一の文字セットに属しています。すべての文字セットには少なくとも 1 つの照合順序が属し、ほとんどの文字セットのは 2 つ以上の照合順序が属しています。
    </p><p>
      照合順序は重みに基づいて文字を順序付けします。文字セット内のそれぞれの文字が重みにマップされています。重みが等しい文字は同等と見なされ、重みが等しくない文字は、その重みの相対的な大きさに従って比較されます。
    </p><p>
      <code class="literal">WEIGHT_STRING()</code> 関数を使用すると、文字列内の文字の重みを確認できます。重みを示した返される値はバイナリ文字列であるので、<code class="literal">HEX(WEIGHT_STRING(<em class="replaceable"><code>str</code></em>))</code> を使用して重みを出力可能な形式で表示すると便利です。次の例は、大文字と小文字を区別しない非バイナリ文字列である場合は、<code class="literal">'AaBb'</code> 内の大文字と小文字で重みは異ならないが、バイナリ文字列である場合は異なることを示します。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT HEX(WEIGHT_STRING('AaBb' COLLATE latin1_swedish_ci));</code></strong>
+------------------------------------------------------+
| HEX(WEIGHT_STRING('AaBb' COLLATE latin1_swedish_ci)) |
+------------------------------------------------------+
| 41414242                                             |
+------------------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT HEX(WEIGHT_STRING(BINARY 'AaBb'));</code></strong>
+-----------------------------------+
| HEX(WEIGHT_STRING(BINARY 'AaBb')) |
+-----------------------------------+
| 41614262                          |
+-----------------------------------+
</pre><p>
      <a class="xref" href="globalization.html#charset-collation-implementations" title="10.4.1 照合順序の実装タイプ">セクション10.4.1「照合順序の実装タイプ」</a>で説明するように、MySQL では複数の照合順序の実装をサポートしています。これらの中には、再コンパイルせずに、MySQL に追加できるものもあります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          8 ビットの文字セットの単純な照合順序。
        </p></li><li class="listitem"><p>
          Unicode 文字セットの UCA ベースの照合順序。
        </p></li><li class="listitem"><p>
          バイナリ (<code class="literal"><em class="replaceable"><code>xxx</code></em>_bin</code>) 照合順序。
        </p></li></ul></div><p>
      以降のセクションでは、最初の 2 種類の照合順序を既存の文字セットに追加する方法について説明します。バイナリ照合順序については、既存の文字セットにもすでに用意されているので、ここでは追加方法は説明しません。
    </p><p>
      新しい照合順序を追加する手順のサマリー:
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          照合順序 ID を選択します。
        </p></li><li class="listitem"><p>
          照合順序に名前を付ける構成情報を追加し、文字順序付けルールについて記述します。
        </p></li><li class="listitem"><p>
          サーバーを再起動します。
        </p></li><li class="listitem"><p>
          照合順序が存在していることを検証します。
        </p></li></ol></div><p>
      ここでの説明では、MySQL を再コンパイルすることなく追加できる照合順序だけを取り上げます。再コンパイルを必要とする照合順序 (C ソースファイル内の関数を利用して実装されたものなど) を追加するには、<a class="xref" href="globalization.html#adding-character-set" title="10.3 文字セットの追加">セクション10.3「文字セットの追加」</a>の手順を使用してください。ただし、完全な文字セットに必要なすべての情報を追加するのではなく、既存の文字セットに合わせて適切なファイルを変更します。つまり、文字セットの現在の照合順序ですでに存在するものに基づいて、新しい照合順序のデータ構造、関数、構成情報を追加します。
    </p><a class="indexterm" name="idm139979105287744"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        既存の照合順序を変更すると、その照合順序を使用するカラムでインデックスの行順序に影響が及ぶことがあります。この場合、間違ったクエリー結果などの問題が起こらないように、これらのインデックスを再構築してください。詳細は、<a class="xref" href="installing.html#checking-table-incompatibilities" title="2.11.3 テーブルまたはインデックスの再構築が必要かどうかのチェック">セクション2.11.3「テーブルまたはインデックスの再構築が必要かどうかのチェック」</a>を参照してください。
      </p></div><h3><a name="idm139979105283488"></a>追加のリソース</h3><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Unicode 照合順序アルゴリズム (UCA) の仕様: <a class="ulink" href="http://www.unicode.org/reports/tr10/" target="_top">http://www.unicode.org/reports/tr10/</a>
        </p></li><li class="listitem"><p>
          Locale Data Markup Language (LDML) の仕様: <a class="ulink" href="http://www.unicode.org/reports/tr35/" target="_top">http://www.unicode.org/reports/tr35/</a>
        </p></li><li class="listitem"><p>
          MySQL ブログ記事<span class="quote">「<span class="quote">新しい Unicode 照合順序を追加するための手順</span>」</span>: <a class="ulink" href="http://blogs.mysql.com/peterg/2008/05/19/instructions-for-adding-a-new-unicode-collation/" target="_top">http://blogs.mysql.com/peterg/2008/05/19/instructions-for-adding-a-new-unicode-collation/</a>
        </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="charset-collation-implementations"></a>10.4.1 照合順序の実装タイプ</h3></div></div></div><p>
        MySQL は複数のタイプの照合順序を実装します。
      </p><p>
        <span class="bold"><strong>8 ビットの文字セットに対する単純な照合順序</strong></span>
      </p><p>
        この種の照合順序は、文字コードと重みの 1 対 1 のマッピングを定義した 256 個の重みの配列を使用して実装されます。<code class="literal">latin1_swedish_ci</code> がその一例です。これは、大文字と小文字を区別しない照合順序なので、大文字と小文字は同じ重みで、等しいものと見なされます。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET NAMES 'latin1' COLLATE 'latin1_swedish_ci';</code></strong>
Query OK, 0 rows affected (0.01 sec)

mysql&gt; <strong class="userinput"><code>SELECT HEX(WEIGHT_STRING('a')), HEX(WEIGHT_STRING('A'));</code></strong>
+-------------------------+-------------------------+
| HEX(WEIGHT_STRING('a')) | HEX(WEIGHT_STRING('A')) |
+-------------------------+-------------------------+
| 41                      | 41                      |
+-------------------------+-------------------------+
1 row in set (0.01 sec)

mysql&gt; <strong class="userinput"><code>SELECT 'a' = 'A';</code></strong>
+-----------+
| 'a' = 'A' |
+-----------+
|         1 |
+-----------+
1 row in set (0.12 sec)
</pre><p>
        実装の手順については、<a class="xref" href="globalization.html#adding-collation-simple-8bit" title="10.4.3 8 ビットの文字セットへの単純な照合順序の追加">セクション10.4.3「8 ビットの文字セットへの単純な照合順序の追加」</a>を参照してください。
      </p><p>
        <span class="bold"><strong>8 ビット文字セットに対する複雑な照合順序</strong></span>
      </p><p>
        この種の照合順序は、<a class="xref" href="globalization.html#adding-character-set" title="10.3 文字セットの追加">セクション10.3「文字セットの追加」</a>で説明しているように、文字を順序付けする方法を定義した C ソースファイル内の関数を使用して実装されます。
      </p><p>
        <span class="bold"><strong>Unicode 以外のマルチバイト文字セットの照合順序</strong></span>
      </p><p>
        この種の照合順序では、8 ビット (シングルバイト) 文字とマルチバイト文字が異なる方法で処理されます。8 ビットの文字の場合、文字コードは大文字と小文字を区別しない形式で重みにマップされます。(たとえば、シングルバイト文字 <code class="literal">'a'</code> と <code class="literal">'A'</code> はどちらも重みが <code class="literal">0x41</code> です。)マルチバイト文字の場合、文字コードと重みの間には、2 種類の関係があります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            重みが文字コードと等しい場合。<code class="literal">sjis_japanese_ci</code> がこの種の照合順序の一例です。マルチバイト文字 <code class="literal">'ぢ'</code> の文字コードは <code class="literal">0x82C0</code> であり、重みも <code class="literal">0x82C0</code> です。
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t1</code></strong>
    -&gt; <strong class="userinput"><code>(c1 VARCHAR(2) CHARACTER SET sjis COLLATE sjis_japanese_ci);</code></strong>
Query OK, 0 rows affected (0.01 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO t1 VALUES ('a'),('A'),(0x82C0);</code></strong>
Query OK, 3 rows affected (0.00 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql&gt; <strong class="userinput"><code>SELECT c1, HEX(c1), HEX(WEIGHT_STRING(c1)) FROM t1;</code></strong>
+------+---------+------------------------+
| c1   | HEX(c1) | HEX(WEIGHT_STRING(c1)) |
+------+---------+------------------------+
| a    | 61      | 41                     |
| A    | 41      | 41                     |
| ぢ    | 82C0    | 82C0                   |
+------+---------+------------------------+
3 rows in set (0.00 sec)
</pre></li><li class="listitem"><p>
            文字コードが 1 対 1 で重みにマップされていても、必ずしもコードと重みが等しくない場合。<code class="literal">gbk_chinese_ci</code> がこの種の照合順序の一例です。マルチバイト文字 <code class="literal">'膰'</code> の文字コードは <code class="literal">0x81B0</code> ですが、重みは <code class="literal">0xC286</code> です。
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t1</code></strong>
    -&gt; <strong class="userinput"><code>(c1 VARCHAR(2) CHARACTER SET gbk COLLATE gbk_chinese_ci);</code></strong>
Query OK, 0 rows affected (0.33 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO t1 VALUES ('a'),('A'),(0x81B0);</code></strong>
Query OK, 3 rows affected (0.00 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql&gt; <strong class="userinput"><code>SELECT c1, HEX(c1), HEX(WEIGHT_STRING(c1)) FROM t1;</code></strong>
+------+---------+------------------------+
| c1   | HEX(c1) | HEX(WEIGHT_STRING(c1)) |
+------+---------+------------------------+
| a    | 61      | 41                     |
| A    | 41      | 41                     |
| 膰    | 81B0    | C286                   |
+------+---------+------------------------+
3 rows in set (0.00 sec)
</pre></li></ul></div><p>
        実装の手順については、<a class="xref" href="globalization.html#adding-character-set" title="10.3 文字セットの追加">セクション10.3「文字セットの追加」</a>を参照してください。
      </p><p>
        <span class="bold"><strong>Unicode マルチバイト文字セットの照合順序</strong></span>
      </p><p>
        これらの照合順序の一部は Unicode 照合順序アルゴリズム (UCA) に基づきますが、それ以外は基づいていません。
      </p><p>
        UCA に基づいていない照合順序では、文字コードと重みは 1 対 1 でマップしています。MySQL では、このような照合順序は大文字と小文字を区別せず、アクセント、濁音、破裂音を区別しません。<code class="literal">utf8_general_ci</code> がその一例です。<code class="literal">'a'</code>、<code class="literal">'A'</code>、<code class="literal">'À'</code>、および <code class="literal">'á'</code> のそれぞれは文字コードは別々ですが、重みはすべて <code class="literal">0x0041</code> であり、等しいものと見なされます。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET NAMES 'utf8' COLLATE 'utf8_general_ci';</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>CREATE TABLE t1</code></strong>
    -&gt; <strong class="userinput"><code>(c1 CHAR(1) CHARACTER SET UTF8 COLLATE utf8_general_ci);</code></strong>
Query OK, 0 rows affected (0.01 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO t1 VALUES ('a'),('A'),('À'),('á');</code></strong>
Query OK, 4 rows affected (0.00 sec)
Records: 4  Duplicates: 0  Warnings: 0

mysql&gt; <strong class="userinput"><code>SELECT c1, HEX(c1), HEX(WEIGHT_STRING(c1)) FROM t1;</code></strong>
+------+---------+------------------------+
| c1   | HEX(c1) | HEX(WEIGHT_STRING(c1)) |
+------+---------+------------------------+
| a    | 61      | 0041                   |
| A    | 41      | 0041                   |
| À    | C380    | 0041                   |
| á    | C3A1    | 0041                   |
+------+---------+------------------------+
4 rows in set (0.00 sec)
</pre><p>
        MySQL の UCA ベースの照合順序には、次の 3 つのプロパティーがあります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            文字に重みがある場合、それぞれの重みは 2 バイト (16 ビット) を使用します。
          </p></li><li class="listitem"><p>
            文字の重みはゼロ (または空の重み) の場合があります。この場合、文字は無視できます。例:「U+0000 NULL」は重みがなく、無視できます。
          </p></li><li class="listitem"><p>
            1 つの文字が 1 つの重みを持つ場合があります。例: <code class="literal">'a'</code> には <code class="literal">0x0E33</code> の重みがあります。
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET NAMES 'utf8' COLLATE 'utf8_unicode_ci';</code></strong>
Query OK, 0 rows affected (0.05 sec)

mysql&gt; <strong class="userinput"><code>SELECT HEX('a'), HEX(WEIGHT_STRING('a'));</code></strong>
+----------+-------------------------+
| HEX('a') | HEX(WEIGHT_STRING('a')) |
+----------+-------------------------+
| 61       | 0E33                    |
+----------+-------------------------+
1 row in set (0.02 sec)
</pre></li><li class="listitem"><p>
            1 つの文字が複数の重みを持つ場合があります。これは拡張形式です。例: ドイツ語の文字 <code class="literal">'ß'</code> (SZ リガチャーまたは SHARP S) には、<code class="literal">0x0FEA0FEA</code> の重みがあります。
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET NAMES 'utf8' COLLATE 'utf8_unicode_ci';</code></strong>
Query OK, 0 rows affected (0.11 sec)

mysql&gt; <strong class="userinput"><code>SELECT HEX('ß'), HEX(WEIGHT_STRING('ß'));</code></strong>
+-----------+--------------------------+
| HEX('ß')  | HEX(WEIGHT_STRING('ß'))  |
+-----------+--------------------------+
| C39F      | 0FEA0FEA                 |
+-----------+--------------------------+
1 row in set (0.00 sec)
</pre></li><li class="listitem"><p>
            複数の文字が 1 つの重みを持つ場合があります。これは短縮形式です。例: <code class="literal">'ch'</code> は、チェコ語の単一の文字であり、<code class="literal">0x0EE2</code> の重みを持ちます。
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET NAMES 'utf8' COLLATE 'utf8_czech_ci';</code></strong>
Query OK, 0 rows affected (0.09 sec)

mysql&gt; <strong class="userinput"><code>SELECT HEX('ch'), HEX(WEIGHT_STRING('ch'));</code></strong>
+-----------+--------------------------+
| HEX('ch') | HEX(WEIGHT_STRING('ch')) |
+-----------+--------------------------+
| 6368      | 0EE2                     |
+-----------+--------------------------+
1 row in set (0.00 sec)
</pre></li></ul></div><p>
        複数の文字と複数の重みのマッピングも可能です (これは拡張形式を使用した短縮形式です) が、MySQL ではサポートされていません。
      </p><p>
        UCA に基づいていない照合順序に関する実装の手順については、<a class="xref" href="globalization.html#adding-character-set" title="10.3 文字セットの追加">セクション10.3「文字セットの追加」</a>を参照してください。UCA 照合順序については、<a class="xref" href="globalization.html#adding-collation-unicode-uca" title="10.4.4 Unicode 文字セットへの UCA 照合順序の追加">セクション10.4.4「Unicode 文字セットへの UCA 照合順序の追加」</a>を参照してください。
      </p><p>
        <span class="bold"><strong>その他の照合順序</strong></span>
      </p><p>
        上記のカテゴリのどれにも該当しない照合順序も少数存在します。
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="adding-collation-choosing-id"></a>10.4.2 照合順序 ID の選択</h3></div></div></div><p>
        各照合順序には一意の ID が必要です。照合順序を追加するには、現在使用されていない ID 値を選択する必要があります。1024 から 2047 の ID 範囲は、ユーザー定義の照合順序に予約されています。MySQL 5.6.3 以降、<code class="literal">InnoDB</code> テーブルは 2 バイトの照合順序 ID をサポートしています。MySQL 5.6.3 より前では、<code class="literal">InnoDB</code> テーブルは、255 を最大値とするシングルバイトの照合順序 ID だけをサポートしていました。<code class="literal">MyISAM</code> テーブルでは、MySQL 5.5 以降の 2 バイトの照合順序 ID をサポートしています。
      </p><p>
        選択した照合順序は次のコンテキストで表示されます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">INFORMATION_SCHEMA.COLLATIONS</code> テーブルの <code class="literal">ID</code> カラム。
          </p></li><li class="listitem"><p>
            <code class="literal">SHOW COLLATION</code> 出力の <code class="literal">Id</code> カラム。
          </p></li><li class="listitem"><p>
            <code class="literal">MYSQL_FIELD</code> C API データ構造の <code class="literal">charsetnr</code> メンバー。
          </p></li><li class="listitem"><p>
            <code class="literal">mysql_get_character_set_info()</code> C API 関数で返される <code class="literal">MY_CHARSET_INFO</code> データ構造の <code class="literal">number</code> メンバー。
          </p></li></ul></div><p>
        現在使用されている最大の ID を判別するには、次のステートメントを発行します。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT MAX(ID) FROM INFORMATION_SCHEMA.COLLATIONS;</code></strong>
+---------+
| MAX(ID) |
+---------+
|     210 |
+---------+
</pre><p>
        現在使用されているすべての ID のリストを表示するには、次のステートメントを発行します。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT ID FROM INFORMATION_SCHEMA.COLLATIONS ORDER BY ID;</code></strong>
+-----+
| ID  |
+-----+
|   1 |
|   2 |
| ... |
|  52 |
|  53 |
|  57 |
|  58 |
| ... |
|  98 |
|  99 |
| 128 |
| 129 |
| ... |
| 210 |
+-----+
</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
          MySQL 5.5 より前では、ユーザー定義の照合順序 ID の範囲が用意されており、1 から 254 の範囲で ID を選択する必要があります。この場合、MySQL をアップグレードすると、選択した照合順序 ID が新しい MySQL 配布に含められた照合順序に割り当てられていることがわかります。この場合、自身の照合順序には新しい値を選択する必要があります。
        </p><p>
          さらに、アップグレードする前に、変更する構成ファイルを保存する必要があります。適切にアップグレードすると、そのプロセスによって変更したファイルが置き換えられます。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="adding-collation-simple-8bit"></a>10.4.3 8 ビットの文字セットへの単純な照合順序の追加</h3></div></div></div><p>
        このセクションでは、MySQL <code class="filename">Index.xml</code> ファイル内の <code class="literal">&lt;charset&gt;</code> 文字セットの記述に関連付けられた <code class="literal">&lt;collation&gt;</code> 要素を書き込むことによって、8 ビット文字セットの単純な照合順序を追加する方法について説明します。ここで説明した手順では、MySQL の再コンパイルは不要です。この例では、<code class="literal">latin1_test_ci</code> という名前の照合順序を <code class="literal">latin1</code> 文字セットに追加します。
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            <a class="xref" href="globalization.html#adding-collation-choosing-id" title="10.4.2 照合順序 ID の選択">セクション10.4.2「照合順序 ID の選択」</a>で示したように、照合順序 ID を選択します。次のステップでは、1024 の ID を使用します。
          </p></li><li class="listitem"><p>
            <code class="literal">Index.xml</code> および <code class="literal">latin1.xml</code> 構成ファイルを変更します。これらのファイルは、<code class="literal">character_sets_dir</code> システム変数によって名前の付けられたディレクトリに置かれます。使用しているシステムではパス名が異なることがありますが、次のようにして変数値を確認できます。
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'character_sets_dir';</code></strong>
+--------------------+-----------------------------------------+
| Variable_name      | Value                                   |
+--------------------+-----------------------------------------+
| character_sets_dir | /user/local/mysql/share/mysql/charsets/ |
+--------------------+-----------------------------------------+
</pre></li><li class="listitem"><p>
            照合順序の名前を選択して、<code class="filename">Index.xml</code> ファイルに表示します。照合順序を追加する文字セットの <code class="literal">&lt;charset&gt;</code> 要素を探し、照合順序名および ID を指定する <code class="literal">&lt;collation&gt;</code> 要素を追加して、名前を ID に関連付けます。例:
          </p><pre class="programlisting">
&lt;charset name="latin1"&gt;
  ...
  &lt;collation name="latin1_test_ci" id="1024"/&gt;
  ...
&lt;/charset&gt;
</pre></li><li class="listitem"><p>
            <code class="filename">latin1.xml</code> 構成ファイルで、照合順序に名前を付ける <code class="literal">&lt;collation&gt;</code> 要素と、0 から 255 の文字コードの文字コードと重みのマッピングテーブルを定義する <code class="literal">&lt;map&gt;</code> 要素を追加します。<code class="literal">&lt;map&gt;</code> 要素内のそれぞれの値は、16 進形式の数値にする必要があります。
          </p><pre class="programlisting">
&lt;collation name="latin1_test_ci"&gt;
&lt;map&gt;
 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F
 10 11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F
 20 21 22 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F
 30 31 32 33 34 35 36 37 38 39 3A 3B 3C 3D 3E 3F
 40 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F
 50 51 52 53 54 55 56 57 58 59 5A 5B 5C 5D 5E 5F
 60 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F
 50 51 52 53 54 55 56 57 58 59 5A 7B 7C 7D 7E 7F
 80 81 82 83 84 85 86 87 88 89 8A 8B 8C 8D 8E 8F
 90 91 92 93 94 95 96 97 98 99 9A 9B 9C 9D 9E 9F
 A0 A1 A2 A3 A4 A5 A6 A7 A8 A9 AA AB AC AD AE AF
 B0 B1 B2 B3 B4 B5 B6 B7 B8 B9 BA BB BC BD BE BF
 41 41 41 41 5B 5D 5B 43 45 45 45 45 49 49 49 49
 44 4E 4F 4F 4F 4F 5C D7 5C 55 55 55 59 59 DE DF
 41 41 41 41 5B 5D 5B 43 45 45 45 45 49 49 49 49
 44 4E 4F 4F 4F 4F 5C F7 5C 55 55 55 59 59 DE FF
&lt;/map&gt;
&lt;/collation&gt;
</pre></li><li class="listitem"><p>
            サーバーを再起動し、このステートメントを使用して、照合順序の有無を検証します。
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW COLLATION LIKE 'latin1_test_ci';</code></strong>
+----------------+---------+------+---------+----------+---------+
| Collation      | Charset | Id   | Default | Compiled | Sortlen |
+----------------+---------+------+---------+----------+---------+
| latin1_test_ci | latin1  | 1024 |         |          |       1 |
+----------------+---------+------+---------+----------+---------+
</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="adding-collation-unicode-uca"></a>10.4.4 Unicode 文字セットへの UCA 照合順序の追加</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="globalization.html#ldml-collation-example">10.4.4.1 LDML 構文を使用した UCA 照合順序の定義</a></span></dt><dt><span class="section"><a href="globalization.html#ldml-rules">10.4.4.2 MySQL でサポートされる LDML 構文</a></span></dt><dt><span class="section"><a href="globalization.html#collation-diagnostics">10.4.4.3 Index.xml の構文解析中の診断</a></span></dt></dl></div><p>
        このセクションでは、MySQL <code class="filename">Index.xml</code> ファイルで <code class="literal">&lt;charset&gt;</code> 文字セットの記述内に <code class="literal">&lt;collation&gt;</code> 要素を書き込むことによって、Unicode 文字セットの UCA 照合順序を追加する方法について説明します。ここで説明した手順では、MySQL の再コンパイルは不要です。これは、<a class="ulink" href="http://www.unicode.org/reports/tr35/" target="_top">http://www.unicode.org/reports/tr35/</a> で入手できる Locale Data Markup Language (LDML) 仕様のサブセットを使用します。この方法を使用すれば、照合順序全体を定義する必要はありません。代わりに、既存の<span class="quote">「<span class="quote">基本</span>」</span>照合順序から始め、基本照合順序とどのように異なるかという点で新しい照合順序について記述します。次の表は、UCA 照合順序を定義できる Unicode 文字セットの基本照合順序を一覧表示しています。<code class="literal">utf16le</code> のユーザー定義 UCA 照合順序は作成できません。このような照合順序のベースとして役立つ <code class="literal">utf16le_unicode_ci</code> 照合順序はありません。
      </p><div class="table"><a name="idm139979105145680"></a><p class="title"><b>表 10.1 ユーザー定義の UCA 照合順序に使用可能な MySQL 文字セット</b></p><div class="table-contents"><table summary="ユーザー定義の UCA 照合順序に使用可能な MySQL 文字セット" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">文字セット</th><th scope="col">基本照合順序</th></tr></thead><tbody><tr><td scope="row"><code class="literal">utf8</code></td><td><code class="literal">utf8_unicode_ci</code></td></tr><tr><td scope="row"><code class="literal">ucs2</code></td><td><code class="literal">ucs2_unicode_ci</code></td></tr><tr><td scope="row"><code class="literal">utf16</code></td><td><code class="literal">utf16_unicode_ci</code></td></tr><tr><td scope="row"><code class="literal">utf32</code></td><td><code class="literal">utf32_unicode_ci</code></td></tr></tbody></table></div></div><br class="table-break"><p>
        以降のセクションでは、LDML 構文を使用して定義された照合順序を追加する方法について説明し、MySQL でサポートされている LDML ルールのサマリーを示します。
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="ldml-collation-example"></a>10.4.4.1 LDML 構文を使用した UCA 照合順序の定義</h4></div></div></div><p>
          MySQL を再コンパイルせずに Unicode 文字セットの UCA 照合順序を追加するには、次の手順を使用します。照合順序のソート特性の記述に使用する LDML ルールを把握していない場合は、<a class="xref" href="globalization.html#ldml-rules" title="10.4.4.2 MySQL でサポートされる LDML 構文">セクション10.4.4.2「MySQL でサポートされる LDML 構文」</a>を参照してください。
        </p><p>
          この例では、<code class="literal">utf8_phone_ci</code> という名前の照合順序を <code class="literal">utf8</code> 文字セットを追加します。この照合順序は、ユーザーが名前と電話番号を投稿する Web アプリケーションに関連したシナリオ用に設計されています。電話番号は、次のようなさまざまな形式で指定できます。
        </p><pre class="programlisting">
+7-12345-67
+7-12-345-67
+7 12 345 67
+7 (12) 345 67
+71234567
</pre><p>
          このような値を扱うときに生じる問題は、さまざまな形式が許容されることで、特定の電話番号の検索が非常に困難になるということです。この解決方法として、句読点文字を並べ替えて無視できるようにする新しい照合順序を定義します。
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              <a class="xref" href="globalization.html#adding-collation-choosing-id" title="10.4.2 照合順序 ID の選択">セクション10.4.2「照合順序 ID の選択」</a>で示したように、照合順序 ID を選択します。次のステップでは、1029 の ID を使用します。
            </p></li><li class="listitem"><p>
              <code class="literal">Index.xml</code> 構成ファイルを変更します。このファイルは、<code class="literal">character_sets_dir</code> システム変数によって名前の付けられたディレクトリに置かれます。使用しているシステムではパス名が異なることがありますが、次のようにして変数値を確認できます。
            </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'character_sets_dir';</code></strong>
+--------------------+-----------------------------------------+
| Variable_name      | Value                                   |
+--------------------+-----------------------------------------+
| character_sets_dir | /user/local/mysql/share/mysql/charsets/ |
+--------------------+-----------------------------------------+
</pre></li><li class="listitem"><p>
              照合順序の名前を選択して、<code class="filename">Index.xml</code> ファイルに表示します。さらに、照合順序の順序付けルールを提供する必要があります。照合順序を追加する文字セットの <code class="literal">&lt;charset&gt;</code> 要素を探し、照合順序名および ID を指定する <code class="literal">&lt;collation&gt;</code> 要素を追加して、名前を ID に関連付けます。<code class="literal">&lt;collation&gt;</code> 要素内で、順序付けルールを含む <code class="literal">&lt;rules&gt;</code> 要素を提供します。
            </p><pre class="programlisting">
&lt;charset name="utf8"&gt;
  ...
  &lt;collation name="utf8_phone_ci" id="1029"&gt;
    &lt;rules&gt;
      &lt;reset&gt;\u0000&lt;/reset&gt;
      &lt;i&gt;\u0020&lt;/i&gt; &lt;!-- space --&gt;
      &lt;i&gt;\u0028&lt;/i&gt; &lt;!-- left parenthesis --&gt;
      &lt;i&gt;\u0029&lt;/i&gt; &lt;!-- right parenthesis --&gt;
      &lt;i&gt;\u002B&lt;/i&gt; &lt;!-- plus --&gt;
      &lt;i&gt;\u002D&lt;/i&gt; &lt;!-- hyphen --&gt;
    &lt;/rules&gt;
  &lt;/collation&gt;
  ...
&lt;/charset&gt;
</pre></li><li class="listitem"><p>
              その他の Unicode 文字セットに同様の照合順序が必要な場合は、ほかの <code class="literal">&lt;collation&gt;</code> 要素を追加します。たとえば、<code class="literal">ucs2_phone_ci</code> を定義するには、<code class="literal">&lt;collation&gt;</code> 要素を <code class="literal">&lt;charset name="ucs2"&gt;</code> 要素に追加します。それぞれの照合順序には一意の独自 ID が必要になります。
            </p></li><li class="listitem"><p>
              サーバーを再起動し、このステートメントを使用して、照合順序の有無を検証します。
            </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW COLLATION LIKE 'utf8_phone_ci';</code></strong>
+---------------+---------+------+---------+----------+---------+
| Collation     | Charset | Id   | Default | Compiled | Sortlen |
+---------------+---------+------+---------+----------+---------+
| utf8_phone_ci | utf8    | 1029 |         |          |       8 |
+---------------+---------+------+---------+----------+---------+
</pre></li></ol></div><p>
          次に、照合順序をテストして、目的のプロパティーがあることを確認します。
        </p><p>
          新しい照合順序を使用して、いくつかのサンプルの電話番号を含むテーブルを作成します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE phonebook (</code></strong>
    -&gt; <strong class="userinput"><code>  name VARCHAR(64),</code></strong>
    -&gt; <strong class="userinput"><code>  phone VARCHAR(64) CHARACTER SET utf8 COLLATE utf8_phone_ci</code></strong>
    -&gt; <strong class="userinput"><code>);</code></strong>
Query OK, 0 rows affected (0.09 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO phonebook VALUES ('Svoj','+7 912 800 80 02');</code></strong>
Query OK, 1 row affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO phonebook VALUES ('Hf','+7 (912) 800 80 04');</code></strong>
Query OK, 1 row affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO phonebook VALUES ('Bar','+7-912-800-80-01');</code></strong>
Query OK, 1 row affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO phonebook VALUES ('Ramil','(7912) 800 80 03');</code></strong>
Query OK, 1 row affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO phonebook VALUES ('Sanja','+380 (912) 8008005');</code></strong>
Query OK, 1 row affected (0.00 sec)
</pre><p>
          いくつかのクエリーを実行して、無視された句読点文字が実際にソートおよび比較で無視されているかどうかを確認します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM phonebook ORDER BY phone;</code></strong>
+-------+--------------------+
| name  | phone              |
+-------+--------------------+
| Sanja | +380 (912) 8008005 |
| Bar   | +7-912-800-80-01   |
| Svoj  | +7 912 800 80 02   |
| Ramil | (7912) 800 80 03   |
| Hf    | +7 (912) 800 80 04 |
+-------+--------------------+
5 rows in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT * FROM phonebook WHERE phone='+7(912)800-80-01';</code></strong>
+------+------------------+
| name | phone            |
+------+------------------+
| Bar  | +7-912-800-80-01 |
+------+------------------+
1 row in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT * FROM phonebook WHERE phone='79128008001';</code></strong>
+------+------------------+
| name | phone            |
+------+------------------+
| Bar  | +7-912-800-80-01 |
+------+------------------+
1 row in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT * FROM phonebook WHERE phone='7 9 1 2 8 0 0 8 0 0 1';</code></strong>
+------+------------------+
| name | phone            |
+------+------------------+
| Bar  | +7-912-800-80-01 |
+------+------------------+
1 row in set (0.00 sec)
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="ldml-rules"></a>10.4.4.2 MySQL でサポートされる LDML 構文</h4></div></div></div><a class="indexterm" name="idm139979105087984"></a><p>
          このセクションでは、MySQL が認識する LDML 構文について説明します。これは、<a class="ulink" href="http://www.unicode.org/reports/tr35/" target="_top">http://www.unicode.org/reports/tr35/</a> で入手できる LDML 仕様で説明されている構文のサブセットであり、詳細についてはこの仕様を参照してください。MySQL は、サイズの大きい構文のサブセットを認識するので、多くの場合、Unicode 共通ロケールデータリポジトリから照合順序定義をダウンロードして、該当する部分 (<code class="literal">&lt;rules&gt;</code> タグと <code class="literal">&lt;/rules&gt;</code> タグの間の部分) を MySQL <code class="filename">Index.xml</code> ファイルに貼り付けることが可能です。ここで説明するルールは、文字のソートがプライマリレベルのみで行われることを除いて、すべてサポートされます。セカンダリ以上のソートレベルでの差を指定するルールは認識されますが (たとえば、照合順序の定義に含めることができます)、プライマリレベルでは等式として扱われます。
        </p><p>
          MySQL Server は、<code class="filename">Index.xml</code> ファイルの構文解析中に問題を検出すると、診断を生成します。<a class="xref" href="globalization.html#collation-diagnostics" title="10.4.4.3 Index.xml の構文解析中の診断">セクション10.4.4.3「Index.xml の構文解析中の診断」</a>を参照してください。
        </p><p>
          <span class="bold"><strong>文字表現</strong></span>
        </p><p>
          LDML ルールで名前が付けられた文字は、文字どおりに、または <code class="literal">\u<em class="replaceable"><code>nnnn</code></em></code> 形式で書き込めます。ただし、<em class="replaceable"><code>nnnn</code></em> は 16 進 Unicode コードポイント値です。たとえば、<code class="literal">A</code> と <code class="literal">á</code> は、文字どおりに、または <code class="literal">\u0041</code> および <code class="literal">\u00E1</code> として書き込めます。16 進値内で、<code class="literal">A</code> から <code class="literal">F</code> の桁は、大文字と小文字を区別しません。<code class="literal">\u00E1</code> と <code class="literal">\u00e1</code> は同等になります。UCA 4.0.0 照合順序の場合、16 進表記は、Basic Multilingual Plane の文字にのみ使用でき、<code class="literal">0000</code> から <code class="literal">FFFF</code> の BMP 範囲外の文字には使用できません。UCA 5.2.0 照合順序の場合、16 進表記をすべての文字に使用できます。
        </p><p>
          <code class="filename">Index.xml</code> ファイル自体は、UTF-8 エンコーディングを使用して書き込む必要があります。
        </p><p>
          <span class="bold"><strong>構文ルール</strong></span>
        </p><p>
          LDML には、文字の順序付けを指定するリセットルールとシフトルールがあります。順序付けは、アンカーポイントを確立するリセットルールから開始し、そのアンカーポイントを基準として文字をソートする方法を示すシフトルールが続く一連のルールとして指定されます。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">&lt;reset&gt;</code> ルールはそれ自体ではどの順序付けも指定しません。その代わりにこれは、所定の文字に関連して後続のシフトルールを実行できるように、順序付けを<span class="quote">「<span class="quote">リセット</span>」</span>します。次のどちらのルールも、文字 <code class="literal">'A'</code> に関連して実行されるように後続のシフトルールをリセットします。
            </p><pre class="programlisting">
&lt;reset&gt;A&lt;/reset&gt;

&lt;reset&gt;\u0041&lt;/reset&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;p&gt;</code>、<code class="literal">&lt;s&gt;</code>、および <code class="literal">&lt;t&gt;</code> のシフトルールは、文字と文字とのプライマリ、セカンダリ、およびターシャリの差を定義します。
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  プライマリの差を使用して、個々の文字を区別します。
                </p></li><li class="listitem"><p>
                  セカンダリの差を使用して、アクセントバリエーションを区別します。
                </p></li><li class="listitem"><p>
                  ターシャリの差を使用して、大文字と小文字のバリエーションを区別します。
                </p></li></ul></div><p>
              次のどちらのルールも、<code class="literal">'G'</code> 文字のプライマリシフトルールを指定します。
            </p><pre class="programlisting">
&lt;p&gt;G&lt;/p&gt;

&lt;p&gt;\u0047&lt;/p&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;i&gt;</code> シフトルールは、ある文字が別の文字とまったく同じようにソートするよう指定します。次のルールは、<code class="literal">'b'</code> が <code class="literal">'a'</code> と同じようにソートします。
            </p><pre class="programlisting">
&lt;reset&gt;a&lt;/reset&gt;
&lt;i&gt;b&lt;/i&gt;
</pre></li><li class="listitem"><p>
              略記されたシフト構文は、タグの単一のペアを使用して、複数のシフトルールを指定します。次の表は、略記された構文ルールと同等の略記されていないルールとの対応を示します。
            </p><div class="table"><a name="idm139979105047072"></a><p class="title"><b>表 10.2 略記されたシフト構文</b></p><div class="table-contents"><table summary="略記されたシフト構文" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">略記された構文</th><th scope="col">略記されていない構文</th></tr></thead><tbody><tr><td scope="row"><code class="literal">&lt;pc&gt;xyz&lt;/pc&gt;</code></td><td><code class="literal">&lt;p&gt;x&lt;/p&gt;&lt;p&gt;y&lt;/p&gt;&lt;p&gt;z&lt;/p&gt;</code></td></tr><tr><td scope="row"><code class="literal">&lt;sc&gt;xyz&lt;/sc&gt;</code></td><td><code class="literal">&lt;s&gt;x&lt;/s&gt;&lt;s&gt;y&lt;/s&gt;&lt;s&gt;z&lt;/s&gt;</code></td></tr><tr><td scope="row"><code class="literal">&lt;tc&gt;xyz&lt;/tc&gt;</code></td><td><code class="literal">&lt;t&gt;x&lt;/t&gt;&lt;t&gt;y&lt;/t&gt;&lt;t&gt;z&lt;/t&gt;</code></td></tr><tr><td scope="row"><code class="literal">&lt;ic&gt;xyz&lt;/ic&gt;</code></td><td><code class="literal">&lt;i&gt;x&lt;/i&gt;&lt;i&gt;y&lt;/i&gt;&lt;i&gt;z&lt;/i&gt;</code></td></tr></tbody></table></div></div><br class="table-break"></li><li class="listitem"><p>
              拡張形式は、複数文字のシーケンスのアンカーポイントを確立するリセットルールです。MySQL は 2 から 6 文字長の拡張形式をサポートしています。次のルールは、プライマリレベルで <code class="literal">'z'</code> を 3 文字のシーケンス <code class="literal">'abc'</code> よりも大きくします。
            </p><pre class="programlisting">
&lt;reset&gt;abc&lt;/reset&gt;
&lt;p&gt;z&lt;/p&gt;
</pre></li><li class="listitem"><p>
              短縮形式は、複数文字のシーケンスをソートするシフトルールです。MySQL は、2 から 6 文字長の短縮形式をサポートしています。次のルールは、プライマリレベルで 3 文字のシーケンス <code class="literal">'xyz'</code> を <code class="literal">'a'</code> よりも大きくします。
            </p><pre class="programlisting">
&lt;reset&gt;a&lt;/reset&gt;
&lt;p&gt;xyz&lt;/p&gt;
</pre></li><li class="listitem"><p>
              長い拡張形式と長い短縮形式を一緒に使用できます。次のルールは、プライマリレベルで 3 文字のシーケンス <code class="literal">'xyz'</code> を 3 文字のシーケンス <code class="literal">'abc'</code> よりも大きくします。
            </p><pre class="programlisting">
&lt;reset&gt;abc&lt;/reset&gt;
&lt;p&gt;xyz&lt;/p&gt;
</pre></li><li class="listitem"><p>
              通常の拡張形式の構文では、<code class="literal">&lt;x&gt;</code> と <code class="literal">&lt;extend&gt;</code> 要素を使用して、拡張形式を指定します。次のルールは、セカンダリレベルで文字 <code class="literal">'k'</code> をシーケンス <code class="literal">'ch'</code> よりも大きくします。つまり、<code class="literal">'k'</code> は、<code class="literal">'c'</code> に <code class="literal">'h'</code> が続いたあとの文字に拡張したかのように動作します。
            </p><pre class="programlisting">
&lt;reset&gt;c&lt;/reset&gt;
&lt;x&gt;&lt;s&gt;k&lt;/s&gt;&lt;extend&gt;h&lt;/extend&gt;&lt;/x&gt;
</pre><p>
              この構文は長いシーケンスを許可します。次のルールは、ターシャリレベルでシーケンス <code class="literal">'ccs'</code> をシーケンス <code class="literal">'cscs'</code> よりも大きくします。
            </p><pre class="programlisting">
&lt;reset&gt;cs&lt;/reset&gt;
&lt;x&gt;&lt;t&gt;ccs&lt;/t&gt;&lt;extend&gt;cs&lt;/extend&gt;&lt;/x&gt;
</pre><p>
              LDML 仕様では、通常の拡張形式構文を<span class="quote">「<span class="quote">慎重を要するもの</span>」</span>と記述しています。詳細についてはその仕様を参照してください。
            </p></li><li class="listitem"><p>
              前コンテキスト構文は、<code class="literal">&lt;x&gt;</code> および <code class="literal">&lt;context&gt;</code> 要素を使用して、文字の前のコンテキストによってソートが変更されるよう指定します。次のルールは、セカンダリレベルで <code class="literal">'-'</code> を <code class="literal">'a'</code> よりも大きくしますが、これは <code class="literal">'-'</code> の前に <code class="literal">'b'</code> があったときだけです。
            </p><pre class="programlisting">
&lt;reset&gt;a&lt;/reset&gt;
&lt;x&gt;&lt;context&gt;b&lt;/context&gt;&lt;s&gt;-&lt;/s&gt;&lt;/x&gt;
</pre></li><li class="listitem"><p>
              前コンテキスト構文には、<code class="literal">&lt;extend&gt;</code> 要素を含めることができます。次のルールは、プライマリレベルで <code class="literal">'def'</code> を <code class="literal">'aghi'</code> よりも大きくしますが、これは <code class="literal">'def'</code> の前に <code class="literal">'abc'</code> があったときだけです。
            </p><pre class="programlisting">
&lt;reset&gt;a&lt;/reset&gt;
&lt;x&gt;&lt;context&gt;abc&lt;/context&gt;&lt;p&gt;def&lt;/p&gt;&lt;extend&gt;ghi&lt;/extend&gt;&lt;/x&gt;
</pre></li><li class="listitem"><p>
              リセットルールでは <code class="literal">before</code> 属性が許可されています。通常、リセットルールのあとのシフトルールは、リセット文字のあとにソートする文字を指定します。<code class="literal">before</code> 属性を伴うリセットルール後のシフトルールは、リセット文字の前にソートする文字を指定します。次のルールは、プライマリレベルで文字 <code class="literal">'b'</code> を <code class="literal">'a'</code> の直前に配置します。
            </p><pre class="programlisting">
&lt;reset before="primary"&gt;a&lt;/reset&gt;
&lt;p&gt;b&lt;/p&gt;
</pre><p>
              許容されている <code class="literal">before</code> 属性値は、名前または同等な数値でソートレベルを指定します。
            </p><pre class="programlisting">
&lt;reset before="primary"&gt;
&lt;reset before="1"&gt;

&lt;reset before="secondary"&gt;
&lt;reset before="2"&gt;

&lt;reset before="tertiary"&gt;
&lt;reset before="3"&gt;
</pre></li><li class="listitem"><p>
              リセットルールでは、リテラル文字ではなく、論理リセット位置に名前を付けることができます。
            </p><pre class="programlisting">
&lt;first_tertiary_ignorable/&gt;
&lt;last_tertiary_ignorable/&gt;
&lt;first_secondary_ignorable/&gt;
&lt;last_secondary_ignorable/&gt;
&lt;first_primary_ignorable/&gt;
&lt;last_primary_ignorable/&gt;
&lt;first_variable/&gt;
&lt;last_variable/&gt;
&lt;first_non_ignorable/&gt;
&lt;last_non_ignorable/&gt;
&lt;first_trailing/&gt;
&lt;last_trailing/&gt;
</pre><p>
              次のルールは、プライマリレベルで <code class="literal">'z'</code> を、Default Unicode Collation Element Table (DUCET) エントリを伴い、CJK ではない無視できない文字よりも大きくします。
            </p><pre class="programlisting">
&lt;reset&gt;&lt;last_non_ignorable/&gt;&lt;/reset&gt;
&lt;p&gt;z&lt;/p&gt;
</pre><p>
              論理位置には、次の表に示すコードポイントが設定されています。
            </p><div class="table"><a name="idm139979104988320"></a><p class="title"><b>表 10.3 論理リセット位置のコードポイント</b></p><div class="table-contents"><table summary="論理リセット位置のコードポイント" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">論理位置</th><th scope="col">Unicode 4.0.0 コードポイント</th><th scope="col">Unicode 5.2.0 コードポイント</th></tr></thead><tbody><tr><td scope="row"><code class="literal">&lt;first_non_ignorable/&gt;</code></td><td>U+02D0</td><td>U+02D0</td></tr><tr><td scope="row"><code class="literal">&lt;last_non_ignorable/&gt;</code></td><td>U+A48C</td><td>U+1342E</td></tr><tr><td scope="row"><code class="literal">&lt;first_primary_ignorable/&gt;</code></td><td>U+0332</td><td>U+0332</td></tr><tr><td scope="row"><code class="literal">&lt;last_primary_ignorable/&gt;</code></td><td>U+20EA</td><td>U+101FD</td></tr><tr><td scope="row"><code class="literal">&lt;first_secondary_ignorable/&gt;</code></td><td>U+0000</td><td>U+0000</td></tr><tr><td scope="row"><code class="literal">&lt;last_secondary_ignorable/&gt;</code></td><td>U+FE73</td><td>U+FE73</td></tr><tr><td scope="row"><code class="literal">&lt;first_tertiary_ignorable/&gt;</code></td><td>U+0000</td><td>U+0000</td></tr><tr><td scope="row"><code class="literal">&lt;last_tertiary_ignorable/&gt;</code></td><td>U+FE73</td><td>U+FE73</td></tr><tr><td scope="row"><code class="literal">&lt;first_trailing/&gt;</code></td><td>U+0000</td><td>U+0000</td></tr><tr><td scope="row"><code class="literal">&lt;last_trailing/&gt;</code></td><td>U+0000</td><td>U+0000</td></tr><tr><td scope="row"><code class="literal">&lt;first_variable/&gt;</code></td><td>U+0009</td><td>U+0009</td></tr><tr><td scope="row"><code class="literal">&lt;last_variable/&gt;</code></td><td>U+2183</td><td>U+1D371</td></tr></tbody></table></div></div><br class="table-break"></li><li class="listitem"><p>
              <code class="literal">&lt;collation&gt;</code> 要素は、シフトルールの文字重み計算に影響する <code class="literal">shift-after-method</code> 属性を許可します。この属性には、次の値が許可されています。
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">simple</code>: <code class="literal">before</code> 属性を持たないリセットルールで、文字の重みを計算します。これは、属性が指定されない場合のデフォルトです。
                </p></li><li class="listitem"><p>
                  <code class="literal">expand</code>: リセットルールのあとのシフトに拡張形式を使用します。
                </p></li></ul></div><p>
              <code class="literal">'0'</code> と <code class="literal">'1'</code> が <code class="literal">0E29</code> と <code class="literal">0E2A</code> の重みを持ち、すべての基本ラテン文字を <code class="literal">'0'</code> から <code class="literal">'1'</code> の間に設定するとします。
            </p><pre class="programlisting">
&lt;reset&gt;0&lt;/reset&gt;
&lt;pc&gt;abcdefghijklmnopqrstuvwxyz&lt;/pc&gt;
</pre><p>
              単純なシフトモードの場合、重みは次のように計算されます。
            </p><pre class="programlisting">
'a' has weight 0E29+1
'b' has weight 0E29+2
'c' has weight 0E29+3
...
</pre><p>
              ただし、<code class="literal">'0'</code> から <code class="literal">'1'</code> の間には 26 個の文字を設定するのに十分な未使用の位置がありません。数字と文字が混在する結果になります。
            </p><p>
              これを解決するには <code class="literal">shift-after-method="expand"</code> を使用します。この場合、重みは次のように計算されます。
            </p><pre class="programlisting">
'a' has weight [0E29][233D+1]
'b' has weight [0E29][233D+2]
'c' has weight [0E29][233D+3]
...
</pre><p>
              <code class="literal">233D</code> は、文字 <code class="literal">0xA48C</code> の UCA 4.0.0 重みです。これは、最後の無視できない文字 (CJK を除き、照合順序で一種のもっとも大きな文字) です。UCA 5.2.0 も同様ですが、文字 <code class="literal">0x1342E</code> に <code class="literal">3ACA</code> を使用します。
            </p></li></ul></div><p>
          <span class="bold"><strong>MySQL 固有の LDML 拡張機能</strong></span>
        </p><p>
          MySQL 5.6 では、LDML ルールの拡張機能によって、<code class="literal">&lt;collation&gt;</code> 要素は、照合順序が基づく UCA バージョンを示す <code class="literal">version</code> オプション属性を、<code class="literal">&lt;collation&gt;</code> タグに含めることができます。<code class="literal">version</code> 属性を省略すると、そのデフォルト値は <code class="literal">4.0.0</code> になります。たとえば、次の指定は、UCA 5.2.0 に基づいている照合順序を示します。
        </p><pre class="programlisting">
&lt;collation id="<em class="replaceable"><code>nnn</code></em>" name="utf8_<em class="replaceable"><code>xxx</code></em>_ci" version="5.2.0"&gt;
...
&lt;/collation&gt;
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="collation-diagnostics"></a>10.4.4.3 Index.xml の構文解析中の診断</h4></div></div></div><p>
          MySQL Server は、<code class="filename">Index.xml</code> ファイルの構文解析中に問題が見つかったときに、診断を生成します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              不明なタグはエラーログに書き込まれます。たとえば、照合順序定義に <code class="literal">&lt;aaa&gt;</code> タグが含まれる場合、次のメッセージが表示されます。
            </p><pre class="programlisting">
[Warning] Buffered warning: Unknown LDML tag:
'charsets/charset/collation/rules/aaa'
</pre></li><li class="listitem"><p>
              照合順序の初期化が可能でない場合、サーバーは<span class="quote">「<span class="quote">不明な照合順序</span>」</span>エラーをレポートし、前の例のように問題点を説明した警告も生成します。それ以外の場合、照合順序の説明が全体的に正しいが、いくつかの不明なタグが含まれているときに、照合順序が初期化され、使用できます。不明な部分は無視されますが、警告がエラーログに生成されます。
            </p></li><li class="listitem"><p>
              照合順序の問題によって、クライアントが <code class="literal">SHOW WARNINGS</code> で表示できる警告が生成されます。6 文字のサポートされる最大長より長い拡張形式が、リセットルールに含まれているとします。
            </p><pre class="programlisting">
&lt;reset&gt;abcdefghi&lt;/reset&gt;
&lt;i&gt;x&lt;/i&gt;
</pre><p>
              この照合順序を使用しようとすると、次の警告が生成されます。
            </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT _utf8'test' COLLATE utf8_test_ci;</code></strong>
ERROR 1273 (HY000): Unknown collation: 'utf8_test_ci'
mysql&gt; <strong class="userinput"><code>SHOW WARNINGS;</code></strong>
+---------+------+----------------------------------------+
| Level   | Code | Message                                |
+---------+------+----------------------------------------+
| Error   | 1273 | Unknown collation: 'utf8_test_ci'      |
| Warning | 1273 | Expansion is too long at 'abcdefghi=x' |
+---------+------+----------------------------------------+
</pre></li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="charset-configuration"></a>10.5 文字セットの構成</h2></div></div></div><p>
      デフォルトのサーバー文字セットおよび照合順序は、サーバー起動時に、<code class="option">--character-set-server</code> オプションと <code class="option">--collation-server</code> オプションで変更できます。照合順序は、デフォルト文字セットの正当な照合順序である必要があります。(各文字列セットに使用できる照合順序を特定するには、<code class="literal">SHOW COLLATION</code> ステートメントを使用します。)<a class="xref" href="server-administration.html#server-options" title="5.1.3 サーバーコマンドオプション">セクション5.1.3「サーバーコマンドオプション」</a>を参照してください。
    </p><p>
      バイナリにコンパイルされない文字セットを使用しようとすると、次の問題が生じることがあります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          文字セットが格納される場所 (通常、MySQL インストールディレクトリ下の <code class="filename">share/mysql/charsets</code> または <code class="filename">share/charsets</code> ディレクトリ) を判断するときに、プログラムが不正なパスを使用します。これは、該当プログラムを実行するときに <code class="option">--character-sets-dir</code> オプションを使用することによって修正できます。たとえば、MySQL クライアントプログラムで使用されるディレクトリを指定するには、オプションファイルの <code class="literal">[client]</code> グループに記述します。ここに挙げる例は、それぞれ Unix または Windows の場合に設定がどのようになるかを示します。
        </p><pre class="programlisting">
[client]
character-sets-dir=/usr/local/mysql/share/mysql/charsets

[client]
character-sets-dir="C:/Program Files/MySQL/MySQL Server 5.6/share/charsets"
</pre></li><li class="listitem"><p>
          文字セットは、動的にロードできない複雑な文字セットです。この場合、文字セットのサポートを使用してプログラムを再コンパイルする必要があります。
        </p><p>
          Unicode 文字セットの場合、LDML 表記を使用することによって、再コンパイルせずに照合順序を定義できます。<a class="xref" href="globalization.html#adding-collation-unicode-uca" title="10.4.4 Unicode 文字セットへの UCA 照合順序の追加">セクション10.4.4「Unicode 文字セットへの UCA 照合順序の追加」</a>を参照してください。
        </p></li><li class="listitem"><p>
          文字セットは動的な文字セットですが、その構成ファイルがありません。この場合、新しい MySQL 配布から文字セットの構成ファイルをインストールする必要があります。
        </p></li><li class="listitem"><p>
          文字セットインデックスファイルに文字セットの名前が含まれていない場合、プログラムはエラーメッセージを表示します。このファイルの名前は <code class="filename">Index.xml</code> で、メッセージは次のとおりです。
        </p><pre class="programlisting">
Character set '<em class="replaceable"><code>charset_name</code></em>' is not a compiled character set and is not
specified in the '/usr/share/mysql/charsets/Index.xml' file
</pre><p>
          この問題を解決するには、新しいインデックスファイルを取得するか、欠落している文字セットの名前を手動で現在のファイルに追加する必要があります。
        </p></li></ul></div><p>
      次のようにしてクライアントプログラムに強制的に特定の文字セットを使用させることができます。
    </p><pre class="programlisting">
[client]
default-character-set=<em class="replaceable"><code>charset_name</code></em>
</pre><p>
      これは通常は不要です。ただし、<code class="literal">character_set_system</code> が <code class="literal">character_set_server</code> または <code class="literal">character_set_client</code> と異なり、(データベースオブジェクト識別子またはカラム値、あるいはその両方として) 手動で文字を入力した場合、これらの文字はクライアントからの出力に間違って表示されたり、出力自体が間違って書式設定されたりすることがあります。このような場合、<code class="option">--default-character-set=<em class="replaceable"><code>system_character_set</code></em></code> を使用して MySQL クライアントを起動し、システム文字セットに一致するようにクライアント文字セットを設定すると、問題が修正されます。
    </p><p>
      <code class="literal">MyISAM</code> テーブルでは、<span class="command"><strong>myisamchk -dvv <em class="replaceable"><code>tbl_name</code></em></strong></span> を使用するとテーブルの文字セットの名前および数値を確認できます。
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="time-zone-support"></a>10.6 MySQL Server でのタイムゾーンのサポート</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="globalization.html#time-zone-upgrades">10.6.1 タイムゾーンの変更による現在の時間の維持</a></span></dt><dt><span class="section"><a href="globalization.html#time-zone-leap-seconds">10.6.2 タイムゾーンのうるう秒のサポート</a></span></dt></dl></div><a class="indexterm" name="idm139979104882992"></a><p>
      MySQL Server は複数のタイムゾーン設定を保持しています。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          システムタイムゾーン。サーバーは、起動するときに、ホストマシンのタイムゾーンを特定し、これを使用して <code class="literal">system_time_zone</code> システム変数で設定しようとします。その後、この値は変更しません。
        </p><p>
          <span class="command"><strong>mysqld_safe</strong></span> で <code class="option">--timezone=<em class="replaceable"><code>timezone_name</code></em></code> オプションを使用すると、起動時に MySQL Server のシステムタイムゾーンを設定できます。<span class="command"><strong>mysqld</strong></span> を起動する前に、<code class="literal">TZ</code> 環境変数を設定することによって設定することもできます。<code class="option">--timezone</code> または <code class="literal">TZ</code> に許可される値は、システムによって異なります。許容可能な値を確認するには、オペレーティングシステムのドキュメントを参照してください。
        </p></li><li class="listitem"><p>
          サーバーの現在のタイムゾーン。<code class="literal">time_zone</code> グローバルシステム変数は、サーバーが現在動作しているタイムゾーンを示します。<code class="literal">time_zone</code> の初期値は <code class="literal">'SYSTEM'</code> であり、これはサーバーのタイムゾーンがシステムタイムゾーンと同じであることを示します。
        </p><p>
          コマンド行で <code class="option">--default-time-zone=<em class="replaceable"><code>timezone</code></em></code> オプションを使用すると、初期グローバルサーバータイムゾーン値を起動時に明示的に指定できます。または、オプションファイルで次の行を使用できます。
        </p><pre class="programlisting">
default-time-zone='<em class="replaceable"><code>timezone</code></em>'
</pre><p>
          <code class="literal">SUPER</code> 権限がある場合は、実行時に次のステートメントを使用すると、サーバータイムゾーンのグローバル値を設定できます。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL time_zone = <em class="replaceable"><code>timezone</code></em>;</code></strong>
</pre></li><li class="listitem"><p>
          接続ごとのタイムゾーン。接続するそれぞれのクライアントには、<code class="literal">time_zone</code> セッション変数で指定された、それぞれのタイムゾーン設定があります。最初、セッション変数は、<code class="literal">time_zone</code> グローバル変数から値を取得しますが、クライアントは次のステートメントを使用して、それぞれのタイムゾーンを変更できます。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET time_zone = <em class="replaceable"><code>timezone</code></em>;</code></strong>
</pre></li></ul></div><p>
      現在のセッションのタイムゾーン設定は、ゾーンを区別する時間値の表示とストレージに影響します。これには、<code class="literal">NOW()</code> や <code class="literal">CURTIME()</code> などの関数で表示される値や、<code class="literal">TIMESTAMP</code> カラムに保存し、そこから読み出す値も含まれます。<code class="literal">TIMESTAMP</code> カラムの値は、ストレージでは現在のタイムゾーンから UTC に、読み出しでは UTC から現在のタイムゾーンに変換されます。
    </p><p>
      現在のタイムゾーン設定は、<code class="literal">UTC_TIMESTAMP()</code> 関数などによって表示される値、または <code class="literal">DATE</code>、<code class="literal">TIME</code>、<code class="literal">DATETIME</code> カラムの値には影響しません。また、これらのデータ型の値も UTC で格納されません。タイムゾーンは、<code class="literal">TIMESTAMP</code> 値から変換するときにのみ適用されます。<code class="literal">DATE</code>、<code class="literal">TIME</code>、または <code class="literal">DATETIME</code> 値に対してロケール固有の演算を実行する場合、これらの値を UTC に変換し、演算を実行してから、元に変換し直します。
    </p><p>
      グローバルおよびクライアント固有のタイムゾーンの現在値は、次のように取得できます。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @@global.time_zone, @@session.time_zone;</code></strong>
</pre><p>
      <em class="replaceable"><code>timezone</code></em> 値は、次の複数の形式で指定でき、大文字と小文字を区別しません。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">'SYSTEM'</code> 値は、タイムゾーンをシステムタイムゾーンと同じにする必要があることを示します。
        </p></li><li class="listitem"><p>
          この値は、<code class="literal">'+10:00'</code> や <code class="literal">'-6:00'</code> など、UTC からのオフセットを示す文字列として指定できます。
        </p></li><li class="listitem"><p>
          この値は、<code class="literal">'Europe/Helsinki'</code>、<code class="literal">'US/Eastern'</code>、<code class="literal">'MET'</code> などの名前付きのタイムゾーンとして指定できます。名前付きのタイムゾーンは、<code class="literal">mysql</code> データベース内のタイムゾーン情報テーブルが作成され移入されている場合にのみ使用できます。
        </p></li></ul></div><p>
      MySQL のインストール手順では、<code class="literal">mysql</code> データベース内にタイムゾーンテーブルを作成しますが、これらをロードしません。次の手順を使用して、手動でこれを行う必要があります。(以前のバージョンから MySQL 4.1.3 以降にアップグレードする場合は、<code class="literal">mysql</code> データベースをアップグレードすることでテーブルを作成できます。<a class="xref" href="programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — MySQL テーブルのチェックとアップグレード">セクション4.4.7「<span class="command"><strong>mysql_upgrade</strong></span> — MySQL テーブルのチェックとアップグレード」</a>の手順を使用してください。テーブルを作成したあとでロードできます。)
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        情報は変更することがあるので、タイムゾーン情報のロードは必ずしも 1 回だけの操作とはかぎりません。たとえば、米国、メキシコ、一部のカナダのサマータイムのルールは、2007 年に変更されました。このような変更が起きた場合、古いルールを使用したアプリケーションは旧式になり、MySQL Server で使用されている情報を最新の状態に維持するために、タイムゾーンテーブルをリロードする必要が生じることがあります。このセクションの最後のノートを参照してください。
      </p></div><p>
      システムに独自の <em class="firstterm">zoneinfo</em> データベース (タイムゾーンについて述べたファイルセット) がある場合、タイムゾーンテーブルに入力するために <span class="command"><strong>mysql_tzinfo_to_sql</strong></span> プログラムを使用する必要があります。このようなシステムには、Linux、FreeBSD、Solaris、OS X などがあります。これらのファイルの 1 つの適切な場所は <code class="filename">/usr/share/zoneinfo</code> ディレクトリです。システムに zoneinfo データベースがない場合、このセクションで後述するダウンロード可能なパッケージを使用できます。
    </p><p>
      <span class="command"><strong>mysql_tzinfo_to_sql</strong></span> プログラムはタイムゾーンテーブルのロードに使用されます。コマンド行で、zoneinfo ディレクトリのパス名を <span class="command"><strong>mysql_tzinfo_to_sql</strong></span> に渡し、出力を <span class="command"><strong>mysql</strong></span> プログラムに送信します。例:
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root mysql</code></strong>
</pre><p>
      <span class="command"><strong>mysql_tzinfo_to_sql</strong></span> は、システムのタイムゾーンファイルを読み取り、そのファイルから SQL ステートメントを生成します。<span class="command"><strong>mysql</strong></span> はこれらのステートメントを処理して、タイムゾーンテーブルをロードします。
    </p><p>
      <span class="command"><strong>mysql_tzinfo_to_sql</strong></span> を使用すると、単一のタイムゾーンファイルをロードしたり、うるう秒情報を生成したりできます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          タイムゾーン名 <em class="replaceable"><code>tz_name</code></em> に対応した単一のタイムゾーンファイル <em class="replaceable"><code>tz_file</code></em> をロードするには、次のように <span class="command"><strong>mysql_tzinfo_to_sql</strong></span> を呼び出します。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql_tzinfo_to_sql <em class="replaceable"><code>tz_file</code></em> <em class="replaceable"><code>tz_name</code></em> | mysql -u root mysql</code></strong>
</pre><p>
          このアプローチでは、サーバーが認識する名前付きゾーンごとに、個別のコマンドを実行してタイムゾーンファイルをロードする必要があります。
        </p></li><li class="listitem"><p>
          タイムゾーンがうるう秒に対応する必要がある場合は、次のようにうるう秒の情報を初期化します。ここで <em class="replaceable"><code>tz_file</code></em> はタイムゾーンファイルの名前です。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql_tzinfo_to_sql --leap <em class="replaceable"><code>tz_file</code></em> | mysql -u root mysql</code></strong>
</pre></li><li class="listitem"><p>
          <span class="command"><strong>mysql_tzinfo_to_sql</strong></span> の実行後、以前にキャッシュしたすべてのタイムゾーンデータを使用し続けないように、サーバーを再起動することをお勧めします。
        </p></li></ul></div><p>
      zoneinfo データベース (Windows など) を含まないシステムの場合、MySQL Developer Zone でダウンロードに使用できる事前に構築されたタイムゾーンテーブルのパッケージを使用できます。
    </p><pre class="programlisting">
<a class="ulink" href="http://dev.mysql.com/downloads/timezones.html" target="_top">http://dev.mysql.com/downloads/timezones.html</a>
</pre><p>
      このタイムゾーンパッケージには、<code class="literal">MyISAM</code> のタイムゾーンテーブル用に、<code class="filename">.frm</code>、<code class="filename">.MYD</code>、<code class="filename">.MYI</code> などのファイルが含まれています。これらのテーブルを <code class="literal">mysql</code> データベースの一部にする必要があるため、ファイルを MySQL Server のデータディレクトリの <code class="filename">mysql</code> サブディレクトリに入れてください。サーバーを停止してからこれを行い、そのあとで再起動します。
    </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
        システムに zoneinfo データベースがある場合は、ダウンロード可能なパッケージを使用しないでください。代わりに、<span class="command"><strong>mysql_tzinfo_to_sql</strong></span> ユーティリティーを使用してください。そうしないと、MySQL とシステム上のほかのアプリケーション間で日時処理に違いが生じることがあります。
      </p></div><p>
      レプリケーションセットアップのタイムゾーン設定の詳細は、<a class="xref" href="replication.html#replication-features" title="17.4.1 レプリケーションの機能と問題">セクション17.4.1「レプリケーションの機能と問題」</a>を参照してください。
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="time-zone-upgrades"></a>10.6.1 タイムゾーンの変更による現在の時間の維持</h3></div></div></div><a class="indexterm" name="idm139979104789152"></a><p>
        前述のように、タイムゾーンルールが変更すると、古いルールを使用するアプリケーションが旧式になります。現在の時間に維持するには、システムが現在のタイムゾーン情報を使用していることを確認する必要があります。MySQL の場合、現在の時間に維持するために考慮する 2 つの要素があります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            オペレーティングシステムの時間は、そのタイムゾーンが <code class="literal">SYSTEM</code> に設定されている場合、MySQL Server が時間に使用する値に影響します。オペレーティングシステムが最新のタイムゾーン情報を使用していることを確認します。ほとんどのオペレーティングシステムでは、最新の更新またはサービスパックによってシステムは時間の変更に対応できます。時間の変更に対処した更新については、オペレーティングシステムベンダーの Web サイトを確認してください。
          </p></li><li class="listitem"><p>
            システムの <code class="filename">/etc/localtime</code> タイムゾーンファイルを、<span class="command"><strong>mysqld</strong></span> の起動時に有効なものとは異なるルールを使用するバージョンに置き換えた場合、更新したルールを使用するように <span class="command"><strong>mysqld</strong></span> を再起動する必要があります。そうしないと、システムが時間を変更したときに <span class="command"><strong>mysqld</strong></span> が認識されないことがあります。
          </p></li><li class="listitem"><p>
            MySQL で名前付きのタイムゾーンを使用する場合、<code class="literal">mysql</code> データベース内のタイムゾーンテーブルが最新になっていることを確認します。システムに独自の zoneinfo データベースがある場合は、zoneinfo データベースを更新するたびに、このセクションで前述した手順を使用して MySQL タイムゾーンテーブルをリロードする必要があります。システムに独自の zoneinfo データベースがない場合、MySQL Developer Zone で更新がないか調べます。新しい更新が利用できる場合は、これをダウンロードし使用して、現在のタイムゾーンテーブルを置き換えます。<span class="command"><strong>mysqld</strong></span> は、検索したタイムゾーン情報をキャッシュするので、タイムゾーンテーブルを置き換えたあとは、<span class="command"><strong>mysqld</strong></span> を再起動して、古くなったタイムゾーンデータを提供し続けないようにする必要があります。
          </p></li></ul></div><p>
        サーバーのタイムゾーン設定として使用するか、独自のタイムゾーンを設定するクライアントが使用するために、名前付きタイムゾーンが使用できるかどうか不確かな場合は、タイムゾーンテーブルが空かどうかを調べてください。次のクエリーは、タイムゾーン名を含むテーブルに行があるかどうかを判断します。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT COUNT(*) FROM mysql.time_zone_name;</code></strong>
+----------+
| COUNT(*) |
+----------+
|        0 |
+----------+
</pre><p>
        カウントがゼロの場合、テーブルが空であることを示します。この場合、名前付きタイムゾーンを使用できず、テーブルを更新する必要はありません。カウントがゼロより大きい場合、テーブルは空ではなく、その内容が名前付きタイムゾーンのサポートに使用できることを示します。この場合、名前付きタイムゾーンを使用するユーザーが、正しいクエリー結果が得られるように、必ずタイムゾーンテーブルをリロードしてください。
      </p><p>
        サマータイムのルール変更に対して MySQL インストールが正しく更新されているかどうかを確認するには、次のようなテストを使用します。この例では、3 月 11 日午前 2 時に米国で行われる 2007 年 DST の 1 時間の変更に適切な値を使用しています。
      </p><p>
        テストでは次の 2 つのクエリーを使用します。
      </p><pre class="programlisting">
SELECT CONVERT_TZ('2007-03-11 2:00:00','US/Eastern','US/Central');
SELECT CONVERT_TZ('2007-03-11 3:00:00','US/Eastern','US/Central');
</pre><p>
        2 つの時間値は、DST 変更が行われる時間を示し、名前付きタイムゾーンの使用には、タイムゾーンテーブルを使用する必要がにあります。結果では、両方のクエリーで同じ結果が返されることが期待されます (「米国/中央」タイムゾーンの同等の値に変換された入力時間)。
      </p><p>
        タイムゾーンテーブルを更新する前に、次のような正しくない結果が表示されます。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT CONVERT_TZ('2007-03-11 2:00:00','US/Eastern','US/Central');</code></strong>
+------------------------------------------------------------+
| CONVERT_TZ('2007-03-11 2:00:00','US/Eastern','US/Central') |
+------------------------------------------------------------+
| 2007-03-11 01:00:00                                        |
+------------------------------------------------------------+

mysql&gt; <strong class="userinput"><code>SELECT CONVERT_TZ('2007-03-11 3:00:00','US/Eastern','US/Central');</code></strong>
+------------------------------------------------------------+
| CONVERT_TZ('2007-03-11 3:00:00','US/Eastern','US/Central') |
+------------------------------------------------------------+
| 2007-03-11 02:00:00                                        |
+------------------------------------------------------------+
</pre><p>
        テーブルの更新後に、正しい結果が表示されます。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT CONVERT_TZ('2007-03-11 2:00:00','US/Eastern','US/Central');</code></strong>
+------------------------------------------------------------+
| CONVERT_TZ('2007-03-11 2:00:00','US/Eastern','US/Central') |
+------------------------------------------------------------+
| 2007-03-11 01:00:00                                        |
+------------------------------------------------------------+

mysql&gt; <strong class="userinput"><code>SELECT CONVERT_TZ('2007-03-11 3:00:00','US/Eastern','US/Central');</code></strong>
+------------------------------------------------------------+
| CONVERT_TZ('2007-03-11 3:00:00','US/Eastern','US/Central') |
+------------------------------------------------------------+
| 2007-03-11 01:00:00                                        |
+------------------------------------------------------------+
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="time-zone-leap-seconds"></a>10.6.2 タイムゾーンのうるう秒のサポート</h3></div></div></div><a class="indexterm" name="idm139979104758384"></a><p>
        うるう秒値は、<code class="literal">:59:59</code> で終わる時間部分を使用して返されます。これは、<code class="literal">NOW()</code> などの関数が、うるう秒の間、2、3 秒連続して同じ値を返すことがあることを意味します。<code class="literal">:59:60</code> または <code class="literal">:59:61</code> で終わる時間部分を持つリテラル時間値が無効と見なされることに変わりはありません。
      </p><p>
        うるう秒の 1 秒前の <code class="literal">TIMESTAMP</code> 値を検索する必要がある場合、<code class="literal">'YYYY-MM-DD hh:mm:ss'</code> 値での比較を使用すると異常な結果が得られることがあります。この点について次の例で説明します。ローカルタイムゾーンを UTC に変更するので、内部値 (UTC での値) と表示値 (タイムゾーン修正が適用された値) の差がなくなります。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (</code></strong>
    -&gt; <strong class="userinput"><code>  a INT,</code></strong>
    -&gt; <strong class="userinput"><code>  ts TIMESTAMP DEFAULT NOW(),</code></strong>
    -&gt; <strong class="userinput"><code>  PRIMARY KEY (ts)</code></strong>
    -&gt; <strong class="userinput"><code>);</code></strong>
Query OK, 0 rows affected (0.01 sec)

mysql&gt; <strong class="userinput"><code>-- change to UTC</code></strong>
mysql&gt; <strong class="userinput"><code>SET time_zone = '+00:00';</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>-- Simulate NOW() = '2008-12-31 23:59:59'</code></strong>
mysql&gt; <strong class="userinput"><code>SET timestamp = 1230767999;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO t1 (a) VALUES (1);</code></strong>
Query OK, 1 row affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>-- Simulate NOW() = '2008-12-31 23:59:60'</code></strong>
mysql&gt; <strong class="userinput"><code>SET timestamp = 1230768000;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO t1 (a) VALUES (2);</code></strong>
Query OK, 1 row affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>-- values differ internally but display the same</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT a, ts, UNIX_TIMESTAMP(ts) FROM t1;</code></strong>
+------+---------------------+--------------------+
| a    | ts                  | UNIX_TIMESTAMP(ts) |
+------+---------------------+--------------------+
|    1 | 2008-12-31 23:59:59 |         1230767999 |
|    2 | 2008-12-31 23:59:59 |         1230768000 |
+------+---------------------+--------------------+
2 rows in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>-- only the non-leap value matches</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT * FROM t1 WHERE ts = '2008-12-31 23:59:59';</code></strong>
+------+---------------------+
| a    | ts                  |
+------+---------------------+
|    1 | 2008-12-31 23:59:59 |
+------+---------------------+
1 row in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>-- the leap value with seconds=60 is invalid</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT * FROM t1 WHERE ts = '2008-12-31 23:59:60';</code></strong>
Empty set, 2 warnings (0.00 sec)
</pre><p>
        これを回避するには、うるう秒の修正が適用されている、実際にカラムに格納されている UTC 値に基づいた比較を使用します。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>-- selecting using UNIX_TIMESTAMP value return leap value</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT * FROM t1 WHERE UNIX_TIMESTAMP(ts) = 1230768000;</code></strong>
+------+---------------------+
| a    | ts                  |
+------+---------------------+
|    2 | 2008-12-31 23:59:59 |
+------+---------------------+
1 row in set (0.00 sec)
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="locale-support"></a>10.7 MySQL Server のロケールサポート</h2></div></div></div><p>
      <code class="literal">lc_time_names</code> システム変数で示されたロケールは、曜日および月の名前と短縮形を表示するために使用する言語を制御します。この変数は <code class="literal">DATE_FORMAT()</code>、<code class="literal">DAYNAME()</code>、および <code class="literal">MONTHNAME()</code> 関数の出力に影響を与えます。
    </p><p>
      <code class="literal">lc_time_names</code> は、<code class="literal">STR_TO_DATE()</code> または <code class="literal">GET_FORMAT()</code> 関数には影響しません。
    </p><p>
      <code class="literal">lc_time_names</code> 値は、<code class="literal">FORMAT()</code> の結果に影響しませんが、この関数は、結果の数値の小数点、桁区切り、および区切り文字のグルーピングに使用するロケールを指定できるようにするオプションの 3 番目のパラメータを取ります。許可されるロケール値は、<code class="literal">lc_time_names</code> システム変数の正当な値と同じです。
    </p><p>
      ロケール名には、<code class="literal">'ja_JP'</code> や <code class="literal">'pt_BR'</code> など、IANA (<a class="ulink" href="http://www.iana.org/assignments/language-subtag-registry" target="_top">http://www.iana.org/assignments/language-subtag-registry</a>) に記載された言語および地域のサブタグが含まれます。システムのロケール設定とは無関係にデフォルト値は <code class="literal">'en_US'</code> ですが、サーバーの起動時に値を設定することも、<code class="literal">SUPER</code> 権限がある場合には <code class="literal">GLOBAL</code> 値を設定することもできます。どのクライアントでも、<code class="literal">lc_time_names</code> の値を調べたり、その <code class="literal">SESSION</code> 値を設定してそれ自体の接続用のロケールに影響を与えたりできます。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET NAMES 'utf8';</code></strong>
Query OK, 0 rows affected (0.09 sec)

mysql&gt; <strong class="userinput"><code>SELECT @@lc_time_names;</code></strong>
+-----------------+
| @@lc_time_names |
+-----------------+
| en_US           |
+-----------------+
1 row in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT DAYNAME('2010-01-01'), MONTHNAME('2010-01-01');</code></strong>
+-----------------------+-------------------------+
| DAYNAME('2010-01-01') | MONTHNAME('2010-01-01') |
+-----------------------+-------------------------+
| Friday                | January                 |
+-----------------------+-------------------------+
1 row in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT DATE_FORMAT('2010-01-01','%W %a %M %b');</code></strong>
+-----------------------------------------+
| DATE_FORMAT('2010-01-01','%W %a %M %b') |
+-----------------------------------------+
| Friday Fri January Jan                  |
+-----------------------------------------+
1 row in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>SET lc_time_names = 'es_MX';</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT @@lc_time_names;</code></strong>
+-----------------+
| @@lc_time_names |
+-----------------+
| es_MX           |
+-----------------+
1 row in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT DAYNAME('2010-01-01'), MONTHNAME('2010-01-01');</code></strong>
+-----------------------+-------------------------+
| DAYNAME('2010-01-01') | MONTHNAME('2010-01-01') |
+-----------------------+-------------------------+
| viernes               | enero                   |
+-----------------------+-------------------------+
1 row in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT DATE_FORMAT('2010-01-01','%W %a %M %b');</code></strong>
+-----------------------------------------+
| DATE_FORMAT('2010-01-01','%W %a %M %b') |
+-----------------------------------------+
| viernes vie enero ene                   |
+-----------------------------------------+
1 row in set (0.00 sec)
</pre><p>
      影響を受けた関数それぞれの曜日または月の名前は、<code class="literal">utf8</code> から <code class="literal">character_set_connection</code> システム変数で指定される文字セットに変換されます。
    </p><p>
      <code class="literal">lc_time_names</code> は次のどのロケール値にも設定できます。MySQL でサポートされるロケールのセットは、オペレーティングシステムでサポートされるものと異なる場合があります。
    </p><div class="informaltable"><table summary="次の表に、lc_time_names を設定できるロケール値を一覧表示します。ロケール値は 2 カラムテーブルに、左から右にアルファベット順で示されます。" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row"><code class="literal">ar_AE</code>: アラビア語 - アラブ首長国連邦</td><td><code class="literal">ar_BH</code>: アラビア語 - バーレーン</td></tr><tr><td scope="row"><code class="literal">ar_DZ</code>: アラビア語 - アルジェリア</td><td><code class="literal">ar_EG</code>: アラビア語 - エジプト</td></tr><tr><td scope="row"><code class="literal">ar_IN</code>: アラビア語 - インド</td><td><code class="literal">ar_IQ</code>: アラビア語 - イラク</td></tr><tr><td scope="row"><code class="literal">ar_JO</code>: アラビア語 - ヨルダン</td><td><code class="literal">ar_KW</code>: アラビア語 - クウェート</td></tr><tr><td scope="row"><code class="literal">ar_LB</code>: アラビア語 - レバノン</td><td><code class="literal">ar_LY</code>: アラビア語 - リビア</td></tr><tr><td scope="row"><code class="literal">ar_MA</code>: アラビア語 - モロッコ</td><td><code class="literal">ar_OM</code>: アラビア語 - オマーン</td></tr><tr><td scope="row"><code class="literal">ar_QA</code>: アラビア語 - カタール</td><td><code class="literal">ar_SA</code>: アラビア語 - サウジアラビア</td></tr><tr><td scope="row"><code class="literal">ar_SD</code>: アラビア語 - スーダン</td><td><code class="literal">ar_SY</code>: アラビア語 - シリア</td></tr><tr><td scope="row"><code class="literal">ar_TN</code>: アラビア語 - チュニジア</td><td><code class="literal">ar_YE</code>: アラビア語 - イエメン</td></tr><tr><td scope="row"><code class="literal">be_BY</code>: ベラルーシ語 - ベラルーシ</td><td><code class="literal">bg_BG</code>: ブルガリア語 - ブルガリア</td></tr><tr><td scope="row"><code class="literal">ca_ES</code>: カタロニア語 - スペイン</td><td><code class="literal">cs_CZ</code>: チェコ語 - チェコ</td></tr><tr><td scope="row"><code class="literal">da_DK</code>: デンマーク語 - デンマーク</td><td><code class="literal">de_AT</code>: ドイツ語 - オーストリア</td></tr><tr><td scope="row"><code class="literal">de_BE</code>: ドイツ語 - ベルギー</td><td><code class="literal">de_CH</code>: ドイツ語 - スイス</td></tr><tr><td scope="row"><code class="literal">de_DE</code>: ドイツ語 - ドイツ</td><td><code class="literal">de_LU</code>: ドイツ語 - ルクセンブルク</td></tr><tr><td scope="row"><code class="literal">el_GR</code>: ギリシャ語 - ギリシャ</td><td><code class="literal">en_AU</code>: 英語 - オーストラリア</td></tr><tr><td scope="row"><code class="literal">en_CA</code>: 英語 - カナダ</td><td><code class="literal">en_GB</code>: 英語 - イギリス</td></tr><tr><td scope="row"><code class="literal">en_IN</code>: 英語 - インド</td><td><code class="literal">en_NZ</code>: 英語 - ニュージーランド</td></tr><tr><td scope="row"><code class="literal">en_PH</code>: 英語 - フィリピン</td><td><code class="literal">en_US</code>: 英語 - 米国</td></tr><tr><td scope="row"><code class="literal">en_ZA</code>: 英語 - 南アフリカ</td><td><code class="literal">en_ZW</code>: 英語 - ジンバブエ</td></tr><tr><td scope="row"><code class="literal">es_AR</code>: スペイン語 - アルゼンチン</td><td><code class="literal">es_BO</code>: スペイン語 - ボリビア</td></tr><tr><td scope="row"><code class="literal">es_CL</code>: スペイン語 - チリ</td><td><code class="literal">es_CO</code>: スペイン語 - コロンビア</td></tr><tr><td scope="row"><code class="literal">es_CR</code>: スペイン語 - コスタリカ</td><td><code class="literal">es_DO</code>: スペイン語 - ドミニカ共和国</td></tr><tr><td scope="row"><code class="literal">es_EC</code>: スペイン語 - エクアドル</td><td><code class="literal">es_ES</code>: スペイン語 - スペイン</td></tr><tr><td scope="row"><code class="literal">es_GT</code>: スペイン語 - グアテマラ</td><td><code class="literal">es_HN</code>: スペイン語 - ホンジュラス</td></tr><tr><td scope="row"><code class="literal">es_MX</code>: スペイン語 - メキシコ</td><td><code class="literal">es_NI</code>: スペイン語 - ニカラグア</td></tr><tr><td scope="row"><code class="literal">es_PA</code>: スペイン語 - パナマ</td><td><code class="literal">es_PE</code>: スペイン語 - ペルー</td></tr><tr><td scope="row"><code class="literal">es_PR</code>: スペイン語 - プエルトリコ</td><td><code class="literal">es_PY</code>: スペイン語 - パラグアイ</td></tr><tr><td scope="row"><code class="literal">es_SV</code>: スペイン語 - エルサルバドル</td><td><code class="literal">es_US</code>: スペイン語 - 米国</td></tr><tr><td scope="row"><code class="literal">es_UY</code>: スペイン語 - ウルグアイ</td><td><code class="literal">es_VE</code>: スペイン語 - ベネズエラ</td></tr><tr><td scope="row"><code class="literal">et_EE</code>: エストニア語 - エストニア</td><td><code class="literal">eu_ES</code>: バスク語 - バスク</td></tr><tr><td scope="row"><code class="literal">fi_FI</code>: フィンランド語 - フィンランド</td><td><code class="literal">fo_FO</code>: フェーロー語 - フェロー諸島</td></tr><tr><td scope="row"><code class="literal">fr_BE</code>: フランス語 - ベルギー</td><td><code class="literal">fr_CA</code>: フランス語 - カナダ</td></tr><tr><td scope="row"><code class="literal">fr_CH</code>: フランス語 - スイス</td><td><code class="literal">fr_FR</code>: フランス語 - フランス</td></tr><tr><td scope="row"><code class="literal">fr_LU</code>: フランス語 - ルクセンブルク</td><td><code class="literal">gl_ES</code>: ガリシア語 - スペイン</td></tr><tr><td scope="row"><code class="literal">gu_IN</code>: グジャラート語 - インド</td><td><code class="literal">he_IL</code>: ヘブライ語 - イスラエル</td></tr><tr><td scope="row"><code class="literal">hi_IN</code>: ヒンディー語 - インド</td><td><code class="literal">hr_HR</code>: クロアチア語 - クロアチア</td></tr><tr><td scope="row"><code class="literal">hu_HU</code>: ハンガリー語 - ハンガリー</td><td><code class="literal">id_ID</code>: インドネシア語 - インドネシア</td></tr><tr><td scope="row"><code class="literal">is_IS</code>: アイスランド語 - アイスランド</td><td><code class="literal">it_CH</code>: イタリア語 - スイス</td></tr><tr><td scope="row"><code class="literal">it_IT</code>: イタリア語 - イタリア</td><td><code class="literal">ja_JP</code>: 日本語 - 日本</td></tr><tr><td scope="row"><code class="literal">ko_KR</code>: 韓国語 - 韓国</td><td><code class="literal">lt_LT</code>: リトアニア語 - リトアニア</td></tr><tr><td scope="row"><code class="literal">lv_LV</code>: ラトビア語 - ラトビア</td><td><code class="literal">mk_MK</code>: マケドニア語 - マケドニア</td></tr><tr><td scope="row"><code class="literal">mn_MN</code>: モンゴル語 - モンゴル</td><td><code class="literal">ms_MY</code>: マレー語 - マレーシア</td></tr><tr><td scope="row"><code class="literal">nb_NO</code>: ノルウェー語 (ブークモール) - ノルウェー</td><td><code class="literal">nl_BE</code>: オランダ語 - ベルギー</td></tr><tr><td scope="row"><code class="literal">nl_NL</code>: オランダ語 - オランダ</td><td><code class="literal">no_NO</code>: ノルウェー語 - ノルウェー</td></tr><tr><td scope="row"><code class="literal">pl_PL</code>: ポーランド語 - ポーランド</td><td><code class="literal">pt_BR</code>: ポルトガル語 - ブラジル</td></tr><tr><td scope="row"><code class="literal">pt_PT</code>: ポルトガル語 - ポルトガル</td><td><code class="literal">rm_CH</code>: ロマンシュ語 - スイス</td></tr><tr><td scope="row"><code class="literal">ro_RO</code>: ルーマニア語 - ルーマニア</td><td><code class="literal">ru_RU</code>: ロシア語 - ロシア</td></tr><tr><td scope="row"><code class="literal">ru_UA</code>: ロシア語 - ウクライナ</td><td><code class="literal">sk_SK</code>: スロバキア語 - スロバキア</td></tr><tr><td scope="row"><code class="literal">sl_SI</code>: スロベニア語 - スロベニア</td><td><code class="literal">sq_AL</code>: アルバニア語 - アルバニア</td></tr><tr><td scope="row"><code class="literal">sr_RS</code>: セルビア語 - ユーゴスラビア</td><td><code class="literal">sv_FI</code>: スウェーデン語 - フィンランド</td></tr><tr><td scope="row"><code class="literal">sv_SE</code>: スウェーデン語 - スウェーデン</td><td><code class="literal">ta_IN</code>: タミル語 - インド</td></tr><tr><td scope="row"><code class="literal">te_IN</code>: テルグ語 - インド</td><td><code class="literal">th_TH</code>: タイ語 - タイ</td></tr><tr><td scope="row"><code class="literal">tr_TR</code>: トルコ語 - トルコ</td><td><code class="literal">uk_UA</code>: ウクライナ語 - ウクライナ</td></tr><tr><td scope="row"><code class="literal">ur_PK</code>: ウルドゥー語 - パキスタン</td><td><code class="literal">vi_VN</code>: ベトナム語 - ベトナム</td></tr><tr><td scope="row"><code class="literal">zh_CN</code>: 中国語 - 中国</td><td><code class="literal">zh_HK</code>: 中国語 - 香港</td></tr><tr><td scope="row"><code class="literal">zh_TW</code>: 中国語 - 台湾</td><td> </td></tr></tbody></table></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="language-structure.html">前</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="data-types.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">第 9 章 言語構造 </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> 第 11 章 データ型</td></tr></table></div><div class="copyright-footer"></div></body></html>
