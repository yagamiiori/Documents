<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>第 6 章 セキュリティー</title><link rel="stylesheet" type="text/css" href="mvl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="MySQL 5.6 リファレンスマニュアル"><link rel="up" href="index.html" title="MySQL 5.6 リファレンスマニュアル"><link rel="prev" href="server-administration.html" title="第 5 章 MySQL サーバーの管理"><link rel="next" href="backup-and-recovery.html" title="第 7 章 バックアップとリカバリ">
<script language="javascript" type="text/javascript">
  function addOnload(theFunc)
  {
    var previous = window.onload;
    if (typeof window.onload != 'function')
    {
      window.onload = theFunc;
    }
    else
    {
      window.onload = function()
      {
        previous();
        theFunc();
      }
    }
  }

  addOnload(function()
  {
    var base = new Date(1442918127*1000);
    var now = new Date();
    var diff = ((now-base)/1000)/(24*3600);

    if (diff > 90) {
      var nodes = document.getElementsByClassName('titlepage');
      nodes[0].innerHTML = '<p style="border: 5px #ff0000 solid; padding: 5px; margin 5px">' +
        'This copy of the manual is more than 90 days old. We encourage you to download a ' +
        'new version from <a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
    }
  });
</script>
<noscript></noscript>
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 6 章 セキュリティー</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="server-administration.html">前</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="backup-and-recovery.html">次へ</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="security"></a>第 6 章 セキュリティー</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="section"><a href="security.html#general-security-issues">6.1 一般的なセキュリティーの問題</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#security-guidelines">6.1.1 セキュリティーガイドライン</a></span></dt><dt><span class="section"><a href="security.html#password-security">6.1.2 パスワードをセキュアな状態にする</a></span></dt><dt><span class="section"><a href="security.html#security-against-attack">6.1.3 攻撃者に対する MySQL のセキュアな状態の維持</a></span></dt><dt><span class="section"><a href="security.html#security-options">6.1.4 セキュリティー関連の mysqld オプションおよび変数</a></span></dt><dt><span class="section"><a href="security.html#changing-mysql-user">6.1.5 MySQL を通常ユーザーとして実行する方法</a></span></dt><dt><span class="section"><a href="security.html#load-data-local">6.1.6 LOAD DATA LOCAL のセキュリティーの問題</a></span></dt><dt><span class="section"><a href="security.html#secure-client-programming">6.1.7 クライアントプログラミングのセキュリティーガイドライン</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#privilege-system">6.2 MySQL アクセス権限システム</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#privileges-provided">6.2.1 MySQL で提供される権限</a></span></dt><dt><span class="section"><a href="security.html#grant-table-structure">6.2.2 権限システム付与テーブル</a></span></dt><dt><span class="section"><a href="security.html#account-names">6.2.3 アカウント名の指定</a></span></dt><dt><span class="section"><a href="security.html#connection-access">6.2.4 アクセス制御、ステージ 1: 接続の検証</a></span></dt><dt><span class="section"><a href="security.html#request-access">6.2.5 アクセス制御、ステージ 2: リクエストの確認</a></span></dt><dt><span class="section"><a href="security.html#privilege-changes">6.2.6 権限変更が有効化される時期</a></span></dt><dt><span class="section"><a href="security.html#access-denied">6.2.7 アクセス拒否エラーの原因</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#user-account-management">6.3 MySQL ユーザーアカウントの管理</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#user-names">6.3.1 ユーザー名とパスワード</a></span></dt><dt><span class="section"><a href="security.html#adding-users">6.3.2 ユーザーアカウントの追加</a></span></dt><dt><span class="section"><a href="security.html#removing-users">6.3.3 ユーザーアカウントの削除</a></span></dt><dt><span class="section"><a href="security.html#user-resources">6.3.4 アカウントリソース制限の設定</a></span></dt><dt><span class="section"><a href="security.html#assigning-passwords">6.3.5 アカウントパスワードの割り当て</a></span></dt><dt><span class="section"><a href="security.html#password-expiration-sandbox-mode">6.3.6 パスワードの期限切れとサンドボックスモード</a></span></dt><dt><span class="section"><a href="security.html#pluggable-authentication">6.3.7 プラガブル認証</a></span></dt><dt><span class="section"><a href="security.html#authentication-plugins-available">6.3.8 MySQL で使用可能な認証プラグイン</a></span></dt><dt><span class="section"><a href="security.html#proxy-users">6.3.9 プロキシユーザー</a></span></dt><dt><span class="section"><a href="security.html#ssl-connections">6.3.10 セキュアな接続のための SSL の使用</a></span></dt><dt><span class="section"><a href="security.html#windows-and-ssh">6.3.11 SSH を使用した Windows から MySQL へのリモート接続</a></span></dt><dt><span class="section"><a href="security.html#audit-log-plugin">6.3.12 MySQL Enterprise Audit ログプラグイン</a></span></dt><dt><span class="section"><a href="security.html#account-activity-auditing">6.3.13 SQL ベースの MySQL アカウントアクティビティーの監査</a></span></dt></dl></dd></dl></div><p>
    MySQL インストール内のセキュリティーについて検討するときは、可能性のあるさまざまなトピックについて考慮し、それらが MySQL サーバーおよび関連するアプリケーションのセキュリティーに及ぼす影響について考慮するようにしてください。
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        セキュリティーに影響する一般的な要因。これらには、適切なパスワードの選択、不要な権限をユーザーに付与しないこと、SQL インジェクションおよびデータ損失を防ぐことによるアプリケーションセキュリティーの確保などが含まれます。<a class="xref" href="security.html#general-security-issues" title="6.1 一般的なセキュリティーの問題">セクション6.1「一般的なセキュリティーの問題」</a>を参照してください。
      </p></li><li class="listitem"><p>
        インストール自体のセキュリティー。インストールにおけるデータファイル、ログファイル、およびすべてのアプリケーションファイルを保護することで、許可のない人物による読み取りまたは書き込みができないようにします。詳細については、<a class="xref" href="installing.html#postinstallation" title="2.10 インストール後のセットアップとテスト">セクション2.10「インストール後のセットアップとテスト」</a>を参照してください。
      </p></li><li class="listitem"><p>
        データベースおよびデータベース内で使用中のビューおよびストアドプログラムへのアクセス権限を付与されたユーザーおよびデータベースを含む、データベースシステム自体の内部におけるアクセス制御およびセキュリティー。詳細については、<a class="xref" href="security.html#privilege-system" title="6.2 MySQL アクセス権限システム">セクション6.2「MySQL アクセス権限システム」</a>および<a class="xref" href="security.html#user-account-management" title="6.3 MySQL ユーザーアカウントの管理">セクション6.3「MySQL ユーザーアカウントの管理」</a>を参照してください。
      </p></li><li class="listitem"><p>
        MySQL およびシステムのネットワークセキュリティー。セキュリティーは個々のユーザーに対する権限付与に関係しますが、MySQL が、MySQL サーバーホスト上でローカルからのみ利用できるか、限定されたほかのホストのセットについてのみ利用できるように MySQL を制限したい場合もあります。
      </p></li><li class="listitem"><p>
        データベースファイル、構成、およびログファイルの十分かつ適切なバックアップを用意します。また、リカバリソリューションを用意するようにし、バックアップから情報を正しくリカバリできることをテストしてください。<a class="xref" href="backup-and-recovery.html" title="第 7 章 バックアップとリカバリ">第7章「<i>バックアップとリカバリ</i>」</a>を参照してください。
      </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="general-security-issues"></a>6.1 一般的なセキュリティーの問題</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#security-guidelines">6.1.1 セキュリティーガイドライン</a></span></dt><dt><span class="section"><a href="security.html#password-security">6.1.2 パスワードをセキュアな状態にする</a></span></dt><dt><span class="section"><a href="security.html#security-against-attack">6.1.3 攻撃者に対する MySQL のセキュアな状態の維持</a></span></dt><dt><span class="section"><a href="security.html#security-options">6.1.4 セキュリティー関連の mysqld オプションおよび変数</a></span></dt><dt><span class="section"><a href="security.html#changing-mysql-user">6.1.5 MySQL を通常ユーザーとして実行する方法</a></span></dt><dt><span class="section"><a href="security.html#load-data-local">6.1.6 LOAD DATA LOCAL のセキュリティーの問題</a></span></dt><dt><span class="section"><a href="security.html#secure-client-programming">6.1.7 クライアントプログラミングのセキュリティーガイドライン</a></span></dt></dl></div><a class="indexterm" name="idm139979123429104"></a><p>
    このセクションでは、留意するべき一般的なセキュリティーの問題と、攻撃または悪用に対して MySQL インストールをさらにセキュアな状態にするために実行可能なアクションについて説明します。ユーザーアカウントのセットアップおよびデータベースアクセスの検査のために MySQL が使用するアクセス制御システムについての詳細は、<a class="xref" href="installing.html#postinstallation" title="2.10 インストール後のセットアップとテスト">セクション2.10「インストール後のセットアップとテスト」</a>を参照してください。
  </p><p>
    MySQL Server のセキュリティーの問題について、よくある質問のうちのいくつかに対する回答は、<a class="xref" href="faqs.html#faqs-security" title="A.9 MySQL 5.6 FAQ: セキュリティー">セクションA.9「MySQL 5.6 FAQ: セキュリティー」</a>を参照してください。
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-guidelines"></a>6.1.1 セキュリティーガイドライン</h3></div></div></div><a class="indexterm" name="idm139979123422784"></a><a class="indexterm" name="idm139979123421360"></a><p>
      インターネットに接続したコンピュータ上で MySQL を使用するすべてのユーザーは、セキュリティーに関するもっとも一般的な間違いを回避するために、このセクションを読むようにしてください。
    </p><p>
      セキュリティーについて検討する際、該当するすべての種類の攻撃 (盗聴、改変、プレイバック、およびサービス妨害) から、(MySQL サーバーだけでなく) サーバーホスト全体を完全に保護することを考慮する必要があります。ここでは可用性およびフォールトトレランスのすべての側面について扱うことはしません。
    </p><p>
      MySQL では、ユーザーが実行を試行できるすべての接続、クエリー、およびその他の操作に対して、アクセス制御リスト (ACL) に基づくセキュリティーが使用されています。また、MySQL クライアントとサーバーの間で SSL に対応した接続のサポートもあります。ここで説明されている多くの概念は MySQL に固有のものではなく、同じような一般的な考え方は、ほぼすべてのアプリケーションに該当します。
    </p><p>
      MySQL を実行するときは、次のガイドラインに従ってください。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">mysql</code> データベース内の <code class="literal">user</code> テーブルに対するアクセス権限を (MySQL <code class="literal">root</code> アカウント以外の) すべてのユーザーに絶対に付与しないでください。</strong></span>これはきわめて重要です。
        </p></li><li class="listitem"><p>
          MySQL アクセス権限システムのしくみについて学習してください (<a class="xref" href="security.html#privilege-system" title="6.2 MySQL アクセス権限システム">セクション6.2「MySQL アクセス権限システム」</a>を参照してください)。MySQL へのアクセスを制御するには、<code class="literal">GRANT</code> および <code class="literal">REVOKE</code> ステートメントを使用します。必要以上の権限を付与しないでください。すべてのホストに権限を付与してはいけません。
        </p><p>
          チェックリスト:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">mysql -u root</code> を試してください。パスワードを尋ねられずにサーバーへの接続に成功する場合、すべてのユーザーが、完全な権限を持つ MySQL <code class="literal">root</code> ユーザーとして MySQL サーバーに接続できます。<code class="literal">root</code> パスワードの設定に関する情報に特に注意して、MySQL インストール手順を見直してください。<a class="xref" href="installing.html#default-privileges" title="2.10.2 最初の MySQL アカウントのセキュリティー設定">セクション2.10.2「最初の MySQL アカウントのセキュリティー設定」</a>を参照してください。
            </p></li><li class="listitem"><p>
              <code class="literal">SHOW GRANTS</code> ステートメントを使用して、どのアカウントが何にアクセスできるかをチェックします。<code class="literal">REVOKE</code> ステートメントを使用して、不要な権限を削除します。
            </p></li></ul></div></li><li class="listitem"><p>
          平文パスワードをデータベースに保管しないでください。コンピュータのセキュリティーが損なわれた場合、侵入者はすべてのパスワードのリストを取得して使用することができます。代わりに、<code class="literal">SHA2()</code>、<code class="literal">SHA1()</code>、<code class="literal">MD5()</code>、またはその他の一方向のハッシュ機能を使用して、ハッシュ値を保管してください。
        </p><p>
          レインボーテーブルを使用したパスワードのリカバリを避けるために、これらの関数をプレーンテキストパスワードに使用しないようにしてください。代わりに、ソルトとして使用する何らかの文字列を選択して、hash(hash(パスワード)+ソルト) 値を使用してください。
        </p></li><li class="listitem"><p>
          辞書からパスワードを選択しないでください。パスワードを解読する特殊なプログラムが存在します。<span class="quote">「<span class="quote">xfish98</span>」</span> のようなパスワードでさえも、非常に悪いものです。同じ <span class="quote">「<span class="quote">fish</span>」</span> という単語を、標準 QWERTY キーボードでキー 1 個分左にずらしてタイプした <span class="quote">「<span class="quote">duag98</span>」</span> の方が、ずっと優れています。別の方法は、文の各単語の先頭文字を取ったパスワードを使用することです (たとえば、<span class="quote">「<span class="quote">Four score and seven years ago</span>」</span> からは <span class="quote">「<span class="quote">Fsasya</span>」</span> というパスワードができます)。パスワードは覚えやすく入力も簡単ですが、文を知らない人は推測が困難です。この事例で、数字を示す単語をさらに数値に置き換えて <span class="quote">「<span class="quote">4 score and 7 years ago</span>」</span> という句を作成し、<span class="quote">「<span class="quote">4sa7ya</span>」</span> というさらに推測困難なパスワードを得ることができます。
        </p></li><li class="listitem"><p>
          ファイアウォールに投資します。これにより、あらゆる種類のソフトウェアの悪用のうち、少なくとも 50% から保護されます。MySQL をファイアウォールの背後または非武装地帯 (DMZ) に配置します。
        </p><p>
          チェックリスト:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">nmap</code> などのツールを使用して、インターネットから自分のポートをスキャンしてみてください。MySQL はデフォルトでポート 3306 を使用します。このポートは信頼できないホストからアクセス可能であってはいけません。MySQL ポートが開いているかどうかを検査する簡単な方法として、いずれかのリモートマシンから次のコマンドを試行します。ここで、<em class="replaceable"><code>server_host</code></em> は MySQL サーバーが実行しているホストのホスト名または IP アドレスです。
            </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>telnet <em class="replaceable"><code>server_host</code></em> 3306</code></strong>
</pre><p>
              <span class="command"><strong>telnet</strong></span> がハングするか、接続が拒否されれば、ポートはブロックされており、これは期待どおりの結果です。接続を取得して、何らかの文字化けした文字が得られた場合、ポートは開いているため、ポートを開いたままにしておく十分な理由が実際にある場合を除き、ファイアウォールまたはルーターで閉じるようにしてください。
            </p></li></ul></div></li><li class="listitem"><p>
          MySQL にアクセスするアプリケーションは、ユーザーから入力されるすべてのデータを信頼しないようにし、適切な防御的プログラミング技術を使用して記述するようにします。<a class="xref" href="security.html#secure-client-programming" title="6.1.7 クライアントプログラミングのセキュリティーガイドライン">セクション6.1.7「クライアントプログラミングのセキュリティーガイドライン」</a>を参照してください。
        </p></li><li class="listitem"><p>
          プレーンの (暗号化されていない) データをインターネット経由で送信しないでください。この情報は、情報を傍受する時間と能力を持ち、自身の目的のために情報を使用するすべての人物からアクセスできます。代わりに、SSL や SSH などの暗号化されたプロトコルを使用してください。MySQL は、内部 SSL 接続をサポートします。別の技術として、SSH ポートフォワーディングを使用して、暗号化された (および圧縮された) 通信用トンネルを作成する方法があります。
        </p></li><li class="listitem"><p>
          <span class="command"><strong>tcpdump</strong></span> や <span class="command"><strong>strings</strong></span> などのユーティリティーの使用法について学習します。ほとんどの場合、次のようなコマンドを発行することによって、MySQL データストリームが暗号化されていない状態であるかどうかを検査できます。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>tcpdump -l -i eth0 -w - src or dst port 3306 | strings</code></strong>
</pre><p>
          これは Linux で動作するほか、ほかのシステムでもわずかな変更を行うことで動作するはずです。
        </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
            平文データが表示されない場合、これは情報が実際に暗号化されていることを必ずしも意味しているわけではありません。セキュリティーを強化する必要がある場合、セキュリティーの専門家に相談してください。
          </p></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="password-security"></a>6.1.2 パスワードをセキュアな状態にする</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#password-security-user">6.1.2.1 パスワードセキュリティーのためのエンドユーザーガイドライン</a></span></dt><dt><span class="section"><a href="security.html#password-security-admin">6.1.2.2 パスワードセキュリティーについての管理者ガイドライン</a></span></dt><dt><span class="section"><a href="security.html#password-logging">6.1.2.3 パスワードおよびロギング</a></span></dt><dt><span class="section"><a href="security.html#password-hashing">6.1.2.4 MySQL でのパスワードハッシュ</a></span></dt><dt><span class="section"><a href="security.html#application-password-use">6.1.2.5 MySQL 4.1 でのパスワードハッシュ変更がアプリケーションプログラムに及ぼす影響</a></span></dt><dt><span class="section"><a href="security.html#validate-password-plugin">6.1.2.6 パスワード検証プラグイン</a></span></dt></dl></div><a class="indexterm" name="idm139979123368672"></a><p>
      パスワードは MySQL のいくつかのコンテキストで現れます。次のセクションでは、エンドユーザーおよび管理者がこれらのパスワードをセキュアな状態にし、公開しないようにするためのガイドラインを提供します。また、MySQL がパスワードハッシュを内部で使用する方法や、厳密なパスワードを強制するために使用できるプラグインについても説明します。
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="password-security-user"></a>6.1.2.1 パスワードセキュリティーのためのエンドユーザーガイドライン</h4></div></div></div><a class="indexterm" name="idm139979123364464"></a><p>
        MySQL ユーザーは、パスワードをセキュアな状態にするために次のガイドラインを使用することをお勧めします。
      </p><p>
        クライアントプログラムを実行して MySQL サーバーに接続する場合、ほかのユーザーからの検出によって公開されるような方法でパスワードを指定することはお勧めできません。クライアントプログラムを実行するときにパスワードを指定するために使用できる方法と、それぞれの方法のリスクの評価について、次の一覧で示します。簡単に言えば、もっとも安全な方法は、クライアントプログラムがパスワードを求めるプロンプトを出すようにするか、適切に保護されたオプションファイルにパスワードを指定する方法です。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="command"><strong>mysql_config_editor</strong></span> ユーティリティーを使用します。これは、<code class="filename">.mylogin.cnf</code> という名前の暗号化されたログインファイルに認証情報を格納できます。このファイルは、MySQL Server に接続するための認証情報を取得するために、MySQL クライアントプログラムによってあとで読み取ることができます。<a class="xref" href="programs.html#mysql-config-editor" title="4.6.6 mysql_config_editor — MySQL 構成ユーティリティー">セクション4.6.6「<span class="command"><strong>mysql_config_editor</strong></span> — MySQL 構成ユーティリティー」</a>を参照してください。
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm139979123355440"></a> <a class="indexterm" name="idm139979123354000"></a> コマンド行で <code class="option">-p<em class="replaceable"><code>your_pass</code></em></code> または <code class="option">--password=<em class="replaceable"><code>your_pass</code></em></code> オプションを使用します。例:
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u francis -pfrank <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p>
            これは便利ですが<span class="emphasis"><em>セキュアではありません</em></span>。一部のシステムでは、使用しているパスワードが、コマンド行を表示するためにほかのユーザーによって起動できる <span class="command"><strong>ps</strong></span> などのシステムステータスプログラムによって表示可能になります。MySQL クライアントは通常、クライアントの初期化シーケンス中にコマンド行パスワード引数をゼロで上書きします。ただし、まだ値が表示可能な短い期間があります。また、一部のシステムではこの上書きの方法には効果がなく、パスワードは <span class="command"><strong>ps</strong></span> から表示可能になったままになります。(SystemV Unix システムおよびおそらくほかのシステムでもこの問題の影響があります。)
          </p><p>
            ターミナルウィンドウのタイトルバーに現在のコマンドを表示するようにオペレーティング環境がセットアップされている場合、コマンドがウィンドウのコンテンツ領域からスクロールアウトされて表示されなくなっても、コマンドが実行中であるかぎりパスワードが表示されたままになります。
          </p></li><li class="listitem"><p>
            コマンド行でパスワード値を指定せずに <code class="option">-p</code> または <code class="option">--password</code> オプションを使用します。この場合、クライアントプログラムはパスワードを対話的に要求します。
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u francis -p <em class="replaceable"><code>db_name</code></em></code></strong>
Enter password: ********
</pre><p>
            <span class="quote">「<span class="quote"><code class="literal">*</code></span>」</span> 文字はパスワードを入力したことを示しています。パスワードは入力時に表示されません。
          </p><p>
            この方法でパスワードを入力する方が、コマンド行でパスワードを指定するよりもセキュアです。これは、パスワードがほかのユーザーに表示されないためです。ただし、このパスワード入力方法は、対話的に実行するプログラムについてのみ適しています。非対話的に実行するスクリプトからクライアントを呼び出す場合、キーボードからパスワードを入力する機会はありません。一部のシステムでは、スクリプトの 1 行目が (誤って) パスワードとして読み取られて解釈されることすらあります。
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm139979123337184"></a> パスワードをオプションファイルに保管します。たとえば Unix の場合、ホームディレクトリの <code class="filename">.my.cnf</code> ファイルの <code class="literal">[client]</code> セクションにパスワードを一覧表示することができます。
          </p><pre class="programlisting">
[client]
password=your_pass
</pre><p>
            パスワードを安全に保持するには、自分以外のすべてのユーザーからファイルにアクセス可能にしてはいけません。このようにするには、ファイルのアクセスモードを <code class="literal">400</code> または <code class="literal">600</code> に設定します。例:
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>chmod 600 .my.cnf</code></strong>
</pre><p>
            パスワードを格納する特定のオプションファイルをコマンド行から指定するには、<code class="option">--defaults-file=<em class="replaceable"><code>file_name</code></em></code> オプションを使用します。ここで <code class="filename">file_name</code> はファイルへのフルパス名です。例:
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --defaults-file=/home/francis/mysql-opts</code></strong>
</pre><p>
            <a class="xref" href="programs.html#option-files" title="4.2.6 オプションファイルの使用">セクション4.2.6「オプションファイルの使用」</a>には、オプションファイルについてさらに詳しく記載されています。
          </p></li><li class="listitem"><p>
            <code class="literal">MYSQL_PWD</code> 環境変数にパスワードを保存します。<a class="xref" href="installing.html#environment-variables" title="2.12 環境変数">セクション2.12「環境変数」</a>を参照してください。
          </p><p>
            この方法で MySQL パスワードを指定することは<span class="emphasis"><em>非常に危険</em></span>であるため、使用するべきではありません。<span class="command"><strong>ps</strong></span> のバージョンによっては、実行プロセスの環境を表示するオプションがあります。一部のシステムで、<code class="literal">MYSQL_PWD</code> を設定した場合、パスワードは <span class="command"><strong>ps</strong></span> を実行するすべてのユーザーに公開されます。そのようなバージョンの <span class="command"><strong>ps</strong></span> を持たないシステムであっても、ユーザーが処理環境を調査できるほかの方法がないと想定することは賢明ではありません。
          </p></li></ul></div><a class="indexterm" name="idm139979123317024"></a><p>
        Unix の場合、<span class="command"><strong>mysql</strong></span> クライアントは実行済みステートメントを履歴ファイルに書き込みます (<a class="xref" href="programs.html#mysql-logging" title="4.5.1.3 mysql のロギング">セクション4.5.1.3「mysql のロギング」</a>を参照してください)。デフォルトでは、このファイルは <code class="filename">.mysql_history</code> という名前で、ユーザーのホームディレクトリに作成されます。パスワードは、<code class="literal">CREATE USER</code>、<code class="literal">GRANT</code>、<code class="literal">SET PASSWORD</code> などの SQL ステートメントではプレーンテキストとして書き込むことができるため、これらのステートメントを使用する場合、ステートメントは履歴ファイルに記録されます。このファイルを安全に保持するには、以前 <code class="filename">.my.cnf</code> ファイルについて説明したのと同じ方法である制限アクセスモードを使用します。
      </p><p>
        コマンドインタプリタが履歴を保持するように構成されている場合、コマンドが保存されるすべてのファイルには、コマンド行で入力された MySQL パスワードが格納されます。たとえば、<span class="command"><strong>bash</strong></span> は <code class="filename">~/.bash_history</code> を使用します。そのようなすべてのファイルは、制限アクセスモードにするようにしてください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="password-security-admin"></a>6.1.2.2 パスワードセキュリティーについての管理者ガイドライン</h4></div></div></div><a class="indexterm" name="idm139979123304128"></a><p>
        データベース管理者は、パスワードをセキュアな状態にするための次のガイドラインを使用するようにしてください。
      </p><p>
        MySQL はユーザーアカウント用のパスワードを <code class="literal">mysql.user</code> テーブルに保管します。このテーブルへのアクセス権を、管理者以外のすべてのアカウントに決して付与しないでください。
      </p><p>
        アカウントパスワードは期限切れとなることがあり、ユーザーはそれらをリセットする必要があります。<a class="xref" href="security.html#password-expiration-sandbox-mode" title="6.3.6 パスワードの期限切れとサンドボックスモード">セクション6.3.6「パスワードの期限切れとサンドボックスモード」</a>を参照してください。
      </p><p>
        <code class="literal">validate_password</code> プラグインを使用して、許容可能なパスワードについてのポリシーを強制することができます。<a class="xref" href="security.html#validate-password-plugin" title="6.1.2.6 パスワード検証プラグイン">セクション6.1.2.6「パスワード検証プラグイン」</a>を参照してください。
      </p><p>
        プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数の値) またはプラグインディレクトリの場所を指定する <code class="filename">my.cnf</code> ファイルを変更するためのアクセス権を持つユーザーは、認証プラグインなどのプラグインを置換して、プラグインによって提供される機能を変更することができます。
      </p><p>
        パスワードが書き込まれる可能性があるログファイルなどのファイルを保護するようにしてください。<a class="xref" href="security.html#password-logging" title="6.1.2.3 パスワードおよびロギング">セクション6.1.2.3「パスワードおよびロギング」</a>を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="password-logging"></a>6.1.2.3 パスワードおよびロギング</h4></div></div></div><a class="indexterm" name="idm139979123290816"></a><a class="indexterm" name="idm139979123288704"></a><p>
        パスワードは、<code class="literal">CREATE USER</code>、<code class="literal">GRANT</code>、<code class="literal">SET PASSWORD</code> などの SQL ステートメントや、<code class="literal">PASSWORD()</code> 関数を呼び出すステートメントにプレーンテキストとして書き込むことができます。これらのステートメントが MySQL サーバーによって、書き込まれたとおりにログに記録された場合、それらのパスワードはログにアクセス可能なすべてのユーザーから利用できるようになります。
      </p><p>
        MySQL 5.6.3 からステートメントロギングが変更され、次のステートメントについてはパスワードがプレーンテキストで表示されなくなりました。
      </p><pre class="programlisting">
CREATE USER ... IDENTIFIED BY ...
GRANT ... IDENTIFIED BY ...
SET PASSWORD ...
SLAVE START ... PASSWORD = ...              (as of 5.6.4)
CREATE SERVER ... OPTIONS(... PASSWORD ...) (as of 5.6.9)
ALTER SERVER ... OPTIONS(... PASSWORD ...)  (as of 5.6.9)
</pre><p>
        これらのステートメント内のパスワードは、一般クエリーログ、スロークエリーログ、およびバイナリログについて、ステートメントテキストの文字どおりに表示されないように書き換えられます。ほかのステートメントについては書き換えが適用されません。
      </p><p>
        一般クエリーログの場合、パスワードの書き換えは、<code class="option">--log-raw</code> オプションを使用してサーバーを起動することによって抑制することができます。このオプションは、サーバーによって受け取られるステートメントの正確なテキストを表示する際の診断目的で役立つ場合がありますが、セキュリティー上の理由で本番用途では推奨されません。
      </p><p>
        監査ログプラグインによって生成される監査ログファイルの内容は、暗号化されません。セキュリティー上の理由から、このファイルは MySQL サーバーおよびログを表示する正当な理由を持つユーザーからのみアクセス可能なディレクトリに書き込むようにしてください。<a class="xref" href="security.html#audit-log-security" title="6.3.12.2 監査ログプラグインのセキュリティーに関する考慮事項">セクション6.3.12.2「監査ログプラグインのセキュリティーに関する考慮事項」</a>を参照してください。
      </p><p>
        ログファイルが不当に公開されないよう保護するには、サーバーおよびデータベース管理者にのみアクセスを制限したディレクトリにログファイルを配置するようにしてください。<code class="literal">mysql</code> データベース内のテーブルにログを記録する場合、これらのテーブルへのアクセス権を、管理者以外のアカウントに決して付与してはいけません。
      </p><p>
        レプリケーションスレーブは、レプリケーションマスターのパスワードをマスター情報リポジトリに格納し、このリポジトリは、ファイルまたはテーブルのいずれかになります (<a class="xref" href="replication.html#slave-logs" title="17.2.2 レプリケーションリレーおよびステータスログ">セクション17.2.2「レプリケーションリレーおよびステータスログ」</a>を参照してください)。このリポジトリはデータベース管理者からのみアクセス可能になるようにします。MySQL 5.6.4 の時点では、パスワードのファイルへの保管に代わる方法は、<code class="literal">START SLAVE</code> ステートメントを使用して、マスターに接続するための資格情報を指定する方法です。
      </p><p>
        パスワードを保管するテーブルまたはログファイルを含むデータベースバックアップは、制限アクセスモードを使用して保護するようにしてください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="password-hashing"></a>6.1.2.4 MySQL でのパスワードハッシュ</h4></div></div></div><a class="indexterm" name="idm139979123268000"></a><p>
        MySQL では、<code class="literal">mysql</code> データベースの <code class="literal">user</code> テーブルにユーザーアカウントがリストされます。各 MySQL アカウントにパスワードを割り当てることができますが、<code class="literal">user</code> テーブルはパスワードの平文バージョンを格納せず、パスワードから計算されたハッシュ値を格納します。
      </p><p>
        MySQL では、クライアントとサーバーの通信の 2 つのフェーズでパスワードが使用されます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            クライアントがサーバーに接続しようとすると、初期認証ステップがあり、そのステップでは、クライアントが使用するアカウントについての <code class="literal">user</code> テーブルに格納されたハッシュ値に一致するハッシュ値を持つパスワードをクライアントが提供する必要があります。
          </p></li><li class="listitem"><p>
            クライアントが接続したあと、クライアントは (十分な権限がある場合に) <code class="literal">user</code> テーブルにリストされているアカウントについてのパスワードハッシュを設定または変更することができます。クライアントは、<code class="literal">PASSWORD()</code> 関数を使用してパスワードハッシュを生成するか、パスワード生成ステートメント (<code class="literal">CREATE USER</code>、<code class="literal">GRANT</code>、または <code class="literal">SET PASSWORD</code>) を使用することによって、これを行うことができます。
          </p></li></ul></div><p>
        言い換えると、クライアントが最初に接続しようとしたとき、サーバーは認証中にハッシュ値を<span class="emphasis"><em>検査</em></span>します。接続されたクライアントが <code class="literal">PASSWORD()</code> 関数を呼び出すか、パスワード生成ステートメントを使用してパスワードを設定または変更する場合、サーバーはハッシュ値を<span class="emphasis"><em>生成</em></span>します。
      </p><p>
        MySQL のパスワードハッシュ方式には、次に記述するような歴史があります。これらの変更は、パスワードハッシュ値を計算する <code class="literal">PASSWORD()</code> 関数からの結果と、パスワードが格納される <code class="literal">user</code> テーブルの構造の変更によって説明されます。
      </p><h5><a name="idm139979123247312"></a>元の (4.1 より前の) ハッシュ方式</h5><p>
        元のハッシュ方式では 16 バイト文字列が生成されていました。そのようなハッシュは、次のようになります。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PASSWORD('mypass');</code></strong>
+--------------------+
| PASSWORD('mypass') |
+--------------------+
| 6f8c114b58f2ce9e   |
+--------------------+
</pre><p>
        アカウントパスワードを格納するために、<code class="literal">user</code> テーブルの <code class="literal">Password</code> カラムは、この時点で 16 バイト長でした。
      </p><h5><a name="idm139979123242208"></a>4.1 ハッシュ方式</h5><p>
        MySQL 4.1 では、セキュリティーを高めてパスワードが傍受されるリスクを低下させる、パスワードハッシュが導入されました。この変更にはさまざまな側面がありました。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">PASSWORD()</code> 関数結果の形式の変更
          </p></li><li class="listitem"><p>
            <code class="literal">Password</code> カラムの拡張
          </p></li><li class="listitem"><p>
            デフォルトのハッシュ方式による制御
          </p></li><li class="listitem"><p>
            サーバーに接続しようとするクライアントについて、許可されたハッシュ方式による制御
          </p></li></ul></div><p>
        MySQL 4.1 の変更は、2 段階で行われました。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            MySQL 4.1.0 では 4.1 ハッシュ方式の予備バージョンが使用されていました。この方式は使用期間がたいへん短かったため、以後の説明ではこれについては言及しません。
          </p></li><li class="listitem"><p>
            MySQL 4.1.1 ではハッシュ方式が変更され、41 バイトの長いハッシュ値が生成されるようになりました。
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PASSWORD('mypass');</code></strong>
+-------------------------------------------+
| PASSWORD('mypass')                        |
+-------------------------------------------+
| *6C8989366EAF75BB670AD8EA7A7FC1176A95CEF4 |
+-------------------------------------------+
</pre><p>
            長いパスワードハッシュ形式は暗号化特性に優れ、長いハッシュに基づくクライアント認証の方が短いハッシュに基づく認証よりセキュアです。
          </p><p>
            長いパスワードハッシュに対応するために、<code class="literal">user</code> テーブルの <code class="literal">Password</code> カラムはこの時点で現在の長さである 41 バイトに変更されました。
          </p><p>
            拡張された <code class="literal">Password</code> カラムは、4.1 より前と 4.1 の両方の形式でパスワードハッシュを格納できます。特定のハッシュ値の形式は、2 つの方法で決定されます。
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                長さ: 4.1 および 4.1 より前のハッシュは、それぞれ 41 バイトと 16 バイトです。
              </p></li><li class="listitem"><p>
                4.1 形式のパスワードハッシュは常に <span class="quote">「<span class="quote"><code class="literal">*</code></span>」</span> 文字で始まりますが、4.1 より前の形式のパスワードでそうなることはありません。
              </p></li></ul></div><p>
            4.1 より前のパスワードハッシュを明示的に生成できるようにするために、2 つの追加変更が行われました。
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                ハッシュ値を 16 バイト形式で返す <code class="literal">OLD_PASSWORD()</code> 関数が追加されました。
              </p></li><li class="listitem"><p>
                互換性目的で、DBA およびアプリケーションがハッシュ方式を制御できるようにする <code class="literal">old_passwords</code> システム変数が追加されました。<code class="literal">old_passwords</code> 値がデフォルトの 0 のときは、ハッシュで 4.1 方式を使用し、(41 バイトのハッシュ値)、<code class="literal">old_passwords=1</code> と設定すると、ハッシュで 4.1 より前の方式を使用します。この場合、<code class="literal">PASSWORD()</code> は 16 バイト値を生成し、<code class="literal">OLD_PASSWORD()</code> と同等です
              </p></li></ul></div><p>
            クライアントが接続できる方法を DBA が制御できるようにするために、<code class="literal">secure_auth</code> システム変数が追加されました。この変数を無効または有効にしてサーバーを起動することにより、クライアントが 4.1 より前の古いパスワードハッシュ方式を使用して接続することを許可または禁止します。MySQL 5.6.5 より前では、<code class="literal">secure_auth</code> はデフォルトで無効になっています。5.6.5 の時点では、よりセキュアなデフォルト構成を促進するために <code class="literal">secure_auth</code> はデフォルトで有効になっています (DBA は自らの裁量によりこれを無効化できますが、これは推奨されません)。4.1 より前のパスワードハッシュは非推奨であるため使用しないようにしてください。(アカウントのアップグレード手順については、<a class="xref" href="security.html#account-upgrades" title="6.3.8.3 4.1 よりも前のパスワードハッシュ方式と mysql_old_password プラグインからの移行">セクション6.3.8.3「4.1 よりも前のパスワードハッシュ方式と mysql_old_password プラグインからの移行」</a>を参照してください。)
          </p><p>
            さらに、<span class="command"><strong>mysql</strong></span> クライアントは、<code class="literal">secure_auth</code> に類似した <code class="option">--secure-auth</code> オプションをサポートしますが、これはクライアント側から指定します。これは 4.1 より前のパスワードハッシュを使用する、セキュアではないアカウントへの接続を防ぐために使用できます。このオプションは、MySQL 5.6.7 より前ではデフォルトで無効になっていますが、それ以降では有効になっています。
          </p></li></ul></div><h5><a name="idm139979123202944"></a>ハッシュ方式に関する互換性の問題</h5><p>
        MySQL 4.1 での 16 バイトから 41 バイトへの <code class="literal">Password</code> カラムの拡張は、インストールまたはアップグレード操作に次のように影響します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            MySQL の新規インストールを実行する場合、<code class="literal">Password</code> カラムは自動的に 41 バイトの長さになります。
          </p></li><li class="listitem"><p>
            MySQL 4.1 以降から現在のバージョンの MySQL へのアップグレードでは、どちらのバージョンも同じカラム長とパスワードハッシュ方式を使用しているため、<code class="literal">Password</code> カラムに関して問題は何も発生しないはずです。
          </p></li><li class="listitem"><p>
            4.1 より前のリリースから 4.1 以降へのアップグレードの場合、アップグレード後にシステムテーブルをアップグレードする必要があります。(<a class="xref" href="programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — MySQL テーブルのチェックとアップグレード">セクション4.4.7「<span class="command"><strong>mysql_upgrade</strong></span> — MySQL テーブルのチェックとアップグレード」</a>を参照してください。)
          </p></li></ul></div><p>
        4.1 ハッシュ方式は MySQL 4.1 (およびそれ以降の) サーバーとクライアントによってのみ認識されるため、互換性の問題が発生する可能性があります。4.1 またはそれより新しいクライアントは、4.1 より前と 4.1 のパスワードハッシュ方式の両方を認識するため、4.1 より前のサーバーに接続できます。ただし、4.1 より前のクライアントが 4.1 またはそれより新しいサーバーに接続しようとすると、問題が発生することがあります。たとえば、4.0 の <span class="command"><strong>mysql</strong></span> クライアントは次のエラーメッセージを出して失敗することがあります。
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -h localhost -u root</code></strong>
Client does not support authentication protocol requested
by server; consider upgrading MySQL client
</pre><p>
        この現象は、MySQL 4.1 以降にアップグレードしたあとで、古い PHP <code class="literal">mysql</code> 拡張を使用しようとしたときにも発生します。(<a class="ulink" href="http://dev.mysql.com/doc/apis-php/en/apis-php-problems.html" target="_top">Common Problems with MySQL and PHP</a>を参照してください。)
      </p><p>
        次の説明では、4.1 より前と 4.1 のハッシュ方式の違いについて、およびサーバーをアップグレードしたが 4.1 より前のクライアントとの下位互換性を保持する必要がある場合にどうすればよいかについて記載します。(ただし、古いクライアントによる接続を維持することは推奨されず、可能な場合は避けるようにしてください。)<a class="xref" href="error-handling.html#old-client" title="B.5.2.4 クライアントは認証プロトコルに対応できません">セクションB.5.2.4「クライアントは認証プロトコルに対応できません」</a>から追加情報を見つけることができます。この情報は、MySQL データベースを 4.1 より古いバージョンから 4.1 以降にマイグレーションを実行する PHP プログラマにとって特に重要です。
      </p><p>
        短いパスワードハッシュと長いパスワードハッシュの違いは、サーバーが認証中にパスワードを使用する方法と、パスワード変更操作を実行する接続対象のクライアントに対してサーバーがパスワードハッシュを生成する方法の両方に関係します。
      </p><p>
        サーバーが認証中にパスワードハッシュを使用する方法は、<code class="literal">Password</code> カラムの幅によって影響します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            カラムが短い場合、短いハッシュ認証のみが使用されます。
          </p></li><li class="listitem"><p>
            カラムが長い場合、短いハッシュまたは長いハッシュのいずれかを保持でき、サーバーはいずれかの形式を使用できます。
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                4.1 より前のクライアントは接続できますが、4.1 より前のハッシュ方式のみ認識するため、短いハッシュを持つアカウントを使用してのみ認証できます。
              </p></li><li class="listitem"><p>
                4.1 以降のクライアントは、短いハッシュまたは長いハッシュを持つアカウントを使用して認証できます。
              </p></li></ul></div></li></ul></div><p>
        短いハッシュのアカウントであっても、認証プロセスは、古いクライアントよりも 4.1 以降のクライアントの方が実際には少しセキュアです。セキュリティーの観点で、セキュアでないものからもっともセキュアなものの順に並べると、次のようになります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            短いパスワードハッシュで認証する 4.1 より前のクライアント
          </p></li><li class="listitem"><p>
            短いパスワードハッシュで認証する 4.1 以降のクライアント
          </p></li><li class="listitem"><p>
            長いパスワードハッシュで認証する 4.1 以降のクライアント
          </p></li></ul></div><p>
        接続対象のクライアントに対してサーバーがパスワードハッシュを生成する方法は、<code class="literal">Password</code> カラムの幅と、<code class="literal">old_passwords</code> システム変数に影響されます。4.1 以降のサーバーは、特定の条件が満たされた場合にのみ長いハッシュを生成し、この条件とは、<code class="literal">Password</code> カラムが長い値を保持するための十分な幅を持つこと、および <code class="literal">old_passwords</code> が 1 に設定されていてはいけないということです。
      </p><p>
        これらの条件は次のように適用されます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Password</code> カラムは、長いハッシュ (41 バイト) を保持するための十分な幅を持つ必要があります。カラムが更新されておらず、4.1 より前の 16 バイトの幅のままである場合、サーバーは長いハッシュがカラムに適合しないことを認識し、クライアントが <code class="literal">PASSWORD()</code> 関数またはパスワード生成ステートメントを使用してパスワード変更操作を実行したときに、サーバーは短いハッシュのみ生成します。これは、4.1 より古い MySQL バージョンから 4.1 以降にアップグレードしたが、<code class="literal">Password</code> カラムを拡張するための <span class="command"><strong>mysql_upgrade</strong></span> プログラムをまだ実行していない場合に発生する動作です。
          </p></li><li class="listitem"><p>
            <code class="literal">Password</code> カラムが広い場合、短いパスワードハッシュまたは長いパスワードハッシュのいずれかを格納できます。この場合は、代わりに短いパスワードハッシュを生成することをサーバーに強制するために <code class="literal">old_passwords</code> システム変数を 1 に設定してサーバーが起動されないかぎり、<code class="literal">PASSWORD()</code> 関数およびパスワード生成ステートメントは長いハッシュを生成します。
          </p></li></ul></div><p>
        <code class="literal">old_passwords</code> システム変数の目的は、ほかの状況ではサーバーが長いパスワードハッシュを生成するような状況で、4.1 より前のクライアントとの下位互換性を許可することです。このオプションは認証に影響しませんが (4.1 以降のクライアントは、長いパスワードハッシュを持つアカウントを引き続き使用できます)、パスワード変更操作の結果として <code class="literal">user</code> テーブル内で長いパスワードハッシュが作成されないようにします。この発生が許される場合、アカウントは 4.1 より前のクライアントによって使用できなくなります。<code class="literal">old_passwords</code> を無効にすると、次のような好ましくないシナリオが発生する可能性があります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            4.1 より前の古いクライアントが、短いパスワードハッシュを持つアカウントに接続します。
          </p></li><li class="listitem"><p>
            クライアントが自分のパスワードを変更します。<code class="literal">old_passwords</code> が無効なとき、これによりアカウントは長いパスワードハッシュを持つようになります。
          </p></li><li class="listitem"><p>
            古いクライアントがアカウントに次回接続しようとしたとき、古いクライアントは接続できません。これはアカウントが、認証中に 4.1 ハッシュ方式を必要とする長いパスワードハッシュを持つためです。(アカウントがユーザーテーブルに長いパスワードハッシュを持つようになると、4.1 より前のクライアントは長いハッシュを認識しないため、4.1 以降のクライアントのみが認証できます。)
          </p></li></ul></div><p>
        このシナリオでは、4.1 より前の古いクライアントをサポートする必要がある場合、<code class="literal">old_passwords</code> を 1 に設定しないで 4.1 またはそれより新しいサーバーを実行することは問題があるということを示しています。<code class="literal">old_passwords=1</code> を指定してサーバーを実行することにより、パスワード変更操作は長いパスワードハッシュを生成せず、アカウントが古いクライアントからアクセスできなくなることはありません。(これらのクライアントは、自分のパスワードを変更し、長いパスワードハッシュを結局得ることによって誤って自分自身をロックアウトしてしまうことはありません。)
      </p><p>
        <code class="literal">old_passwords=1</code> の欠点は、4.1 以降のクライアントについても、作成または変更されたすべてのパスワードが短いハッシュを使用することです。つまり、長いパスワードハッシュによって提供される追加のセキュリティーが失われます。長いハッシュ (たとえば 4.1 クライアントによって使用するためのもの) を持つアカウントを作成するか、長いパスワードハッシュを使用するための既存のアカウントを変更するために、管理者は <code class="literal">old_passwords</code> のセッション値を 0 に設定し、グローバル値を 1 に設定したままにすることができます。
      </p><pre class="programlisting">

mysql&gt; <strong class="userinput"><code>SET @@session.old_passwords = 0;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT @@session.old_passwords, @@global.old_passwords;</code></strong>
+-------------------------+------------------------+
| @@session.old_passwords | @@global.old_passwords |
+-------------------------+------------------------+
|                       0 |                      1 |
+-------------------------+------------------------+
1 row in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>CREATE USER 'newuser'@'localhost' IDENTIFIED BY 'newpass';</code></strong>
Query OK, 0 rows affected (0.03 sec)

mysql&gt; <strong class="userinput"><code>SET PASSWORD FOR 'existinguser'@'localhost' = PASSWORD('existingpass');</code></strong>
Query OK, 0 rows affected (0.00 sec)
</pre><p>
        MySQL 4.1 以降では次のシナリオが発生する可能性があります。要因は、<code class="literal">Password</code> カラムが短いか長いかということと、長い場合、サーバーが <code class="literal">old_passwords</code> を有効または無効のいずれに指定して起動したかということです。
      </p><p>
        <span class="bold"><strong>シナリオ 1:</strong></span> ユーザーテーブルの <code class="literal">Password</code> カラムが短い場合:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Password</code> カラムには短いハッシュのみ格納できます。
          </p></li><li class="listitem"><p>
            サーバーはクライアント認証中に短いハッシュのみ使用します。
          </p></li><li class="listitem"><p>
            接続対象のクライアントの場合、<code class="literal">PASSWORD()</code> 関数またはパスワード生成ステートメントを含むパスワードハッシュ生成操作では、短いハッシュだけが使用されます。アカウントのパスワードに何らかの変更を行うと、そのアカウントは短いパスワードハッシュを持つことになります。
          </p></li><li class="listitem"><p>
            <code class="literal">Password</code> カラムが短いと、サーバーは短いパスワードハッシュのみ生成するため、<code class="literal">old_passwords</code> の値は無関係です。
          </p></li></ul></div><p>
        このシナリオは、4.1 より前の MySQL インストールが 4.1 以降にアップグレードされたが、<span class="command"><strong>mysql_upgrade</strong></span> がまだ実行されておらず、<code class="literal">mysql</code> データベース内のシステムテーブルがアップグレードされていない場合に発生します。(これはよりセキュアな 4.1 のパスワードハッシュを使用できなくなるため、推奨される構成ではありません。)
      </p><p>
        <span class="bold"><strong>シナリオ 2:</strong></span> <code class="literal">Password</code> カラムが長く、サーバーは <code class="literal">old_passwords=1</code> を指定して起動される場合:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Password</code> カラムには短いハッシュまたは長いハッシュを格納できます。
          </p></li><li class="listitem"><p>
            4.1 以降のクライアントは、短いハッシュまたは長いハッシュを持つアカウントについて認証できます。
          </p></li><li class="listitem"><p>
            4.1 より前のクライアントは、短いハッシュを持つアカウントについてのみ認証できます。
          </p></li><li class="listitem"><p>
            接続対象のクライアントの場合、<code class="literal">PASSWORD()</code> 関数またはパスワード生成ステートメントを含むパスワードハッシュ生成操作では、短いハッシュだけが使用されます。アカウントのパスワードに何らかの変更を行うと、そのアカウントは短いパスワードハッシュを持つことになります。
          </p></li></ul></div><p>
        このシナリオでは、<code class="literal">old_passwords=1</code> によって長いハッシュを生成できないため、新しく作成されるアカウントは短いパスワードハッシュを持ちます。また、<code class="literal">old_passwords</code> を 1 に設定する前に長いハッシュを持つアカウントを作成した場合、<code class="literal">old_passwords=1</code> のときにアカウントのパスワードを変更すると、アカウントには短いパスワードが提供され、長いハッシュの持つセキュリティー上の利点を失うことになります。
      </p><p>
        長いパスワードハッシュを持つ新しいアカウントを作成するか、長いハッシュを使用するための既存のアカウントを変更するには、以前説明したように、まず <code class="literal">old_passwords</code> のセッション値を 0 に設定し、グローバル値を 1 に設定したままにします。
      </p><p>
        このシナリオでは、サーバーの <code class="literal">Password</code> カラムは最新状態ですが、サーバーは 4.1 より前のハッシュ値を生成するようにデフォルトのパスワードハッシュ方式を設定して実行されます。これは推奨される構成ではありませんが、4.1 より前のクライアントおよびパスワードが 4.1 以降にアップグレードされる移行期間に役立つことがあります。これが完了したら、<code class="literal">old_passwords=0</code> および <code class="literal">secure_auth=1</code> を指定してサーバーを実行することが推奨されます。
      </p><p>
        <span class="bold"><strong>シナリオ 3:</strong></span> <code class="literal">Password</code> カラムが長く、サーバーは <code class="literal">old_passwords=0</code> を指定して起動される場合:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Password</code> カラムには短いハッシュまたは長いハッシュを格納できます。
          </p></li><li class="listitem"><p>
            4.1 以降のクライアントは、短いハッシュまたは長いハッシュを持つアカウントを使用して認証できます。
          </p></li><li class="listitem"><p>
            4.1 より前のクライアントは、短いハッシュを持つアカウントを使用する場合のみ認証できます。
          </p></li><li class="listitem"><p>
            接続対象のクライアントの場合、<code class="literal">PASSWORD()</code> 関数またはパスワード生成ステートメントを含むパスワードハッシュ生成操作では、長いハッシュだけが使用されます。アカウントのパスワードに変更を行うと、そのアカウントは長いパスワードハッシュを持つことになります。
          </p></li></ul></div><p>
        以前示したように、このシナリオの危険性は、短いパスワードハッシュを持つアカウントが 4.1 より前のクライアントからアクセスできなくなることがあるということです。<code class="literal">PASSWORD()</code> 関数またはパスワード生成ステートメントを使用して実行したそのようなアカウントのパスワードの変更により、アカウントに長いパスワードハッシュが提供されることになります。その時点以降では、4.1 より前のクライアントはそのアカウントを使用してサーバーに接続できなくなります。クライアントは 4.1 以降にアップグレードする必要があります。
      </p><p>
        これが問題になる場合、特別な方法でパスワードを変更することができます。たとえば、通常、アカウントのパスワード変更には、<code class="literal">SET PASSWORD</code> を次のように使用しています。
      </p><pre class="programlisting">
SET PASSWORD FOR '<em class="replaceable"><code>some_user</code></em>'@'<em class="replaceable"><code>some_host</code></em>' = PASSWORD('mypass');
</pre><p>
        パスワードを変更するが、短いハッシュを作成する場合、代わりに <code class="literal">OLD_PASSWORD()</code> 関数を使用します。
      </p><pre class="programlisting">
SET PASSWORD FOR '<em class="replaceable"><code>some_user</code></em>'@'<em class="replaceable"><code>some_host</code></em>' = OLD_PASSWORD('mypass');
</pre><p>
        <code class="literal">OLD_PASSWORD()</code> は、短いハッシュを明示的に生成する必要があるような状況で役立ちます。
      </p><p>
        前の各シナリオの欠点は、次のように要約できます。
      </p><p>
        シナリオ 1 では、よりセキュアな認証を提供する長いハッシュを活用することができません。
      </p><p>
        シナリオ 2 では、<code class="literal">old_passwords=1</code> によって、短いパスワードを持つアカウントをアクセス不能にすることはできませんが、注意を払って <code class="literal">old_passwords</code> のセッション値を最初に 0 に変更しないかぎり、パスワード変更操作によって、長いハッシュを持つアカウントは短いハッシュに戻されます。
      </p><p>
        シナリオ 3 では、短いハッシュを使用するアカウントは <code class="literal">OLD_PASSWORD()</code> を明示的に使用せずにパスワードを変更した場合、4.1 より前のクライアントからアクセスできなくなります。
      </p><p>
        短いパスワードハッシュに関連する互換性の問題を回避するための最良の方法は、短いパスワードハッシュを使用しない方法です。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            すべてのクライアントプログラムを MySQL 4.1 以降にアップグレードする。
          </p></li><li class="listitem"><p>
            <code class="literal">old_passwords=0</code> を指定してサーバーを実行する。
          </p></li><li class="listitem"><p>
            長いパスワードハッシュを使用するために、短いパスワードハッシュを持つすべてのアカウントについてのパスワードをリセットする。
          </p></li><li class="listitem"><p>
            セキュリティーを強化するために、<code class="literal">secure_auth=1</code> を指定してサーバーを実行する。
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="application-password-use"></a>6.1.2.5 MySQL 4.1 でのパスワードハッシュ変更がアプリケーションプログラムに及ぼす影響</h4></div></div></div><p>
        アプリケーション固有の目的で <code class="literal">PASSWORD()</code> を使用してパスワードを生成するアプリケーションの場合、MySQL バージョン 4.1 以降にアップグレードすると互換性の問題が生じる可能性があります。<code class="literal">PASSWORD()</code> は MySQL アカウントのパスワード管理専用のものであるため、アプリケーションではこれを行うべきではありません。ただし、一部のアプリケーションではそれら固有の目的で <code class="literal">PASSWORD()</code> を使用しています。
      </p><p>
        4.1 より前の MySQL バージョンを 4.1 以降にアップグレードして、長いパスワードハッシュを生成する条件でサーバーを実行すると、アプリケーション固有のパスワード用に <code class="literal">PASSWORD()</code> を使用するアプリケーションは破損します。そのような状況で推奨される一連のアクションは、アプリケーションを変更して、ハッシュ値を生成する <code class="literal">SHA2()</code>、<code class="literal">SHA1()</code>、<code class="literal">MD5()</code> などの関数を使用するようにすることです。これが不可能な場合は、古い形式の短いハッシュを生成するために提供されている <code class="literal">OLD_PASSWORD()</code> 関数を使用することができます。ただし、<code class="literal">OLD_PASSWORD()</code> は将来サポートされなくなる可能性があることに留意してください。
      </p><p>
        サーバーが <code class="literal">old_passwords=1</code> を指定して実行している場合、サーバーは短いハッシュを生成し、<code class="literal">OLD_PASSWORD()</code> は <code class="literal">PASSWORD()</code> と同等になります。
      </p><p>
        MySQL データベースをバージョン 4.0 以前からバージョン 4.1 以降にマイグレーションを実行する PHP プログラマは、<a class="ulink" href="http://dev.mysql.com/doc/apis-php/en/index.html" target="_top">MySQL and PHP</a>を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="validate-password-plugin"></a>6.1.2.6 パスワード検証プラグイン</h4></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#validate-password-plugin-installation">6.1.2.6.1 パスワード検証プラグインのインストール</a></span></dt><dt><span class="section"><a href="security.html#validate-password-options-variables">6.1.2.6.2 パスワード検証プラグインのオプションおよび変数</a></span></dt></dl></div><a class="indexterm" name="idm139979123049648"></a><a class="indexterm" name="idm139979123048128"></a><p>
        <code class="literal">validate_password</code> プラグイン (MySQL 5.6.6 の時点で使用可能) は、パスワードをテストしてセキュリティーを向上させるために使用することができます。このプラグインは、2 つの機能を実装します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            平文の値として指定されるパスワードを割り当てるステートメントで、値は現在のパスワードポリシーと照合して検査され、弱い場合は拒否されます (ステートメントは <code class="literal">ER_NOT_VALID_PASSWORD</code> エラーを返します)。これは、<code class="literal">CREATE USER</code>、<code class="literal">GRANT</code>、および <code class="literal">SET PASSWORD</code> ステートメントに影響します。<code class="literal">PASSWORD()</code> および <code class="literal">OLD_PASSWORD()</code> 関数への引数として指定されるパスワードも検査されます。
          </p></li><li class="listitem"><p>
            パスワード候補の強さは、<code class="literal">VALIDATE_PASSWORD_STRENGTH()</code> SQL 関数を使用して評価でき、これはパスワード引数を取得して、0 (弱い) から 100 (強い) までの整数を返します。
          </p></li></ul></div><p>
        たとえば、次のステートメントの平文パスワードが検査されます。デフォルトのパスワードポリシーではパスワードに最低 8 文字の長さが要求されるため、パスワードが弱いことからステートメントはエラーを生成します。
      </p><a class="indexterm" name="idm139979123034160"></a><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET PASSWORD = PASSWORD('abc');</code></strong>
ERROR 1819 (HY000): Your password does not satisfy the current policy
requirements
</pre><p>
        ハッシュ済みの値として指定されたパスワードは、元のパスワード値が得られないため検査されません。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET PASSWORD = '*0D3CED9BEC10A777AEC23CCC353A8C08A633045E';</code></strong>
Query OK, 0 rows affected (0.01 sec)
</pre><p>
        パスワード検査を制御するパラメータは、<code class="literal">validate_password_<em class="replaceable"><code>xxx</code></em></code> の形式の名前を持つシステム変数の値として利用できます。これらの変数を変更してパスワード検査を構成することができます。<a class="xref" href="security.html#validate-password-options-variables" title="6.1.2.6.2 パスワード検証プラグインのオプションおよび変数">セクション6.1.2.6.2「パスワード検証プラグインのオプションおよび変数」</a>を参照してください。
      </p><p>
        パスワード検査の 3 つのレベルは、<code class="literal">LOW</code>、<code class="literal">MEDIUM</code>、および <code class="literal">STRONG</code> です。デフォルトは <code class="literal">MEDIUM</code> で、これを変更するには、<code class="literal">validate_password_policy</code> の値を変更します。これらのポリシーにより、実装されるパスワードテストはますます厳密になります。次の記述はデフォルトのパラメータ値を示しており、これらは適切なシステム変数を変更することによって変更できます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">LOW</code> ポリシーは、パスワードの長さのみテストします。パスワードは少なくとも 8 文字の長さでなければなりません。
          </p></li><li class="listitem"><p>
            <code class="literal">MEDIUM</code> ポリシーは、パスワードが最低 1 つの数値文字を含み、1 つの小文字および大文字を含み、1 つの特殊文字 (英数字以外) を含む必要があるという条件を追加します。
          </p></li><li class="listitem"><p>
            <code class="literal">STRONG</code> ポリシーは、パスワードの 4 文字以上の部分文字列が、(辞書ファイルが指定された場合に) 辞書ファイル内の単語と一致してはならないという条件を追加します。
          </p></li></ul></div><p>
        <code class="literal">validate_password</code> プラグインがインストールされていない場合、<code class="literal">validate_password_<em class="replaceable"><code>xxx</code></em></code> システム変数は利用できず、ステートメント内のパスワードは検査されず、<code class="literal">VALIDATE_PASSWORD_STRENGTH()</code> は常に 0 を返します。たとえば、アカウントに 8 文字より短いパスワードを割り当てることができます。
      </p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="validate-password-plugin-installation"></a>6.1.2.6.1 パスワード検証プラグインのインストール</h5></div></div></div><a class="indexterm" name="idm139979123009616"></a><p>
          パスワード検証プラグインの名前は <code class="literal">validate_password</code> です。サーバーから使用できるようにするには、プラグインライブラリのオブジェクトファイルが MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数によって指定されたディレクトリ) に存在する必要があります。必要に応じて、サーバーの起動時に、プラグインディレクトリの場所をサーバーに指示する <code class="literal">plugin_dir</code> の値を設定します。
        </p><p>
          サーバー起動時にプラグインをロードするには、<code class="option">--plugin-load</code> オプションを使用して、プラグインを格納するオブジェクトファイルの名前を指定します。このプラグインのロード方式では、サーバーを起動するたびにオプションを指定する必要があります。たとえば、<code class="filename">my.cnf</code> ファイルに次の行を入力します。
        </p><pre class="programlisting">
[mysqld]
plugin-load=validate_password.so
</pre><p>
          システム上のオブジェクトファイルのサフィクスが <code class="filename">.so</code> とは異なる場合、正しいサフィクスに置き換えてください (たとえば Windows の場合は <code class="filename">.dll</code>)。
        </p><p>
          または、プラグインを実行時に登録するには (必要に応じて拡張子を変更して) 次のステートメントを使用します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN validate_password SONAME 'validate_password.so';</code></strong>
</pre><p>
          <code class="literal">INSTALL PLUGIN</code> は、プラグインをロードします。また、後続の通常のサーバー起動のたびにプラグインがロードされるように、そのプラグインを <code class="literal">mysql.plugins</code> テーブルに登録します。
        </p><p>
          プラグインが <code class="literal">INSTALL PLUGIN</code> によって以前登録されているか、<code class="option">--plugin-load</code> を指定してロードされた場合、<code class="option">--validate-password</code> オプションをサーバー起動時に使用して、プラグインの有効化を制御できます。たとえば、プラグインをロードして、実行時に削除されないようにするには、次のオプションを使用します。
        </p><pre class="programlisting">
[mysqld]
plugin-load=validate_password.so
validate-password=FORCE_PLUS_PERMANENT
</pre><p>
          パスワード検証プラグインを使用せずにサーバーが実行することを回避することが望まれる場合、<code class="option">--validate-password</code> に <code class="literal">FORCE</code> または <code class="literal">FORCE_PLUS_PERMANENT</code> の値を指定して使用することで、プラグインが正常に初期化しない場合にサーバー起動を強制的に失敗させるようにします。
        </p><p>
          プラグインのインストールについての一般的な情報は、<a class="xref" href="server-administration.html#server-plugins" title="5.1.8 サーバープラグイン">セクション5.1.8「サーバープラグイン」</a>を参照してください。プラグインのインストールを検証するには、<code class="literal">INFORMATION_SCHEMA.PLUGINS</code> テーブルを調査するか、<code class="literal">SHOW PLUGINS</code> ステートメントを使用します。<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.1.8.2 サーバープラグイン情報の取得">セクション5.1.8.2「サーバープラグイン情報の取得」</a>を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="validate-password-options-variables"></a>6.1.2.6.2 パスワード検証プラグインのオプションおよび変数</h5></div></div></div><a class="indexterm" name="idm139979122980496"></a><a class="indexterm" name="idm139979122979056"></a><a class="indexterm" name="idm139979122976944"></a><p>
          <code class="literal">validate_password</code> プラグインの有効化を制御するには、次のオプションを使用します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_validate-password"></a>
              <a class="indexterm" name="idm139979122972384"></a> <a class="indexterm" name="idm139979122970224"></a> <code class="option">--validate-password[=<em class="replaceable"><code>value</code></em>]</code>
            </p><div class="informaltable"><table summary="Options for validate-password" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>コマンド行形式</strong></span></td><td colspan="3"><code class="literal">--validate-password[=value]</code></td></tr><tr><td scope="row" rowspan="6"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">列挙</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" rowspan="4" valign="top"><span class="bold"><strong>有効な値</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">FORCE</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">FORCE_PLUS_PERMANENT</code></td></tr></tbody></table></div><p>
              このオプションは、サーバーが起動時に <code class="literal">validate_password</code> プラグインをロードする方法を制御します。値は<a class="xref" href="server-administration.html#server-plugin-loading" title="5.1.8.1 プラグインのインストールおよびアンインストール">セクション5.1.8.1「プラグインのインストールおよびアンインストール」</a>に記載されているような、プラグインロードオプション用に指定可能ないずれかの値とする必要があります。たとえば、<code class="option">--validate-password=FORCE_PLUS_PERMANENT</code> の場合、プラグインをロードし、サーバーの実行中にプラグインが削除されないようにするようサーバーに指示します。
            </p><p>
              このオプションは、<code class="literal">validate_password</code> プラグインが <code class="literal">INSTALL PLUGIN</code> で以前登録されていたか、<code class="option">--plugin-load</code> でロードされている場合にのみ利用できます。<a class="xref" href="security.html#validate-password-plugin-installation" title="6.1.2.6.1 パスワード検証プラグインのインストール">セクション6.1.2.6.1「パスワード検証プラグインのインストール」</a>を参照してください。
            </p></li></ul></div><p>
          <code class="literal">validate_password</code> プラグインがインストールされている場合、パスワード検査を制御するパラメータを示すいくつかのシステム変数を公開します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'validate_password%';</code></strong>
+--------------------------------------+--------+
| Variable_name                        | Value  |
+--------------------------------------+--------+
| validate_password_dictionary_file    |        |
| validate_password_length             | 8      |
| validate_password_mixed_case_count   | 1      |
| validate_password_number_count       | 1      |
| validate_password_policy             | MEDIUM |
| validate_password_special_char_count | 1      |
+--------------------------------------+--------+
</pre><p>
          パスワードの検査方法を変更するために、これらの変数はいずれもサーバー起動時に設定でき、これらのほとんどは実行時にも設定できます。次のリストは、各変数の意味を説明したものです。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_validate_password_dictionary_file"></a>
              <a class="indexterm" name="idm139979122933520"></a> <a class="indexterm" name="idm139979122931920"></a> <code class="literal">validate_password_dictionary_file</code>
            </p><div class="informaltable"><table summary="Options for validate_password_dictionary_file" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_dictionary_file">validate_password_dictionary_file</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">いいえ</td></tr><tr><td scope="row"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">ファイル名</code></td></tr></tbody></table></div><p>
              パスワードを検査するために <code class="literal">validate_password</code> プラグインによって使用される辞書ファイルのパス名。この変数は、そのプラグインがインストールされないかぎり利用できません。
            </p><p>
              デフォルトでは、この変数は空の値を持ち、辞書検査は実行されません。辞書検査を有効にするには、この変数を空白でない値に設定する必要があります。ファイル名が相対パスとして指定された場合、サーバーのデータディレクトリを基準として解釈されます。この内容は小文字で記載し、1 行に 1 つの単語としてください。内容は、<code class="literal">utf8</code> の文字セットを持つものとして処理されます。許可される最大のファイルサイズは 1M バイトです。
            </p><p>
              パスワード検査中に辞書ファイルが使用されるようにするには、パスワードポリシーを 2 (<code class="literal">STRONG</code>) に設定する必要があります。<code class="literal">validate_password_policy</code> システム変数の説明を参照してください。これが true である場合、長さが 4 から 100 までのパスワードの各部分文字列が辞書ファイル内の単語と比較されます。いずれかが一致すると、パスワードが拒否されます。比較では大文字と小文字が区別されません。
            </p><p>
              <code class="literal">VALIDATE_PASSWORD_STRENGTH()</code> の場合、パスワードは <code class="literal">STRONG</code> を含むすべてのポリシーと照合して検査されるため、強さの評価には <code class="literal">validate_password_policy</code> 値に関係なく辞書検査が含まれます。
            </p><p>
              サーバーが実行中に辞書ファイルに変更を行なった場合、変更を認識させるにはサーバーの再起動が必要です。
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_length"></a>
              <a class="indexterm" name="idm139979122900480"></a> <a class="indexterm" name="idm139979122898928"></a> <code class="literal">validate_password_length</code>
            </p><div class="informaltable"><table summary="Options for validate_password_length" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_length">validate_password_length</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">はい</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">数値</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">8</code></td></tr><tr><td scope="row"><span class="bold"><strong>最小値</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table></div><p>
              <code class="literal">validate_password</code> プラグインによって検査されるパスワードに必要な最小の文字数。この変数は、そのプラグインがインストールされないかぎり利用できません。
            </p><p>
              <code class="literal">validate_password_length</code> の最小値は、関連するほかのいくつかのシステム変数の関数です。MySQL 5.6.10 の時点では、サーバーでは次の式の値より小さい値は設定されません。
            </p><pre class="programlisting">
validate_password_number_count
+ validate_password_special_char_count
+ (2 * validate_password_mixed_case_count)
</pre><p>
              前述の制約のため <code class="literal">validate_password</code> プラグインが <code class="literal">validate_password_length</code> の値を調整した場合、プラグインはエラーログファイルにメッセージを書き込みます。
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_mixed_case_count"></a>
              <a class="indexterm" name="idm139979122867312"></a> <a class="indexterm" name="idm139979122865712"></a> <code class="literal">validate_password_mixed_case_count</code>
            </p><div class="informaltable"><table summary="Options for validate_password_mixed_case_count" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_mixed_case_count">validate_password_mixed_case_count</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">はい</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">数値</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>最小値</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table></div><p>
              パスワードポリシーが <code class="literal">MEDIUM</code> またはそれより強い場合、<code class="literal">validate_password</code> プラグインによって検査されるパスワードに必要な小文字および大文字の最大数。この変数は、そのプラグインがインストールされないかぎり利用できません。
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_number_count"></a>
              <a class="indexterm" name="idm139979122838160"></a> <a class="indexterm" name="idm139979122836688"></a> <code class="literal">validate_password_number_count</code>
            </p><div class="informaltable"><table summary="Options for validate_password_number_count" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_number_count">validate_password_number_count</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">はい</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">数値</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>最小値</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table></div><p>
              パスワードポリシーが <code class="literal">MEDIUM</code> またはそれより強い場合、<code class="literal">validate_password</code> プラグインによって検査されるパスワードに必要な数値文字 (数字) の最大数。この変数は、そのプラグインがインストールされないかぎり利用できません。
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_policy"></a>
              <a class="indexterm" name="idm139979122809136"></a> <a class="indexterm" name="idm139979122807584"></a> <code class="literal">validate_password_policy</code>
            </p><div class="informaltable"><table summary="Options for validate_password_policy" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_policy">validate_password_policy</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">はい</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">列挙</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>有効な値</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr></tbody></table></div><p>
              <code class="literal">validate_password</code> プラグインによって適用されるパスワードポリシー。この変数は、そのプラグインがインストールされないかぎり利用できません。
            </p><p>
              <code class="literal">validate_password_policy</code> 値は、数値 0、1、2 または対応する記号値 <code class="literal">LOW</code>、<code class="literal">MEDIUM</code>、<code class="literal">STRONG</code> を使用して指定できます。次の表では、それぞれのポリシーに対して実施されるテストについて説明します。長さテストの場合、必要な長さは <code class="literal">validate_password_length</code> システム変数の値です。同様に、ほかのテストについて必要な値は、ほかの <code class="literal">validate_password_<em class="replaceable"><code>xxx</code></em></code> 変数によって提供されます。
            </p><div class="informaltable"><table summary="この表は、validate_password プラグインによって適用されるパスワードポリシーを一覧で示し、それぞれのポリシーに対して実施されるテストについて説明します。" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">ポリシー</th><th scope="col">実施されるテスト</th></tr></thead><tbody><tr><td scope="row"><code class="literal">0</code> または <code class="literal">LOW</code></td><td>長さ</td></tr><tr><td scope="row"><code class="literal">1</code> または <code class="literal">MEDIUM</code></td><td>長さ。数値、小文字、大文字、および特殊文字</td></tr><tr><td scope="row"><code class="literal">2</code> または <code class="literal">STRONG</code></td><td>長さ。数値、小文字、大文字、および特殊文字。辞書ファイル</td></tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                MySQL 5.6.10 以前では、<code class="literal">validate_password_policy</code> の名前は <code class="literal">validate_password_policy_number</code> でした。
              </p></div></li><li class="listitem"><p><a name="sysvar_validate_password_special_char_count"></a>
              <a class="indexterm" name="idm139979122756208"></a> <a class="indexterm" name="idm139979122754608"></a> <code class="literal">validate_password_special_char_count</code>
            </p><div class="informaltable"><table summary="Options for validate_password_special_char_count" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_special_char_count">validate_password_special_char_count</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">はい</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">数値</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>最小値</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table></div><p>
              パスワードポリシーが <code class="literal">MEDIUM</code> またはそれより強い場合、<code class="literal">validate_password</code> プラグインによって検査されるパスワードに必要な英数字以外の文字の最大数。この変数は、そのプラグインがインストールされないかぎり利用できません。
            </p></li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-against-attack"></a>6.1.3 攻撃者に対する MySQL のセキュアな状態の維持</h3></div></div></div><a class="indexterm" name="idm139979122726416"></a><a class="indexterm" name="idm139979122724304"></a><a class="indexterm" name="idm139979122722256"></a><a class="indexterm" name="idm139979122721024"></a><a class="indexterm" name="idm139979122719696"></a><p>
      MySQL サーバーに接続するときは、パスワードを使用するようにしてください。接続において、パスワードは平文で送信されません。クライアント接続シーケンス中のパスワード処理は、きわめてセキュアな状態を維持するように MySQL 4.1.1 でアップグレードされました。4.1.1 より前の形式のパスワードをまだ使用している場合、暗号化アルゴリズムは新しいアルゴリズムほど強くありません。クライアントとサーバーの間のトラフィックを傍受できる利口な攻撃者は、多少の労力をかければパスワードを解読することができます。(さまざまなパスワード処理方法についての説明は、<a class="xref" href="security.html#password-hashing" title="6.1.2.4 MySQL でのパスワードハッシュ">セクション6.1.2.4「MySQL でのパスワードハッシュ」</a>を参照してください。)
    </p><p>
      ほかのすべての情報はテキストとして送信され、接続を観察できるすべてのユーザーによって読み取ることができます。クライアントとサーバーの間の接続が、信頼できないネットワークを介して行われ、そのことに不安がある場合、圧縮されたプロトコルを使用して、トラフィックの解読をさらに困難にすることができます。また、MySQL の内部 SSL サポートを使用して、接続をさらにセキュアな状態にすることもできます。<a class="xref" href="security.html#ssl-connections" title="6.3.10 セキュアな接続のための SSL の使用">セクション6.3.10「セキュアな接続のための SSL の使用」</a>を参照してください。または SSH を使用して、MySQL サーバーと MySQL クライアントの間で暗号化された TCP/IP 接続を実現します。オープンソース SSH クライアントは <a class="ulink" href="http://www.openssh.org/" target="_top">http://www.openssh.org/</a> から見つけることができ、オープンソースと商用の SSH クライアントの比較は <a class="ulink" href="http://en.wikipedia.org/wiki/Comparison_of_SSH_clients" target="_top">http://en.wikipedia.org/wiki/Comparison_of_SSH_clients</a> にあります。
    </p><p>
      MySQL システムをセキュアな状態にするには、次の推奨事項についてよく検討するようにしてください。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          すべての MySQL アカウントがパスワードを持つことを要求します。クライアントプログラムは、それを実行中の人物の ID を必ずしも認識しているわけではありません。クライアント/サーバーアプリケーションでは、ユーザーがクライアントプログラムに任意のユーザー名を指定できることが一般的です。たとえば、<em class="replaceable"><code>other_user</code></em> にパスワードがない場合、<span class="command"><strong>mysql</strong></span> プログラムを <code class="literal">mysql -u <em class="replaceable"><code>other_user</code></em> <em class="replaceable"><code>db_name</code></em></code> として呼び出すことによって、すべてのユーザーがこのプログラムを使用してほかのユーザーとして接続することができます。すべてのアカウントにパスワードがある場合、ほかのユーザーのアカウントを使用した接続は、もっと難しくなります。
        </p><p>
          パスワードの設定方法についての説明は、<a class="xref" href="security.html#assigning-passwords" title="6.3.5 アカウントパスワードの割り当て">セクション6.3.5「アカウントパスワードの割り当て」</a>を参照してください。
        </p></li><li class="listitem"><p>
          データベースディレクトリ内の読み取りまたは書き込み権限を持つ Unix ユーザーアカウントのみが、<span class="command"><strong>mysqld</strong></span> の実行に使用されるアカウントであるようにしてください。
        </p></li><li class="listitem"><p>
          MySQL サーバーを Unix <code class="literal">root</code> ユーザーとして絶対に実行しないでください。これを行うと、<code class="literal">FILE</code> 権限を持つすべてのユーザーが、<code class="literal">root</code> としてサーバーにファイルを作成させることができるため (<code class="literal">~root/.bashrc</code> など)、非常に危険です。これを防ぐために、<span class="command"><strong>mysqld</strong></span> は <code class="option">--user=root</code> オプションを使用して明示的に指定された場合を除き、<code class="literal">root</code> として実行することを拒否します。
        </p><p>
          <span class="command"><strong>mysqld</strong></span> は、権限のない普通のユーザーとしても実行できます (また、そのように実行するべきです)。<code class="literal">mysql</code> という名前の別の Unix アカウントを作成して、すべてをさらにセキュアな状態にすることができます。このアカウントは、MySQL の管理にのみ使用してください。<span class="command"><strong>mysqld</strong></span> を別の Unix ユーザーとして開始するには、サーバーオプションを指定した <code class="filename">my.cnf</code> オプションファイルの <code class="literal">[mysqld]</code> グループ内のユーザー名を指定する <code class="literal">user</code> オプションを追加します。例:
        </p><pre class="programlisting">
[mysqld]
user=mysql
</pre><p>
          これにより、サーバーを手動で起動した場合も、<span class="command"><strong>mysqld_safe</strong></span> または <span class="command"><strong>mysql.server</strong></span> を使用して起動した場合も、指定のユーザーでサーバーが起動します。詳細は、<a class="xref" href="security.html#changing-mysql-user" title="6.1.5 MySQL を通常ユーザーとして実行する方法">セクション6.1.5「MySQL を通常ユーザーとして実行する方法」</a>を参照してください。
        </p><p>
          <code class="literal">root</code> 以外の Unix ユーザーとして <span class="command"><strong>mysqld</strong></span> を実行しても、<code class="literal">user</code> テーブル内の <code class="literal">root</code> ユーザー名を変更する必要があるということを意味するわけではありません。<span class="emphasis"><em>MySQL アカウントのユーザー名は、Unix アカウントのユーザー名とは何の関係もありません</em></span>。
        </p></li><li class="listitem"><p>
          管理者以外のユーザーに <code class="literal">FILE</code> 権限を付与しないでください。この権限を持つすべてのユーザーは、<span class="command"><strong>mysqld</strong></span> デーモンの権限で、ファイルシステムのあらゆる場所のファイルに書き込むことができます。これは、権限テーブルを実装するファイルを格納するサーバーのデータディレクトリを含みます。<code class="literal">FILE</code> 権限の操作をもう少し安全にするために、<code class="literal">SELECT ... INTO OUTFILE</code> で生成されたファイルは既存のファイルを上書きせず、すべてのユーザーによって書き込み可能になります。
        </p><a class="indexterm" name="idm139979122677264"></a><p>
          <code class="literal">FILE</code> 権限は、すべてのユーザーが読み取り可能であるか、サーバーを実行している Unix ユーザーがアクセスできる、すべてのファイルを読み取る場合にも使用できます。この権限を使用して、すべてのファイルをデータベーステーブルに読み取ることができます。これは不正使用される可能性があり、たとえば <code class="literal">LOAD DATA</code> を使用して <code class="filename">/etc/passwd</code> をテーブルにロードし、次に <code class="literal">SELECT</code> を使用してこれを表示することができます。
        </p><p>
          ファイルを読み取りおよび書き込みできる場所を制限するには、<code class="literal">secure_file_priv</code> システムを特定のディレクトリに設定します。<a class="xref" href="server-administration.html#server-system-variables" title="5.1.4 サーバーシステム変数">セクション5.1.4「サーバーシステム変数」</a>を参照してください。
        </p></li><li class="listitem"><p>
          管理者以外のユーザーに <code class="literal">PROCESS</code> または <code class="literal">SUPER</code> 権限を付与しないでください。<span class="command"><strong>mysqladmin processlist</strong></span> および <code class="literal">SHOW PROCESSLIST</code> の出力には、現在実行されているすべてのステートメントのテキストが表示されるため、サーバープロセスリストを表示できるすべてのユーザーが、ほかのユーザーによって発行された <code class="literal">UPDATE user SET password=PASSWORD('not_secure')</code> などのステートメントを表示できる場合があります。
        </p><p>
          <span class="command"><strong>mysqld</strong></span> は、<code class="literal">SUPER</code> 権限を持つユーザー用に特別な接続を確保しているため、通常の接続がすべて使用中の場合でも、MySQL <code class="literal">root</code> ユーザーはログインしてサーバーのアクティビティーを検査することができます。
        </p><p>
          <code class="literal">SUPER</code> 権限は、クライアント接続を終了したり、システム変数の値を変更することによってサーバー操作を変更したり、レプリケーションサーバーを制御したりするために使用することができます。
        </p></li><li class="listitem"><p>
          テーブルへのシンボリックリンクを許可しないでください。(この機能は <code class="option">--skip-symbolic-links</code> オプションで無効にできます。)このことは、<span class="command"><strong>mysqld</strong></span> を <code class="literal">root</code> として実行する場合に特に重要です。これは、サーバーのデータディレクトリへの書き込みアクセス権限があるすべてのユーザーは、システムのすべてのファイルを削除できることになるためです。<a class="xref" href="optimization.html#symbolic-links-to-tables" title="8.11.3.1.2 Unix 上の MyISAM へのシンボリックリンクの使用">セクション8.11.3.1.2「Unix 上の MyISAM へのシンボリックリンクの使用」</a>を参照してください。
        </p></li><li class="listitem"><p>
          ストアドプログラムおよびビューは、<a class="xref" href="stored-programs-views.html#stored-programs-security" title="20.6 ストアドプログラムおよびビューのアクセスコントロール">セクション20.6「ストアドプログラムおよびビューのアクセスコントロール」</a>に記載されているセキュリティーガイドラインを使用して記述するようにしてください。
        </p></li><li class="listitem"><p>
          DNS を信頼していない場合、付与テーブル内でホスト名の代わりに IP アドレスを使用するようにしてください。いずれの場合も、ワイルドカードを含むホスト名の値を使用して付与テーブルエントリを作成することについては、十分に注意するようにしてください。
        </p></li><li class="listitem"><p>
          単一アカウントに対して許可される接続数を制限するには、<span class="command"><strong>mysqld</strong></span> の <code class="literal">max_user_connections</code> 変数を設定することによってこれを実行できます。<code class="literal">GRANT</code> ステートメントは、アカウントに対して許可されるサーバー使用の範囲を制限するためのリソース制御オプションもサポートします。<a class="xref" href="sql-syntax.html#grant" title="13.7.1.4 GRANT 構文">セクション13.7.1.4「GRANT 構文」</a>を参照してください。
        </p></li><li class="listitem"><p>
          プラグインディレクトリがサーバーによって書き込み可能な場合、ユーザーは <code class="literal">SELECT ... INTO DUMPFILE</code> を使用して、ディレクトリ内のファイルに実行可能コードを書き込むことができます。これを防ぐために、<code class="literal">plugin_dir</code> をサーバーに対して読み取り専用にしたり、<code class="literal">SELECT</code> 書き込みが安全に実行できるディレクトリに <code class="option">--secure-file-priv</code> を設定したりできます。
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-options"></a>6.1.4 セキュリティー関連の mysqld オプションおよび変数</h3></div></div></div><p>
      次の表は、セキュリティーに影響する <span class="command"><strong>mysqld</strong></span> オプションおよびシステム変数を示します。これらの個別の説明は、<a class="xref" href="server-administration.html#server-options" title="5.1.3 サーバーコマンドオプション">セクション5.1.3「サーバーコマンドオプション」</a>および<a class="xref" href="server-administration.html#server-system-variables" title="5.1.4 サーバーシステム変数">セクション5.1.4「サーバーシステム変数」</a>を参照してください。
    </p><div class="table"><a name="idm139979122634560"></a><p class="title"><b>表 6.1 セキュリティーオプションと変数のサマリー</b></p><div class="table-contents"><table summary="セキュリティーオプションと変数のサマリー" border="1"><colgroup><col class="name"><col class="cmd-line"><col class="option_file"><col class="system_var"><col class="status_var"><col class="var_scope"><col class="dynamic"></colgroup><thead><tr><th scope="col">名前</th><th scope="col">コマンド行</th><th scope="col">オプションファイル</th><th scope="col">システム変数</th><th scope="col">ステータス変数</th><th scope="col">変数スコープ</th><th scope="col">動的</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_allow-suspicious-udfs">allow-suspicious-udfs</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_automatic_sp_privileges">automatic_sp_privileges</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>はい</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_chroot">chroot</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_des-key-file">des-key-file</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_local_infile">local_infile</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>はい</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_old_passwords">old_passwords</a></td><td> </td><td> </td><td>はい</td><td> </td><td>両方</td><td>はい</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_safe-user-create">safe-user-create</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_secure-auth">secure-auth</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td>グローバル</td><td>はい</td></tr><tr><td scope="row"> - <span class="emphasis"><em>変数</em></span>: <a class="link" href="server-administration.html#sysvar_secure_auth">secure_auth</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>はい</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_secure-file-priv">secure-file-priv</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"> - <span class="emphasis"><em>変数</em></span>: <a class="link" href="server-administration.html#sysvar_secure_file_priv">secure_file_priv</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-grant-tables">skip-grant-tables</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-name-resolve">skip-name-resolve</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"> - <span class="emphasis"><em>変数</em></span>: <a class="link" href="server-administration.html#sysvar_skip_name_resolve">skip_name_resolve</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-networking">skip-networking</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"> - <span class="emphasis"><em>変数</em></span>: <a class="link" href="server-administration.html#sysvar_skip_networking">skip_networking</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-show-database">skip-show-database</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"> - <span class="emphasis"><em>変数</em></span>: <a class="link" href="server-administration.html#sysvar_skip_show_database">skip_show_database</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="changing-mysql-user"></a>6.1.5 MySQL を通常ユーザーとして実行する方法</h3></div></div></div><a class="indexterm" name="idm139979122564304"></a><a class="indexterm" name="idm139979122562304"></a><p>
      Windows 上では、通常のユーザーアカウントを使用して Windows サービスとしてサーバーを実行できます。
    </p><p>
      Unix では、MySQL サーバー <span class="command"><strong>mysqld</strong></span> を起動でき、すべてのユーザーが実行できます。しかし、セキュリティー上の理由から、Unix <code class="literal">root</code> ユーザーとしてサーバーを実行することは避けてください。<span class="command"><strong>mysqld</strong></span> を変更し、権限のない普通の Unix ユーザー <em class="replaceable"><code>user_name</code></em> として実行するには、次のことを行う必要があります。
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          サーバーが稼働していれば、サーバーを停止します (<span class="command"><strong>mysqladmin shutdown</strong></span> を使用します)。
        </p></li><li class="listitem"><p>
          データベースディレクトリとファイルを変更して、<em class="replaceable"><code>user_name</code></em> がそこのファイルの読み取りおよび書き込みを行う権限を与えます (この操作は Unix <code class="literal">root</code> ユーザーとして行う必要があります)。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>chown -R <em class="replaceable"><code>user_name</code></em> <em class="replaceable"><code>/path/to/mysql/datadir</code></em></code></strong>
</pre><p>
          この操作を行わない場合、サーバーは <em class="replaceable"><code>user_name</code></em> として実行するとき、データベースまたはテーブルにアクセスできません。
        </p><p>
          MySQL データディレクトリ内のディレクトリまたはファイルがシンボリックリンクの場合、<code class="literal">chown -R</code> がシンボリックリンク先を参照しないことがあります。参照しない場合、それらのリンクを参照し、指定先のディレクトリおよびファイルを変更する必要もあります。
        </p></li><li class="listitem"><p>
          <em class="replaceable"><code>user_name</code></em> というユーザーでサーバーを起動します。代わりに、Unix <code class="literal">root</code> ユーザーとして <code class="option">--user=<em class="replaceable"><code>user_name</code></em></code> オプションを使用して <span class="command"><strong>mysqld</strong></span> を起動する方法もあります。<span class="command"><strong>mysqld</strong></span> が起動すると、接続を受け入れる前に Unix ユーザー <em class="replaceable"><code>user_name</code></em> としての実行に切り替わります。
        </p></li><li class="listitem"><p>
          システム起動時に指定されたユーザーとしてサーバーを起動するには、<code class="filename">/etc/my.cnf</code> オプションファイルまたはサーバーのデータディレクトリに格納されている <code class="filename">my.cnf</code> オプションファイルの <code class="literal">[mysqld]</code> グループに、<code class="literal">user</code> オプションを追加することによってユーザー名を指定します。例:
        </p><pre class="programlisting">
[mysqld]
user=<em class="replaceable"><code>user_name</code></em>
</pre></li></ol></div><p>
      Unix マシン自体がセキュアな状態でない場合、付与テーブルの MySQL <code class="literal">root</code> アカウントにパスワードを割り当てるようにします。これをしないと、そのマシンのログインアカウントを持つすべてのユーザーが、<code class="option">--user=root</code> オプションを使用して <span class="command"><strong>mysql</strong></span> クライアントを実行でき、あらゆる操作を行うことができます。(すべての場合に MySQL アカウントにパスワードを割り当てることはよい考えですが、ほかのログインアカウントがサーバーホスト上に存在する場合は特に重要です。)<a class="xref" href="installing.html#default-privileges" title="2.10.2 最初の MySQL アカウントのセキュリティー設定">セクション2.10.2「最初の MySQL アカウントのセキュリティー設定」</a>を参照してください。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="load-data-local"></a>6.1.6 LOAD DATA LOCAL のセキュリティーの問題</h3></div></div></div><p>
      <code class="literal">LOAD DATA</code> ステートメントは、サーバーホストに配置されているファイルをロードしたり、<code class="literal">LOCAL</code> キーワードが指定された場合に、クライアントホストに配置されているファイルをロードしたりできます。
    </p><p>
      <code class="literal">LOAD DATA</code> ステートメントの <code class="literal">LOCAL</code> バージョンのサポートに関しては、セキュリティーについての潜在的な問題が 2 つあります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          クライアントホストからサーバーホストへのファイルの送信は、MySQL サーバーによって開始されます。理論的には、パッチ適用済みサーバーを構築して、<code class="literal">LOAD DATA</code> ステートメントでクライアントによって指定されたファイルでなく、サーバーが選択するファイルを転送するようサーバーがクライアントプログラムに指示するようにすることができます。そのようなサーバーは、クライアントユーザーが読み取りアクセス権を持つクライアントホスト上のすべてのファイルにアクセスできます。
        </p></li><li class="listitem"><p>
          クライアントが Web サーバーから接続する Web 環境で、ユーザーは <code class="literal">LOAD DATA LOCAL</code> を使用して、Web サーバープロセスが読み取りアクセス権を持つすべてのファイルを読み取ることができます (ユーザーが SQL Server に対してあらゆるコマンドを実行できる場合)。この環境では、MySQL サーバーを基準にしたときのクライアントは実際には Web サーバーであって、Web サーバーに接続するユーザーによって実行されているリモートプログラムではありません。
        </p></li></ul></div><p>
      これらの問題に対処するために、MySQL 3.23.49 と MySQL 4.0.2 (Windows では 4.0.13) 以降で <code class="literal">LOAD DATA LOCAL</code> の処理方法が変更されました。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          デフォルトでは、バイナリ配布内のすべての MySQL クライアントおよびライブラリは <code class="option">-DENABLED_LOCAL_INFILE=1</code> オプションでコンパイルされ、MySQL 3.23.48 以前との互換性が保持されています。
        </p></li><li class="listitem"><p>
          MySQL をソースからビルドしたが、<code class="option">-DENABLED_LOCAL_INFILE=1</code> オプションを指定して <span class="command"><strong>CMake</strong></span> を呼び出さない場合、<code class="literal">LOAD DATA LOCAL</code> は <code class="literal">mysql_options(... MYSQL_OPT_LOCAL_INFILE, 0)</code> を呼び出すように明示的に記述される場合を除いて、いずれのクライアントからも使用できません。<a class="xref" href="connectors-apis.html#mysql-options" title="23.8.7.49 mysql_options()">セクション23.8.7.49「mysql_options()」</a>を参照してください。
        </p></li><li class="listitem"><p>
          <code class="literal">--local-infile=0</code> オプションを指定して <span class="command"><strong>mysqld</strong></span> を起動することによって、サーバー側からのすべての <code class="literal">LOAD DATA LOCAL</code> ステートメントを無効にすることができます。
        </p></li><li class="listitem"><p>
          <span class="command"><strong>mysql</strong></span> コマンド行クライアントの場合、<code class="option">--local-infile[=1]</code> オプションを指定することによって <code class="literal">LOAD DATA LOCAL</code> を有効にするか、<code class="option">--local-infile=0</code> オプションを指定することによってこれを無効にします。<span class="command"><strong>mysqlimport</strong></span> の場合、ローカルデータファイルのロードはデフォルトでオフになっており、<code class="option">--local</code> または <code class="option">-L</code> オプションを使用してこれを有効にします。いずれの場合でも、ローカルロード操作を正常に使用するには、サーバーがこの操作を許可していることが必要。
        </p></li><li class="listitem"><p>
          オプションファイルから <code class="literal">[client]</code> グループを読み取る Perl スクリプトまたはその他のプログラムで <code class="literal">LOAD DATA LOCAL</code> を使用する場合、<code class="literal">local-infile=1</code> オプションをそのグループに追加できます。ただし、<code class="literal">local-infile</code> を認識しないプログラムで問題が発生しないようにするために、<code class="literal">loose-</code> プリフィクスを使用してこれを指定します。
        </p><pre class="programlisting">
[client]
loose-local-infile=1
</pre></li><li class="listitem"><p>
          サーバーまたはクライアントのいずれかで <code class="literal">LOAD DATA LOCAL</code> が無効な場合、そのようなステートメントを発行しようとしたクライアントは次のエラーメッセージを受け取ります。
        </p><pre class="programlisting">
ERROR 1148: The used command is not allowed with this MySQL version
</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="secure-client-programming"></a>6.1.7 クライアントプログラミングのセキュリティーガイドライン</h3></div></div></div><p>
      MySQL にアクセスするアプリケーションは、ユーザーによって入力されるあらゆるデータを信頼しないようにしてください。ユーザーは Web フォーム、URL、または構築されたあらゆるアプリケーションに特殊文字またはエスケープ文字のシーケンスを入力することによってコードを欺くことを試すことができます。ユーザーが <span class="quote">「<span class="quote"><code class="literal">; DROP DATABASE mysql;</code></span>」</span> のような入力を行なっても、アプリケーションがセキュアな状態に保たれるようにしてください。これは極端な例ですが、同様の技術を使用するハッカーに備えていない場合、結果として大規模なセキュリティーリークおよびデータ損失が発生することがあります。
    </p><p>
      よくある過ちは、文字列データ値のみ保護することです。数値データも忘れずに検査してください。ユーザーが <code class="literal">234</code> という値を入力したとき、アプリケーションが <code class="literal">SELECT * FROM table WHERE ID=234</code> のようなクエリーを生成する場合、ユーザーは <code class="literal">234 OR 1=1</code> という値を入力して、<code class="literal">SELECT * FROM table WHERE ID=234 OR 1=1</code> というクエリーをアプリケーションに生成させることができます。その結果、サーバーはテーブル内のすべての行を取得します。これはすべての行を公開し、サーバーに過剰な負荷がかかります。この種類の攻撃から保護するためのもっとも簡単な方法は、数値定数を囲む単一引用符を使用して、<code class="literal">SELECT * FROM table WHERE ID='234'</code> とする方法です。ユーザーが余分の情報を入力すると、その情報はすべて文字列の一部となります。数値コンテキストでは、MySQL は自動的にこの文字列を数値に変換し、あとに続く数値以外のすべての文字を取り除きます。
    </p><p>
      データベースに格納されているデータが公開されているもののみであれば、保護は不要だと思われることもあります。これは正しくありません。データベース内のどの行も表示が許可されている場合であっても、サービス妨害攻撃 (前のパラグラフの技術に基づいた、サーバーにリソースを浪費させるものなど) から保護するべきです。そうしない場合、サーバーは正当なユーザーに対して応答不能になります。
    </p><p>
      チェックリスト:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          厳密な SQL モードを有効にして、サーバーが受け入れるデータ値の制限を厳しくするようサーバーに指示します。<a class="xref" href="server-administration.html#sql-mode" title="5.1.7 サーバー SQL モード">セクション5.1.7「サーバー SQL モード」</a>を参照してください。
        </p></li><li class="listitem"><p>
          すべての Web フォームに単一引用符または二重引用符 (<span class="quote">「<span class="quote"><code class="literal">'</code></span>」</span> および <span class="quote">「<span class="quote"><code class="literal">"</code></span>」</span>) を入力してみます。何らかの種類の MySQL エラーが出る場合、すぐに問題を調査してください。
        </p></li><li class="listitem"><p>
          動的 URL に <code class="literal">%22</code> (<span class="quote">「<span class="quote"><code class="literal">"</code></span>」</span>)、<code class="literal">%23</code> (<span class="quote">「<span class="quote"><code class="literal">#</code></span>」</span>)、および <code class="literal">%27</code> (<span class="quote">「<span class="quote"><code class="literal">'</code></span>」</span>) を追加して、これらを変更してみます。
        </p></li><li class="listitem"><p>
          前の例で示した文字を使用して、動的 URL のデータ型を数値型から文字型に変更してみます。これらの攻撃や類似の攻撃に対してアプリケーションが安全であるようにしてください。
        </p></li><li class="listitem"><p>
          数値フィールドに、数値でなく文字、スペース、および特殊記号を入力してみます。アプリケーションはこれらを MySQL に渡す前にこれらを削除するか、またはエラーを生成します。検査済みでない値を MySQL に渡すことは非常に危険です。
        </p></li><li class="listitem"><p>
          データを MySQL に渡す前にデータのサイズを検査してください。
        </p></li><li class="listitem"><p>
          アプリケーションがデータベースに接続するときは、管理目的で使用するものとは異なるユーザー名を使用するようにしてください。アプリケーションに不要なアクセス権限を付与しないでください。
        </p></li></ul></div><p>
      多くのアプリケーションプログラミングインタフェースには、データ値の特殊文字をエスケープする手段が備わっています。適切に使用すれば、これにより、意図とは異なる効果を持つステートメントをアプリケーションに生成させる値を、アプリケーションユーザーが入力できないようにすることができます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          MySQL C API: <code class="literal">mysql_real_escape_string()</code> API コールを使用してください。
        </p></li><li class="listitem"><p>
          MySQL++: クエリーストリームに対して <code class="literal">escape</code> および <code class="literal">quote</code> 修飾子を使用してください。
        </p></li><li class="listitem"><p>
          PHP: <code class="literal">mysqli</code> または <code class="literal">pdo_mysql</code> 拡張子を使用し、古い <code class="literal">ext/mysql</code> 拡張子を使用しないでください。推奨される API は、プレースホルダを持つプリペアドステートメントのほかに、改善された MySQL 認証プロトコルおよびパスワードをサポートします。<a class="ulink" href="http://dev.mysql.com/doc/apis-php/en/apis-php-mysqlinfo.api.choosing.html" target="_top">Choosing an API</a>も参照してください。
        </p><p>
          古い <code class="literal">ext/mysql</code> 拡張子を使用する必要がある場合、エスケープのために、<code class="literal">mysql_real_escape_string()</code> 関数を使用し、<code class="literal">mysql_escape_string()</code> または <code class="function">addslashes()</code> を使用しないでください。これは、<code class="literal">mysql_real_escape_string()</code> のみが文字セットを認識し、ほかの関数は、(無効な) マルチバイト文字セットを使用したときに<span class="quote">「<span class="quote">バイパスされる</span>」</span>可能性があるためです。
        </p></li><li class="listitem"><p>
          Perl DBI: プレースホルダまたは <code class="literal">quote()</code> メソッドを使用してください。
        </p></li><li class="listitem"><p>
          Ruby DBI: プレースホルダまたは <code class="literal">quote()</code> メソッドを使用してください。
        </p></li><li class="listitem"><p>
          Java JDBC: <code class="literal">PreparedStatement</code> オブジェクトおよびプレースホルダを使用してください。
        </p></li></ul></div><p>
      ほかのプログラミングインタフェースも似たような機能を持っている場合があります。
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="privilege-system"></a>6.2 MySQL アクセス権限システム</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#privileges-provided">6.2.1 MySQL で提供される権限</a></span></dt><dt><span class="section"><a href="security.html#grant-table-structure">6.2.2 権限システム付与テーブル</a></span></dt><dt><span class="section"><a href="security.html#account-names">6.2.3 アカウント名の指定</a></span></dt><dt><span class="section"><a href="security.html#connection-access">6.2.4 アクセス制御、ステージ 1: 接続の検証</a></span></dt><dt><span class="section"><a href="security.html#request-access">6.2.5 アクセス制御、ステージ 2: リクエストの確認</a></span></dt><dt><span class="section"><a href="security.html#privilege-changes">6.2.6 権限変更が有効化される時期</a></span></dt><dt><span class="section"><a href="security.html#access-denied">6.2.7 アクセス拒否エラーの原因</a></span></dt></dl></div><a class="indexterm" name="idm139979122437680"></a><a class="indexterm" name="idm139979122436240"></a><a class="indexterm" name="idm139979122435024"></a><a class="indexterm" name="idm139979122432880"></a><a class="indexterm" name="idm139979122431504"></a><a class="indexterm" name="idm139979122430144"></a><a class="indexterm" name="idm139979122428112"></a><p>
    MySQL 権限システムの主な役割は、特定のホストから接続するユーザーを認証すること、およびそのユーザーを、<code class="literal">SELECT</code>、<code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、<code class="literal">DELETE</code> などのデータベースにおける権限に関連付けることです。追加機能として、匿名ユーザーを持つこと、そして、管理操作や <code class="literal">LOAD DATA INFILE</code> などの MySQL 特有の機能についての権限を与えることなどがあります。
  </p><p>
    MySQL 権限システムでは実行できないこともあります。
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        特定ユーザーのアクセスを拒否するように明示的に指定することはできません。つまり、ユーザーを明示的に突き合わせて接続を拒否することはできません。
      </p></li><li class="listitem"><p>
        ユーザーがデータベースのテーブルを作成または削除できるが、データベース自体の作成または削除はできないような権限をユーザーが持つように指定することはできません。
      </p></li><li class="listitem"><p>
        パスワードはアカウントに対してグローバルに適用されます。データベース、テーブル、ルーチンなどの特定のオブジェクトにパスワードを関連付けることはできません。
      </p></li></ul></div><p>
    MySQL 権限システムへのユーザーインタフェースは、<code class="literal">CREATE USER</code>、<code class="literal">GRANT</code>、<code class="literal">REVOKE</code> などの SQL ステートメントで構成されます。<a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 アカウント管理ステートメント">セクション13.7.1「アカウント管理ステートメント」</a>を参照してください。
  </p><p>
    内部的には、サーバーは権限情報を <code class="literal">mysql</code> データベース (つまり <code class="literal">mysql</code> という名前のデータベース) の付与テーブルに格納します。MySQL サーバーはこれらのテーブルの内容を起動時にメモリーに読み取り、付与テーブルのインメモリーコピーに基づいてアクセス制御を決定します。
  </p><p>
    MySQL 権限システムによって、すべてのユーザーは自分に許可された操作のみ実行可能になります。ユーザーとして MySQL サーバーに接続すると、ユーザーの ID は、<span class="emphasis"><em>接続元のホスト</em></span>および<span class="emphasis"><em>指定したユーザー名</em></span>によって決定されます。接続後にリクエストを発行すると、システムは、ユーザー ID と <span class="emphasis"><em>ユーザーが行う操作</em></span>に応じて権限を付与します。
  </p><p>
    MySQL ではホスト名とユーザー名の両方を考慮に入れてユーザーを特定しますが、これは、特定のユーザー名がすべてのホストで同一人物に属すると想定する根拠がないためです。たとえば、<code class="literal">office.example.com</code> から接続したユーザー <code class="literal">joe</code> は、<code class="literal">home.example.com</code> から接続した <code class="literal">joe</code> と同一人物とは限りません。MySQL では、たまたま同じ名前を持った異なるホスト上のユーザーを識別できるようにすることによってこれを処理します。つまり、<code class="literal">office.example.com</code> からの <code class="literal">joe</code> による接続に対して 1 つの権限セットを付与し、<code class="literal">home.example.com</code> からの <code class="literal">joe</code> による接続に対して別の権限セットを提供することができます。特定のアカウントが持つ権限を表示するには、<code class="literal">SHOW GRANTS</code> ステートメントを使用します。例:
  </p><pre class="programlisting">
SHOW GRANTS FOR 'joe'@'office.example.com';
SHOW GRANTS FOR 'joe'@'home.example.com';
</pre><p>
    サーバーに接続するクライアントプログラムを実行するとき、MySQL アクセス制御には 2 つのステージがあります。
  </p><p>
    <span class="bold"><strong>ステージ 1:</strong></span> サーバーは、ユーザーの ID および正しいパスワードを指定することによって ID を検証できるかどうかに基づいて、接続を受け入れるか拒否します。
  </p><p>
    <span class="bold"><strong>ステージ 2:</strong></span> 接続できる場合、サーバーはユーザーが発行する各ステートメントを検査して、ステートメントを実行するだけの十分な権限をユーザーが持っているかどうかを判別します。たとえば、データベースのテーブルからレコードを選択したり、データベースのテーブルを削除したりしようとすると、サーバーはユーザーにそのテーブルの <code class="literal">SELECT</code> 権限があるかどうか、またはデータベースの <code class="literal">DROP</code> 権限があるかどうかを検証します。
  </p><p>
    各ステージで発生する動作の詳細な説明については、<a class="xref" href="security.html#connection-access" title="6.2.4 アクセス制御、ステージ 1: 接続の検証">セクション6.2.4「アクセス制御、ステージ 1: 接続の検証」</a>および<a class="xref" href="security.html#request-access" title="6.2.5 アクセス制御、ステージ 2: リクエストの確認">セクション6.2.5「アクセス制御、ステージ 2: リクエストの確認」</a>を参照してください。
  </p><p>
    ユーザーの接続中に (ユーザー自身または別のだれかによって) 権限が変更された場合、それらの変更は、ユーザーが発行する次のステートメントで必ずしもすぐに有効になるわけではありません。サーバーが付与テーブルをリロードする条件についての詳細は、<a class="xref" href="security.html#privilege-changes" title="6.2.6 権限変更が有効化される時期">セクション6.2.6「権限変更が有効化される時期」</a>を参照してください。
  </p><p>
    セキュリティーに関連する一般的な助言については、<a class="xref" href="security.html#general-security-issues" title="6.1 一般的なセキュリティーの問題">セクション6.1「一般的なセキュリティーの問題」</a>を参照してください。権限に関連した問題の診断についての支援情報は、<a class="xref" href="security.html#access-denied" title="6.2.7 アクセス拒否エラーの原因">セクション6.2.7「アクセス拒否エラーの原因」</a>を参照してください。
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="privileges-provided"></a>6.2.1 MySQL で提供される権限</h3></div></div></div><p>
      MySQL では、さまざまなコンテキストおよびさまざまな動作レベルに適用される権限が提供されます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          管理権限によって、ユーザーは MySQL サーバーの動作を管理できます。これらの権限は特定のデータベースに固有でないため、グローバルです。
        </p></li><li class="listitem"><p>
          データベース権限は、データベースおよびデータベース内のすべてのオブジェクトに適用されます。これらの権限は、特定のデータベースに付与したり、すべてのデータベースに適用されるようにグローバルに付与したりすることができます。
        </p></li><li class="listitem"><p>
          テーブル、インデックス、ビュー、ストアドルーチンなどのデータベースオブジェクト向けの権限は、データベース内の特定のオブジェクト、データベース内の特定タイプのすべてのオブジェクト (たとえばデータベース内のすべてのテーブル)、またはすべてのデータベース内の特定タイプのすべてのオブジェクトにグローバルに付与することができます。
        </p></li></ul></div><p>
      アカウント権限に関する情報は、<code class="literal">mysql</code> データベース内の <code class="literal">user</code>、<code class="literal">db</code>、<code class="literal">tables_priv</code>、<code class="literal">columns_priv</code>、および <code class="literal">procs_priv</code> テーブルに格納されます (<a class="xref" href="security.html#grant-table-structure" title="6.2.2 権限システム付与テーブル">セクション6.2.2「権限システム付与テーブル」</a>を参照してください)。MySQL サーバーはこれらのテーブルの内容を起動時にメモリーに読み取り、<a class="xref" href="security.html#privilege-changes" title="6.2.6 権限変更が有効化される時期">セクション6.2.6「権限変更が有効化される時期」</a>に示す条件でこれらを再ロードします。アクセス制御決定は、付与テーブルのインメモリーコピーに基づきます。
    </p><p>
      MySQL の一部のリリースでは、新たな権限や機能を追加するために付与テーブルの構造に変更を加えているものもあります。すべての新しい機能を確実に活用できるようにするには、新しいバージョンの MySQL に更新するときに常に付与テーブルを更新して、最新の構造を持つようにします。<a class="xref" href="programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — MySQL テーブルのチェックとアップグレード">セクション4.4.7「<span class="command"><strong>mysql_upgrade</strong></span> — MySQL テーブルのチェックとアップグレード」</a>を参照してください。
    </p><p>
      次の表には、<code class="literal">GRANT</code> および <code class="literal">REVOKE</code> ステートメント内で SQL レベルで使用される権限名のほか、付与テーブル内の各権限に関連付けられたカラムおよび権限が適用されるコンテキストが示されています。
    </p><div class="table"><a name="idm139979122366576"></a><p class="title"><b>表 6.2 GRANT および REVOKE に対して許容可能な権限</b></p><div class="table-contents"><table summary="GRANT および REVOKE に対して許容可能な権限" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">権限</th><th scope="col">カラム</th><th scope="col">コンテキスト</th></tr></thead><tbody><tr><td scope="row"><code class="literal">CREATE</code></td><td><code class="literal">Create_priv</code></td><td>データベース、テーブル、またはインデックス</td></tr><tr><td scope="row"><code class="literal">DROP</code></td><td><code class="literal">Drop_priv</code></td><td>データベース、テーブル、またはビュー</td></tr><tr><td scope="row"><code class="literal">GRANT OPTION</code></td><td><code class="literal">Grant_priv</code></td><td>データベース、テーブル、またはストアドルーチン</td></tr><tr><td scope="row"><code class="literal">LOCK TABLES</code></td><td><code class="literal">Lock_tables_priv</code></td><td>データベース</td></tr><tr><td scope="row"><code class="literal">REFERENCES</code></td><td><code class="literal">References_priv</code></td><td>データベースまたはテーブル</td></tr><tr><td scope="row"><code class="literal">EVENT</code></td><td><code class="literal">Event_priv</code></td><td>データベース</td></tr><tr><td scope="row"><code class="literal">ALTER</code></td><td><code class="literal">Alter_priv</code></td><td>テーブル</td></tr><tr><td scope="row"><code class="literal">DELETE</code></td><td><code class="literal">Delete_priv</code></td><td>テーブル</td></tr><tr><td scope="row"><code class="literal">INDEX</code></td><td><code class="literal">Index_priv</code></td><td>テーブル</td></tr><tr><td scope="row"><code class="literal">INSERT</code></td><td><code class="literal">Insert_priv</code></td><td>テーブルまたはカラム</td></tr><tr><td scope="row"><code class="literal">SELECT</code></td><td><code class="literal">Select_priv</code></td><td>テーブルまたはカラム</td></tr><tr><td scope="row"><code class="literal">UPDATE</code></td><td><code class="literal">Update_priv</code></td><td>テーブルまたはカラム</td></tr><tr><td scope="row"><code class="literal">CREATE TEMPORARY TABLES</code></td><td><code class="literal">Create_tmp_table_priv</code></td><td>テーブル</td></tr><tr><td scope="row"><code class="literal">TRIGGER</code></td><td><code class="literal">Trigger_priv</code></td><td>テーブル</td></tr><tr><td scope="row"><code class="literal">CREATE VIEW</code></td><td><code class="literal">Create_view_priv</code></td><td>ビュー</td></tr><tr><td scope="row"><code class="literal">SHOW VIEW</code></td><td><code class="literal">Show_view_priv</code></td><td>ビュー</td></tr><tr><td scope="row"><code class="literal">ALTER ROUTINE</code></td><td><code class="literal">Alter_routine_priv</code></td><td>ストアドルーチン</td></tr><tr><td scope="row"><code class="literal">CREATE ROUTINE</code></td><td><code class="literal">Create_routine_priv</code></td><td>ストアドルーチン</td></tr><tr><td scope="row"><code class="literal">EXECUTE</code></td><td><code class="literal">Execute_priv</code></td><td>ストアドルーチン</td></tr><tr><td scope="row"><code class="literal">FILE</code></td><td><code class="literal">File_priv</code></td><td>サーバーホストでのファイルアクセス</td></tr><tr><td scope="row"><code class="literal">CREATE TABLESPACE</code></td><td><code class="literal">Create_tablespace_priv</code></td><td>サーバー管理</td></tr><tr><td scope="row"><code class="literal">CREATE USER</code></td><td><code class="literal">Create_user_priv</code></td><td>サーバー管理</td></tr><tr><td scope="row"><code class="literal">PROCESS</code></td><td><code class="literal">Process_priv</code></td><td>サーバー管理</td></tr><tr><td scope="row"><code class="literal">PROXY</code></td><td><code class="literal">proxies_priv</code> テーブルを参照</td><td>サーバー管理</td></tr><tr><td scope="row"><code class="literal">RELOAD</code></td><td><code class="literal">Reload_priv</code></td><td>サーバー管理</td></tr><tr><td scope="row"><code class="literal">REPLICATION CLIENT</code></td><td><code class="literal">Repl_client_priv</code></td><td>サーバー管理</td></tr><tr><td scope="row"><code class="literal">REPLICATION SLAVE</code></td><td><code class="literal">Repl_slave_priv</code></td><td>サーバー管理</td></tr><tr><td scope="row"><code class="literal">SHOW DATABASES</code></td><td><code class="literal">Show_db_priv</code></td><td>サーバー管理</td></tr><tr><td scope="row"><code class="literal">SHUTDOWN</code></td><td><code class="literal">Shutdown_priv</code></td><td>サーバー管理</td></tr><tr><td scope="row"><code class="literal">SUPER</code></td><td><code class="literal">Super_priv</code></td><td>サーバー管理</td></tr><tr><td scope="row"><code class="literal">ALL [PRIVILEGES]</code></td><td> </td><td>サーバー管理</td></tr><tr><td scope="row"><code class="literal">USAGE</code></td><td> </td><td>サーバー管理</td></tr></tbody></table></div></div><br class="table-break"><p>
      次のリストには、MySQL で使用可能な各権限の一般的な説明が提供されています。特定の SQL ステートメントには、ここに示されているよりも具体的な権限要件がある場合もあります。そのような場合、該当するステートメントの説明で詳細を示します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="priv_all"></a>
          <code class="literal">ALL</code> または <code class="literal">ALL PRIVILEGES</code> 権限指定子は、短縮形です。これは、<span class="quote">「<span class="quote">特定の権限レベルで使用可能なすべての権限</span>」</span> (<code class="literal">GRANT OPTION</code> を除く) を表します。たとえば、グローバルまたはテーブルレベルで <code class="literal">ALL</code> を付与すると、すべてのグローバル権限またはテーブルレベルのすべての権限が付与されます。
        </p></li><li class="listitem"><p><a name="priv_alter"></a>
          <code class="literal">ALTER</code> 権限は、テーブルの構造を変更するための <code class="literal">ALTER TABLE</code> の使用を可能にします。<code class="literal">ALTER TABLE</code> には <code class="literal">CREATE</code> および <code class="literal">INSERT</code> 権限も必要です。テーブルを名前変更するには、古いテーブル側で <code class="literal">ALTER</code> および <code class="literal">DROP</code> と、新しいテーブル側で <code class="literal">ALTER</code>、<code class="literal">CREATE</code>、および <code class="literal">INSERT</code> 権限が必要です。
        </p></li><li class="listitem"><p><a name="priv_alter-routine"></a>
          ストアドルーチン (プロシージャーおよび関数) を変更または削除するには、<code class="literal">ALTER ROUTINE</code> 権限が必要です。
        </p></li><li class="listitem"><p><a name="priv_create"></a>
          <code class="literal">CREATE</code> 権限は、新規データベースおよびテーブルの作成を可能にします。
        </p></li><li class="listitem"><p><a name="priv_create-routine"></a>
          ストアドルーチン (プロシージャーおよび関数) を作成するには、<code class="literal">CREATE ROUTINE</code> 権限が必要です。
        </p></li><li class="listitem"><p><a name="priv_create-tablespace"></a>
          テーブルスペースおよびログファイルグループを作成、変更、または削除するには、<code class="literal">CREATE TABLESPACE</code> 権限が必要です。
        </p></li><li class="listitem"><p><a name="priv_create-temporary-tables"></a>
          <code class="literal">CREATE TEMPORARY TABLES</code> 権限は、<code class="literal">CREATE TEMPORARY TABLE</code> ステートメントを使用した一時テーブルの作成を可能にします。
        </p><p>
          MySQL 5.6.3 の時点では、セッションによって一時テーブルが作成されると、サーバーはテーブル上の権限チェックを追加実行しません。セッションの作成によって、<code class="literal">DROP TABLE</code>、<code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、<code class="literal">SELECT</code> などのあらゆる操作をテーブル上で実行できます。
        </p><p>
          この動作の 1 つの影響として、現在のユーザーが一時テーブルを作成する権限を持たなくても、セッションが一時テーブルを操作できるということがあります。現在のユーザーが <code class="literal">CREATE TEMPORARY TABLES</code> 権限を持たないが、<code class="literal">CREATE TEMPORARY TABLES</code> を持つユーザーの権限で実行して一時テーブルを作成する、<code class="literal">DEFINER</code> コンテキストのストアドプロシージャーを実行できるとします。プロシージャーの実行中、セッションは定義側ユーザーの権限を使用します。プロシージャーが復帰したあと、有効な権限は現在のユーザーの権限に戻り、これによって引き続き一時テーブルを表示し、一時テーブルに対してあらゆる操作を実行できることになります。
        </p><p>
          MySQL 5.6.3 より前では、<code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、<code class="literal">SELECT</code> などの一時テーブル上でのほかの操作には、一時テーブルを格納するデータベースに対する操作について、または同じ名前の非一時テーブルについての追加の権限が必要です。
        </p><p>
          一時テーブルと非一時テーブルの権限を分離するための、この状況についての一般的な回避策は、一時テーブルを使用するための専用データベースを作成することです。そうすることで、そのデータベースについて、<code class="literal">CREATE TEMPORARY TABLES</code> 権限と、ユーザーによって実行される一時テーブル操作に必要なほかのすべての権限を、そのユーザーに付与することができます。
        </p></li><li class="listitem"><p><a name="priv_create-user"></a>
          <code class="literal">CREATE USER</code> 権限は、<code class="literal">CREATE USER</code>、<code class="literal">DROP USER</code>、<code class="literal">RENAME USER</code>、および <code class="literal">REVOKE ALL PRIVILEGES</code> の使用を可能にします。
        </p></li><li class="listitem"><p><a name="priv_create-view"></a>
          <code class="literal">CREATE VIEW</code> 権限は、<code class="literal">CREATE VIEW</code> の使用を可能にします。
        </p></li><li class="listitem"><p><a name="priv_delete"></a>
          <code class="literal">DELETE</code> 権限は、データベースのテーブルからの行の削除を可能にします。
        </p></li><li class="listitem"><p><a name="priv_drop"></a>
          <code class="literal">DROP</code> 権限は、既存のデータベース、テーブル、およびビューのドロップを可能にします。パーティション化されたテーブルで <code class="literal">ALTER TABLE ... DROP PARTITION</code> ステートメントを使用するには <code class="literal">DROP</code> 権限が必要です。<code class="literal">DROP</code> 権限は <code class="literal">TRUNCATE TABLE</code> のためにも必要です。<span class="emphasis"><em><code class="literal">mysql</code> データベースに対する <code class="literal">DROP</code> 権限をユーザーに付与すると、MySQL アクセス権限が格納されているデータベースをユーザーが削除することができます。</em></span>
        </p></li><li class="listitem"><p><a name="priv_event"></a>
          イベントスケジューラについてのイベントを作成、変更、削除、または表示するには、<code class="literal">EVENT</code> 権限が必要です。
        </p></li><li class="listitem"><p><a name="priv_execute"></a>
          ストアドルーチン (プロシージャーおよび関数) を実行するには、<code class="literal">EXECUTE</code> 権限が必要です。
        </p></li><li class="listitem"><p><a name="priv_file"></a>
          <code class="literal">FILE</code> 権限は、<code class="literal">LOAD DATA INFILE</code> および <code class="literal">SELECT ... INTO OUTFILE</code> ステートメントと <code class="literal">LOAD_FILE()</code> 関数を使用するサーバーホスト上でファイルの読み取りおよび書き込みを実行するための許可をユーザーに与えます。<code class="literal">FILE</code> 権限を持つユーザーは、すべてのユーザーから読み取り可能であるか、MySQL サーバーによって読み取り可能なサーバーホスト上のすべてのファイルを読み取ることができます。(このことは暗黙的に、データベースディレクトリ内のあらゆるファイルにサーバーからアクセスできるため、ユーザーはそれらのすべてのファイルを読み取ることができることを意味します。)さらに <code class="literal">FILE</code> 権限によって、ユーザーは MySQL サーバーが書き込みアクセス権限を持つあらゆるディレクトリに新しいファイルを作成できます。これは、権限テーブルを実装するファイルを格納するサーバーのデータディレクトリを含みます。セキュリティー対策として、サーバーは既存のファイルを上書きしません。
        </p><p>
          ファイルを読み取りおよび書き込みできる場所を制限するには、<code class="literal">secure_file_priv</code> システムを特定のディレクトリに設定します。<a class="xref" href="server-administration.html#server-system-variables" title="5.1.4 サーバーシステム変数">セクション5.1.4「サーバーシステム変数」</a>を参照してください。
        </p></li><li class="listitem"><p><a name="priv_grant-option"></a>
          <code class="literal">GRANT OPTION</code> 権限によって、ユーザーは自分自身が所有する権限をほかのユーザーに付与したり、ほかのユーザーから削除したりすることができます。
        </p></li><li class="listitem"><p><a name="priv_index"></a>
          <code class="literal">INDEX</code> 権限によって、ユーザーはインデックスを作成またはドロップできます。<code class="literal">INDEX</code> は既存のテーブルに適用されます。テーブルに対する <code class="literal">CREATE</code> 権限を持つ場合、<code class="literal">CREATE TABLE</code> ステートメントにインデックス定義を含めることも可能です。
        </p></li><li class="listitem"><p><a name="priv_insert"></a>
          <code class="literal">INSERT</code> 権限は、データベースのテーブルへの行の挿入を可能にします。<code class="literal">ANALYZE TABLE</code>、<code class="literal">OPTIMIZE TABLE</code>、<code class="literal">REPAIR TABLE</code> などのテーブル保守に関するステートメントにも、<code class="literal">INSERT</code> 権限が必要です。
        </p></li><li class="listitem"><p><a name="priv_lock-tables"></a>
          <code class="literal">LOCK TABLES</code> 権限は、ユーザーが <code class="literal">SELECT</code> 権限を持つテーブルをロックするために、明示的な <code class="literal">LOCK TABLES</code> ステートメントの使用を可能にします。これには、ロックされたテーブルをほかのセッションから読み取らせないようにする書き込みロックの使用が含まれます。
        </p></li><li class="listitem"><p><a name="priv_process"></a>
          <code class="literal">PROCESS</code> 権限は、サーバー内で実行するスレッドについての情報の表示に関係します (つまり、セッションによって実行されるステートメントについての情報)。この権限は、<code class="literal">SHOW PROCESSLIST</code> または <span class="command"><strong>mysqladmin processlist</strong></span> を使用して、ほかのアカウントに属するスレッドを表示することを可能にし、自分自身のスレッドを表示することもできます。<code class="literal">PROCESS</code> 権限は、<code class="literal">SHOW ENGINE</code> の使用も可能にします。
        </p></li><li class="listitem"><p><a name="priv_proxy"></a>
          <code class="literal">PROXY</code> 権限によって、ユーザーは別のユーザーになりすましたり、別のユーザーとして認識されるようにしたりすることができます。<a class="xref" href="security.html#proxy-users" title="6.3.9 プロキシユーザー">セクション6.3.9「プロキシユーザー」</a>を参照してください。
        </p></li><li class="listitem"><p><a name="priv_references"></a>
          <code class="literal">REFERENCES</code> 権限は現在使用されていません。
        </p></li><li class="listitem"><p><a name="priv_reload"></a>
          <code class="literal">RELOAD</code> 権限は、<code class="literal">FLUSH</code> ステートメントの使用を可能にします。また、これは <code class="literal">FLUSH</code> 操作 (<code class="literal">flush-hosts</code>、<code class="literal">flush-logs</code>、<code class="literal">flush-privileges</code>、<code class="literal">flush-status</code>、<code class="literal">flush-tables</code>、<code class="literal">flush-threads</code>、<code class="literal">refresh</code>、および <code class="literal">reload</code>) と同等な <span class="command"><strong>mysqladmin</strong></span> コマンドを使用可能にします。
        </p><p>
          <code class="literal">reload</code> コマンドは、付与テーブルをメモリーにリロードするようにサーバーに指示します。<code class="literal">flush-privileges</code> は <code class="literal">reload</code> のシノニムです。<code class="literal">refresh</code> コマンドは、ログファイルを閉じて再オープンし、すべてのテーブルをフラッシュします。ほかの <code class="literal">flush-<em class="replaceable"><code>xxx</code></em></code> コマンドは <code class="literal">refresh</code> に類似した機能を実行しますが、より具体的であるため一部の状況では好ましい場合があります。たとえば、ログファイルだけをフラッシュするときは、<code class="literal">refresh</code> よりも <code class="literal">flush-logs</code> を選択することをお勧めします。
        </p></li><li class="listitem"><p><a name="priv_replication-client"></a>
          <code class="literal">REPLICATION CLIENT</code> 権限は、<code class="literal">SHOW MASTER STATUS</code> および <code class="literal">SHOW SLAVE STATUS</code> の使用を可能にします。MySQL 5.6.6 以降では、これは <code class="literal">SHOW BINARY LOGS</code> ステートメントの使用も可能にします。
        </p></li><li class="listitem"><p><a name="priv_replication-slave"></a>
          <code class="literal">REPLICATION SLAVE</code> 権限は、マスターとしての現在のサーバーに接続するときにスレーブサーバーが使用するアカウントに対して与えるようにしてください。この権限がない場合、スレーブは、マスターサーバー上のデータベースに対して実行された更新をリクエストすることができません。
        </p></li><li class="listitem"><p><a name="priv_select"></a>
          <code class="literal">SELECT</code> 権限によって、ユーザーはデータベース内のテーブルから行を選択できます。<code class="literal">SELECT</code> ステートメントで <code class="literal">SELECT</code> 権限が必要となるのは、ステートメントがテーブルから実際にレコードを取得する場合です。一部の <code class="literal">SELECT</code> ステートメントはテーブルにアクセスしないため、あらゆるデータベースへのアクセス権がなくても実行できます。たとえば、テーブルを参照しない式を評価するための単純な計算機として <code class="literal">SELECT</code> を使用することができます。
        </p><pre class="programlisting">
SELECT 1+1;
SELECT PI()*2;
</pre><p>
          <code class="literal">SELECT</code> 権限は、カラム値を読み取るほかのステートメントについても必要です。たとえば、<code class="literal">UPDATE</code> ステートメントの代入 <em class="replaceable"><code>col_name</code></em>=<em class="replaceable"><code>expr</code></em> の右辺で参照されるカラムや、<code class="literal">DELETE</code> または <code class="literal">UPDATE</code> ステートメントの <code class="literal">WHERE</code> 句で指定されるカラムについて、<code class="literal">SELECT</code> が必要です。
        </p></li><li class="listitem"><p><a name="priv_show-databases"></a>
          <code class="literal">SHOW DATABASES</code> 権限によって、アカウントは <code class="literal">SHOW DATABASE</code> ステートメントを発行することでデータベース名を表示することができます。この権限を持たないアカウントには、アカウントが一部の権限を持つデータベースしか表示されず、サーバーが <code class="option">--skip-show-database</code> オプションで起動されている場合はステートメントを一切使用できません。<span class="emphasis"><em>すべての</em></span>グローバル権限は、データベースに対する権限だということに注意してください。
        </p></li><li class="listitem"><p><a name="priv_show-view"></a>
          <code class="literal">SHOW VIEW</code> 権限は、<code class="literal">SHOW CREATE VIEW</code> の使用を可能にします。
        </p></li><li class="listitem"><p><a name="priv_shutdown"></a>
          <code class="literal">SHUTDOWN</code> 権限は、<span class="command"><strong>mysqladmin shutdown</strong></span> コマンドの使用を可能にします。対応する SQL ステートメントはありません。
        </p></li><li class="listitem"><p><a name="priv_super"></a>
          <code class="literal">SUPER</code> 権限によって、アカウントはほかのアカウントに属するスレッドを強制終了するための <code class="literal">CHANGE MASTER TO</code>、<code class="literal">KILL</code>、または <span class="command"><strong>mysqladmin kill</strong></span> (自分のスレッドは常に強制終了できます)、<code class="literal">PURGE BINARY LOGS</code>、グローバルシステム変数を変更するための <code class="literal">SET GLOBAL</code> を使用した構成変更、<span class="command"><strong>mysqladmin debug</strong></span> コマンド、ロギングの有効化または無効化、<code class="literal">read_only</code> システム変数が有効な場合の更新の実行、スレーブサーバー上でのレプリケーションの開始と停止、ストアドプログラムおよびビューの <code class="literal">DEFINER</code> 属性内のすべてのアカウントの指定を使用することができ、ユーザーは <code class="literal">max_connections</code> システム変数によって制御される接続制限に達している場合でも (一度) 接続することができます。
        </p><p>
          バイナリロギングを有効にした場合にストアドファンクションを作成または変更するとき、<a class="xref" href="stored-programs-views.html#stored-programs-logging" title="20.7 ストアドプログラムのバイナリロギング">セクション20.7「ストアドプログラムのバイナリロギング」</a>に記載されているように <code class="literal">SUPER</code> 権限がやはり必要になることがあります。
        </p></li><li class="listitem"><p><a name="priv_trigger"></a>
          <code class="literal">TRIGGER</code> 権限はトリガー操作を有効にします。テーブルのトリガーを作成、削除、または実行するには、そのテーブルに対してこの権限を持つ必要があります。
        </p></li><li class="listitem"><p><a name="priv_update"></a>
          <code class="literal">UPDATE</code> 権限は、データベース内のテーブルの行の更新を可能にします。
        </p></li><li class="listitem"><p><a name="priv_usage"></a>
          <code class="literal">USAGE</code> 権限指定子は、<span class="quote">「<span class="quote">権限なし</span>」</span>を表します。これは <code class="literal">GRANT</code> と一緒にグローバルレベルで使用されて、既存のアカウント権限に影響を及ぼすことなくリソース制限や SSL 特性などのアカウント属性を変更します。
        </p></li></ul></div><p>
      アカウントには必要な権限のみを付与することをお勧めします。<code class="literal">FILE</code> 権限と管理権限の付与については十分に注意するようにしてください。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">FILE</code> 権限を悪用して、MySQL サーバーがサーバーホスト上で読み取ることができるあらゆるファイルをデータベーステーブルから読み取ることができます。これにはすべてのユーザーが読み取り可能なすべてのファイルと、サーバーのデータディレクトリ内のファイルが含まれます。そのあと、<code class="literal">SELECT</code> を使用してそのテーブルにアクセスし、テーブルの内容をクライアントホストに送信することができます。
        </p></li><li class="listitem"><p>
          <code class="literal">GRANT OPTION</code> 権限によって、ユーザーはほかのユーザーに権限を付与することができます。異なる権限を持つ 2 人のユーザーが <code class="literal">GRANT OPTION</code> 権限を持っていれば、権限を組み合わせることができます。
        </p></li><li class="listitem"><p>
          <code class="literal">ALTER</code> 権限を使用して、テーブルの名前を変更することによって権限システムを壊すことができます。
        </p></li><li class="listitem"><p>
          <code class="literal">SHUTDOWN</code> 権限を悪用して、サーバーを終了することによって、ほかのユーザーへのサービスを完全に妨害することができます。
        </p></li><li class="listitem"><p>
          <code class="literal">PROCESS</code> 権限は、パスワードの設定や変更を行うステートメントなどを含め、現在実行中のステートメントのプレーンテキストを表示することができます。
        </p></li><li class="listitem"><p>
          <code class="literal">SUPER</code> 権限は、ほかのセッションを終了したり、サーバーの動作方法を変更したりするために使用できます。
        </p></li><li class="listitem"><p>
          <code class="literal">mysql</code> データベース自体に付与した権限を使用して、パスワードおよびその他のアクセス権限情報を変更することができます。パスワードは暗号化されて保管されているため、悪意のあるユーザーは単純にそのパスワードを見てプレーンテキストパスワードを知ることはできません。ただし、<code class="literal">user</code> テーブルの <code class="literal">Password</code> カラムへの書き込みアクセス権限を持つユーザーは、アカウントのパスワードを変更し、そのアカウントを使用して MySQL サーバーに接続することができます。
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="grant-table-structure"></a>6.2.2 権限システム付与テーブル</h3></div></div></div><a class="indexterm" name="idm139979122057520"></a><a class="indexterm" name="idm139979122055408"></a><p>
      通常では、アカウントをセットアップして各アカウントで使用可能な権限を制御するためには、<code class="literal">GRANT</code> や <code class="literal">REVOKE</code> などのステートメントを使用することによって、<code class="literal">mysql</code> データベース内の付与テーブルの内容を間接的に操作します。<a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 アカウント管理ステートメント">セクション13.7.1「アカウント管理ステートメント」</a>を参照してください。ここでは付与テーブルの基本構造と、サーバーがクライアントと対話するときに付与テーブルの内容をどのように使用するかについて説明します。
    </p><p>
      次の <code class="literal">mysql</code> データベーステーブルには付与情報が格納されています。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">user</code>: ユーザーアカウント、グローバル権限、および権限以外のその他のカラムが含まれています。
        </p></li><li class="listitem"><p>
          <code class="literal">db</code>: データベースレベルの権限が格納されています。
        </p></li><li class="listitem"><p>
          <code class="literal">host</code>: 使用されなくなりました。MySQL 5.6.7 以降の新しい MySQL インストールではこのテーブルが作成されなくなりました。
        </p></li><li class="listitem"><p>
          <code class="literal">tables_priv</code>: テーブルレベルの権限が格納されています。
        </p></li><li class="listitem"><p>
          <code class="literal">columns_priv</code>: カラムレベルの権限が格納されています。
        </p></li><li class="listitem"><p>
          <code class="literal">procs_priv</code>: ストアドプロシージャーおよびストアドファンクションの権限が格納されています。
        </p></li><li class="listitem"><p>
          <code class="literal">proxies_priv</code>: プロキシユーザー権限が格納されています。
        </p></li></ul></div><p>
      <code class="literal">mysql</code> データベース内のほかのテーブルには付与情報が保持されておらず、ほかの場所で説明されています。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">event</code>: イベントスケジューラについての情報が格納されています。<a class="xref" href="stored-programs-views.html#events" title="20.4 イベントスケジューラの使用">セクション20.4「イベントスケジューラの使用」</a>を参照してください。
        </p></li><li class="listitem"><p>
          <code class="literal">func</code>: ユーザー定義関数についての情報が格納されています。<a class="xref" href="extending-mysql.html#adding-functions" title="24.3 MySQL への新しい関数の追加">セクション24.3「MySQL への新しい関数の追加」</a>を参照してください。
        </p></li><li class="listitem"><p>
          <code class="literal">help_<em class="replaceable"><code>xxx</code></em></code>: これらのテーブルはサーバー側のヘルプに使用されます。<a class="xref" href="server-administration.html#server-side-help-support" title="5.1.10 サーバー側のヘルプ">セクション5.1.10「サーバー側のヘルプ」</a>を参照してください。
        </p></li><li class="listitem"><p>
          <code class="literal">plugin</code>: サーバープラグインについての情報が格納されています。<a class="xref" href="server-administration.html#server-plugin-loading" title="5.1.8.1 プラグインのインストールおよびアンインストール">セクション5.1.8.1「プラグインのインストールおよびアンインストール」</a>および<a class="xref" href="extending-mysql.html#plugin-api" title="24.2 MySQL プラグイン API">セクション24.2「MySQL プラグイン API」</a>を参照してください。
        </p></li><li class="listitem"><p>
          <code class="literal">proc</code>: ストアドプロシージャーおよびストアドファンクションについての情報が格納されています。<a class="xref" href="stored-programs-views.html#stored-routines" title="20.2 ストアドルーチン (プロシージャーと関数) の使用">セクション20.2「ストアドルーチン (プロシージャーと関数) の使用」</a>を参照してください。
        </p></li><li class="listitem"><p>
          <code class="literal">servers</code>: <code class="literal">FEDERATED</code> ストレージエンジンによって使用されます。<a class="xref" href="storage-engines.html#federated-create-server" title="15.8.2.2 CREATE SERVER を使用した FEDERATED テーブルの作成">セクション15.8.2.2「CREATE SERVER を使用した FEDERATED テーブルの作成」</a>を参照してください。
        </p></li><li class="listitem"><p>
          <code class="literal">time_zone_<em class="replaceable"><code>xxx</code></em></code>: これらのテーブルにはタイムゾーン情報が格納されています。<a class="xref" href="globalization.html#time-zone-support" title="10.6 MySQL Server でのタイムゾーンのサポート">セクション10.6「MySQL Server でのタイムゾーンのサポート」</a>を参照してください。
        </p></li><li class="listitem"><p>
          名前に <code class="literal">_log</code> が付いているテーブルは、ロギングに使用されます。<a class="xref" href="server-administration.html#server-logs" title="5.2 MySQL Server ログ">セクション5.2「MySQL Server ログ」</a>を参照してください。
        </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        <code class="literal">mysql</code> データベース内のテーブルの変更は、<code class="literal">CREATE USER</code>、<code class="literal">GRANT</code>、<code class="literal">CREATE PROCEDURE</code> などのステートメントの応答としてサーバーによって通常実行されます。<code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、<code class="literal">DELETE</code> などのステートメントを使用してこれらのテーブルを直接変更することは推奨されません。これらの変更の結果として誤った形式となった行を、サーバーは随意で無視します。
      </p></div><p>
      各付与テーブルにはスコープカラムと権限カラムがあります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          スコープカラムはテーブル内の各行 (エントリ) のスコープ、つまり行が適用されるコンテキストを決定します。たとえば、<code class="literal">Host</code> と <code class="literal">User</code> の値が <code class="literal">'thomas.loc.gov'</code> と <code class="literal">'bob'</code> である <code class="literal">user</code> テーブル行は、<code class="literal">bob</code> というユーザー名を指定するクライアントによるホスト <code class="literal">thomas.loc.gov</code> からサーバーに対して実行する認証接続のために使用されます。同様に、<code class="literal">Host</code>、<code class="literal">User</code>、および <code class="literal">Db</code> カラム値が <code class="literal">'thomas.loc.gov'</code>、<code class="literal">'bob'</code>、および <code class="literal">'reports'</code> である <code class="literal">db</code> テーブル行は、<code class="literal">bob</code> が <code class="literal">thomas.loc.gov</code> ホストから <code class="literal">reports</code> データベースに接続するときに使用されます。<code class="literal">tables_priv</code> テーブルおよび <code class="literal">columns_priv</code> テーブルには、それぞれの行に適用されるテーブルまたはテーブルとカラムの組み合わせを示すスコープカラムがあります。<code class="literal">procs_priv</code> スコープカラムは、それぞれの行に適用されるストアドルーチンを示します。
        </p></li><li class="listitem"><p>
          権限カラムは、テーブル行によって付与される権限、つまり実行可能な操作を指定します。サーバーはさまざまな付与テーブル内の情報を組み合わせてユーザーの権限の完全な記述を構成します。この実行に使用されるルールの説明は、<a class="xref" href="security.html#request-access" title="6.2.5 アクセス制御、ステージ 2: リクエストの確認">セクション6.2.5「アクセス制御、ステージ 2: リクエストの確認」</a>にあります。
        </p></li></ul></div><p>
      サーバーは次の方法で付与テーブルを使用します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">user</code> テーブルのスコープカラムは、入接続を拒否または許可するかを決定します。許可される接続について、<code class="literal">user</code> テーブル内で付与されるすべての権限は、ユーザーのグローバル権限を示します。このテーブル内で付与されるすべての権限は、サーバー上の<span class="emphasis"><em>すべてのデータベース</em></span>に適用されます。
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            あらゆるグローバル権限は、すべてのデータベースに対する権限とみなされるため、あらゆるグローバル権限を持つユーザーは、<code class="literal">SHOW DATABASES</code> を使用したり、または <code class="literal">INFORMATION_SCHEMA</code> の <code class="literal">SCHEMATA</code> テーブルを調べたりすることで、すべてのデータベース名を表示できるようになります。
          </p></div></li><li class="listitem"><p>
          <code class="literal">db</code> テーブルのスコープカラムは、どのユーザーがどのホストからどのデータベースにアクセスできるかを決定します。権限カラムは、許可される操作を決定します。データベースレベルで付与される権限は、データベースのほかテーブルやストアドプログラムなどのデータベース内のすべてのオブジェクトに適用されます。
        </p></li><li class="listitem"><p>
          <code class="literal">tables_priv</code> および <code class="literal">columns_priv</code> テーブルは <code class="literal">db</code> テーブルと似ていますが、これらはさらに粒度が細かく、データベースレベルでなくテーブルレベルおよびカラムレベルに適用されます。テーブルレベルで付与される権限は、テーブルおよびそのすべてのカラムに適用されます。カラムレベルで付与される権限は、特定のカラムにのみ適用されます。
        </p></li><li class="listitem"><p>
          <code class="literal">procs_priv</code> テーブルはストアドルーチンに適用されます。ルーチンレベルで付与される権限は、単一ルーチンにのみ適用されます。
        </p></li><li class="listitem"><p>
          <code class="literal">proxies_priv</code> テーブルは、ほかのユーザーのプロキシの役割を担うことができるユーザーがだれか、およびプロキシユーザーが <code class="literal">PROXY</code> 権限をほかのユーザーに付与できるかどうかを指定します。
        </p></li></ul></div><p>
      サーバーは <code class="literal">mysql</code> データベース内の <code class="literal">user</code> および <code class="literal">db</code> テーブルを、アクセス制御のステージ 1 とステージ 2 の両方で使用します (<a class="xref" href="security.html#privilege-system" title="6.2 MySQL アクセス権限システム">セクション6.2「MySQL アクセス権限システム」</a>を参照してください)。<code class="literal">user</code> と <code class="literal">db</code> のテーブルのカラムをここで示します。
    </p><div class="table"><a name="idm139979121960848"></a><p class="title"><b>表 6.3 user テーブルおよび db テーブルのカラム</b></p><div class="table-contents"><table summary="user テーブルおよび db テーブルのカラム" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">テーブル名</th><th scope="col"><code class="literal">user</code></th><th scope="col"><code class="literal">db</code></th></tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>スコープカラム</strong></span></td><td><code class="literal">Host</code></td><td><code class="literal">Host</code></td></tr><tr><td scope="row"> </td><td><code class="literal">User</code></td><td><code class="literal">Db</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Password</code></td><td><code class="literal">User</code></td></tr><tr><td scope="row"><span class="bold"><strong>権限カラム</strong></span></td><td><code class="literal">Select_priv</code></td><td><code class="literal">Select_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Insert_priv</code></td><td><code class="literal">Insert_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Update_priv</code></td><td><code class="literal">Update_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Delete_priv</code></td><td><code class="literal">Delete_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Index_priv</code></td><td><code class="literal">Index_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Alter_priv</code></td><td><code class="literal">Alter_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Create_priv</code></td><td><code class="literal">Create_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Drop_priv</code></td><td><code class="literal">Drop_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Grant_priv</code></td><td><code class="literal">Grant_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Create_view_priv</code></td><td><code class="literal">Create_view_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Show_view_priv</code></td><td><code class="literal">Show_view_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Create_routine_priv</code></td><td><code class="literal">Create_routine_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Alter_routine_priv</code></td><td><code class="literal">Alter_routine_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Execute_priv</code></td><td><code class="literal">Execute_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Trigger_priv</code></td><td><code class="literal">Trigger_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Event_priv</code></td><td><code class="literal">Event_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Create_tmp_table_priv</code></td><td><code class="literal">Create_tmp_table_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Lock_tables_priv</code></td><td><code class="literal">Lock_tables_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">References_priv</code></td><td><code class="literal">References_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Reload_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Shutdown_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Process_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">File_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Show_db_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Super_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Repl_slave_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Repl_client_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Create_user_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Create_tablespace_priv</code></td><td> </td></tr><tr><td scope="row"><span class="bold"><strong>セキュリティーカラム</strong></span></td><td><code class="literal">ssl_type</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">ssl_cipher</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">x509_issuer</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">x509_subject</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">plugin</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">authentication_string</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">password_expired</code></td><td> </td></tr><tr><td scope="row"><span class="bold"><strong>リソース制御カラム</strong></span></td><td><code class="literal">max_questions</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">max_updates</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">max_connections</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">max_user_connections</code></td><td> </td></tr></tbody></table></div></div><br class="table-break"><p>
      <code class="literal">mysql.user</code> テーブルの <code class="literal">plugin</code> および <code class="literal">authentication_string</code> カラムは認証プラグイン情報を格納します。
    </p><p>
      アカウント行の <code class="literal">plugin</code> カラムが空の場合、サーバーは <code class="literal">Password</code> カラムのパスワードハッシュの形式に応じて、<code class="literal">mysql_native_password</code> または <code class="literal">mysql_old_password</code> プラグインを暗黙的に使用してアカウントを認証します。<code class="literal">Password</code> 値が空または 4.1 のパスワードハッシュ (41 文字) である場合、サーバーは <code class="literal">mysql_native_password</code> を使用します。パスワード値が 4.1 より前のパスワードハッシュ (16 文字) の場合、サーバーは <code class="literal">mysql_old_password</code> を使用します。(これらのハッシュ形式についての追加情報は、<a class="xref" href="security.html#password-hashing" title="6.1.2.4 MySQL でのパスワードハッシュ">セクション6.1.2.4「MySQL でのパスワードハッシュ」</a>を参照してください。)クライアントは、アカウント行の <code class="literal">Password</code> カラム内のパスワードと一致する必要があります。
    </p><p>
      アカウント行で <code class="literal">plugin</code> カラムにプラグインが指定された場合、サーバーはこれを使用して、アカウントに対する接続の試行を認証します。プラグインが <code class="literal">Password</code> カラム内の値を使用するかどうかはプラグインによって異なります。
    </p><p>
      <code class="literal">password_expired</code> カラムは、DBA がアカウントパスワードを期限切れにして、ユーザーにパスワードをリセットするよう求めることができるようにするために、MySQL 5.6.6 で追加されました。デフォルトの <code class="literal">password_expired</code> 値は <code class="literal">'N'</code> ですが、<code class="literal">ALTER USER</code> ステートメントを使用して <code class="literal">'Y'</code> に設定できます。アカウントのパスワードの有効期限が切れたあと、サーバーへの以降の接続で、そのアカウントによって実行されるすべての操作は、ユーザーが <code class="literal">SET PASSWORD</code> ステートメントを発行して新しいアカウントパスワードを確立するまで、エラーになります。<a class="xref" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER 構文">セクション13.7.1.1「ALTER USER 構文」</a>を参照してください。
    </p><p>
      パスワードの有効期限が切れたあと、<code class="literal">SET PASSWORD</code> を使用してパスワードを現在の値に設定することによって、パスワードを<span class="quote">「<span class="quote">リセット</span>」</span>することができます。適切なポリシーとして、別のパスワードを選択することをお勧めします。
    </p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注意</div><p>
        MySQL 5.6.6 で、<code class="literal">ALTER USER</code> は <code class="literal">Password</code> カラムを空の文字列に設定するため、このステートメントは 5.6.7 まで使用しないでください。
      </p></div><p>
      アクセス制御のステージ 2 で、サーバーはリクエスト検証を実行して、クライアントが発行した各リクエストに対してそれぞれのクライアントが十分な権限を持つことを確認します。<code class="literal">user</code> および <code class="literal">db</code> 付与テーブルに加えて、テーブルに関するリクエストの場合、サーバーは <code class="literal">tables_priv</code> および <code class="literal">columns_priv</code> テーブルを参照することもあります。後者のテーブルは、テーブルレベルおよびカラムレベルでの細かい権限制御を提供します。これらには、次の表に示すカラムがあります。
    </p><div class="table"><a name="idm139979121836816"></a><p class="title"><b>表 6.4 tables_priv テーブルおよび columns_priv テーブルのカラム</b></p><div class="table-contents"><table summary="tables_priv テーブルおよび columns_priv テーブルのカラム" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">テーブル名</th><th scope="col"><code class="literal">tables_priv</code></th><th scope="col"><code class="literal">columns_priv</code></th></tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>スコープカラム</strong></span></td><td><code class="literal">Host</code></td><td><code class="literal">Host</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Db</code></td><td><code class="literal">Db</code></td></tr><tr><td scope="row"> </td><td><code class="literal">User</code></td><td><code class="literal">User</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Table_name</code></td><td><code class="literal">Table_name</code></td></tr><tr><td scope="row"> </td><td> </td><td><code class="literal">Column_name</code></td></tr><tr><td scope="row"><span class="bold"><strong>権限カラム</strong></span></td><td><code class="literal">Table_priv</code></td><td><code class="literal">Column_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Column_priv</code></td><td> </td></tr><tr><td scope="row"><span class="bold"><strong>その他のカラム</strong></span></td><td><code class="literal">Timestamp</code></td><td><code class="literal">Timestamp</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Grantor</code></td><td> </td></tr></tbody></table></div></div><br class="table-break"><p>
      <code class="literal">Timestamp</code> カラムおよび <code class="literal">Grantor</code> カラムは、それぞれ現在のタイムスタンプおよび <code class="literal">CURRENT_USER</code> 値に設定されます。ただし、これらは未使用のため、ここではこれ以上説明しません。
    </p><p>
      ストアドルーチンに関するリクエストを検証するために、サーバーは <code class="literal">procs_priv</code> テーブルを参照することがあり、このテーブルには次の表に示すカラムがあります。
    </p><div class="table"><a name="idm139979121805440"></a><p class="title"><b>表 6.5 procs_priv テーブルのカラム</b></p><div class="table-contents"><table summary="procs_priv テーブルのカラム" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">テーブル名</th><th scope="col"><code class="literal">procs_priv</code></th></tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>スコープカラム</strong></span></td><td><code class="literal">Host</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Db</code></td></tr><tr><td scope="row"> </td><td><code class="literal">User</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Routine_name</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Routine_type</code></td></tr><tr><td scope="row"><span class="bold"><strong>権限カラム</strong></span></td><td><code class="literal">Proc_priv</code></td></tr><tr><td scope="row"><span class="bold"><strong>その他のカラム</strong></span></td><td><code class="literal">Timestamp</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Grantor</code></td></tr></tbody></table></div></div><br class="table-break"><p>
      <code class="literal">Routine_type</code> カラムは、<code class="literal">'FUNCTION'</code> または <code class="literal">'PROCEDURE'</code> の値を持つ <code class="literal">ENUM</code> カラムであり、その行が示すルーチンのタイプを指します。このカラムにより、同じ名前を持つ関数とプロシージャーに別々に権限を付与することができます。
    </p><p>
      <code class="literal">Timestamp</code> カラムと <code class="literal">Grantor</code> カラムは現在未使用のため、ここではこれ以上説明しません。
    </p><p>
      <code class="literal">proxies_priv</code> テーブルはプロキシユーザーについての情報を記録します。これには次のカラムがあります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">Host</code>、<code class="literal">User</code>: これらのカラムは、プロキシ設定されるアカウントに対して <code class="literal">PROXY</code> 権限を持つユーザーアカウントを示します。
        </p></li><li class="listitem"><p>
          <code class="literal">Proxied_host</code>、<code class="literal">Proxied_user</code>: これらのカラムは、プロキシ設定されるユーザーのアカウントを示します。
        </p></li><li class="listitem"><p>
          <code class="literal">Grantor</code>: 現在未使用です。
        </p></li><li class="listitem"><p>
          <code class="literal">Timestamp</code>: 現在未使用です。
        </p></li><li class="listitem"><p>
          <code class="literal">With_grant</code>: このカラムは、プロキシアカウントが <code class="literal">PROXY</code> 権限を別のアカウントに付与できるかどうかを示します。
        </p></li></ul></div><p>
      付与テーブルのスコープカラムには文字列が格納されています。これらは次に示すように宣言され、それぞれのデフォルト値は空の文字列です。
    </p><div class="table"><a name="idm139979121767024"></a><p class="title"><b>表 6.6 付与テーブルのスコープカラムの型</b></p><div class="table-contents"><table summary="付与テーブルのスコープカラムの型" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">カラム名</th><th scope="col">型</th></tr></thead><tbody><tr><td scope="row"><code class="literal">Host</code>、<code class="literal">Proxied_host</code></td><td><code class="literal">CHAR(60)</code></td></tr><tr><td scope="row"><code class="literal">User</code>、<code class="literal">Proxied_user</code></td><td><code class="literal">CHAR(16)</code></td></tr><tr><td scope="row"><code class="literal">Password</code></td><td><code class="literal">CHAR(41)</code></td></tr><tr><td scope="row"><code class="literal">Db</code></td><td><code class="literal">CHAR(64)</code></td></tr><tr><td scope="row"><code class="literal">Table_name</code></td><td><code class="literal">CHAR(64)</code></td></tr><tr><td scope="row"><code class="literal">Column_name</code></td><td><code class="literal">CHAR(64)</code></td></tr><tr><td scope="row"><code class="literal">Routine_name</code></td><td><code class="literal">CHAR(64)</code></td></tr></tbody></table></div></div><br class="table-break"><a class="indexterm" name="idm139979121747072"></a><p>
      アクセスチェックのために、<code class="literal">User</code>、<code class="literal">Proxied_user</code>、<code class="literal">Password</code>、<code class="literal">Db</code>、および <code class="literal">Table_name</code> 値の比較は大文字小文字を区別します。<code class="literal">Host</code>、<code class="literal">Proxied_host</code>、<code class="literal">Column_name</code>、および <code class="literal">Routine_name</code> 値の比較は大文字小文字を区別しません。
    </p><p>
      <code class="literal">user</code> および <code class="literal">db</code> テーブルでは、各権限は、<code class="literal">ENUM('N','Y') DEFAULT 'N'</code> として宣言される別個のカラムにリストされます。つまり、各権限は無効または有効にすることができ、デフォルトは無効です。
    </p><p>
      <code class="literal">tables_priv</code>、<code class="literal">columns_priv</code>、および <code class="literal">procs_priv</code> のテーブルでは、権限カラムは <code class="literal">SET</code> カラムとして宣言されます。これらのカラムの値は、テーブルによって制御されるあらゆる組み合わせの権限を含むことができます。カラム値にリストされている権限のみが入力されます。
    </p><div class="table"><a name="idm139979121730784"></a><p class="title"><b>表 6.7 Set タイプ権限のカラム値</b></p><div class="table-contents"><table summary="Set タイプ権限のカラム値" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">テーブル名</th><th scope="col">カラム名</th><th scope="col">可能な Set 要素</th></tr></thead><tbody><tr><td scope="row"><code class="literal">tables_priv</code></td><td><code class="literal">Table_priv</code></td><td><code class="literal">'Select', 'Insert', 'Update', 'Delete', 'Create', 'Drop', 'Grant', 'References', 'Index', 'Alter', 'Create View', 'Show view', 'Trigger'</code></td></tr><tr><td scope="row"><code class="literal">tables_priv</code></td><td><code class="literal">Column_priv</code></td><td><code class="literal">'Select', 'Insert', 'Update', 'References'</code></td></tr><tr><td scope="row"><code class="literal">columns_priv</code></td><td><code class="literal">Column_priv</code></td><td><code class="literal">'Select', 'Insert', 'Update', 'References'</code></td></tr><tr><td scope="row"><code class="literal">procs_priv</code></td><td><code class="literal">Proc_priv</code></td><td><code class="literal">'Execute', 'Alter Routine', 'Grant'</code></td></tr></tbody></table></div></div><br class="table-break"><p>
      管理者権限 (<code class="literal">RELOAD</code>、<code class="literal">SHUTDOWN</code> など) は、<code class="literal">user</code> テーブルのみで指定されます。管理操作はサーバー自体での操作であって、データベース固有でないため、これらの権限をほかの付与テーブルにリストする理由はありません。したがって、ユーザーが管理操作を実行できるかどうかを判別するには、サーバーは <code class="literal">user</code> テーブルのみ参照する必要があります。
    </p><p>
      <code class="literal">FILE</code> 権限も、<code class="literal">user</code> テーブルでのみ指定されます。これはそもそも管理権限ではありませんが、サーバーホスト上のファイルを読み取りまたは書き込みするための能力は、アクセスするデータベースとは無関係です。
    </p><p>
      <span class="command"><strong>mysqld</strong></span> サーバーは、起動時に付与テーブルの内容をメモリーに読み取ります。<code class="literal">FLUSH PRIVILEGES</code> ステートメントを発行するか、<span class="command"><strong>mysqladmin flush-privileges</strong></span> または <span class="command"><strong>mysqladmin reload</strong></span> コマンドを実行することによって、テーブルをリロードするようサーバーに指示することができます。付与テーブルへの変更は、<a class="xref" href="security.html#privilege-changes" title="6.2.6 権限変更が有効化される時期">セクション6.2.6「権限変更が有効化される時期」</a>で示すように反映されます。
    </p><p>
      アカウントの権限を変更するとき、変更によって権限が希望どおりにセットアップされるかどうかを確認することをお勧めします。特定のアカウントの権限をチェックするには、<code class="literal">SHOW GRANTS</code> ステートメントを使用します (<a class="xref" href="sql-syntax.html#show-grants" title="13.7.5.22 SHOW GRANTS 構文">セクション13.7.5.22「SHOW GRANTS 構文」</a>を参照してください)。たとえば、ユーザー名およびホスト名の値がそれぞれ <code class="literal">bob</code> および <code class="literal">pc84.example.com</code> のアカウントに付与された権限を調べるには、次のステートメントを使用します。
    </p><pre class="programlisting">
SHOW GRANTS FOR 'bob'@'pc84.example.com';
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="account-names"></a>6.2.3 アカウント名の指定</h3></div></div></div><a class="indexterm" name="idm139979121695152"></a><a class="indexterm" name="idm139979121693728"></a><a class="indexterm" name="idm139979121691664"></a><a class="indexterm" name="idm139979121689600"></a><a class="indexterm" name="idm139979121687520"></a><p>
      MySQL アカウント名はユーザー名とホスト名で構成されます。これにより、別々のホストから接続可能な同じ名前を持つユーザーのためのアカウントを作成できます。このセクションでは、特殊な値やワイルドカードルールを含む、アカウント名の記述方法について説明します。
    </p><p>
      <code class="literal">CREATE USER</code>、<code class="literal">GRANT</code>、<code class="literal">SET PASSWORD</code> などの SQL ステートメントでは、次のルールを使用してアカウント名を記述してください。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          アカウント名の構文は <code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code> です。
        </p></li><li class="listitem"><p>
          ユーザー名のみで構成されるアカウント名は、<code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'%'</code> と同等です。たとえば、<code class="literal">'me'</code> は <code class="literal">'me'@'%'</code> と同等です。
        </p></li><li class="listitem"><p>
          ユーザー名およびホスト名は、それらが引用符なしの識別子として有効な場合、引用する必要はありません。引用符が必要なのは、<em class="replaceable"><code>user_name</code></em> 文字列が特殊文字 (<span class="quote">「<span class="quote"><code class="literal">-</code></span>」</span> など) を含んでいたり、<em class="replaceable"><code>host_name</code></em> 文字列が特殊文字またはワイルドカード文字 (<span class="quote">「<span class="quote"><code class="literal">%</code></span>」</span> など) を含んでいたりする場合で、たとえば <code class="literal">'test-user'@'%.com'</code> のようになります。
        </p></li><li class="listitem"><p>
          ユーザー名およびホスト名は、逆引用符 (<span class="quote">「<span class="quote"><code class="literal">`</code></span>」</span>)、単一引用符 (<span class="quote">「<span class="quote"><code class="literal">'</code></span>」</span>)、または二重引用符 (<span class="quote">「<span class="quote"><code class="literal">"</code></span>」</span>) のいずれかを使用して、識別子または文字列として引用符で囲みます。
        </p></li><li class="listitem"><p>
          ユーザー名およびホスト名の部分が引用符で囲まれる場合、別々に囲んでください。つまり、<code class="literal">'me'@'localhost'</code> と記述し、<code class="literal">'me@localhost'</code> とは記述しません。後者は <code class="literal">'me@localhost'@'%'</code> と解釈されます。
        </p></li><li class="listitem"><p>
          <code class="literal">CURRENT_USER</code> または <code class="literal">CURRENT_USER()</code> 関数への参照は、現行クライアントのユーザー名およびホスト名の文字を指定することと同等です。
        </p></li></ul></div><p>
      MySQL は、<code class="literal">mysql</code> データベースの付与テーブルにアカウント名を格納するとき、ユーザー名とホスト名の部分に別々のカラムを使用します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">user</code> テーブルにはアカウントごとに 1 行が格納されます。<code class="literal">User</code> および <code class="literal">Host</code> カラムはユーザー名およびホスト名を格納します。このテーブルには、アカウントが持つグローバル権限も指定されます。
        </p></li><li class="listitem"><p>
          ほかの付与テーブルには、データベースおよびデータベース内のオブジェクトに対してアカウントが持つ権限が示されます。これらのテーブルにはアカウント名を格納するための <code class="literal">User</code> および <code class="literal">Host</code> カラムがあります。これらのテーブルの各行は、同じ <code class="literal">User</code> および <code class="literal">Host</code> の値を持つ <code class="literal">user</code> テーブル内のアカウントに関連付けられています。
        </p></li></ul></div><p>
      付与テーブル構造に関する追加の詳細については、<a class="xref" href="security.html#grant-table-structure" title="6.2.2 権限システム付与テーブル">セクション6.2.2「権限システム付与テーブル」</a>を参照してください。
    </p><p>
      ユーザー名およびホスト名は、次に示すような特殊な値が使用されたりワイルドカード規則が適用されたりします。
    </p><p>
      ユーザー名は、入接続を試行するユーザー名と文字が一致するブランクでない値であるか、あらゆるユーザー名と一致するブランク値 (空の文字列) です。ブランクのユーザー名を持つアカウントは匿名ユーザーです。SQL ステートメントで匿名ユーザーを指定するには、<code class="literal">''@'localhost'</code> のように引用符で囲んだ空のユーザー名部分を使用します。
    </p><p>
      アカウント名のホスト名部分は多くの形式を持つことができ、ワイルドカードが許可されます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          ホスト値はホスト名または IP アドレス (IPv4 または IPv6) とすることができます。<code class="literal">'localhost'</code> という名前はローカルホストを示します。IP アドレス <code class="literal">'127.0.0.1'</code> は IPv4 ループバックインタフェースを示します。IP アドレス <code class="literal">'::1'</code> は、IPv6 ループバックインタフェースを示します。
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139979121640384"></a> ワイルドカード文字 <span class="quote">「<span class="quote"><code class="literal">%</code></span>」</span> および <span class="quote">「<span class="quote"><code class="literal">_</code></span>」</span> を、ホスト名または IP アドレスの値に使用できます。これらは <code class="literal">LIKE</code> 演算子で実行されるパターンマッチング演算と同じ意味を持ちます。たとえば、ホスト値 <code class="literal">'%'</code> はあらゆるホスト名に一致し、<code class="literal">'%.mysql.com'</code> という値は <code class="literal">mysql.com</code> ドメイン内のすべてのホストに一致し、<code class="literal">'192.168.1.%'</code> は 192.168.1 のクラス C ネットワークのあらゆるホストに一致します。
        </p><p>
          IP ワイルドカード値をホスト値に使用できるため (サブネット上のすべてのホストに一致する <code class="literal">'192.168.1.%'</code> など)、一部のユーザーがホスト <code class="literal">192.168.1.somewhere.com</code> を指定することによって、この機能を悪用しようとする可能性があります。このような試みを阻止するために、MySQL では、数字およびドットで始まるホスト名との一致が許可されていません。したがって、<code class="literal">1.2.example.com</code> のような名前を持つホストがある場合、その名前はアカウント名のホスト部分と決して一致しません。IP ワイルドカード値は、ホスト名でなく IP アドレスのみと一致することができます。
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139979121627312"></a> IPv4 アドレスで指定されるホスト値について、ネットワーク番号に使用するアドレスビットの数を示すネットマスクを指定することができます。ネットマスク表記は IPv6 アドレスについては使用できません。
        </p><p>
          構文は <code class="literal"><em class="replaceable"><code>host_ip</code></em>/<em class="replaceable"><code>netmask</code></em></code> です。例:
        </p><pre class="programlisting">
CREATE USER 'david'@'192.58.197.0/255.255.255.0';
</pre><p>
          これにより <code class="literal">david</code> は、次の条件が true となる IP アドレス <em class="replaceable"><code>client_ip</code></em> を持つすべてのクライアントホストから接続できます。
        </p><pre class="programlisting">
<em class="replaceable"><code>client_ip</code></em> &amp; <em class="replaceable"><code>netmask</code></em> = <em class="replaceable"><code>host_ip</code></em>
</pre><p>
          つまり、次のような <code class="literal">CREATE USER</code> ステートメントがあるとします。
        </p><pre class="programlisting">
<em class="replaceable"><code>client_ip</code></em> &amp; 255.255.255.0 = 192.58.197.0
</pre><p>
          この条件を満たし、MySQL サーバーに接続できる IP アドレスは、<code class="literal">192.58.197.0</code> から <code class="literal">192.58.197.255</code> までの範囲のものです。
        </p><p>
          ネットマスクは、8、16、24、または 32 ビットのアドレスを使用するようサーバーに指示するためにのみ使用できます。例:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">192.0.0.0/255.0.0.0</code>: 192 のクラス A ネットワーク上のすべてのホスト
            </p></li><li class="listitem"><p>
              <code class="literal">192.168.0.0/255.255.0.0</code>: 192.168 のクラス B ネットワーク上のすべてのホスト
            </p></li><li class="listitem"><p>
              <code class="literal">192.168.1.0/255.255.255.0</code>: 192.168.1 のクラス C ネットワーク上のすべてのホスト
            </p></li><li class="listitem"><p>
              <code class="literal">192.168.1.1</code>: この特定の IP アドレスを持つホストのみ
            </p></li></ul></div><p>
          次のネットマスクは 28 ビットをマスクしますが、28 は 8 の倍数でないため機能しません。
        </p><pre class="programlisting">
192.168.0.1/255.255.255.240
</pre></li></ul></div><p>
      サーバーは、クライアントホスト名または IP アドレス用のシステム DNS リゾルバによって返された値を使用して、アカウント名のホスト値の突き合わせをクライアントホストに対して実行します。アカウントホスト値がネットマスク記法を使用して指定される場合を除き、この比較は IP アドレスとして指定されるアカウントホスト値であっても文字列の突き合わせとして実行されます。つまり、DNS によって使用されるのと同じ形式でアカウントホスト値を指定しなければならないということを意味します。留意するべき問題の例を次に示します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          ローカルネットワーク上のホストの完全修飾名が <code class="literal">host1.example.com</code> だとします。DNS がこのホストの名前参照を <code class="literal">host1.example.com</code> として返す場合、アカウントホスト値にこの名前を使用します。ただし、DNS が <code class="literal">host1</code> のみを返す場合、代わりに <code class="literal">host1</code> を使用します。
        </p></li><li class="listitem"><p>
          DNS が特定のホストの IP アドレスとして <code class="literal">192.168.1.2</code> を返す場合、これはアカウントホスト値 <code class="literal">192.168.1.2</code> と一致しますが <code class="literal">192.168.01.2</code> とは一致しません。同様に、これは <code class="literal">192.168.1.%</code> のようなアカウントホストパターンに一致しますが <code class="literal">192.168.01.%</code> には一致しません。
        </p></li></ul></div><p>
      このような問題を避けるために、DNS がホスト名およびアドレスを返す際の形式を確認し、同じ形式の値を MySQL アカウント名に使用するようにすることをお勧めします。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="connection-access"></a>6.2.4 アクセス制御、ステージ 1: 接続の検証</h3></div></div></div><a class="indexterm" name="idm139979121590432"></a><a class="indexterm" name="idm139979121588992"></a><a class="indexterm" name="idm139979121586960"></a><p>
      ユーザーが MySQL サーバーに接続しようとすると、サーバーはユーザーの ID と、正しいパスワードを指定することでユーザーが自分の ID を検証できるかどうかに基づいて、接続を受け入れるか拒否します。できない場合、サーバーはアクセスを完全に拒否します。それ以外の場合、サーバーは接続を受け入れてステージ 2 に進み、リクエストを待機します。
    </p><p>
      ユーザーの ID は 2 つの部分の情報に基づきます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          接続元のクライアントホスト
        </p></li><li class="listitem"><p>
          MySQL ユーザー名
        </p></li></ul></div><p>
      ID チェックは、<code class="literal">user</code> テーブルの 3 つのスコープカラム (<code class="literal">Host</code>、<code class="literal">User</code>、<code class="literal">Password</code>) を使用して実施されます。サーバーは、一部の <code class="literal">user</code> テーブル行の <code class="literal">Host</code> および <code class="literal">User</code> カラムがクライアントホスト名およびユーザー名と一致し、その行に指定されているパスワードがクライアントから提供された場合のみ、接続を受け入れます。許容可能な <code class="literal">Host</code> および <code class="literal">User</code> 値についてのルールは、<a class="xref" href="security.html#account-names" title="6.2.3 アカウント名の指定">セクション6.2.3「アカウント名の指定」</a>にあります。
    </p><a class="indexterm" name="idm139979121572960"></a><p>
      <code class="literal">User</code> カラム値がブランクでない場合、入接続のユーザー名は正確に一致する必要があります。<code class="literal">User</code> 値がブランクの場合、これはすべてのユーザー名と一致します。入接続と一致する <code class="literal">user</code> テーブル行のユーザー名がブランクである場合、ユーザーはクライアントが実際に指定した名前を持つユーザーでなく、名前のない匿名ユーザーとみなされます。つまり、接続期間中の (つまりステージ 2 での) 今後のすべてのアクセスチェックでブランクのユーザー名が使用されることを意味します。
    </p><p>
      <code class="literal">Password</code> カラムはブランクにできます。これはワイルドカードではなく、あらゆるパスワードが一致するという意味ではありません。これは、ユーザーはパスワードを指定せずに接続しなければならないことを意味します。サーバーがプラグインを使用してクライアントを認証する場合、プラグインが実装する認証方式で、<code class="literal">Password</code> カラムのパスワードが使用される場合もそうでない場合もあります。この場合、MySQL サーバーへの認証を行う際に、外部パスワードも使用される可能性があります。
    </p><a class="indexterm" name="idm139979121565168"></a><p>
      <code class="literal">user</code> テーブル内のブランクでない <code class="literal">Password</code> 値は暗号化パスワードを表します。MySQL は、すべてのユーザーが表示できるプレーンテキスト形式のパスワードを格納しません。代わりに、接続しようとしたユーザーが入力したパスワードは (<code class="literal">PASSWORD()</code> 関数を使用して) 暗号化されます。そのあと、暗号化パスワードは、接続プロセス中にパスワードが正しいかどうかをチェックするときに使用されます。これは、暗号化パスワードが接続を介してやりとりされずに実行されます。<a class="xref" href="security.html#user-names" title="6.3.1 ユーザー名とパスワード">セクション6.3.1「ユーザー名とパスワード」</a>を参照してください。
    </p><p>
      MySQL から見ると、暗号化パスワードが<span class="emphasis"><em>実際の</em></span>パスワードであるため、暗号化パスワードへのアクセス権限をすべてのユーザーに付与しないようにしてください。特に、<span class="emphasis"><em>管理者以外のユーザーに、<code class="literal">mysql</code> データベース内のテーブルへの読み取りアクセス権限を付与しないでください</em></span>。
    </p><p>
      次の表では、<code class="literal">user</code> テーブルエントリの <code class="literal">Host</code> 値および <code class="literal">User</code> 値のさまざまな組み合わせが入接続にどのように適用されるかを示しています。
    </p><div class="informaltable"><table summary="この表では、user テーブルの Host 値および User 値のさまざまな組み合わせが MySQL サーバーへの入接続にどのように適用されるかを示しています。" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col"><code class="literal">Host</code> 値</th><th scope="col"><code class="literal">User</code> 値</th><th scope="col">許容される接続</th></tr></thead><tbody><tr><td scope="row"><code class="literal">'thomas.loc.gov'</code></td><td><code class="literal">'fred'</code></td><td><code class="literal">thomas.loc.gov</code> から接続する <code class="literal">fred</code></td></tr><tr><td scope="row"><code class="literal">'thomas.loc.gov'</code></td><td><code class="literal">''</code></td><td><code class="literal">thomas.loc.gov</code> から接続するすべてのユーザー</td></tr><tr><td scope="row"><code class="literal">'%'</code></td><td><code class="literal">'fred'</code></td><td>任意のホストから接続する <code class="literal">fred</code></td></tr><tr><td scope="row"><code class="literal">'%'</code></td><td><code class="literal">''</code></td><td>任意のホストから接続する任意のユーザー</td></tr><tr><td scope="row"><code class="literal">'%.loc.gov'</code></td><td><code class="literal">'fred'</code></td><td><code class="literal">loc.gov</code> ドメイン内の任意のホストから接続する <code class="literal">fred</code></td></tr><tr><td scope="row"><code class="literal">'x.y.%'</code></td><td><code class="literal">'fred'</code></td><td><code class="literal">x.y.net</code>、<code class="literal">x.y.com</code>、<code class="literal">x.y.edu</code> などから接続する <code class="literal">fred</code>。おそらく有用ではありません</td></tr><tr><td scope="row"><code class="literal">'144.155.166.177'</code></td><td><code class="literal">'fred'</code></td><td>IP アドレス <code class="literal">144.155.166.177</code> のホストから接続する <code class="literal">fred</code></td></tr><tr><td scope="row"><code class="literal">'144.155.166.%'</code></td><td><code class="literal">'fred'</code></td><td><code class="literal">144.155.166</code> のクラス C サブネットの任意のホストから接続する <code class="literal">fred</code></td></tr><tr><td scope="row"><code class="literal">'144.155.166.0/255.255.255.0'</code></td><td><code class="literal">'fred'</code></td><td>前の例と同じ</td></tr></tbody></table></div><p>
      入接続のクライアントホスト名およびユーザー名が <code class="literal">user</code> テーブルの複数行と一致することもあります。このことは前の一連の例で示されており、示されている複数のエントリが、<code class="literal">fred</code> による <code class="literal">thomas.loc.gov</code> からの接続に一致します。
    </p><p>
      複数の一致が可能な場合、サーバーはいずれを使用するかを決定する必要があります。この問題は、次のように解決されます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          サーバーが <code class="literal">user</code> テーブルをメモリーに読み取るとき、行を毎回ソートします。
        </p></li><li class="listitem"><p>
          クライアントが接続しようとすると、サーバーは行をソート順に参照します。
        </p></li><li class="listitem"><p>
          サーバーは、クライアントホスト名およびユーザー名が一致した最初の行を使用します。
        </p></li></ul></div><p>
      サーバーは、具体性がもっとも高い <code class="literal">Host</code> 値が先になるように行を並べるソートルールを使用します。リテラルのホスト名および IP アドレスは具体性がもっとも高くなります。(リテラルの IP アドレスの具体性は IP アドレスがネットマスクを持つかどうかによって影響されないため、<code class="literal">192.168.1.13</code> と <code class="literal">192.168.1.0/255.255.255.0</code> の具体性は同等とみなされます。)パターン <code class="literal">'%'</code> は<span class="quote">「<span class="quote">任意のホスト</span>」</span>を意味するため、具体性はもっとも低くなります。空の文字列 <code class="literal">''</code> も<span class="quote">「<span class="quote">任意のホスト</span>」</span>を意味しますが、<code class="literal">'%'</code> のあとにソートされます。同じ <code class="literal">Host</code> 値を持つ行は、もっとも具体的な <code class="literal">User</code> 値が最初になるよう並べられます (ブランクの <code class="literal">User</code> 値は <span class="quote">「<span class="quote">任意のユーザー</span>」</span>を意味し、具体性がもっとも低くなります)。<code class="literal">Host</code> および <code class="literal">User</code> 値の具体性が等しい行については、順序は不確定です。
    </p><p>
      <code class="literal">user</code> テーブルが次の内容であると仮定して、これがどのように作用するかを説明します。
    </p><pre class="programlisting">
+-----------+----------+-
| Host      | User     | ...
+-----------+----------+-
| %         | root     | ...
| %         | jeffrey  | ...
| localhost | root     | ...
| localhost |          | ...
+-----------+----------+-
</pre><p>
      サーバーがテーブルをメモリーに読み取るとき、サーバーは前に記載したルールを使用して行をソートします。ソート後の結果は次のようになります。
    </p><pre class="programlisting">
+-----------+----------+-
| Host      | User     | ...
+-----------+----------+-
| localhost | root     | ...
| localhost |          | ...
| %         | jeffrey  | ...
| %         | root     | ...
+-----------+----------+-
</pre><a class="indexterm" name="idm139979121490640"></a><a class="indexterm" name="idm139979121488496"></a><a class="indexterm" name="idm139979121486464"></a><p>
      クライアントが接続しようとすると、サーバーはソート済みの行を参照し、見つかった最初の一致を使用します。<code class="literal">jeffrey</code> による <code class="literal">localhost</code> からの接続の場合、テーブルの 2 つの行が一致し、すなわち <code class="literal">Host</code> および <code class="literal">User</code> 値が <code class="literal">'localhost'</code> および <code class="literal">''</code> であるものと、値が <code class="literal">'%'</code> および <code class="literal">'jeffrey'</code> であるものが一致します。ソート順では <code class="literal">'localhost'</code> 行が最初になるため、サーバーはこの行を使用します。
    </p><p>
      次に別の例を示します。<code class="literal">user</code> テーブルが次のようになっていると仮定します。
    </p><pre class="programlisting">
+----------------+----------+-
| Host           | User     | ...
+----------------+----------+-
| %              | jeffrey  | ...
| thomas.loc.gov |          | ...
+----------------+----------+-
</pre><p>
      ソート済みテーブルは次のようになります。
    </p><pre class="programlisting">
+----------------+----------+-
| Host           | User     | ...
+----------------+----------+-
| thomas.loc.gov |          | ...
| %              | jeffrey  | ...
+----------------+----------+-
</pre><p>
      <code class="literal">jeffrey</code> による <code class="literal">thomas.loc.gov</code> からの接続は最初の行に一致しますが、<code class="literal">jeffrey</code> による任意のホストからの接続は 2 番目の行に一致します。
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        よくある誤解として、ある特定のユーザー名についてサーバーが接続に対する一致を検出しようとしたとき、そのユーザーの名前を明示的に指定するすべての行が最初に使用されるという認識があります。これは正しくありません。このことは前述の例によって説明され、<code class="literal">jeffrey</code> による <code class="literal">thomas.loc.gov</code> からの接続は、<code class="literal">User</code> カラム値として <code class="literal">'jeffrey'</code> を格納している行ではなく、ユーザー名のない行が最初に一致します。その結果、<code class="literal">jeffrey</code> は接続するときにユーザー名を指定したにもかかわらず、匿名ユーザーとして認証されます。
      </p></div><p>
      サーバーに接続できても権限が期待したものとは異なる場合、おそらくほかのアカウントとして認証されています。サーバーがユーザーの認識に使用したアカウントを見つけるには、<code class="literal">CURRENT_USER()</code> 関数を使用します。(<a class="xref" href="functions.html#information-functions" title="12.14 情報関数">セクション12.14「情報関数」</a>を参照してください。)これは、一致する <code class="literal">user</code> テーブル行の <code class="literal">User</code> および <code class="literal">Host</code> 値を示す、<code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code> 形式の値を返します。たとえば、<code class="literal">jeffrey</code> が接続して、次のクエリーを発行したとします。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT CURRENT_USER();</code></strong>
+----------------+
| CURRENT_USER() |
+----------------+
| @localhost     |
+----------------+
</pre><p>
      ここで表示された結果は、一致した <code class="literal">user</code> テーブル行の <code class="literal">User</code> カラム値がブランクであることを示しています。つまり、サーバーは <code class="literal">jeffrey</code> を匿名ユーザーとして扱っています。
    </p><p>
      認証の問題を診断するための別の方法は、<code class="literal">user</code> テーブルを出力し、テーブルを手作業でソートして、最初の一致が行われた行を確認する方法です。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="request-access"></a>6.2.5 アクセス制御、ステージ 2: リクエストの確認</h3></div></div></div><p>
      接続が確立されたあと、サーバーはアクセス制御のステージ 2 に入ります。接続を介してユーザーが発行する各リクエストに対し、サーバーはユーザーが実行する操作を判別し、その操作を行う十分な権限をユーザーが持つかどうかを検査します。ここで、付与テーブルの権限カラムが役立ちます。これらの権限は、<code class="literal">user</code>、<code class="literal">db</code>、<code class="literal">tables_priv</code>、<code class="literal">columns_priv</code>、または <code class="literal">procs_priv</code> テーブルから取得される可能性があります。(それぞれの付与テーブルにあるカラムの一覧を示す、<a class="xref" href="security.html#grant-table-structure" title="6.2.2 権限システム付与テーブル">セクション6.2.2「権限システム付与テーブル」</a>を参照すると役立つことがあります。)
    </p><p>
      <code class="literal">user</code> テーブルは、ユーザーにグローバルに割り当てられ、デフォルトのデータベースに関係なく適用される権限を付与します。たとえば、<code class="literal">user</code> テーブルによってユーザーに <code class="literal">DELETE</code> 権限が付与された場合、そのサーバーホスト上のあらゆるデータベースのあらゆるテーブルの行を削除できてしまいます。<code class="literal">user</code> テーブルの権限は、データベース管理者などの権限を必要とするユーザーに対してのみ付与するのが賢明です。ほかのユーザーについては、<code class="literal">user</code> テーブルのすべての権限を <code class="literal">'N'</code> に設定しておき、具体的なレベルでのみ権限を付与するようにします。特定のデータベース、テーブル、カラム、またはルーチンに対して権限を付与することができます。
    </p><a class="indexterm" name="idm139979121438624"></a><a class="indexterm" name="idm139979121437152"></a><p>
      <code class="literal">db</code> テーブルは、データベース固有の権限を付与します。このテーブルのスコープカラムの値は、次の形式を取ることができます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          ブランクの <code class="literal">User</code> 値は匿名ユーザーに一致します。ブランク以外の値は文字どおりに一致し、ユーザー名にワイルドカードはありません。
        </p></li><li class="listitem"><p>
          <code class="literal">Host</code> および <code class="literal">Db</code> カラム内でワイルドカード文字<span class="quote">「<span class="quote"><code class="literal">%</code></span>」</span>および<span class="quote">「<span class="quote"><code class="literal">_</code></span>」</span>を使用することができます。これらは <code class="literal">LIKE</code> 演算子で実行されるパターンマッチング演算と同じ意味を持ちます。権限を付与するときにいずれかの文字を文字どおりに使用する場合、文字をバックスラッシュでエスケープする必要があります。たとえば、データベース名の一部としてアンダースコア文字 (<span class="quote">「<span class="quote"><code class="literal">_</code></span>」</span>) を含めるには、<code class="literal">GRANT</code> ステートメント内でこれを <span class="quote">「<span class="quote"><code class="literal">\_</code></span>」</span> と指定します。
        </p></li><li class="listitem"><p>
          <code class="literal">'%'</code> またはブランクの <code class="literal">Host</code> 値は、<span class="quote">「<span class="quote">任意のホスト</span>」</span>を意味します。
        </p></li><li class="listitem"><p>
          <code class="literal">'%'</code> またはブランクの <code class="literal">Db</code> 値は、<span class="quote">「<span class="quote">任意のデータベース</span>」</span>を意味します。
        </p></li></ul></div><a class="indexterm" name="idm139979121417952"></a><a class="indexterm" name="idm139979121415808"></a><a class="indexterm" name="idm139979121413776"></a><a class="indexterm" name="idm139979121411728"></a><p>
      サーバーは <code class="literal">user</code> テーブルを読み取るのと同時に、<code class="literal">db</code> テーブルをメモリーに読み取ってソートします。サーバーは、<code class="literal">Host</code>、<code class="literal">Db</code>、および <code class="literal">User</code> スコープカラムに基づき <code class="literal">db</code> テーブルをソートします。<code class="literal">user</code> テーブルと同じように、ソートでは、もっとも具体的な値が最初に配置され、もっとも具体的でない値が最後に配置され、サーバーが一致するエントリを参照するときは、見つかった最初の一致が使用されます。
    </p><a class="indexterm" name="idm139979121403488"></a><a class="indexterm" name="idm139979121401280"></a><a class="indexterm" name="idm139979121399168"></a><p>
      <code class="literal">tables_priv</code>、<code class="literal">columns_priv</code>、および <code class="literal">procs_priv</code> テーブルは、テーブル固有、カラム固有、およびルーチン固有の権限を付与します。これらのテーブルのスコープカラムの値は、次の形式を取ることができます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">Host</code> カラム内でワイルドカード文字<span class="quote">「<span class="quote"><code class="literal">%</code></span>」</span>および<span class="quote">「<span class="quote"><code class="literal">_</code></span>」</span>を使用することができます。これらは <code class="literal">LIKE</code> 演算子で実行されるパターンマッチング演算と同じ意味を持ちます。
        </p></li><li class="listitem"><p>
          <code class="literal">'%'</code> またはブランクの <code class="literal">Host</code> 値は、<span class="quote">「<span class="quote">任意のホスト</span>」</span>を意味します。
        </p></li><li class="listitem"><p>
          <code class="literal">Db</code>、<code class="literal">Table_name</code>、<code class="literal">Column_name</code>、および <code class="literal">Routine_name</code> カラムは、ワイルドカードを含めたり、ブランクにしたりすることができません。
        </p></li></ul></div><p>
      サーバーは、<code class="literal">Host</code>、<code class="literal">Db</code>、および <code class="literal">User</code> カラムに基づき、<code class="literal">tables_priv</code>、<code class="literal">columns_priv</code>、および <code class="literal">procs_priv</code> テーブルをソートします。これは <code class="literal">db</code> テーブルのソートと同様ですが、<code class="literal">Host</code> カラムのみワイルドカードを含めることができるため、よりシンプルです。
    </p><p>
      サーバーはソート済みテーブルを使用して、サーバーが受け取るリクエストを検証します。<code class="literal">SHUTDOWN</code> や <code class="literal">RELOAD</code> などの管理権限が必要なリクエストでは、サーバーは <code class="literal">user</code> テーブル行のみチェックします。これは、管理権限を指定するのはこのテーブルだけであるためです。リクエストされた操作がその行によって許可される場合、サーバーはアクセス権限を付与し、そうでない場合はアクセスを拒否します。たとえば、ユーザーが <span class="command"><strong>mysqladmin shutdown</strong></span> を実行したいが、<code class="literal">user</code> テーブル行によって <code class="literal">SHUTDOWN</code> 権限がユーザーに付与されていない場合、サーバーは <code class="literal">db</code> テーブルさえもチェックせずにアクセスを拒否します。(これには <code class="literal">Shutdown_priv</code> カラムがないため、実行は不要です。)
    </p><p>
      データベース関連のリクエスト (<code class="literal">INSERT</code>、<code class="literal">UPDATE</code> など) の場合、サーバーは <code class="literal">user</code> テーブル行を参照することによって、ユーザーのグローバル権限を最初にチェックします。リクエストされた操作が行で許可されている場合、アクセス権限が付与されます。<code class="literal">user</code> テーブル内のグローバル権限が不十分な場合、サーバーは <code class="literal">db</code> テーブルをチェックすることによってユーザーのデータベース固有の権限を調べます。
    </p><p>
      サーバーは、<code class="literal">db</code> テーブルを参照し <code class="literal">Host</code>、<code class="literal">Db</code>、および <code class="literal">User</code> カラムの一致がないかチェックします。<code class="literal">Host</code> および <code class="literal">User</code> カラムは、接続するユーザーのホスト名および MySQL ユーザー名に突き合わせされます。<code class="literal">Db</code> カラムは、ユーザーがアクセスしようとしているデータベースに突き合わせされます。<code class="literal">Host</code> および <code class="literal">User</code> に該当する行がない場合、アクセスは拒否されます。
    </p><p>
      <code class="literal">db</code> テーブルエントリによって付与されるデータベース固有の権限を判別したあと、サーバーは <code class="literal">user</code> テーブルによって付与されるグローバル権限にそれらの権限を追加します。その結果、リクエストされた操作が許可される場合、アクセス権限が付与されます。そうでない場合、サーバーは続けて <code class="literal">tables_priv</code> および <code class="literal">columns_priv</code> テーブル内でユーザーのテーブル権限およびカラム権限をチェックし、これらをユーザーの権限に追加し、結果に基づいてアクセスを許可または拒否します。ストアドルーチン操作の場合、サーバーは <code class="literal">tables_priv</code> および <code class="literal">columns_priv</code> の代わりに <code class="literal">procs_priv</code> テーブルを使用します。
    </p><p>
      ブール条件によって表現すると、ユーザーの権限を計算する方法についての前述の説明は、次のように要約できます。
    </p><pre class="programlisting">
global privileges
OR (database privileges AND host privileges)
OR table privileges
OR column privileges
OR routine privileges
</pre><p>
      リクエストされた操作に対して <code class="literal">user</code> 行のグローバル権限が最初に十分ではないことがわかっている場合に、サーバーがそれらの権限をあとでデータベース権限、テーブル権限、およびカラム権限と組み合わせることの理由が明確でないかもしれません。この理由は、1 つのリクエストが複数のタイプの権限を必要とすることがあるためです。たとえば、<code class="literal">INSERT INTO ... SELECT</code> ステートメントを実行する場合、<code class="literal">INSERT</code> および <code class="literal">SELECT</code> 権限が両方必要です。使用する権限が、<code class="literal">user</code> テーブル行で 1 つの権限を付与し、<code class="literal">db</code> テーブル行でもう 1 つの権限を付与するようになっている場合があります。この状況で、リクエストを実行するために必要な権限はありますが、サーバーはいずれのテーブルから来たものかを見分けることができず、両方のテーブルのエントリによって付与される権限を組み合わせる必要があります。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="privilege-changes"></a>6.2.6 権限変更が有効化される時期</h3></div></div></div><a class="indexterm" name="idm139979121338096"></a><a class="indexterm" name="idm139979121335984"></a><p>
      <span class="command"><strong>mysqld</strong></span> を起動すると、すべての付与テーブルの内容がメモリーに読み取られます。インメモリーテーブルは、その時点でアクセス制御に有効になります。
    </p><p>
      ユーザーが <code class="literal">GRANT</code>、<code class="literal">REVOKE</code>、<code class="literal">SET PASSWORD</code>、<code class="literal">RENAME USER</code> などのアカウント管理ステートメントを使用して、付与テーブルを間接的に変更した場合、サーバーはそれらの変更を認識し、再びすぐに付与テーブルをメモリーにロードします。
    </p><p>
      <code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、<code class="literal">DELETE</code> などのステートメントを使用して、付与テーブルを直接変更する場合、サーバーを再起動するか、テーブルをリロードするようサーバーに指示するまで、変更内容は権限チェックに影響しません。付与テーブルを直接変更したが、それらをリロードし忘れた場合、サーバーを再起動するまで変更は<span class="emphasis"><em>影響しません</em></span>。このため、変更したのに違いが現れないことを不思議に思うことがあるかもしれません。
    </p><p>
      付与テーブルをリロードするようサーバーに指示するには、フラッシュ権限操作を実行します。これは、<code class="literal">FLUSH PRIVILEGES</code> ステートメントを発行するか、<span class="command"><strong>mysqladmin flush-privileges</strong></span> または <span class="command"><strong>mysqladmin reload</strong></span> コマンドを実行することによって行うことができます。
    </p><p>
      付与テーブルのリロードは、既存のクライアント接続のための権限に次のような影響を及ぼします。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          テーブルおよびカラムの権限の変更は、クライアントの次回のリクエストで有効になります。
        </p></li><li class="listitem"><p>
          データベース権限の変更は、クライアントが次回 <code class="literal">USE <em class="replaceable"><code>db_name</code></em></code> ステートメントを実行したときに有効になります。
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            クライアントアプリケーションがデータベース名をキャッシュしている場合があるため、この影響は、実際に別のデータベースに変更したり、権限をフラッシュしたりしないかぎり、クライアントアプリケーションに認識されないことがあります。
          </p></div></li><li class="listitem"><p>
          接続済みクライアントについてのグローバルな権限およびパスワードは影響されません。これらの変更は、後続の接続についてのみ有効になります。
        </p></li></ul></div><p>
      サーバーが <code class="option">--skip-grant-tables</code> オプションを指定して起動された場合、サーバーは付与テーブルを読み取ったりアクセス制御を実装したりしません。すべてのユーザーが接続してあらゆることが可能であるため、<span class="emphasis"><em>セキュアではありません。</em></span>そのように起動されたサーバーが、テーブルを読み取ってアクセスチェックを有効にするようにするには、権限をフラッシュします。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="access-denied"></a>6.2.7 アクセス拒否エラーの原因</h3></div></div></div><a class="indexterm" name="idm139979121309808"></a><a class="indexterm" name="idm139979121308496"></a><a class="indexterm" name="idm139979121306304"></a><p>
      MySQL サーバーへの接続を試行したときに問題が発生した場合に問題を修正するために実行できる一連のアクションについて、次の項目で説明します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          サーバーが実行中であることを確認します。そうでない場合、クライアントは接続できません。たとえば、サーバーに接続しようとして次のいずれかのようなメッセージで失敗した場合、サーバーが実行中でないことが 1 つの原因であることがあります。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql</code></strong>
ERROR 2003: Can't connect to MySQL server on '<em class="replaceable"><code>host_name</code></em>' (111)
shell&gt; <strong class="userinput"><code>mysql</code></strong>
ERROR 2002: Can't connect to local MySQL server through socket
'/tmp/mysql.sock' (111)
</pre></li><li class="listitem"><p>
          サーバーは実行しているが、サーバーが待機しているのと異なる TCP/IP ポート、名前付きパイプ、または Unix ソケットファイルを使用して接続しようとしている場合もあります。これを修正するには、クライアントプログラムを呼び出すときに、適切なポート番号を指すように <code class="option">--port</code> オプションを指定するか、<code class="option">--socket</code> で適切な名前付きパイプまたは Unix ソケットファイルを指定します。ソケットファイルがある場所を見つけるには、次のコマンドを使用できます。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>netstat -ln | grep mysql</code></strong>
</pre></li><li class="listitem"><p>
          サーバーがネットワーク接続を無視するように構成されていないこと、または (リモート側から接続しようとする場合に) サーバーのネットワークインタフェース上でローカル側でのみ待機するように構成されていないことを確認します。サーバーが <code class="option">--skip-networking</code> を指定して起動された場合、サーバーは TCP/IP 接続を受け入れません。サーバーが <code class="option">--bind-address=127.0.0.1</code> を指定して起動された場合、サーバーはローカルのループバックインタフェース上でのみ TCP/IP 接続を待機するためリモート接続を受け入れません。
        </p></li><li class="listitem"><p>
          ファイアウォールが MySQL へのアクセスをブロックしていないか確認します。ファイアウォールは、実行中のアプリケーションまたは MySQL によって通信用に使用されるポート番号 (デフォルトは 3306) を基準として構成されることがあります。Linux または Unix の場合、IP テーブル (または同様の機能の) 構成を調べてポートがブロックされていないことを確認します。Windows の場合、ZoneAlarm や Windows XP パーソナルファイアウォールなどのアプリケーションが MySQL ポートをブロックしないようにこれらを構成することが必要な場合があります。
        </p></li><li class="listitem"><p>
          付与テーブルが適切にセットアップされており、サーバーがこれをアクセス制御に使用できるようになっていることが必要です。一部の配布タイプ (Windows のバイナリ配布または Linux の RPM 配布など) では、インストールプロセスで、付与テーブルがある <code class="literal">mysql</code> データベースが初期化されます。これを行わない配布の場合、<span class="command"><strong>mysql_install_db</strong></span> プログラムを実行して付与テーブルを手動で初期化する必要があります。詳細については、<a class="xref" href="installing.html#unix-postinstallation" title="2.10.1 Unix 類似システムでのインストール後の手順">セクション2.10.1「Unix 類似システムでのインストール後の手順」</a>を参照してください。
        </p><p>
          付与テーブルの初期化が必要かどうかを判別するには、データディレクトリの下にある <code class="filename">mysql</code> ディレクトリを参照します。(通常、データディレクトリは <code class="filename">data</code> または <code class="filename">var</code> という名前で、MySQL のインストールディレクトリの下にあります。)<code class="filename">mysql</code> データベースディレクトリに <code class="filename">user.MYD</code> という名前のファイルがあることを確認してください。ない場合、<span class="command"><strong>mysql_install_db</strong></span> プログラムを実行します。このプログラムを実行してサーバーを起動したあと、次のコマンドを実行して初期の権限をテストします。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u root test</code></strong>
</pre><p>
          サーバーはエラーを出さずにユーザーを接続するはずです。
        </p></li><li class="listitem"><p>
          新規インストールのあと、サーバーに接続してユーザーおよびユーザーのアクセス権限をセットアップするようにします。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u root mysql</code></strong>
</pre><p>
          MySQL <code class="literal">root</code> ユーザーには最初からパスワードがないため、サーバーはユーザーを接続するはずです。これにはセキュリティー面でのリスクが伴うため、別の MySQL アカウントをセットアップする際は、<code class="literal">root</code> アカウントのパスワードを設定することをお勧めします。初期パスワードの設定手順に関しては、<a class="xref" href="installing.html#default-privileges" title="2.10.2 最初の MySQL アカウントのセキュリティー設定">セクション2.10.2「最初の MySQL アカウントのセキュリティー設定」</a>を参照してください。
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139979121271248"></a> 既存の MySQL インストールを新しいバージョンに更新した場合、<span class="command"><strong>mysql_upgrade</strong></span> スクリプトを実行したかどうかを確認します。行なっていない場合は実行します。付与テーブルの構造は、新機能が追加されるときにしばしば変更されるため、アップグレードしたあとは常に、テーブルの構造が最新であることを確認することをお勧めします。その手順は、<a class="xref" href="programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — MySQL テーブルのチェックとアップグレード">セクション4.4.7「<span class="command"><strong>mysql_upgrade</strong></span> — MySQL テーブルのチェックとアップグレード」</a>を参照してください。
        </p></li><li class="listitem"><p>
          クライアントプログラムが接続しようとしたときに次のエラーメッセージを受け取る場合、サーバーはクライアントが生成可能なものよりも新しい形式のパスワードを予期していることを意味します。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql</code></strong>
Client does not support authentication protocol requested
by server; consider upgrading MySQL client
</pre><p>
          これに対処する方法については、<a class="xref" href="security.html#password-hashing" title="6.1.2.4 MySQL でのパスワードハッシュ">セクション6.1.2.4「MySQL でのパスワードハッシュ」</a>および<a class="xref" href="error-handling.html#old-client" title="B.5.2.4 クライアントは認証プロトコルに対応できません">セクションB.5.2.4「クライアントは認証プロトコルに対応できません」</a>を参照してください。
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139979121262224"></a> <a class="indexterm" name="idm139979121260768"></a> <a class="indexterm" name="idm139979121259408"></a> <a class="indexterm" name="idm139979121258048"></a> クライアントプログラムはオプションファイルまたは環境変数に指定された接続パラメータを使用することに留意してください。コマンド行に接続パラメータを指定しないときにクライアントプログラムが間違ったデフォルトの接続パラメータを送信していると思われる場合、該当するオプションファイルおよび環境を確認してください。たとえば、オプションなしでクライアントを実行するときに <code class="literal">Access denied</code> を受け取る場合、いずれかのオプションファイルで古いパスワードを指定していないか確認してください。
        </p><p>
          <code class="option">--no-defaults</code> を指定してクライアントプログラムを呼び出すことによって、オプションファイルの使用をクライアントプログラムによって抑制することができます。例:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysqladmin --no-defaults -u root version</code></strong>
</pre><p>
          クライアントが使用するオプションファイルの一覧は、<a class="xref" href="programs.html#option-files" title="4.2.6 オプションファイルの使用">セクション4.2.6「オプションファイルの使用」</a>にあります。環境変数の一覧は、<a class="xref" href="installing.html#environment-variables" title="2.12 環境変数">セクション2.12「環境変数」</a>にあります。
        </p></li><li class="listitem"><p>
          次のエラーが出る場合、誤った <code class="literal">root</code> パスワードを使用していることを示しています。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysqladmin -u root -p<em class="replaceable"><code>xxxx</code></em> ver</code></strong>
Access denied for user 'root'@'localhost' (using password: YES)
</pre><p>
          パスワードを指定していないのに前述のエラーが発生する場合、いずれかのオプションファイルに間違ったパスワードがリストされていることを意味します。前述の項目で説明したように、<code class="option">--no-defaults</code> オプションを試してみてください。
        </p><p>
          パスワードの変更に関する情報は、<a class="xref" href="security.html#assigning-passwords" title="6.3.5 アカウントパスワードの割り当て">セクション6.3.5「アカウントパスワードの割り当て」</a>を参照してください。
        </p><p>
          <code class="literal">root</code> パスワードを紛失したか忘れた場合、<a class="xref" href="error-handling.html#resetting-permissions" title="B.5.4.1 root のパスワードをリセットする方法">セクションB.5.4.1「root のパスワードをリセットする方法」</a>を参照してください。
        </p></li><li class="listitem"><p>
          <code class="literal">SET PASSWORD</code>、<code class="literal">INSERT</code>、または <code class="literal">UPDATE</code> を使用してパスワードを変更する場合、<code class="literal">PASSWORD()</code> 関数を使用して、そのパスワードを暗号化する必要があります。これらのステートメントに対して <code class="literal">PASSWORD()</code> 関数を使用しないと、パスワードは機能しません。たとえば、次のステートメントはパスワードを割り当てますが、パスワードが暗号化されないため、ユーザーはあとで接続できません。
        </p><pre class="programlisting">
SET PASSWORD FOR 'abe'@'<em class="replaceable"><code>host_name</code></em>' = 'eagle';
</pre><p>
          代わりに、パスワードを次のように設定します。
        </p><pre class="programlisting">
SET PASSWORD FOR 'abe'@'<em class="replaceable"><code>host_name</code></em>' = PASSWORD('eagle');
</pre><p>
          <code class="literal">CREATE USER</code> または <code class="literal">GRANT</code> ステートメントまたは <span class="command"><strong>mysqladmin password</strong></span> コマンドを使用してパスワードを指定するときは、<code class="literal">PASSWORD()</code> 関数は不要です。これらはいずれも <code class="literal">PASSWORD()</code> を自動的に使用してパスワードを暗号化します。<a class="xref" href="security.html#assigning-passwords" title="6.3.5 アカウントパスワードの割り当て">セクション6.3.5「アカウントパスワードの割り当て」</a>および<a class="xref" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER 構文">セクション13.7.1.2「CREATE USER 構文」</a>を参照してください。
        </p></li><li class="listitem"><p>
          <code class="literal">localhost</code> はローカルホスト名のシノニムで、ホストを明示的に指定しない場合にクライアントが接続を試行するデフォルトホストでもあります。
        </p><p>
          そのようなシステムで前述の問題を回避するために、<code class="option">--host=127.0.0.1</code> オプションを使用して、サーバーホストを明示的に指定することができます。これにより、ローカルの <span class="command"><strong>mysqld</strong></span> サーバーへの TCP/IP 接続が作成されます。また、ローカルホストの実際のホスト名を使用する <code class="option">--host</code> オプションを指定することによって TCP/IP を使用することもできます。この場合、サーバーと同じホスト上でクライアントプログラムを実行していても、ホスト名がサーバーホスト上の <code class="literal">user</code> テーブル行に指定されていなければなりません。
        </p></li><li class="listitem"><p>
          <code class="literal">Access denied</code> というエラーメッセージは、ログインしようとしているユーザー名、接続を試行しているクライアントホスト、およびパスワードを使用したかどうかを通知します。通常では、エラーメッセージ内で指定されたホスト名およびユーザー名に正確に一致する 1 つの行を <code class="literal">user</code> テーブル内に持つようにします。たとえば、<code class="literal">using password: NO</code> というメッセージを含むエラーメッセージを受け取る場合、パスワードなしでログインしようとしたことを意味します。
        </p></li><li class="listitem"><p>
          <code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em></code> を使用してデータベースに接続しようとしたときに <code class="literal">Access denied</code> エラーを受け取った場合、<code class="literal">user</code> テーブルにおそらく問題があります。これをチェックするには、<code class="literal">mysql -u root mysql</code> を実行し、次の SQL ステートメントを発行します。
        </p><pre class="programlisting">
SELECT * FROM user;
</pre><p>
          この結果には、クライアントのホスト名および使用中の MySQL ユーザー名に一致する <code class="literal">Host</code> および <code class="literal">User</code> カラムを持つ行が含まれているはずです。
        </p></li><li class="listitem"><p>
          MySQL サーバーを実行しているホストではないホストから接続しようとして次のエラーが発生する場合、クライアントホストと一致する <code class="literal">Host</code> 値を持つ行が <code class="literal">user</code> テーブルにないということを意味しています。
        </p><pre class="programlisting">
Host ... is not allowed to connect to this MySQL server
</pre><p>
          これは、接続しようとするときに使用するクライアントホスト名およびユーザー名の組み合わせに対するアカウントをセットアップすることによって修正できます。
        </p><p>
          接続元のマシンの IP アドレスまたはホスト名がわからない場合、<code class="literal">Host</code> カラム値が <code class="literal">'%'</code> の行を <code class="literal">user</code> テーブル内に作成するようにします。そして、そのクライアントマシンから接続しようとしたあとで、<code class="literal">SELECT USER()</code> クエリーを使用して、実際にどのように接続したかを確認します。そのあと、<code class="literal">user</code> テーブル行の <code class="literal">'%'</code> を、ログに表示されている実際のホスト名に変更します。そうしない場合、特定のユーザー名について任意のホストからの接続が可能になるため、システムはセキュアでない状態のままになります。
        </p><p>
          Linux では、このエラーが発生する可能性がある別の理由として、使用中のバージョンとは異なるバージョンの <code class="literal">glibc</code> ライブラリでコンパイルされたバイナリ MySQL バージョンを使用しているということがあります。この場合、オペレーティングシステムまたは <code class="literal">glibc</code> をアップグレードするか、MySQL のソース配布バージョンをダウンロードして自分でコンパイルします。ソース RPM のコンパイルおよびインストールは通常簡単であるため、これは大きな問題ではありません。
        </p></li><li class="listitem"><p>
          接続しようとしたときにホスト名を指定したが、ホスト名が非表示または IP アドレスとなっているエラーメッセージを受け取った場合、MySQL サーバーはクライアントホストの IP アドレスを名前に解決しようとしたときにエラーを受け取ったことを意味します。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysqladmin -u root -p<em class="replaceable"><code>xxxx</code></em> -h <em class="replaceable"><code>some_hostname</code></em> ver</code></strong>
Access denied for user 'root'@'' (using password: YES)
</pre><p>
          <code class="literal">root</code> として接続しようとして次のエラーを受け取った場合、<code class="literal">User</code> カラム値が <code class="literal">'root'</code> の行が <code class="literal">user</code> テーブルになく、<span class="command"><strong>mysqld</strong></span> がクライアントに対してホスト名を解決できないことを意味します。
        </p><pre class="programlisting">
Access denied for user ''@'unknown'
</pre><p>
          これらのエラーは DNS の問題を示しています。これを修正するには、<span class="command"><strong>mysqladmin flush-hosts</strong></span> を実行して内部 DNS ホストキャッシュをリセットします。<a class="xref" href="optimization.html#host-cache" title="8.11.5.2 DNS ルックアップの最適化とホストキャッシュ">セクション8.11.5.2「DNS ルックアップの最適化とホストキャッシュ」</a>を参照してください。
        </p><p>
          いくつかの永続的な解決策を次に示します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              DNS サーバーの問題を判別して修正します。
            </p></li><li class="listitem"><p>
              MySQL 付与テーブルにホスト名の代わりに IP アドレスを指定します。
            </p></li><li class="listitem"><p>
              クライアントマシン名に対するエントリを、Unix の場合は <code class="filename">/etc/hosts</code> に、Windows の場合は <code class="filename">\windows\hosts</code> に配置します。
            </p></li><li class="listitem"><p>
              <span class="command"><strong>mysqld</strong></span> を <code class="option">--skip-name-resolve</code> オプションで起動します。
            </p></li><li class="listitem"><p>
              <span class="command"><strong>mysqld</strong></span> を <code class="option">--skip-host-cache</code> オプションで起動します。
            </p></li><li class="listitem"><p>
              Unix で、サーバーとクライアントを同じマシンで実行している場合、<code class="literal">localhost</code> に接続します。<code class="literal">localhost</code> への Unix 接続は、TCP/IP ではなく Unix ソケットファイルを使用します。
            </p></li><li class="listitem"><p>
              Windows で、サーバーとクライアントを同じマシンで実行していて、サーバーが名前付きパイプ接続をサポートしている場合、ホスト名 <code class="literal">.</code> (ピリオド) に接続します。<code class="literal">.</code> への接続には、TCP/IP ではなく名前付きパイプが使用されます。
            </p></li></ul></div></li><li class="listitem"><p>
          <code class="literal">mysql -u root test</code> は動作するが、<code class="literal">mysql -h <em class="replaceable"><code>your_hostname</code></em> -u root test</code> が <code class="literal">Access denied</code> になる場合 (ここで、<em class="replaceable"><code>your_hostname</code></em> はローカルホストの実際のホスト名)、ホスト名に対する正しい名前が <code class="literal">user</code> テーブル内にない可能性があります。このときよくある問題として、<code class="literal">user</code> テーブル行の <code class="literal">Host</code> 値は、修飾されていないホスト名を指定しているが、システムの名前解決ルーチンは完全修飾ドメイン名を返すということ (またはその逆) があります。たとえば、<code class="literal">user</code> テーブルにホスト <code class="literal">'pluto'</code> のエントリがあるが、DNS が MySQL に対してホスト名が <code class="literal">'pluto.example.com'</code> であると指示する場合、エントリは無効になります。ホストの IP アドレスを <code class="literal">Host</code> カラム値として格納するエントリを <code class="literal">user</code> テーブルに追加してみてください。(または、<code class="literal">'pluto.%'</code> などのワイルドカードを含む <code class="literal">Host</code> 値を持つエントリを <code class="literal">user</code> テーブルに追加することもできます。ただし、<span class="quote">「<span class="quote"><code class="literal">%</code></span>」</span>で終わる <code class="literal">Host</code> 値を使用することは<span class="emphasis"><em>安全でない</em></span>ため推奨<span class="emphasis"><em>されません</em></span>。)
        </p></li><li class="listitem"><p>
          <code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em> test</code> が動作するが、<code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em> <em class="replaceable"><code>other_db</code></em></code> が動作しない場合、<em class="replaceable"><code>other_db</code></em> という名前のデータベースについて、特定のユーザーにアクセス権限を付与していません。
        </p></li><li class="listitem"><p>
          <code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em></code> をサーバーホスト上で実行したときに動作するが、<code class="literal">mysql -h <em class="replaceable"><code>host_name</code></em> -u <em class="replaceable"><code>user_name</code></em></code> をリモートクライアントホスト上で実行したときに動作しない場合、特定のユーザー名についてリモートホストからサーバーへのアクセスを有効にしていません。
        </p></li><li class="listitem"><p>
          <code class="literal">Access denied</code> を受け取る理由がわからない場合、ワイルドカードを含む <code class="literal">Host</code> 値を持つすべてのエントリ (<code class="literal">'%'</code> または <code class="literal">'_'</code> 文字を含むエントリ) を <code class="literal">user</code> テーブルから削除します。非常によくある間違いは、<code class="literal">Host</code>=<code class="literal">'%'</code> および <code class="literal">User</code>=<code class="literal">'<em class="replaceable"><code>some_user</code></em>'</code> という新しいエントリを挿入して、これにより、ユーザーは同じマシンから接続するよう <code class="literal">localhost</code> に指定できると思い込むことです。これが機能しない理由は、デフォルト権限に、<code class="literal">Host</code> = <code class="literal">'localhost'</code> および <code class="literal">User</code> = <code class="literal">''</code> というエントリを含むためです。このエントリには、<code class="literal">'%'</code> よりもさらに具体的な <code class="literal">'localhost'</code> という <code class="literal">Host</code> 値があるため、<code class="literal">localhost</code> から接続するときは新しいエントリよりもこちらが優先して使用されます。正しい手順としては、<code class="literal">Host</code> = <code class="literal">'localhost'</code> および <code class="literal">User</code> = <code class="literal">'<em class="replaceable"><code>some_user</code></em>'</code> という第 2 のエントリを挿入するか、<code class="literal">Host</code> = <code class="literal">'localhost'</code> および <code class="literal">User</code> = <code class="literal">''</code> のエントリを削除します。このエントリを削除したら、<code class="literal">FLUSH PRIVILEGES</code> ステートメントを発行して、付与テーブルのリロードを必ず行なってください。<a class="xref" href="security.html#connection-access" title="6.2.4 アクセス制御、ステージ 1: 接続の検証">セクション6.2.4「アクセス制御、ステージ 1: 接続の検証」</a>も参照してください。
        </p></li><li class="listitem"><p>
          MySQL サーバーに接続できるが、<code class="literal">SELECT ... INTO OUTFILE</code> または <code class="literal">LOAD DATA INFILE</code> ステートメントを発行するたびに <code class="literal">Access denied</code> メッセージを受け取る場合、<code class="literal">user</code> テーブル内のエントリで <code class="literal">FILE</code> 権限が有効になっていません。
        </p></li><li class="listitem"><p>
          付与テーブルを直接 (たとえば、<code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、または <code class="literal">DELETE</code> ステートメントを使用して) 変更し、変更が無視されたように思われる場合、サーバーに権限テーブルをリロードさせるために <code class="literal">FLUSH PRIVILEGES</code> ステートメントまたは <span class="command"><strong>mysqladmin flush-privileges</strong></span> コマンドを実行する必要があることを覚えておいてください。そうしない場合、サーバーが次回再起動するまで変更の影響はありません。<code class="literal">root</code> パスワードを <code class="literal">UPDATE</code> ステートメントで変更したあと、権限をフラッシュするまで新規パスワードを指定する必要はありません。これは、パスワードが変更されたことがサーバーにまだ認識されないためです。
        </p></li><li class="listitem"><p>
          セッションの最中に権限が変更されたと思われる場合、MySQL 管理者によって権限が変更された可能性があります。付与テーブルのリロードは、新しいクライアント接続に影響しますが、<a class="xref" href="security.html#privilege-changes" title="6.2.6 権限変更が有効化される時期">セクション6.2.6「権限変更が有効化される時期」</a>に示すように既存の接続にも影響します。
        </p></li><li class="listitem"><p>
          Perl、PHP、Python、または ODBC プログラムとのアクセスに問題がある場合、<code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em> <em class="replaceable"><code>db_name</code></em></code> または <code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em> -p<em class="replaceable"><code>your_pass</code></em> <em class="replaceable"><code>db_name</code></em></code> を使用してサーバーに接続してみてください。<span class="command"><strong>mysql</strong></span> クライアントを使用して接続できる場合、問題はアクセス権限ではなくプログラムにあります。(<code class="option">-p</code> とパスワードの間にスペースはありません。<code class="option">--password=<em class="replaceable"><code>your_pass</code></em></code> 構文を使用してパスワードを指定することもできます。<code class="option">-p</code> または <code class="option">--password</code> オプションを使用してパスワード値を指定しない場合、MySQL はパスワードを要求します。)
        </p></li><li class="listitem"><p>
          テスト目的で、<code class="option">--skip-grant-tables</code> オプションを指定して <span class="command"><strong>mysqld</strong></span> サーバーを起動します。これにより、MySQL 付与テーブルを変更でき、<code class="literal">SHOW GRANTS</code> ステートメントを使用して、変更による望ましい影響があるかどうかを確認することができます。変更に満足したら、<span class="command"><strong>mysqladmin flush-privileges</strong></span> を実行して、権限をリロードするよう <span class="command"><strong>mysqld</strong></span> サーバーに指示します。これにより、サーバーを停止して再起動することなく新しい付与テーブルの内容の使用を開始することができます。
        </p></li><li class="listitem"><p>
          すべてが失敗する場合、<span class="command"><strong>mysqld</strong></span> サーバーをデバッグオプション (<code class="option">--debug=d,general,query</code> など) で起動します。これによって、発行された各コマンドに関する情報のほかに、試行された接続についてのホストおよびユーザー情報が出力されます。<a class="xref" href="extending-mysql.html#dbug-package" title="24.4.3 DBUG パッケージ">セクション24.4.3「DBUG パッケージ」</a>を参照してください。
        </p></li><li class="listitem"><p>
          MySQL 付与テーブルに関して何かほかの問題があって、メーリングリストに問題を投稿する必要があると思われる場合、MySQL 付与テーブルのダンプを常に提供してください。<span class="command"><strong>mysqldump mysql</strong></span> コマンドでテーブルをダンプできます。バグレポートを提出するには、<a class="xref" href="introduction.html#bug-reports" title="1.7 質問またはバグをレポートする方法">セクション1.7「質問またはバグをレポートする方法」</a>の説明を参照してください。<span class="command"><strong>mysqldump</strong></span> を実行するには <code class="option">--skip-grant-tables</code> を指定して <span class="command"><strong>mysqld</strong></span> を再起動することが必要な場合もあります。
        </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="user-account-management"></a>6.3 MySQL ユーザーアカウントの管理</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#user-names">6.3.1 ユーザー名とパスワード</a></span></dt><dt><span class="section"><a href="security.html#adding-users">6.3.2 ユーザーアカウントの追加</a></span></dt><dt><span class="section"><a href="security.html#removing-users">6.3.3 ユーザーアカウントの削除</a></span></dt><dt><span class="section"><a href="security.html#user-resources">6.3.4 アカウントリソース制限の設定</a></span></dt><dt><span class="section"><a href="security.html#assigning-passwords">6.3.5 アカウントパスワードの割り当て</a></span></dt><dt><span class="section"><a href="security.html#password-expiration-sandbox-mode">6.3.6 パスワードの期限切れとサンドボックスモード</a></span></dt><dt><span class="section"><a href="security.html#pluggable-authentication">6.3.7 プラガブル認証</a></span></dt><dt><span class="section"><a href="security.html#authentication-plugins-available">6.3.8 MySQL で使用可能な認証プラグイン</a></span></dt><dt><span class="section"><a href="security.html#proxy-users">6.3.9 プロキシユーザー</a></span></dt><dt><span class="section"><a href="security.html#ssl-connections">6.3.10 セキュアな接続のための SSL の使用</a></span></dt><dt><span class="section"><a href="security.html#windows-and-ssh">6.3.11 SSH を使用した Windows から MySQL へのリモート接続</a></span></dt><dt><span class="section"><a href="security.html#audit-log-plugin">6.3.12 MySQL Enterprise Audit ログプラグイン</a></span></dt><dt><span class="section"><a href="security.html#account-activity-auditing">6.3.13 SQL ベースの MySQL アカウントアクティビティーの監査</a></span></dt></dl></div><p>
    このセクションでは、MySQL サーバーのクライアント用にアカウントを設定する方法について説明します。次のトピックについて説明します。
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        MySQL で使用されるアカウント名とパスワードの意味、およびオペレーティングシステムで使用される名前とパスワードと比較する方法
      </p></li><li class="listitem"><p>
        新しいアカウントを設定し、既存のアカウントを削除する方法
      </p></li><li class="listitem"><p>
        パスワードを変更する方法
      </p></li><li class="listitem"><p>
        パスワードをセキュアに使用するためのガイドライン
      </p></li><li class="listitem"><p>
        SSL によるセキュアな接続を使用する方法
      </p></li></ul></div><p>
    すべてのユーザー管理 SQL ステートメントの構文および使用について説明されている<a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 アカウント管理ステートメント">セクション13.7.1「アカウント管理ステートメント」</a>も参照してください。
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="user-names"></a>6.3.1 ユーザー名とパスワード</h3></div></div></div><a class="indexterm" name="idm139979121070096"></a><a class="indexterm" name="idm139979121067984"></a><p>
      MySQL では、<code class="literal">mysql</code> データベースの <code class="literal">user</code> テーブルにアカウントが格納されます。アカウントは、ユーザー名およびユーザーがサーバーに接続できるクライアントホスト (複数の場合あり) に関して定義されます。アカウントはパスワードを持っている場合もあります。<code class="literal">user</code> テーブルでのアカウントの表示については、<a class="xref" href="security.html#grant-table-structure" title="6.2.2 権限システム付与テーブル">セクション6.2.2「権限システム付与テーブル」</a>を参照してください。MySQL 5.6 では、認証プラグインがサポートされているため、アカウントは一部の外部認証方式を使用して認証できます。<a class="xref" href="security.html#pluggable-authentication" title="6.3.7 プラガブル認証">セクション6.3.7「プラガブル認証」</a>を参照してください。
    </p><p>
      ユーザー名とパスワードが MySQL で使用される方法と、オペレーティングシステムで使用される方法との間には、いくつかの違いがあります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          MySQL で認証目的に使用されるユーザー名と、Windows または Unix で使用されるユーザー名 (ログイン名) とには、まったく関係がありません。Unix では、ほとんどの MySQL クライアントがデフォルトで、現在の Unix ユーザー名を MySQL ユーザー名として使用してログインを試みますが、これは便宜上の目的に過ぎません。クライアントプログラムでは、<code class="option">-u</code> または <code class="option">--user</code> オプションを使用して任意のユーザー名を指定することが許可されているため、簡単にデフォルトをオーバーライドできます。これは、ユーザー名を使用すればだれでもサーバーへの接続を試みることができることを意味するため、すべての MySQL アカウントがパスワードを持っていなければ、どのような方法でもデータベースをセキュアにすることはできません。パスワードを持っていないアカウントにユーザー名を指定するユーザーはだれでも、正常にサーバーに接続できます。
        </p></li><li class="listitem"><p>
          MySQL ユーザー名は、最大で 16 文字の長さまで指定できます。オペレーティングシステムのユーザー名は、MySQL ユーザー名とは完全に無関係であるため、最大長が異なる可能性があります。たとえば、Unix ユーザー名は通常、8 文字までに制限されています。
        </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
            MySQL サーバーおよびクライアントでは、MySQL ユーザー名の長さの制限がハードコードされているため、<code class="literal">mysql</code> データベース内のテーブル定義を変更してこれを回避しようとしても、<span class="emphasis"><em>効果がありません</em></span>。
          </p><p>
            <a class="xref" href="programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — MySQL テーブルのチェックとアップグレード">セクション4.4.7「<span class="command"><strong>mysql_upgrade</strong></span> — MySQL テーブルのチェックとアップグレード」</a>で説明する手順を使用する以外は、どのような方法でも <code class="literal">mysql</code> データベース内のテーブルは変更するべきではありません。その他の方法で MySQL のシステムテーブルを再定義しようとすると、未定義 (および未サポート) の動作が発生します。
          </p></div></li><li class="listitem"><p>
          サーバーは (<code class="literal">mysql.user</code> テーブルに格納されたパスワードと照合する) MySQL ネイティブ認証を使用してクライアント接続を認証する際に、<code class="literal">user</code> テーブルに格納された MySQL パスワードを使用します。これらのパスワードと、オペレーティングシステムにログインするためのパスワードとには、まったく関係がありません。Windows または Unix マシンにログインする際に使用される<span class="quote">「<span class="quote">外部</span>」</span>パスワードと、そのマシン上の MySQL サーバーにアクセスする際に使用されるパスワードとの間には、必要な関係はありません。
        </p><p>
          サーバーがプラグインを使用してクライアントを認証する場合は、プラグインで実装されている認証方式で、<code class="literal">user</code> テーブル内のパスワードが使用される場合と、使用されない場合があります。この場合、MySQL サーバーへの認証を行う際に、外部パスワードも使用される可能性があります。
        </p></li><li class="listitem"><p>
          MySQL では独自アルゴリズムを使用して、<code class="literal">user</code> テーブルに格納されたパスワードが暗号化されます。この暗号化は、<code class="literal">PASSWORD()</code> SQL 関数で実装されたものと同じですが、Unix のログインプロセス時に使用されるものとは異なります。Unix のパスワード暗号化は、<code class="literal">ENCRYPT()</code> SQL 関数で実装されたものと同じです。<code class="literal">PASSWORD()</code> および <code class="literal">ENCRYPT()</code> 関数については、<a class="xref" href="functions.html#encryption-functions" title="12.13 暗号化関数と圧縮関数">セクション12.13「暗号化関数と圧縮関数」</a>を参照してください。
        </p><p>
          MySQL バージョン 4.1 以降では、旧バージョンよりも強固な認証方式が採用され、接続プロセス時のパスワード保護が改善されています。TCP/IP パケットが盗聴されたり、<code class="literal">mysql</code> データベースが乗っ取られたりしてもセキュアです。(旧バージョンでは、パスワードが暗号化された形式で <code class="literal">user</code> テーブルに格納されますが、MySQL サーバーに接続する際に、暗号化されたパスワード値を知っていることが利用される可能性があります。)<a class="xref" href="security.html#password-hashing" title="6.1.2.4 MySQL でのパスワードハッシュ">セクション6.1.2.4「MySQL でのパスワードハッシュ」</a>では、パスワードの暗号化について詳細に説明します。
        </p></li><li class="listitem"><p>
          ユーザー名およびパスワードに ASCII 文字のみが含まれている場合は、文字セットの設定に関係なく、サーバーに接続できます。ユーザー名またはパスワードに ASCII 文字以外が含まれているときに接続するには、クライアントは <code class="literal">MYSQL_SET_CHARSET_NAME</code> オプションと引数として適切な文字セット名を指定して、<code class="literal">mysql_options()</code> C API 関数を呼び出すようにしてください。これにより、指定された文字セットを使用した認証が実行されます。それ以外の場合、サーバーのデフォルト文字セットが認証のデフォルトエンコーディングと同じでなければ、認証に失敗します。
        </p><p>
          標準の MySQL クライアントプログラムでは、先ほど説明したように、<code class="literal">mysql_options()</code> が呼び出される <code class="option">--default-character-set</code> オプションがサポートされています。さらに、<a class="xref" href="globalization.html#charset-connection" title="10.1.4 接続文字セットおよび照合順序">セクション10.1.4「接続文字セットおよび照合順序」</a>で説明したように、文字セットの自動検出もサポートされています。C API に基づいていないコネクタを使用するプログラムでは、<code class="literal">mysql_options()</code> と同等のものがコネクタで提供されている場合があり、それを代わりに使用できます。コネクタのドキュメントを確認してください。
        </p><p>
          前述の注は、クライアントの文字セットとして許可されていない <code class="literal">ucs2</code>、<code class="literal">utf16</code>、および <code class="literal">utf32</code> には適用されません。
        </p></li></ul></div><p>
      MySQL をインストールすると、付与テーブルにアカウントの初期セットが移入されます。これらのアカウントの名前およびアクセス権限については、<a class="xref" href="installing.html#default-privileges" title="2.10.2 最初の MySQL アカウントのセキュリティー設定">セクション2.10.2「最初の MySQL アカウントのセキュリティー設定」</a>で説明されています。ここでは、パスワードを割り当てる方法についても説明されています。そのあと、通常は <code class="literal">CREATE USER</code>、<code class="literal">GRANT</code>、および <code class="literal">REVOKE</code> などのステートメントを使用して、MySQL アカウントを設定、変更、および削除します。<a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 アカウント管理ステートメント">セクション13.7.1「アカウント管理ステートメント」</a>を参照してください。
    </p><p>
      コマンド行クライアントを使用して MySQL サーバーに接続する場合は、使用するアカウントでの必要に応じて、ユーザー名とパスワードを指定します。
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=monty --password=<em class="replaceable"><code>password</code></em> <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p>
      短いオプションを好む場合は、コマンドは次のようになります。
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u monty -p<em class="replaceable"><code>password</code></em> <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p>
      <code class="option">-p</code> オプションとそれに続くパスワード値との間には、<span class="emphasis"><em>空白文字</em></span>を入れないでください。
    </p><p>
      コマンド行で <code class="option">--password</code> または <code class="option">-p</code> オプションに続く <em class="replaceable"><code>password</code></em> 値を省略した場合は、値を 1 つ指定するように求めるプロンプトがクライアントに表示されます。
    </p><p>
      コマンド行でパスワードを指定することは、セキュアでないと考えるべきです。<a class="xref" href="security.html#password-security-user" title="6.1.2.1 パスワードセキュリティーのためのエンドユーザーガイドライン">セクション6.1.2.1「パスワードセキュリティーのためのエンドユーザーガイドライン」</a>を参照してください。オプションファイルを使用すれば、コマンド行でパスワードを指定することを回避できます。
    </p><p>
      ユーザー名、パスワード、およびその他の接続パラメータの指定に関する追加情報については、<a class="xref" href="programs.html#connecting" title="4.2.2 MySQL サーバーへの接続">セクション4.2.2「MySQL サーバーへの接続」</a>を参照してください。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="adding-users"></a>6.3.2 ユーザーアカウントの追加</h3></div></div></div><a class="indexterm" name="idm139979121003728"></a><a class="indexterm" name="idm139979121002256"></a><a class="indexterm" name="idm139979121000336"></a><a class="indexterm" name="idm139979120998192"></a><a class="indexterm" name="idm139979120996128"></a><a class="indexterm" name="idm139979120994080"></a><a class="indexterm" name="idm139979120992000"></a><p>
      MySQL アカウントは、次の 2 つの方法で作成できます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          アカウントを作成するためのステートメント (<code class="literal">CREATE USER</code> や <code class="literal">GRANT</code> など) を使用する。これらのステートメントを発行すると、サーバーによって付与テーブルへの適切な変更が行われます。
        </p></li><li class="listitem"><p>
          <code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、<code class="literal">DELETE</code> などのステートメントを使用して、MySQL 付与テーブルを直接操作する。
        </p></li></ul></div><p>
      アカウント作成のステートメントを使用する方が、付与テーブルを直接操作するよりも簡潔で、エラーの発生率も低いため、推奨される方法です。<code class="literal">CREATE USER</code> および <code class="literal">GRANT</code> については、<a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 アカウント管理ステートメント">セクション13.7.1「アカウント管理ステートメント」</a>で説明されています。
    </p><p>
      アカウントを作成するためのもう 1 つのオプションは、GUI ツール MySQL Workbench を使用する方法です。または、MySQL アカウント管理の機能を提供する使用可能な複数のサードパーティープログラムのいずれかを使用します。<code class="literal">phpMyAdmin</code> は、このようなプログラムの 1 つです。
    </p><p>
      次の例では、<span class="command"><strong>mysql</strong></span> クライアントプログラムを使用して、新しいアカウントを設定する方法を示します。これらの例は、<a class="xref" href="installing.html#default-privileges" title="2.10.2 最初の MySQL アカウントのセキュリティー設定">セクション2.10.2「最初の MySQL アカウントのセキュリティー設定」</a>で説明するデフォルトに従って、権限が設定されていることが前提となっています。つまり、変更を行うには、MySQL <code class="literal">root</code> ユーザーとして MySQL サーバーに接続する必要があり、<code class="literal">root</code> アカウントは <code class="literal">mysql</code> データベースに対する <code class="literal">INSERT</code> 権限および <code class="literal">RELOAD</code> 管理権限を持っている必要があります。
    </p><p>
      該当する例で注記したように、特定の制約が有効になるようにサーバーの SQL モードが設定されている場合は、一部のステートメントに失敗します。特に、厳密モード (<code class="literal">STRICT_TRANS_TABLES</code>、<code class="literal">STRICT_ALL_TABLES</code>、および <code class="literal">NO_AUTO_CREATE_USER</code>) では、サーバーが一部のステートメントを受け入れることが回避されます。このような場合のために、回避策を示します。SQL モードおよびそれによる付与テーブルの操作への影響についての詳細は、<a class="xref" href="server-administration.html#sql-mode" title="5.1.7 サーバー SQL モード">セクション5.1.7「サーバー SQL モード」</a>および<a class="xref" href="sql-syntax.html#grant" title="13.7.1.4 GRANT 構文">セクション13.7.1.4「GRANT 構文」</a>を参照してください。
    </p><p>
      まず、<span class="command"><strong>mysql</strong></span> プログラムを使用して、MySQL <code class="literal">root</code> ユーザーとしてサーバーに接続します。
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=root mysql</code></strong>
</pre><p>
      <code class="literal">root</code> アカウントにパスワードを割り当てた場合は、この <span class="command"><strong>mysql</strong></span> コマンドと、このセクションで後述するコマンドの両方に、<code class="option">--password</code> または <code class="option">-p</code> オプションを指定する必要もあります。
    </p><p>
      <code class="literal">root</code> としてサーバーに接続したあとは、新しいアカウントを追加できます。次のステートメントは、<code class="literal">GRANT</code> を使用して 4 つの新しいアカウントを設定します。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'monty'@'localhost' IDENTIFIED BY 'some_pass';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT ALL PRIVILEGES ON *.* TO 'monty'@'localhost'</code></strong>
    -&gt; <strong class="userinput"><code>    WITH GRANT OPTION;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE USER 'monty'@'%' IDENTIFIED BY 'some_pass';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT ALL PRIVILEGES ON *.* TO 'monty'@'%'</code></strong>
    -&gt; <strong class="userinput"><code>    WITH GRANT OPTION;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE USER 'admin'@'localhost';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT RELOAD,PROCESS ON *.* TO 'admin'@'localhost';</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE USER 'dummy'@'localhost';</code></strong>
</pre><p>
      これらのステートメントで作成されたアカウントには、次のプロパティーがあります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          アカウントのうち 2 つは、ユーザー名が <code class="literal">monty</code>、パスワードが <code class="literal">some_pass</code> です。どちらのアカウントも、すべてを実行するための完全な権限を持っているスーパーユーザーアカウントです。<code class="literal">'monty'@'localhost'</code> アカウントは、ローカルホストから接続する際にのみ使用できます。<code class="literal">'monty'@'%'</code> アカウントでは、ホスト部分に <code class="literal">'%'</code> ワイルドカードが使用されているため、これを使用すれば任意のホストから接続できます。
        </p><p>
          <code class="literal">monty</code> として任意の場所から接続できるようにするには、<code class="literal">monty</code> に両方のアカウントが必要です。<code class="literal">localhost</code> アカウントがない場合は、<code class="literal">monty</code> がローカルホストから接続する際に、<span class="command"><strong>mysql_install_db</strong></span> で作成された <code class="literal">localhost</code> の匿名ユーザーアカウントが優先されます。その結果、<code class="literal">monty</code> は匿名ユーザーとして処理されます。その理由は、匿名ユーザーアカウントが <code class="literal">'monty'@'%'</code> アカウントよりも固有の <code class="literal">Host</code> カラム値を持っているため、<code class="literal">user</code> テーブルのソート順でより早く表示されるためです。(<code class="literal">user</code> テーブルのソートについては、<a class="xref" href="security.html#connection-access" title="6.2.4 アクセス制御、ステージ 1: 接続の検証">セクション6.2.4「アクセス制御、ステージ 1: 接続の検証」</a>で説明されています。)
        </p></li><li class="listitem"><p>
          <code class="literal">'admin'@'localhost'</code> アカウントにはパスワードがありません。このアカウントは、<code class="literal">admin</code> がローカルホストから接続する際にのみ使用できます。これには、<code class="literal">RELOAD</code> および <code class="literal">PROCESS</code> の管理者権限が付与されます。これらの権限を持つ <code class="literal">admin</code> ユーザーは、<span class="command"><strong>mysqladmin reload</strong></span>、<span class="command"><strong>mysqladmin refresh</strong></span>、<span class="command"><strong>mysqladmin flush-<em class="replaceable"><code>xxx</code></em></strong></span> コマンド、および <span class="command"><strong>mysqladmin processlist</strong></span> を実行できます。任意のデータベースにアクセスするための権限は付与されません。その他の <code class="literal">GRANT</code> ステートメントを発行すれば、あとでこのような権限を追加できることがあります。
        </p></li><li class="listitem"><p>
          <code class="literal">'dummy'@'localhost'</code> アカウントにはパスワードがありません。このアカウントは、ローカルホストから接続する際にのみ使用できます。権限は付与されません。あとでアカウントに特定の権限を付与することを前提としています。
        </p></li></ul></div><p>
      <code class="literal">NO_AUTO_CREATE_USER</code> SQL モードが有効になっている場合は、パスワードなしでアカウントを作成するステートメントに失敗します。これに対処するには、空でないパスワードを指定する <code class="literal">IDENTIFIED BY</code> 句を使用します。
    </p><p>
      アカウントに対する権限をチェックするには、<code class="literal">SHOW GRANTS</code> を使用します。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'admin'@'localhost';</code></strong>
+-----------------------------------------------------+
| Grants for admin@localhost                          |
+-----------------------------------------------------+
| GRANT RELOAD, PROCESS ON *.* TO 'admin'@'localhost' |
+-----------------------------------------------------+
</pre><a class="indexterm" name="idm139979120913520"></a><a class="indexterm" name="idm139979120911312"></a><p>
      <code class="literal">CREATE USER</code> および <code class="literal">GRANT</code> の代わりとして、直接 <code class="literal">INSERT</code> ステートメントを発行してから、<code class="literal">FLUSH PRIVILEGES</code> を使用して付与テーブルを再ロードするようにサーバーに指示することで、同じアカウントを作成できます。
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=root mysql</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO user</code></strong>
    -&gt;     <strong class="userinput"><code>VALUES('localhost','monty',PASSWORD('some_pass'),</code></strong>
    -&gt;     <strong class="userinput"><code>'Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y');</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO user</code></strong>
    -&gt;     <strong class="userinput"><code>VALUES('%','monty',PASSWORD('some_pass'),</code></strong>
    -&gt;     <strong class="userinput"><code>'Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y',</code></strong>
    -&gt;     <strong class="userinput"><code>'Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y',</code></strong>
    -&gt;     <strong class="userinput"><code>'','','','',0,0,0,0);</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO user SET Host='localhost',User='admin',</code></strong>
    -&gt;     <strong class="userinput"><code>Reload_priv='Y', Process_priv='Y';</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO user (Host,User,Password)</code></strong>
    -&gt;     <strong class="userinput"><code>VALUES('localhost','dummy','');</code></strong>
mysql&gt; <strong class="userinput"><code>FLUSH PRIVILEGES;</code></strong>
</pre><p>
      <code class="literal">INSERT</code> を使用してアカウントを作成する場合は、<code class="literal">FLUSH PRIVILEGES</code> を使用して、付与テーブルを再ロードするようにサーバーに指示する必要があります。そうしなければ、サーバーを再起動するまで変更が認識されません。<code class="literal">CREATE USER</code> では、<code class="literal">FLUSH PRIVILEGES</code> が必要ありません。
    </p><p>
      <code class="literal">INSERT </code> で <code class="literal">PASSWORD()</code> 関数を使用する理由は、パスワードを暗号化するためです。<code class="literal">CREATE USER</code> ステートメントでは自動的にパスワードが暗号化されるため、<code class="literal">PASSWORD()</code> は必要ありません。
    </p><p>
      <code class="literal">'Y'</code> 値を指定すると、アカウントに対する権限が有効になります。MySQL のバージョンによっては、最初の 2 つの <code class="literal">INSERT</code> ステートメントに異なる数の <code class="literal">'Y'</code> 値を使用する必要がある場合もあります。<code class="literal">admin</code> アカウントに対する <code class="literal">INSERT</code> ステートメントでは、<code class="literal">SET</code> を使用することで、さらに読み取り可能になるように拡張された <code class="literal">INSERT</code> 構文が採用されています。
    </p><p>
      <code class="literal">dummy</code> アカウントに対する <code class="literal">INSERT</code> ステートメントでは、<code class="literal">user</code> テーブル行内の <code class="literal">Host</code>、<code class="literal">User</code>、および <code class="literal">Password</code> カラムにのみ、値が割り当てられます。権限カラムは明示的に設定されないため、MySQL によってすべてのカラムに、デフォルト値の <code class="literal">'N'</code> が割り当てられます。これは、<code class="literal">CREATE USER</code> の動作と同等です。
    </p><p>
      厳密な SQL モードが有効になっている場合は、デフォルト値を持たないすべてのカラムに値を指定する必要があります。この場合、<code class="literal">INSERT</code> ステートメントは、明示的に <code class="literal">ssl_cipher</code>、<code class="literal">x509_issuer</code>、および <code class="literal">x509_subject</code> カラムに値を指定する必要があります。
    </p><p>
      スーパーユーザーアカウントを設定するために必要な操作は、すべての権限カラムが <code class="literal">'Y'</code> に設定された <code class="literal">user</code> テーブル行を挿入することだけです。<code class="literal">user</code> テーブルの権限はグローバルであるため、その他の付与テーブルのいずれにもエントリは必要ありません。
    </p><p>
      次の例では、3 つのアカウントを作成し、それらに特定のデータベースへのアクセス権を付与します。それぞれのユーザー名は <code class="literal">custom</code> で、パスワードは <code class="literal">obscure</code> です。
    </p><p>
      <code class="literal">CREATE USER</code> および <code class="literal">GRANT</code> を使用してアカウントを作成するには、次のステートメントを使用します。
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=root mysql</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE USER 'custom'@'localhost' IDENTIFIED BY 'obscure';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP</code></strong>
    -&gt; <strong class="userinput"><code>    ON bankaccount.*</code></strong>
    -&gt; <strong class="userinput"><code>    TO 'custom'@'localhost';</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE USER 'custom'@'host47.example.com' IDENTIFIED BY 'obscure';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP</code></strong>
    -&gt; <strong class="userinput"><code>    ON expenses.*</code></strong>
    -&gt; <strong class="userinput"><code>    TO 'custom'@'host47.example.com';</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE USER 'custom'@'server.domain' IDENTIFIED BY 'obscure';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP</code></strong>
    -&gt; <strong class="userinput"><code>    ON customer.*</code></strong>
    -&gt; <strong class="userinput"><code>    TO 'custom'@'server.domain';</code></strong>
</pre><p>
      3 つのアカウントは、次のように使用できます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          1 番目のアカウントは、<code class="literal">bankaccount</code> データベースにアクセスできますが、ローカルホストからに限定されます。
        </p></li><li class="listitem"><p>
          2 番目のアカウントは、<code class="literal">expenses</code> データベースにアクセスできますが、<code class="literal">host47.example.com</code> ホストからに限定されます。
        </p></li><li class="listitem"><p>
          3 番目のアカウントは、<code class="literal">customer</code> データベースにアクセスできますが、<code class="literal">server.domain</code> ホストからに限定されます。
        </p></li></ul></div><p>
      <code class="literal">GRANT</code> を使用せずに <code class="literal">custom</code> アカウントを設定するには、次のように <code class="literal">INSERT</code> ステートメントを使用して、付与テーブルを直接変更します。
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=root mysql</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO user (Host,User,Password)</code></strong>
    -&gt;     <strong class="userinput"><code>VALUES('localhost','custom',PASSWORD('obscure'));</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO user (Host,User,Password)</code></strong>
    -&gt;     <strong class="userinput"><code>VALUES('host47.example.com','custom',PASSWORD('obscure'));</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO user (Host,User,Password)</code></strong>
    -&gt;     <strong class="userinput"><code>VALUES('server.domain','custom',PASSWORD('obscure'));</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO db</code></strong>
    -&gt;     <strong class="userinput"><code>(Host,Db,User,Select_priv,Insert_priv,</code></strong>
    -&gt;     <strong class="userinput"><code>Update_priv,Delete_priv,Create_priv,Drop_priv)</code></strong>
    -&gt;     <strong class="userinput"><code>VALUES('localhost','bankaccount','custom',</code></strong>
    -&gt;     <strong class="userinput"><code>'Y','Y','Y','Y','Y','Y');</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO db</code></strong>
    -&gt;     <strong class="userinput"><code>(Host,Db,User,Select_priv,Insert_priv,</code></strong>
    -&gt;     <strong class="userinput"><code>Update_priv,Delete_priv,Create_priv,Drop_priv)</code></strong>
    -&gt;     <strong class="userinput"><code>VALUES('host47.example.com','expenses','custom',</code></strong>
    -&gt;     <strong class="userinput"><code>'Y','Y','Y','Y','Y','Y');</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO db</code></strong>
    -&gt;     <strong class="userinput"><code>(Host,Db,User,Select_priv,Insert_priv,</code></strong>
    -&gt;     <strong class="userinput"><code>Update_priv,Delete_priv,Create_priv,Drop_priv)</code></strong>
    -&gt;     <strong class="userinput"><code>VALUES('server.domain','customer','custom',</code></strong>
    -&gt;     <strong class="userinput"><code>'Y','Y','Y','Y','Y','Y');</code></strong>
mysql&gt; <strong class="userinput"><code>FLUSH PRIVILEGES;</code></strong>
</pre><p>
      最初の 3 つの <code class="literal">INSERT</code> ステートメントは、付与されたパスワードを使用してさまざまなホストから接続することをユーザー <code class="literal">custom</code> に許可する <code class="literal">user</code> テーブルエントリを追加しますが、グローバルな権限は付与しません (すべての権限はデフォルト値の <code class="literal">'N'</code> に設定されます)。次の 3 つの <code class="literal">INSERT</code> ステートメントは、<code class="literal">bankaccount</code>、<code class="literal">expenses</code>、および <code class="literal">customer</code> データベースに対する権限を <code class="literal">custom</code> に付与するが、適切なホストからのアクセス時に限定される <code class="literal">db</code> テーブルエントリを追加します。通常どおりに付与テーブルを直接変更する場合は、権限の変更が有効になるように、<code class="literal">FLUSH PRIVILEGES</code> を使用して再ロードするようにサーバーに指示する必要があります。
    </p><p>
      特定のドメイン (<code class="literal">mydomain.com</code> など) 内のすべてのマシンからのアクセス権を持つユーザーを作成する際には、アカウント名のホスト部分に <span class="quote">「<span class="quote"><code class="literal">%</code></span>」</span> ワイルドカード文字を使用できます。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'myname'@'%.mydomain.com' IDENTIFIED BY 'mypass';</code></strong>
</pre><p>
      付与テーブルを直接変更することで同じ処理を行うには、次のように実行します。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>INSERT INTO user (Host,User,Password,...)</code></strong>
    -&gt;     <strong class="userinput"><code>VALUES('%.mydomain.com','myname',PASSWORD('mypass'),...);</code></strong>
mysql&gt; <strong class="userinput"><code>FLUSH PRIVILEGES;</code></strong>
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="removing-users"></a>6.3.3 ユーザーアカウントの削除</h3></div></div></div><a class="indexterm" name="idm139979120798592"></a><a class="indexterm" name="idm139979120796480"></a><a class="indexterm" name="idm139979120794448"></a><a class="indexterm" name="idm139979120792416"></a><a class="indexterm" name="idm139979120790368"></a><a class="indexterm" name="idm139979120788336"></a><a class="indexterm" name="idm139979120786288"></a><a class="indexterm" name="idm139979120784256"></a><p>
      アカウントを削除するには、<a class="xref" href="sql-syntax.html#drop-user" title="13.7.1.3 DROP USER 構文">セクション13.7.1.3「DROP USER 構文」</a>で説明されている <code class="literal">DROP USER</code> ステートメントを使用します。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="user-resources"></a>6.3.4 アカウントリソース制限の設定</h3></div></div></div><a class="indexterm" name="idm139979120778672"></a><a class="indexterm" name="idm139979120776512"></a><a class="indexterm" name="idm139979120774432"></a><a class="indexterm" name="idm139979120773184"></a><a class="indexterm" name="idm139979120771824"></a><a class="indexterm" name="idm139979120770448"></a><p>
      MySQL サーバーリソースの使用を制限する方法の 1 つは、グローバルな <code class="literal">max_user_connections</code> システム変数をゼロ以外の値に設定することです。これにより、任意の特定のアカウントで実行できる同時接続の数が制限されますが、一度クライアントが接続したら、実行内容には制限が課されません。さらに、<code class="literal">max_user_connections</code> を設定しても、各アカウントの管理は有効になりません。どちらのタイプの制御も、多くの MySQL 管理者 (特に、インターネットサービスプロバイダの従業員) にとって関心のあるものです。
    </p><p>
      MySQL 5.6 では、各アカウントに対して次のサーバーリソースの使用を制限できます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          アカウントが 1 時間ごとに発行できるクエリーの数
        </p></li><li class="listitem"><p>
          アカウントが 1 時間ごとに発行できる更新の数
        </p></li><li class="listitem"><p>
          アカウントが 1 時間ごとにサーバーに接続できる回数
        </p></li><li class="listitem"><p>
          アカウントによるサーバーへの同時接続の数
        </p></li></ul></div><p>
      クエリー制限に対して、クライアントが発行できるステートメントがすべてカウントされます (その結果がクエリーキャッシュから提供される場合は除きます)。更新制限に対して、データベースまたはテーブルを変更するステートメントのみがカウントされます。
    </p><p>
      このコンテキストでは、<span class="quote">「<span class="quote">アカウント</span>」</span>は <code class="literal">mysql.user</code> テーブル内の行に対応しています。つまり、接続に適用される <code class="literal">user</code> テーブル行内の <code class="literal">User</code> および <code class="literal">Host</code> 値に対して、接続が評価されます。たとえば、アカウント <code class="literal">'usera'@'%.example.com'</code> は、<code class="literal">example.com</code> ドメイン内の任意のホストから接続することを <code class="literal">usera</code> に許可するために、<code class="literal">usera</code> および <code class="literal">%.example.com</code> の <code class="literal">User</code> および <code class="literal">Host</code> 値を持つ <code class="literal">user</code> テーブル内の行に対応しています。この場合、このような接続ではすべて同じアカウントが使用されるため、サーバーは、<code class="literal">usera</code> による <code class="literal">example.com</code> ドメイン内の任意のホストからのすべての接続に、この行のリソース制限をまとめて適用します。
    </p><p>
      MySQL 5.0.3 よりも前では、ユーザーの接続元である実際のホストに対して、<span class="quote">「<span class="quote">アカウント</span>」</span>が評価されていました。<code class="option">--old-style-user-limits</code> オプションを付けてサーバーを起動すれば、この古いアカウント方式を選択できます。この場合、<code class="literal">usera</code> が <code class="literal">host1.example.com</code> と <code class="literal">host2.example.com</code> から同時に接続すると、サーバーは各接続に個別にアカウントリソースの制限を適用します。<code class="literal">usera</code> が <code class="literal">host1.example.com</code> から再度接続すると、サーバーはそのホストからの既存の接続とともに、その接続に対する制限を適用します。
    </p><p>
      アカウントに対してリソース制限を設定するには、<code class="literal">GRANT</code> ステートメントを使用します (<a class="xref" href="sql-syntax.html#grant" title="13.7.1.4 GRANT 構文">セクション13.7.1.4「GRANT 構文」</a>を参照してください)。制限される各リソースの名前を指定する <code class="literal">WITH</code> 句を指定します。各制限のデフォルト値は、ゼロ (制限なし) です。たとえば、制限された方法でのみ <code class="literal">customer</code> データベースにアクセスできる新しいアカウントを作成するには、次のようなステートメントを発行します。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'francis'@'localhost' IDENTIFIED BY 'frank';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT ALL ON customer.* TO 'francis'@'localhost'</code></strong>
    -&gt; <strong class="userinput"><code>    WITH MAX_QUERIES_PER_HOUR 20</code></strong>
    -&gt; <strong class="userinput"><code>         MAX_UPDATES_PER_HOUR 10</code></strong>
    -&gt; <strong class="userinput"><code>         MAX_CONNECTIONS_PER_HOUR 5</code></strong>
    -&gt; <strong class="userinput"><code>         MAX_USER_CONNECTIONS 2;</code></strong>
</pre><p>
      制限タイプの名前をすべて <code class="literal">WITH</code> 句に指定する必要はありませんが、名前を指定したものは任意の順序で表示できます。1 時間ごとの各制限の値は、1 時間当たりの回数を表す整数にするようにしてください。<code class="literal">MAX_USER_CONNECTIONS</code> では、制限はアカウントによる同時接続の最大数を表す整数です。この制限がゼロに設定されている場合は、グローバルな <code class="literal">max_user_connections</code> システム変数の値によって同時接続の数が決定されます。<code class="literal">max_user_connections</code> もゼロである場合は、アカウントに制限がありません。
    </p><p>
      アカウントに対する既存の制約を変更するには、グローバルレベル (<code class="literal">ON *.*</code>) で <code class="literal">GRANT USAGE</code> ステートメントを使用します。次のステートメントは、<code class="literal">francis</code> に対するクエリー制限を 100 に変更します。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>GRANT USAGE ON *.* TO 'francis'@'localhost'</code></strong>
    -&gt;     <strong class="userinput"><code>WITH MAX_QUERIES_PER_HOUR 100;</code></strong>
</pre><p>
      このステートメントは、指定された制限値のみを変更し、それ以外のアカウントは未変更のままにします。
    </p><p>
      制限を削除するには、その値をゼロに設定します。たとえば、<code class="literal">francis</code> が接続できる 1 時間当たりの回数に対する制限を削除するには、次のステートメントを使用します。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>GRANT USAGE ON *.* TO 'francis'@'localhost'</code></strong>
    -&gt;     <strong class="userinput"><code>WITH MAX_CONNECTIONS_PER_HOUR 0;</code></strong>
</pre><p>
      すでに説明したように、アカウントに対する同時接続の制限は、<code class="literal">MAX_USER_CONNECTIONS</code> 制限および <code class="literal">max_user_connections</code> システム変数によって決定されます。グローバルな <code class="literal">max_user_connections</code> 値が 10 であり、3 つのアカウントが <code class="literal">GRANT</code> を使用して指定されたリソース制限を持っていると仮定します。
    </p><pre class="programlisting">
GRANT ... TO 'user1'@'localhost' WITH MAX_USER_CONNECTIONS 0;
GRANT ... TO 'user2'@'localhost' WITH MAX_USER_CONNECTIONS 5;
GRANT ... TO 'user3'@'localhost' WITH MAX_USER_CONNECTIONS 20;
</pre><p>
      <code class="literal">user1</code> の <code class="literal">MAX_USER_CONNECTIONS</code> はゼロであるため、接続の制限は 10 (グローバルな <code class="literal">max_user_connections</code> 値) です。<code class="literal">user2</code> と <code class="literal">user3</code> の <code class="literal">MAX_USER_CONNECTIONS</code> はゼロ以外であるため、接続の制限はそれぞれ 5 と 20 です。
    </p><p>
      サーバーはアカウントに対応する <code class="literal">user</code> テーブル行に、アカウントに対するリソース制限を格納します。<code class="literal">max_questions</code>、<code class="literal">max_updates</code>、または <code class="literal">max_connections</code> カラムには、1 時間当たりの制限が格納され、<code class="literal">max_user_connections</code> カラムには、<code class="literal">MAX_USER_CONNECTIONS</code> の制限が格納されます。<a class="xref" href="security.html#grant-table-structure" title="6.2.2 権限システム付与テーブル">セクション6.2.2「権限システム付与テーブル」</a>を参照してください。
    </p><p>
      任意のアカウントによるリソースのいずれかの使用に対してゼロ以外の制限が設定されている場合は、リソース使用のカウントが発生します。
    </p><p>
      サーバーが実行されると、各アカウントがリソースを使用する回数がカウントされます。過去 1 時間以内にアカウントが接続数に対する制限に達した場合は、その時間が経過するまで、そのアカウントによる以降の接続が拒否されます。同様に、アカウントがクエリーまたは更新の回数に対する制限に達した場合も、その時間が経過するまで、以降のクエリーまたは更新が拒否されます。このような場合はすべて、適切なエラーメッセージが発行されます。
    </p><p>
      リソースのカウントはクライアントごとではなく、アカウントごとに実行されます。たとえば、アカウントのクエリー制限が 50 である場合は、サーバーへの 2 つの同時クライアント接続を作成しても、制限を 100 に増加できません。両方の接続で発行されたクエリーは、まとめてカウントされます。
    </p><p>
      現在の 1 時間ごとのリソース使用のカウントは、すべてのアカウントに対してグローバルにリセットすることも、特定のアカウントごとに個別にリセットすることもできます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          すべてのアカウントに対して現在のカウントをゼロにリセットするには、<code class="literal">FLUSH USER_RESOURCES</code> ステートメント発行します。また、(たとえば、<code class="literal">FLUSH PRIVILEGES</code> ステートメントまたは <span class="command"><strong>mysqladmin reload</strong></span> コマンドを使用して) 付与テーブルを再ロードして、カウントをリセットすることもできます。
        </p></li><li class="listitem"><p>
          各アカウントの制限のいずれかを再度付与すれば、そのカウントをゼロに設定できます。これを行うには、前述のように <code class="literal">GRANT USAGE</code> を使用して、アカウントが現在持っている値と等しい制限値を指定します。
        </p></li></ul></div><p>
      カウンタをリセットしても、<code class="literal">MAX_USER_CONNECTIONS</code> の制限は影響を受けません。
    </p><p>
      サーバーが起動されると、すべてのカウントがゼロで始まります。再起動後は、カウントが繰り越されません。
    </p><p>
      <code class="literal">MAX_USER_CONNECTIONS</code> の制限では、アカウントが許可されている接続の最大数を現在開いている場合に、エッジケースが発生する可能性があります。接続が発生する時点までにサーバーで切断が完全に処理されていない場合に、切断後にすぐに接続すると、エラー (<code class="literal">ER_TOO_MANY_USER_CONNECTIONS</code> または <code class="literal">ER_USER_LIMIT_REACHED</code>) が発生する可能性があります。サーバーで切断処理が終了すると、別の接続がもう一度許可されます。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="assigning-passwords"></a>6.3.5 アカウントパスワードの割り当て</h3></div></div></div><a class="indexterm" name="idm139979120680672"></a><a class="indexterm" name="idm139979120679360"></a><a class="indexterm" name="idm139979120677840"></a><a class="indexterm" name="idm139979120675808"></a><p>
      MySQL サーバーに接続するクライアントに必要な証明書には、パスワードを含めることができます。このセクションでは、MySQL アカウントにパスワードを割り当てる方法について説明します。クライアント認証は、プラグインを使用することで発生します。<a class="xref" href="security.html#pluggable-authentication" title="6.3.7 プラガブル認証">セクション6.3.7「プラガブル認証」</a>を参照してください。
    </p><p>
      <code class="literal">CREATE USER</code> を使用して新しいアカウントを作成するときに、パスワードを割り当てるには、<code class="literal">IDENTIFIED BY</code> 句を含めます。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'jeffrey'@'localhost'</code></strong>
    -&gt; <strong class="userinput"><code>IDENTIFIED BY 'mypass';</code></strong>
</pre><p>
      既存のアカウントにパスワードを割り当てる方法またはそれを変更する方法の 1 つは、<code class="literal">SET PASSWORD</code> ステートメントを発行することです。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET PASSWORD FOR</code></strong>
    -&gt; <strong class="userinput"><code>'jeffrey'@'localhost' = PASSWORD('mypass');</code></strong>
</pre><p>
      MySQL では、<code class="literal">mysql</code> データベースの <code class="literal">user</code> テーブルにパスワードが格納されます。<code class="literal">mysql</code> データベースに対する <code class="literal">UPDATE</code> 権限を持っている <code class="literal">root</code> などのユーザーのみが、ほかのユーザーのパスワードを変更できます。匿名ユーザーとして接続していない場合は、<code class="literal">FOR</code> 句を省略すれば自分自身のパスワードを変更できます。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET PASSWORD = PASSWORD('mypass');</code></strong>
</pre><p>
      <code class="literal">old_passwords</code> システム変数の値によって、<code class="literal">PASSWORD()</code> で使用されるハッシュ化方式が決定されます。その関数を使用しているパスワードを指定しても、<code class="literal">SET PASSWORD</code> でそのパスワードの形式が正しくないとして拒否される場合は、<code class="literal">old_passwords</code> を設定してハッシュ化方式を変更する必要がある場合もあります。許可されている値については、<a class="xref" href="server-administration.html#server-system-variables" title="5.1.4 サーバーシステム変数">セクション5.1.4「サーバーシステム変数」</a>を参照してください。
    </p><p>
      <code class="literal">read_only</code> システム変数を有効にすると、<code class="literal">SUPER</code> 権限を持っていない任意のユーザーによる <code class="literal">SET PASSWORD</code> ステートメントの使用が回避されます。
    </p><p>
      また、グローバルレベル (<code class="literal">ON *.*</code>) で <code class="literal">GRANT USAGE</code> ステートメントを使用すると、アカウントの現在の権限に影響を与えずに、アカウントにパスワードを割り当てることができます。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>GRANT USAGE ON *.* TO 'jeffrey'@'localhost'</code></strong>
    -&gt; <strong class="userinput"><code>IDENTIFIED BY 'mypass';</code></strong>
</pre><p>
      コマンド行からパスワードを割り当てるには、<span class="command"><strong>mysqladmin</strong></span> コマンドを使用します。
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysqladmin -u <em class="replaceable"><code>user_name</code></em> -h <em class="replaceable"><code>host_name</code></em> password "<em class="replaceable"><code>newpwd</code></em>"</code></strong>
</pre><p>
      このコマンドでパスワードが設定されるアカウントは、<code class="literal">User</code> カラム内の <em class="replaceable"><code>user_name</code></em> に一致する <code class="literal">user</code> テーブル行を持つアカウント、および <code class="literal">Host</code> カラム内の<span class="emphasis"><em>接続元の</em></span>クライアントホストです。
    </p><p>
      認証中にクライアントがサーバーに接続すると、MySQL では <code class="literal">user</code> テーブル内のパスワードが暗号化されたハッシュ値 (<code class="literal">PASSWORD()</code> でパスワードに返される値) として処理されます。アカウントにパスワードを割り当てる際は、平文のパスワードではなく、暗号化された値を格納することが重要です。次のガイドラインを使用します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">CREATE USER</code>、<code class="literal">IDENTIFIED BY</code> 句を含む <code class="literal">GRANT</code>、または <span class="command"><strong>mysqladmin password</strong></span> コマンドを使用してパスワードを割り当てると、自動的にパスワードが暗号化されます。リテラルの平文パスワードを指定します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'jeffrey'@'localhost'</code></strong>
    -&gt; <strong class="userinput"><code>IDENTIFIED BY 'mypass';</code></strong>
</pre></li><li class="listitem"><p>
          <code class="literal">CREATE USER</code> または <code class="literal">GRANT</code> では、<code class="literal">PASSWORD()</code> でパスワードに返されるハッシュ値がわかっている場合に、平文パスワードの送信を回避できます。前にキーワード <code class="literal">PASSWORD</code> を付けたハッシュ値を指定します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'jeffrey'@'localhost'</code></strong>
    -&gt; <strong class="userinput"><code>IDENTIFIED BY PASSWORD '*90E462C37378CED12064BB3388827D2BA3A9B689';</code></strong>
</pre></li><li class="listitem"><p>
          <code class="literal">SET PASSWORD</code> を使用して、アカウントに空でないパスワードを割り当てる場合は、<code class="literal">PASSWORD()</code> 機能を使用してパスワードを暗号化する必要があります。それ以外の場合は、パスワードが平文として格納されます。次のようなパスワードを割り当てると仮定します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET PASSWORD FOR</code></strong>
    -&gt; <strong class="userinput"><code>'jeffrey'@'localhost' = 'mypass';</code></strong>
</pre><p>
          その結果、暗号化された値ではなく、リテラル値の <code class="literal">'mypass'</code> がパスワードとして <code class="literal">user</code> テーブルに格納されます。<code class="literal">jeffrey</code> がこのパスワードを使用してサーバーへの接続を試みると、その値が暗号化され、<code class="literal">user</code> テーブルに格納された値と比較されます。ただし、格納されている値はリテラル文字列の <code class="literal">'mypass'</code> であるため、比較に失敗し、サーバーは接続を拒否し、<code class="literal">「アクセスが拒否されました」</code>というエラーを返します。
        </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        <code class="literal">PASSWORD()</code> の暗号化は、Unix のパスワード暗号化とは異なります。<a class="xref" href="security.html#user-names" title="6.3.1 ユーザー名とパスワード">セクション6.3.1「ユーザー名とパスワード」</a>を参照してください。
      </p></div><p>
      <code class="literal">SET PASSWORD</code>、<code class="literal">GRANT</code>、または <span class="command"><strong>mysqladmin</strong></span> を使用してパスワードを割り当てることが望ましいですが、<code class="literal">user</code> テーブルを直接変更することもできます。この場合、<code class="literal">FLUSH PRIVILEGES</code> を使用して、サーバーで付与テーブルを再ロードさせる必要もあります。それ以外の場合は、サーバーを再起動するまで変更が認識されないままです。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="password-expiration-sandbox-mode"></a>6.3.6 パスワードの期限切れとサンドボックスモード</h3></div></div></div><a class="indexterm" name="idm139979120596752"></a><a class="indexterm" name="idm139979120595312"></a><p>
      MySQL 5.6 では、データベース管理者がアカウントのパスワードを期限切れにして、ユーザーに自分のパスワードをリセットするように要求できるパスワード期限切れ機能が導入されています。直後の説明では、パスワードの期限切れの現在の動作について記述します。そのあと、どの機能がどのような状況で使用できるのかを理解する際に役立つ背景として、この機能の開発について、複数のバージョンにわたって詳細に説明します。ただし、すべての機能と修正を活用できるようにするには、可能なかぎり、MySQL 5.6 の最新バージョンを使用するようにしてください。
    </p><h4><a name="idm139979120591296"></a>パスワードの期限切れの動作</h4><p>
      アカウントのパスワードを期限切れにするには、<code class="literal">ALTER USER</code> ステートメントを使用します。例:
    </p><pre class="programlisting">
ALTER USER 'myuser'@'localhost' PASSWORD EXPIRE;
</pre><a class="indexterm" name="idm139979120588336"></a><p>
      このステートメントは、<code class="literal">password_expired</code> カラムを <code class="literal">'Y'</code> に設定することで、指定されたアカウントに関連付けられた <code class="literal">mysql.user</code> テーブルの行を変更します。これにより、アカウントが開いている現在の接続は影響を受けません。そのアカウントを使用する後続の各接続では、サーバーはクライアントを切断するか、<span class="quote">「<span class="quote">サンドボックスモード</span>」</span>でクライアントを処理します。このモードでは、期限切れのパスワードをリセットするために必要な操作のみが、サーバーからクライアントに許可されます。(サーバーで実行されるアクションは、クライアントとサーバー両方の設定に依存します。)
    </p><p>
      サーバーがクライアントを切断すると、<code class="literal">ER_MUST_CHANGE_PASSWORD_LOGIN</code> エラーが返されます。
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u myuser -p</code></strong>
Password: <strong class="userinput"><code>******</code></strong>
ERROR 1862 (HY000): Your password has expired. To log in you must
change it using a client that supports expired passwords.
</pre><p>
      サーバーがクライアントをサンドボックスモードに移行すると、これらの操作がクライアントセッション内で許可されます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          クライアントは <code class="literal">SET PASSWORD</code> を使用して、アカウントのパスワードをリセットできます。これは、<code class="literal">password_expired</code> カラムを <code class="literal">'N'</code> に設定することで、現在のアカウントに関連付けられた <code class="literal">mysql.user</code> テーブルの行を変更します。パスワードがリセットされると、サーバーはそのセッション、およびアカウントを使用する後続の接続への通常のアクセスをリストアします。
        </p><p>
          パスワードを現在の値に設定すれば、<span class="quote">「<span class="quote">リセット</span>」</span>できます。適切なポリシーとして、別のパスワードを選択することをお勧めします。
        </p></li><li class="listitem"><p>
          クライアントは <code class="literal">SET</code> ステートメントを使用できます。たとえば、<code class="literal">old_passwords</code> システム変数をデフォルトとは異なる値に設定する必要のあるハッシュ化形式がアカウントのパスワードで使用されている場合は、パスワードをリセットする前に、これが必要になることがあります。
        </p></li></ul></div><p>
      セッション内で許可されていない操作の場合、サーバーは <code class="literal">ER_MUST_CHANGE_PASSWORD</code> エラーを返します。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
ERROR 1820 (HY000): You must SET PASSWORD before executing this statement
</pre><p>
      すでに説明したように、サーバーがパスワードの期限が切れているクライアントを切断するのか、サンドボックスモードに移行するのかは、クライアント設定とサーバー設定の組み合わせによって異なります。次の説明では、関連する設定と、それらがどのように相互作用するのかについて記述します。
    </p><p>
      クライアント側では、特定のクライアントが期限切れパスワードに対してサンドボックスモードを処理できるかどうかを示します。C クライアントライブラリを使用するクライアントの場合、これを実行するための方法が 2 つあります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          接続前に <code class="literal">MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS</code> フラグを <code class="literal">mysql_options()</code> に渡します。
        </p><pre class="programlisting">
arg = 1;
result = mysql_options(mysql,
                       MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS, &amp;arg);
</pre></li><li class="listitem"><p>
          接続時に <code class="literal">CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS</code> フラグを <code class="literal">mysql_real_connect()</code> に渡します。
        </p><pre class="programlisting">
mysql = mysql_real_connect(mysql,
                           host, user, password, "test",
                           port, unix_socket,
                           CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS);
</pre></li></ul></div><p>
      その他の MySQL コネクタには、サンドボックスモードを処理する準備ができていることを示す独自の規則が用意されています。関連するコネクタのドキュメントを参照してください。
    </p><p>
      サーバー側では、クライアントが期限切れパスワードを処理できることを示している場合、サーバーはサンドボックスモードに移行します。
    </p><p>
      クライアントが期限切れパスワードを処理できることを示していない場合 (または、そのように示すことができない古いバージョンのクライアントライブラリを使用している場合)、サーバーのアクションは <code class="literal">disconnect_on_expired_password</code> システム変数の値によって異なります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">disconnect_on_expired_password</code> が有効になっている (デフォルト) 場合、サーバーはクライアントを切断し、<code class="literal">ER_MUST_CHANGE_PASSWORD_LOGIN</code> エラーを返します。
        </p></li><li class="listitem"><p>
          <code class="literal">disconnect_on_expired_password</code> が無効になっている場合、サーバーはクライアントをサンドボックスモードに移行します。
        </p></li></ul></div><p>
      前述のクライアント設定とサーバー設定は、期限切れパスワードを持つアカウントにのみ適用されます。クライアントが期限切れでないパスワードを使用して接続すれば、サーバーはクライアントを通常どおりに処理します。
    </p><h4><a name="idm139979120545360"></a>パスワードの期限切れ機能の開発</h4><p>
      次のタイムラインには、さまざまなパスワードの期限切れ機能が追加されたバージョンを記載します。
    </p><p>
      MySQL 5.6.6: パスワードの期限切れの初期実装
    </p><p>
      DBA がアカウントのパスワードを期限切れにすることができるように、<code class="literal">password_expired</code> カラムが <code class="literal">mysql.user</code> テーブルに導入されました。このカラムのデフォルト値は、<code class="literal">'N'</code> (期限切れなし) です。
    </p><p>
      <code class="literal">password_expired</code> カラムを <code class="literal">'Y'</code> に設定するための SQL インタフェースとして、<code class="literal">ALTER USER</code> ステートメントが導入されました。
    </p><p>
      期限切れパスワードを持つアカウントを使用して接続すると、<code class="literal">SET PASSWORD</code> ステートメントのみが許可される<span class="quote">「<span class="quote">サンドボックスモード</span>」</span>に移行します。その他のステートメントの場合、サーバーは <code class="literal">ER_MUST_CHANGE_PASSWORD</code> エラーを返します。この目的は、サーバーでその他の操作が許可される前に、クライアントにパスワードのリセットを強制することです。<code class="literal">SET PASSWORD</code> はアカウントのパスワードをリセットし、<code class="literal">password_expired</code> を <code class="literal">'N'</code> に設定します。
    </p><p>
      初期実装には、<code class="literal">ALTER USER</code> を使用すると <code class="literal">mysql.user</code> テーブル内の <code class="literal">Password</code> カラムが空の文字列に設定されるというバグがあります。つまり、このステートメントを使用するには、ユーザーは MySQL 5.6.7 まで待つべきです。
    </p><p>
      MySQL 5.6.7:
    </p><p>
      <code class="literal">Password</code> カラムが空の文字列に設定されないように、<code class="literal">ALTER USER</code> が固定されました。
    </p><p>
      MySQL 5.6.8:
    </p><p>
      <code class="literal">ALTER USER</code> は、準備されたステートメントとして使用できます。
    </p><p>
      <span class="command"><strong>mysqladmin password</strong></span> は、期限切れのネイティブまたは古いネイティブのパスワードを持つアカウントのパスワードを設定できるようになりました。
    </p><p>
      <code class="literal">SET PASSWORD</code> に加えて、クライアントが <code class="literal">SET</code> ステートメントを実行することが許可されるように、サンドボックスモードが変更されました。<code class="literal">SET</code> の禁止により、<code class="literal">old_passwords</code> を設定する必要があるクライアントがパスワードをリセットできませんでした。また、これにより、接続時に <code class="literal">SET</code> を広範囲に使用してセッション環境を初期化する一部のコネクタも使用できませんでした。
    </p><p>
      MySQL 5.6.9:
    </p><p>
      ステートメントで指定されたアカウントとクライアントが認証したアカウントが一致する場合にのみ、<code class="literal">SET PASSWORD</code> が許可されるように、サンドボックスモードが変更されました。
    </p><p>
      MySQL 5.6.10:
    </p><p>
      期限切れパスワードを持つアカウントのクライアント接続をサーバーが処理する方法をより適切に制御することが許可され、クライアントが期限切れパスワードを処理できるどうかを示すことが許可されるように、サンドボックスモードが変更されました。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          サーバーが期限切れパスワードを持つアカウントを処理する方法を制御する <code class="literal">disconnect_on_expired_password</code> システム変数が追加されました。
        </p></li><li class="listitem"><p>
          C API クライアントライブラリに、<code class="literal">mysql_options()</code> 用の <code class="literal">MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS</code> と <code class="literal">mysql_real_connect()</code> 用の <code class="literal">CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS</code> の 2 つのフラグが追加されました。各フラグを使用すると、クライアントプログラムが期限切れパスワードを持つアカウントに対してサンドボックスモードを処理できるかどうかを示すことができます。
        </p><p>
          <code class="literal">MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS</code> が <span class="command"><strong>mysqltest</strong></span> では無条件に、<span class="command"><strong>mysql</strong></span> ではインタラクティブモードで、<span class="command"><strong>mysqladmin</strong></span> では最初のコマンドが <code class="literal">password</code> の場合に有効になりました。
        </p></li><li class="listitem"><p>
          <code class="literal">ER_MUST_CHANGE_PASSWORD_LOGIN</code> エラーが追加されました。クライアントが切断されると、サーバーはこのエラーを返します。
        </p></li></ul></div><p>
      MySQL サーバーと C API クライアントライブラリにおけるサンドボックスモードへのこれらの変更に合わせて、コネクタを変更に適合させるための修正の取り組みも始まっています。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="pluggable-authentication"></a>6.3.7 プラガブル認証</h3></div></div></div><p>
      クライアントが MySQL サーバーに接続すると、サーバーはクライアントおよびクライアントホストで提供されたユーザー名を使用して、<code class="literal">mysql.user</code> テーブルから適切なアカウント行を選択します。そのあと、サーバーは認証プラグインでクライアントに適用されるアカウント行から決定することで、クライアントを認証します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          アカウント行にプラグインが指定されている場合、サーバーはそれを呼び出すことで、ユーザーを認証します。サーバーがプラグインを検出できない場合は、エラーが発生します。
        </p></li><li class="listitem"><p>
          アカウント行にプラグイン名が指定されていない場合、<code class="literal">Password</code> カラム内のパスワードハッシュ値でネイティブのハッシュ化方式と、4.1 よりも前の古いハッシュ化方式のどちらが使用されているのかに応じて、サーバーは <code class="literal">mysql_native_password</code> と <code class="literal">mysql_old_password</code> のいずれかのプラグインを使用してアカウントを認証します。クライアントは、アカウント行の <code class="literal">Password</code> カラム内のパスワードと一致する必要があります。
        </p></li></ul></div><p>
      ユーザーが接続を許可されているかどうかを示すステータスがプラグインからサーバーに返されます。
    </p><p>
      プラガブル認証を使用すると、次の 2 つの重要な機能が有効になります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong>外部認証:</strong></span> プラガブル認証を使用すると、<code class="literal">mysql.user</code> テーブルに格納されているパスワードに基づいたネイティブ認証以外の認証方式に適した証明書を使用して、クライアントが MySQL サーバーに接続できます。たとえば、PAM、Windows のログイン ID、LDAP、Kerberos などの外部認証方式を使用するプラグインを作成できます。
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>プロキシユーザー:</strong></span> ユーザーが接続を許可されている場合、接続中のユーザーが別のユーザーのプロキシであることを示すために、認証プラグインは接続中のユーザーの名前と異なるユーザー名をサーバーに返すことができます。接続が存続している間は、アクセス制御のために、プロキシユーザーは別のユーザーの権限を持っているものとして処理されます。実際に、あるユーザーは別のユーザーを偽装します。詳細については、<a class="xref" href="security.html#proxy-users" title="6.3.9 プロキシユーザー">セクション6.3.9「プロキシユーザー」</a>を参照してください。
        </p></li></ul></div><p>
      MySQL では、複数の認証プラグインが使用可能です。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          アカウント行の <code class="literal">Password</code> カラムと照合してパスワードを一致させるネイティブ認証を実行するプラグイン。<code class="literal">mysql_native_password</code> プラグインには、ネイティブのパスワードハッシュ化方式に基づいた認証が実装されています。<code class="literal">mysql_old_password</code> プラグインには、古い (4.1 よりも前の) パスワードハッシュ化方式 (現在は非推奨です) に基づいたネイティブ認証が実装されています。<a class="xref" href="security.html#native-authentication-plugin" title="6.3.8.1 ネイティブ認証プラグイン">セクション6.3.8.1「ネイティブ認証プラグイン」</a>および<a class="xref" href="security.html#old-native-authentication-plugin" title="6.3.8.2 古いネイティブ認証プラグイン">セクション6.3.8.2「古いネイティブ認証プラグイン」</a>を参照してください。サーバーの起動時に <code class="option">--default-authentication-plugin</code> オプションが設定されている場合を除き、<code class="literal">mysql_native_password</code> を使用したネイティブ認証が新しいアカウントのデフォルトです。
        </p></li><li class="listitem"><p>
          SHA-256 のパスワードハッシュ化を使用して認証を実行するプラグイン。このプラグインは、アカウント行の <code class="literal">authentication_string</code> カラムと照合してパスワードを一致させます。これは、ネイティブ認証で実現できるよりも強力な暗号化です。<a class="xref" href="security.html#sha256-authentication-plugin" title="6.3.8.4 SHA-256 認証プラグイン">セクション6.3.8.4「SHA-256 認証プラグイン」</a>を参照してください。
        </p></li><li class="listitem"><p>
          PAM (Pluggable Authentication Module) と照合して外部認証を実行するプラグイン。これを使用すると、MySQL サーバーが PAM を使用して MySQL ユーザーを認証できます。このプラグインでは、プロキシユーザーもサポートされています。<a class="xref" href="security.html#pam-authentication-plugin" title="6.3.8.5 PAM 認証プラグイン">セクション6.3.8.5「PAM 認証プラグイン」</a>を参照してください。
        </p></li><li class="listitem"><p>
          Windows で外部認証を実行するプラグイン。これを使用すると、MySQL サーバーがネイティブの Windows サービスを使用して、クライアント接続を認証できます。Windows にログインしたユーザーは、追加のパスワードを指定せずに、自分の環境内の情報に基づいて MySQL クライアントプログラムからサーバーに接続できます。このプラグインでは、プロキシユーザーもサポートされています。<a class="xref" href="security.html#windows-authentication-plugin" title="6.3.8.6 Windows ネイティブ認証プラグイン">セクション6.3.8.6「Windows ネイティブ認証プラグイン」</a>を参照してください。
        </p></li><li class="listitem"><p>
          ハッシュ化または暗号化を行わずに、サーバーにパスワードを送信するクライアント側のプラグイン。このプラグインは、クライアントユーザーから提供されたものとまったく同じパスワードにアクセスする必要があるサーバー側のプラグインで使用できます。<a class="xref" href="security.html#cleartext-authentication-plugin" title="6.3.8.7 クライアント側のクリアテキスト認証プラグイン">セクション6.3.8.7「クライアント側のクリアテキスト認証プラグイン」</a>を参照してください。
        </p></li><li class="listitem"><p>
          Unix ソケットファイルを使用してローカルホストから接続するクライアントを認証するプラグイン。<a class="xref" href="security.html#socket-authentication-plugin" title="6.3.8.8 ソケットピア証明書認証プラグイン">セクション6.3.8.8「ソケットピア証明書認証プラグイン」</a>を参照してください。
        </p></li><li class="listitem"><p>
          MySQL のネイティブ認証を使用して認証するテストプラグイン。このプラグインは、テストおよび開発のために、認証プラグインを作成する方法を示す例として使用されます。<a class="xref" href="security.html#test-authentication-plugin" title="6.3.8.9 テスト認証プラグイン">セクション6.3.8.9「テスト認証プラグイン」</a>を参照してください。
        </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        プラガブル認証の使用に対する現在の制約 (どのコネクタがどのプラグインをサポートしているのかなど) については、<a class="xref" href="restrictions.html#pluggable-authentication-restrictions" title="D.9 プラガブルな認証の制約">セクションD.9「プラガブルな認証の制約」</a>を参照してください。
      </p><p>
        サードパーティー製コネクタの開発者は、コネクタがプラガブル認証機能を活用できる範囲と、より準拠させるために実行する手順を確認するために、そのセクションを読むべきです。
      </p></div><p>
      独自の認証プラグインを作成することに関心がある場合は、<a class="xref" href="extending-mysql.html#writing-authentication-plugins" title="24.2.4.9 認証プラグインの作成">セクション24.2.4.9「認証プラグインの作成」</a>を参照してください。
    </p><h4><a name="authentication-plugin-use"></a>認証プラグインの使用手順</h4><p>
      このセクションでは、認証プラグインをインストールおよび使用するための一般的な手順を示します。
    </p><p>
      通常、プラガブル認証では、サーバー側とクライアント側で対応するプラグインが使用されます。そのため、次のような特定の認証方式を使用します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          サーバーホストでは、必要に応じて、適切なサーバープラグインを含むライブラリをインストールします。これにより、サーバーはこれを使用して、クライアント接続を認証できます。同様に、各クライアントホストでは、クライアントプログラムで使用される適切なクライアントプラグインを含むライブラリをインストールします。
        </p></li><li class="listitem"><p>
          認証用のプラグインの使用を指定する MySQL アカウントを作成します。
        </p></li><li class="listitem"><p>
          クライアントが接続すると、サーバープラグインからクライアントプログラムに、認証に使用されるクライアントプラグインが指示されます。
        </p></li></ul></div><p>
      ここで示す指示では、MySQL 配布に含まれるサンプルの認証プラグインが使用されています (<a class="xref" href="security.html#test-authentication-plugin" title="6.3.8.9 テスト認証プラグイン">セクション6.3.8.9「テスト認証プラグイン」</a>を参照してください)。この手順は、その他の認証プラグインに似ています。適切なプラグインとファイル名に置き換えてください。
    </p><p>
      サンプルの認証プラグインには、次のような特性があります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          サーバー側のプラグイン名は <code class="literal">test_plugin_server</code> です。
        </p></li><li class="listitem"><p>
          クライアント側のプラグイン名は <code class="literal">auth_test_plugin</code> です。
        </p></li><li class="listitem"><p>
          どちらのプラグインも、プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) 内の <code class="filename">auth_test_plugin.so</code> という名前の共有ライブラリオブジェクトファイルに配置されています。ファイル名のサフィクスは、システムによって異なる場合があります。
        </p></li></ul></div><p>
      次のように、サンプルの認証プラグインをインストールして使用します。
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          サーバーホストおよびクライアントホスト上に、プラグインライブラリがインストールされていることを確認します。
        </p></li><li class="listitem"><p>
          サーバーの起動時または実行時に、サーバー側のテストプラグインをインストールします。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              起動時にプラグインをインストールするには、<code class="option">--plugin-load</code> オプションを使用します。このプラグインのロード方式では、サーバーを起動するたびにオプションを指定する必要があります。たとえば、<code class="filename">my.cnf</code> オプションファイル内で次の行を使用します。
            </p><pre class="programlisting">
[mysqld]
plugin-load=test_plugin_server=auth_test_plugin.so
</pre></li><li class="listitem"><p>
              実行時にプラグインをインストールするには、<code class="literal">INSTALL PLUGIN</code> ステートメントを使用します。
            </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN test_plugin_server SONAME 'auth_test_plugin.so';</code></strong>
</pre><p>
              これにより、プラグインが永続的にインストールされるため、1 回しか実行する必要がありません。
            </p></li></ul></div></li><li class="listitem"><p>
          プラグインがインストールされていることを確認します。たとえば、<code class="literal">SHOW PLUGINS</code> を使用します。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW PLUGINS\G</code></strong>
...
*************************** 21. row ***************************
   Name: test_plugin_server
 Status: ACTIVE
   Type: AUTHENTICATION
Library: auth_test_plugin.so
License: GPL
</pre><p>
          プラグインをチェックするためのその他の方法については、<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.1.8.2 サーバープラグイン情報の取得">セクション5.1.8.2「サーバープラグイン情報の取得」</a>を参照してください。
        </p></li><li class="listitem"><p>
          特定のサーバープラグインを使用して MySQL ユーザーを認証する必要があることを指定するには、ユーザーを作成する <code class="literal">CREATE USER</code> ステートメントの <code class="literal">IDENTIFIED WITH</code> 句にプラグインの名前を指定します。
        </p><pre class="programlisting">
CREATE USER 'testuser'@'localhost' IDENTIFIED WITH test_plugin_server;
</pre></li><li class="listitem"><p>
          クライアントプログラムを使用して、サーバーに接続します。テストプラグインは、ネイティブの MySQL 認証と同じ方法で認証を実行します。したがって、サーバーに接続する際に一般的に使用される通常の <code class="option">--user</code> および <code class="option">--password</code> オプションを指定します。例:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=<em class="replaceable"><code>your_name</code></em> --password=<em class="replaceable"><code>your_pass</code></em></code></strong>
</pre><p>
          <code class="literal">testuser</code> による接続の場合、サーバーは <code class="literal">test_plugin_server</code> という名前のサーバー側のプラグインを使用してアカウントを認証する必要があることを認識し、クライアント側のプラグイン (この場合、<code class="literal">auth_test_plugin</code>) を使用する必要のあるクライアントプログラムと通信します。
        </p><p>
          アカウントがサーバープログラムとクライアントプログラムの両方のデフォルトである認証方式を使用する場合、サーバーはプラグインを使用するクライアントと通信する必要がなく、クライアントとサーバーのネゴシエーションでラウンドトリップが発生することを回避できます。現在、これはネイティブの MySQL 認証 (<code class="literal">mysql_native_password</code>) を使用するアカウントに適用されます。
        </p><p>
          <span class="command"><strong>mysql</strong></span> コマンド行で <code class="option">--default-auth=<em class="replaceable"><code>plugin_name</code></em></code> オプションを指定すると、プログラムで使用するように要求できるクライアント側のプラグインを明示的に作成できます。ただし、ユーザーアカウントが別のプラグインを要求した場合、これはサーバーによってオーバーライドされます。
        </p><p>
          クライアントプログラムでプラグインが見つからない場合は、プラグインが配置されている場所を示す <code class="option">--plugin-dir=<em class="replaceable"><code>dir_name</code></em></code> オプションを指定します。
        </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        <code class="option">--skip-grant-tables</code> オプションを付けてサーバーを起動した場合、サーバーはクライアント認証を実行せず、任意のクライアントが接続することを許可するため、認証プラグインはロードされたとしても使用されません。これはセキュアではないため、リモートクライアントによる接続を回避するために、<code class="option">--skip-networking</code> と組み合わせて <code class="option">--skip-grant-tables</code> を使用する必要がある場合もあります。
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="authentication-plugins-available"></a>6.3.8 MySQL で使用可能な認証プラグイン</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#native-authentication-plugin">6.3.8.1 ネイティブ認証プラグイン</a></span></dt><dt><span class="section"><a href="security.html#old-native-authentication-plugin">6.3.8.2 古いネイティブ認証プラグイン</a></span></dt><dt><span class="section"><a href="security.html#account-upgrades">6.3.8.3 4.1 よりも前のパスワードハッシュ方式と mysql_old_password プラグインからの移行</a></span></dt><dt><span class="section"><a href="security.html#sha256-authentication-plugin">6.3.8.4 SHA-256 認証プラグイン</a></span></dt><dt><span class="section"><a href="security.html#pam-authentication-plugin">6.3.8.5 PAM 認証プラグイン</a></span></dt><dt><span class="section"><a href="security.html#windows-authentication-plugin">6.3.8.6 Windows ネイティブ認証プラグイン</a></span></dt><dt><span class="section"><a href="security.html#cleartext-authentication-plugin">6.3.8.7 クライアント側のクリアテキスト認証プラグイン</a></span></dt><dt><span class="section"><a href="security.html#socket-authentication-plugin">6.3.8.8 ソケットピア証明書認証プラグイン</a></span></dt><dt><span class="section"><a href="security.html#test-authentication-plugin">6.3.8.9 テスト認証プラグイン</a></span></dt></dl></div><p>
      次のセクションでは、MySQL で使用可能な認証プラグインについて説明します。
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="native-authentication-plugin"></a>6.3.8.1 ネイティブ認証プラグイン</h4></div></div></div><a class="indexterm" name="idm139979120398768"></a><a class="indexterm" name="idm139979120397216"></a><p>
        MySQL には、ネイティブ認証 (つまり、<code class="literal">mysql.user</code> テーブルの <code class="literal">Password</code> カラムに格納されたパスワードと照合する認証) を実装する 2 つのプラグインが含まれています。このセクションでは、ネイティブのパスワードハッシュ化方式を使用して、<code class="literal">mysql.user</code> テーブルと照合する認証が実装された <code class="literal">mysql_native_password</code> について説明します。古い (4.1 よりも前の) パスワードハッシュ化方式を使用した認証が実装された <code class="literal">mysql_old_password</code> については、<a class="xref" href="security.html#old-native-authentication-plugin" title="6.3.8.2 古いネイティブ認証プラグイン">セクション6.3.8.2「古いネイティブ認証プラグイン」</a>を参照してください。これらのパスワードハッシュ化方式については、<a class="xref" href="security.html#password-hashing" title="6.1.2.4 MySQL でのパスワードハッシュ">セクション6.1.2.4「MySQL でのパスワードハッシュ」</a>を参照してください。
      </p><p>
        <code class="literal">mysql_native_password</code> ネイティブ認証プラグインには、下位互換性があります。MySQL 5.5.7 よりも古いクライアントでは、認証<span class="emphasis"><em>プラグイン</em></span>がサポートされていませんが、ネイティブ認証<span class="emphasis"><em>プロトコル</em></span>は使用されます。そのため、MySQL 5.5.7 以上からサーバーに接続できます。
      </p><p>
        次の表に、サーバー側とクライアント側のプラグイン名を示します。
      </p><div class="table"><a name="idm139979120385824"></a><p class="title"><b>表 6.8 MySQL ネイティブパスワード認証プラグイン</b></p><div class="table-contents"><table summary="MySQL ネイティブパスワード認証プラグイン" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">サーバー側のプラグイン名</td><td><code class="literal">mysql_native_password</code></td></tr><tr><td scope="row">クライアント側のプラグイン名</td><td><code class="literal">mysql_native_password</code></td></tr><tr><td scope="row">ライブラリオブジェクトファイル名</td><td>なし (プラグインは組み込み済み)</td></tr></tbody></table></div></div><br class="table-break"><p>
        プラグインは、クライアントとサーバーの両方の形式で存在します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバー側のプラグインはサーバーに組み込まれているため、明示的にロードする必要はなく、アンロードしても無効にすることができません。
          </p></li><li class="listitem"><p>
            クライアント側のプラグインは、MySQL 5.5.7 の時点で <code class="literal">libmysqlclient</code> クライアントライブラリに組み込まれ、そのバージョン以降では <code class="literal">libmysqlclient</code> に対してリンクされている任意のプログラムで使用可能です。
          </p></li><li class="listitem"><p>
            MySQL クライアントプログラムでは、デフォルトで <code class="literal">mysql_native_password</code> が使用されます。<code class="option">--default-auth</code> オプションを使用すると、プラグインを明示的に指定できます。
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --default-auth=mysql_native_password ...</code></strong>
</pre></li></ul></div><p>
        アカウント行にプラグイン名が指定されていない場合、<code class="literal">Password</code> カラム内のパスワードハッシュ値でネイティブのハッシュ化方式と、4.1 よりも前の古いハッシュ化方式のどちらが使用されるのかに応じて、サーバーは <code class="literal">mysql_native_password</code> と <code class="literal">mysql_old_password</code> のいずれかのプラグインを使用してアカウントを認証します。クライアントは、アカウント行の <code class="literal">Password</code> カラム内のパスワードと一致する必要があります。
      </p><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.3.7 プラガブル認証">セクション6.3.7「プラガブル認証」</a>を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="old-native-authentication-plugin"></a>6.3.8.2 古いネイティブ認証プラグイン</h4></div></div></div><a class="indexterm" name="idm139979120362544"></a><a class="indexterm" name="idm139979120360992"></a><p>
        MySQL には、ネイティブ認証 (つまり、<code class="literal">mysql.user</code> テーブルの <code class="literal">Password</code> カラムに格納されたパスワードと照合する認証) を実装する 2 つのプラグインが含まれています。このセクションでは、古い (4.1 よりも前の) パスワードハッシュ化方式を使用して、<code class="literal">mysql.user</code> テーブルと照合する認証が実装された <code class="literal">mysql_old_password</code> について説明します。ネイティブのパスワードハッシュ化方式を使用した認証が実装された <code class="literal">mysql_native_password</code> については、<a class="xref" href="security.html#native-authentication-plugin" title="6.3.8.1 ネイティブ認証プラグイン">セクション6.3.8.1「ネイティブ認証プラグイン」</a>を参照してください。これらのパスワードハッシュ化方式については、<a class="xref" href="security.html#password-hashing" title="6.1.2.4 MySQL でのパスワードハッシュ">セクション6.1.2.4「MySQL でのパスワードハッシュ」</a>を参照してください。
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          4.1 よりも前のハッシュ化方式を使用したパスワードは、ネイティブのパスワードハッシュ化方式を使用したパスワードよりもセキュアではありません。4.1 よりも前のパスワードは非推奨であり、これらのサポートは今後の MySQL リリースで削除される予定です。アカウントのアップグレード手順については、<a class="xref" href="security.html#account-upgrades" title="6.3.8.3 4.1 よりも前のパスワードハッシュ方式と mysql_old_password プラグインからの移行">セクション6.3.8.3「4.1 よりも前のパスワードハッシュ方式と mysql_old_password プラグインからの移行」</a>を参照してください。
        </p></div><p>
        <code class="literal">mysql_old_password</code> ネイティブ認証プラグインには、下位互換性があります。MySQL 5.5.7 よりも古いクライアントでは、認証<span class="emphasis"><em>プラグイン</em></span>がサポートされていませんが、ネイティブ認証<span class="emphasis"><em>プロトコル</em></span>は使用されます。そのため、MySQL 5.5.7 以上からサーバーに接続できます。
      </p><p>
        次の表に、サーバー側とクライアント側のプラグイン名を示します。
      </p><div class="table"><a name="idm139979120347552"></a><p class="title"><b>表 6.9 MySQL の古いネイティブ認証プラグイン</b></p><div class="table-contents"><table summary="MySQL の古いネイティブ認証プラグイン" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">サーバー側のプラグイン名</td><td><code class="literal">mysql_old_password</code></td></tr><tr><td scope="row">クライアント側のプラグイン名</td><td><code class="literal">mysql_old_password</code></td></tr><tr><td scope="row">ライブラリオブジェクトファイル名</td><td>なし (プラグインは組み込み済み)</td></tr></tbody></table></div></div><br class="table-break"><p>
        プラグインは、クライアントとサーバーの両方の形式で存在します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバー側のプラグインはサーバーに組み込まれているため、明示的にロードする必要はなく、アンロードしても無効にすることができません。
          </p></li><li class="listitem"><p>
            クライアント側のプラグインは、MySQL 5.5.7 の時点で <code class="literal">libmysqlclient</code> クライアントライブラリに組み込まれ、そのバージョン以降では <code class="literal">libmysqlclient</code> に対してリンクされている任意のプログラムで使用可能です。
          </p></li><li class="listitem"><p>
            MySQL クライアントプログラムは、<code class="option">--default-auth</code> オプションを使用して、<code class="literal">mysql_old_password</code> プラグインを明示的に指定できます。
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --default-auth=mysql_old_password ...</code></strong>
</pre></li></ul></div><p>
        アカウント行にプラグイン名が指定されていない場合、<code class="literal">Password</code> カラム内のパスワードハッシュ値でネイティブのハッシュ化方式と、4.1 よりも前の古いハッシュ化方式のどちらが使用されるのかに応じて、サーバーは <code class="literal">mysql_native_password</code> と <code class="literal">mysql_old_password</code> のいずれかのプラグインを使用してアカウントを認証します。クライアントは、アカウント行の <code class="literal">Password</code> カラム内のパスワードと一致する必要があります。
      </p><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.3.7 プラガブル認証">セクション6.3.7「プラガブル認証」</a>を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="account-upgrades"></a>6.3.8.3 4.1 よりも前のパスワードハッシュ方式と mysql_old_password プラグインからの移行</h4></div></div></div><p>
        MySQL サーバーは、<code class="literal">plugin</code> カラムで名前が指定された認証プラグインを使用して、<code class="literal">mysql.user</code> テーブルに一覧表示されたアカウントごとに接続の試行を認証します。<code class="literal">plugin</code> カラムが空である場合、サーバーは次のように認証を実行します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            MySQL 5.7.2 よりも前では、<code class="literal">Password</code> カラム内のパスワードハッシュ形式に応じて、サーバーは暗黙的に <code class="literal">mysql_native_password</code> または <code class="literal">mysql_old_password</code> プラグインを使用します。<code class="literal">Password</code> 値が空または 4.1 のパスワードハッシュ (41 文字) である場合、サーバーは <code class="literal">mysql_native_password</code> を使用します。パスワード値が 4.1 より前のパスワードハッシュ (16 文字) の場合、サーバーは <code class="literal">mysql_old_password</code> を使用します。(これらのハッシュ形式に関する追加情報については、<a class="xref" href="security.html#password-hashing" title="6.1.2.4 MySQL でのパスワードハッシュ">セクション6.1.2.4「MySQL でのパスワードハッシュ」</a>を参照してください。)
          </p></li><li class="listitem"><p>
            MySQL 5.7.2 の時点では、<code class="literal">plugin</code> カラムを空以外にする必要があり、サーバーは空の <code class="literal">plugin</code> 値を持つアカウントを無効にします。5.7.5 の時点では、<code class="literal">mysql_old_password</code> のサポートが削除されています。
          </p></li></ul></div><p>
        4.1 よりも前のパスワードハッシュおよび <code class="literal">mysql_old_password</code> プラグインは、MySQL 5.6.5 の時点で非推奨となり、4.1 のパスワードハッシュ化および <code class="literal">mysql_native_password</code> プラグインによって提供されるよりも低いセキュリティーレベルを提供します。<code class="literal">plugin</code> カラムを空以外にする必要のある MySQL 5.7.2 の要件と、5.7.5 で <code class="literal">mysql_old_password</code> のサポートが削除されたことを合わせて考えると、DBA は次のようにアカウントをアップグレードすることをお勧めします。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mysql_native_password</code> を明示的に使用するために、それを暗黙的に使用しているアカウントをアップグレードします。
          </p></li><li class="listitem"><p>
            <code class="literal">mysql_native_password</code> を明示的に使用するために、(暗黙的または明示的に) <code class="literal">mysql_old_password</code> を使用しているアカウントをアップグレードします。
          </p></li></ul></div><p>
        このセクションの手順では、これらのアップグレードを実行する方法について説明します。その結果、アカウントは空の <code class="literal">plugin</code> 値を持たず、4.1 よりも前のパスワードハッシュ化または <code class="literal">mysql_old_password</code> プラグインを使用しません。
      </p><p>
        これらの手順のバリエーションとして、DBA は、SHA-256 パスワードハッシュを使用して認証する <code class="literal">sha256_password</code> プラグインにアップグレードするという選択肢をユーザーに提示することがあります。このプラグインについては、<a class="xref" href="security.html#sha256-authentication-plugin" title="6.3.8.4 SHA-256 認証プラグイン">セクション6.3.8.4「SHA-256 認証プラグイン」</a>を参照してください。
      </p><p>
        次の表には、この説明で検討される <code class="literal">mysql.user</code> アカウントのタイプを一覧表示します。
      </p><div class="informaltable"><table border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th scope="col"><code class="literal">plugin</code> カラム</th><th scope="col"><code class="literal">Password</code> カラム</th><th scope="col">認証結果</th><th scope="col">アップグレードアクション</th></tr></thead><tbody><tr><td scope="row">空</td><td>空</td><td>暗黙的に <code class="literal">mysql_native_password</code> を使用する</td><td>プラグインの割り当て</td></tr><tr><td scope="row">空</td><td>4.1 のハッシュ</td><td>暗黙的に <code class="literal">mysql_native_password</code> を使用する</td><td>プラグインの割り当て</td></tr><tr><td scope="row">空</td><td>4.1 よりも前のハッシュ</td><td>暗黙的に <code class="literal">mysql_old_password</code> を使用する</td><td>プラグインを割り当て、パスワードを再ハッシュ化する</td></tr><tr><td scope="row"><code class="literal">mysql_native_password</code></td><td>空</td><td>明示的に <code class="literal">mysql_native_password</code> を使用する</td><td>なし</td></tr><tr><td scope="row"><code class="literal">mysql_native_password</code></td><td>4.1 のハッシュ</td><td>明示的に <code class="literal">mysql_native_password</code> を使用する</td><td>なし</td></tr><tr><td scope="row"><code class="literal">mysql_old_password</code></td><td>空</td><td>明示的に <code class="literal">mysql_old_password</code> を使用する</td><td>プラグインのアップグレード</td></tr><tr><td scope="row"><code class="literal">mysql_old_password</code></td><td>4.1 よりも前のハッシュ</td><td>明示的に <code class="literal">mysql_old_password</code> を使用する</td><td>プラグインをアップグレードし、パスワードを再ハッシュ化する</td></tr></tbody></table></div><p>
        <code class="literal">mysql_native_password</code> プラグインの行に対応するアカウントでは、(プラグインやハッシュ形式を変更する必要がないため) アップグレードアクションは必要ありません。パスワードが空の行に対応するアカウントでは、DBA は、パスワードを選択するようにアカウントの所有者に要求することを検討するべきです (または、<code class="literal">ALTER USER</code> を使用して空のアカウントパスワードを期限切れにすることで、それを要求するべきです)。
      </p><h5><a name="idm139979120264016"></a>mysql_native_password の暗黙的な使用から明示的な使用へのアップグレード</h5><p>
        空のプラグインと 4.1 のパスワードハッシュを持つアカウントは、暗黙的に <code class="literal">mysql_native_password</code> を使用します。<code class="literal">mysql_native_password</code> を明示的に使用するようにアカウントをアップグレードするには、DBA は次のステートメントを実行するようにしてください。
      </p><pre class="programlisting">
UPDATE mysql.user SET plugin = 'mysql_native_password'
WHERE plugin = '' AND (Password = '' OR LENGTH(Password) = 41);
FLUSH PRIVILEGES;
</pre><p>
        MySQL 5.7.2 以降では、DBA は、そのアップグレードアクション間で同じ処理を行う <span class="command"><strong>mysql_upgrade</strong></span> を実行できます。5.7.2 よりも前では、DBA はこれらのステートメントを実行して、アカウントをプロアクティブにアップグレードできます。
      </p><p>
        注:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            この手順は、すでに暗黙的に使用しているアカウントに対してのみ、<code class="literal">mysql_native_password</code> プラグインを明示的にするため、いつ実行しても安全です。
          </p></li><li class="listitem"><p>
            この手順ではパスワードを変更する必要がないため、DBA はユーザーに影響を与えたり、アップグレードプロセスに関与するようにユーザーに要求したりせずに、このアクションを実行できます。
          </p></li></ul></div><h5><a name="idm139979120254016"></a>mysql_old_password から mysql_native_password へのアカウントのアップグレード</h5><p>
        <code class="literal">mysql_native_password</code> を明示的に使用するには、(暗黙的または明示的に) <code class="literal">mysql_old_password</code> を使用しているアカウントをアップグレードするようにしてください。これを行うには、プラグインを変更<span class="emphasis"><em>かつ</em></span>4.1 よりも前から 4.1 のハッシュ形式にパスワードを変更する必要があります。
      </p><p>
        この手順で説明したアカウントをアップグレードする必要がある場合は、次の条件のいずれかに当てはまります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">plugin</code> カラムが空であり、パスワードハッシュ形式が 4.1 よりも前 (16 文字) であるため、アカウントは暗黙的に <code class="literal">mysql_old_password</code> を使用します。
          </p></li><li class="listitem"><p>
            アカウントは明示的に <code class="literal">mysql_old_password</code> を使用します。
          </p></li></ul></div><p>
        このようなアカウント識別するには、次のクエリーを使用します。
      </p><pre class="programlisting">
SELECT User, Host, Password FROM mysql.user
WHERE (plugin = '' AND LENGTH(Password) = 16)
OR plugin = 'mysql_old_password';
</pre><p>
        次の説明では、そのアカウントセットを更新するための 2 つの方法を示します。これらは異なる特性を持っているため、DBA は両方とも読み、特定の MySQL インストールに最適な方を決定するようにしてください。
      </p><p>
        <span class="bold"><strong>方法 1.</strong></span>
      </p><p>
        この方法の特性:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            すべてのユーザーが <code class="literal">mysql_native_password</code> にアップグレードされるまで、<code class="literal">secure_auth=0</code> を指定してサーバーおよびクライアントを実行する必要があります。(それ以外の場合、ユーザーは新しい形式のハッシュにアップグレードするために、古い形式のパスワードハッシュを使用してサーバーに接続できません。)
          </p></li><li class="listitem"><p>
            MySQL 5.5 から 5.7.1 まででは、動作します。5.7.2 の時点では、サーバーは空でないプラグインを持つようにアカウントに要求し、そうでない場合はそれらのアカウントを無効にするため、動作しません。したがって、5.7.2 以降にアップグレードした場合は、方法 2 を選択してください。
          </p></li></ul></div><p>
        DBA は、サーバーが <code class="literal">secure_auth=0</code> を指定して実行されていることを確認するようにしてください。
      </p><p>
        明示的に <code class="literal">mysql_old_password</code> を使用するすべてのアカウントでは、DBA は空のプラグインに設定するようにしてください。
      </p><pre class="programlisting">
UPDATE mysql.user SET plugin = ''
WHERE plugin = 'mysql_old_password';
FLUSH PRIVILEGES;
</pre><p>
        また、影響を受けるアカウントのパスワードを期限切れにするには、次のステートメントを使用します。
      </p><pre class="programlisting">
UPDATE mysql.user SET plugin = '', password_expired = 'Y'
WHERE plugin = 'mysql_old_password';
FLUSH PRIVILEGES;
</pre><p>
        この時点で、影響を受けるユーザーはサーバーに接続し、4.1 のハッシュ化が使用されるようにパスワードをリセットできます。DBA は空のプラグインを現在持っている各ユーザーに、接続して次のステートメントを実行するように要求するようにしてください。
      </p><pre class="programlisting">
SET old_passwords = 0;
SET PASSWORD = PASSWORD('<em class="replaceable"><code>user-chosen-password</code></em>');
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          MySQL 5.6.5 以降では、クライアント側の <code class="option">--secure-auth</code> がデフォルトで有効になっているため、DBA はこれを無効にするようにユーザーに思い出させるようにしてください。そうしなければ、ユーザーは接続できなくなります。
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u <em class="replaceable"><code>user_name</code></em> -p --secure-auth=0</code></strong>
</pre></div><p>
        影響を受けるユーザーがこれらのステートメントを実行したあとに、DBA は対応するアカウントプラグインを <code class="literal">mysql_native_password</code> に設定すると、プラグインを明示的にすることができます。また、DBA は次のステートメントを定期的に実行すると、影響を受けるユーザーが自分のパスワードをリセットした任意のアカウントを検索および修正できます。
      </p><pre class="programlisting">
UPDATE mysql.user SET plugin = 'mysql_native_password'
WHERE plugin = '' AND (Password = '' OR LENGTH(Password) = 41);
FLUSH PRIVILEGES;
</pre><p>
        空のプラグインを持つアカウントがなくなると、このクエリーは空の結果を返します。
      </p><pre class="programlisting">
SELECT User, Host, Password FROM mysql.user
WHERE (plugin = '' AND LENGTH(Password) = 16);
</pre><p>
        この時点で、すべてのアカウントは 4.1 よりも前のパスワードハッシュ化から移行され、<code class="literal">secure_auth=0</code> を指定してサーバーを実行する必要がなくなります。
      </p><p>
        <span class="bold"><strong>方法 2.</strong></span>
      </p><p>
        この方法の特性:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            DBA は、影響を受ける各アカウントに新しいパスワードを割り当てます。そのため、DBA はこのような各ユーザーに新しいパスワードを通知し、新しいパスワードを選択するようにユーザーに要求する必要があります。DBA からユーザーへのパスワードの通知は、MySQL のスコープ外です。DBA はパスワードを慎重に通知するようにしてください。
          </p></li><li class="listitem"><p>
            <code class="literal">secure_auth=0</code> を指定してサーバーまたはクライアントを実行する必要はありません。
          </p></li><li class="listitem"><p>
            MySQL 5.5 以降のどのバージョンでも動作します。
          </p></li></ul></div><p>
        この方法では、パスワードを個別に設定する必要があるため、DBA は各アカウントを別々に更新します。<span class="emphasis"><em>DBA は、アカウントごとに別々のパスワードを選択するようにしてください。</em></span>
      </p><p>
        <code class="literal">'user1'@'localhost'</code> がアップグレードされるアカウントの 1 つであると仮定します。DBA は、次のように変更するようにしてください。
      </p><pre class="programlisting">
SET old_passwords = 0;
UPDATE mysql.user SET plugin = 'mysql_native_password',
Password = PASSWORD('<em class="replaceable"><code>DBA-chosen-password</code></em>')
WHERE (User, Host) = ('user1', 'localhost');
FLUSH PRIVILEGES;
</pre><p>
        また、パスワードを期限切れにするには、代わりに次のステートメントを使用します。
      </p><pre class="programlisting">
SET old_passwords = 0;
UPDATE mysql.user SET plugin = 'mysql_native_password',
Password = PASSWORD('<em class="replaceable"><code>DBA-chosen-password</code></em>'), password_expired = 'Y'
WHERE (User, Host) = ('user1', 'localhost');
FLUSH PRIVILEGES;
</pre><p>
        次に DBA は、ユーザーに新しいパスワードを通知して、そのパスワードを使用してサーバーに接続し、新しいパスワードを選択するために次のステートメントを実行するようにユーザーに要求するようにしてください。
      </p><pre class="programlisting">
SET old_passwords = 0;
SET PASSWORD = PASSWORD('<em class="replaceable"><code>user-chosen-password</code></em>');
</pre><p>
        アップグレードするアカウントごとに繰り返します。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="sha256-authentication-plugin"></a>6.3.8.4 SHA-256 認証プラグイン</h4></div></div></div><a class="indexterm" name="idm139979120202768"></a><a class="indexterm" name="idm139979120201216"></a><p>
        MySQL 5.6.6 の時点で、MySQL では、ユーザーアカウントのパスワード用に SHA-256 ハッシュ化が実装された認証プラグインが提供されています。
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          <code class="literal">sha256_password</code> プラグインで認証するアカウントを使用してサーバーに接続するには、このセクションの後半で説明するように、SSL 接続または、RSA を使用してパスワードを暗号化する単純な接続を使用する必要があります。どちらの方法でも、<code class="literal">sha256_password</code> プラグインを使用するには、SSL の機能を使用して MySQL を構築する必要があります。<a class="xref" href="security.html#ssl-connections" title="6.3.10 セキュアな接続のための SSL の使用">セクション6.3.10「セキュアな接続のための SSL の使用」</a>を参照してください。
        </p></div><p>
        次の表に、サーバー側とクライアント側のプラグイン名を示します。
      </p><div class="table"><a name="idm139979120194176"></a><p class="title"><b>表 6.10 MySQL SHA-256 認証プラグイン</b></p><div class="table-contents"><table summary="MySQL SHA-256 認証プラグイン" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">サーバー側のプラグイン名</td><td><code class="literal">sha256_password</code></td></tr><tr><td scope="row">クライアント側のプラグイン名</td><td><code class="literal">sha256_password</code></td></tr><tr><td scope="row">ライブラリオブジェクトファイル名</td><td>なし (プラグインは組み込み済み)</td></tr></tbody></table></div></div><br class="table-break"><p>
        サーバー側の <code class="literal">sha256_password</code> プラグインはサーバーに組み込まれているため、明示的にロードする必要はなく、アンロードしても無効にすることはできません。同様に、クライアントはクライアント側のプラグインの場所を指定する必要がありません。
      </p><p>
        SHA-256 パスワードのハッシュ化を使用するアカウントを設定するには、次の手順を使用します。
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            アカウントを作成し、<code class="literal">sha256_password</code> プラグインを使用して認証するように指定します。
          </p><pre class="programlisting">
CREATE USER 'sha256user'@'localhost' IDENTIFIED WITH sha256_password;
</pre></li><li class="listitem"><p>
            <code class="literal"> PASSWORD ()</code> 関数でパスワード文字列の SHA-256 ハッシュ化が使用されるように、<code class="literal">old_passwords</code> システム変数を 2 に設定してから、アカウントのパスワードを設定します。
          </p><pre class="programlisting">
SET old_passwords = 2;
SET PASSWORD FOR 'sha256user'@'localhost' = PASSWORD('Sh@256Pa33');
</pre></li></ol></div><p>
        または、<code class="literal">sha256_password</code> に設定されたデフォルトの認証プラグインを使用して、サーバーを起動します。たとえば、サーバーのオプションファイルに次の行を挿入します。
      </p><pre class="programlisting">
[mysqld]
default-authentication-plugin=sha256_password
</pre><p>
        これにより、新しいアカウント用に <code class="literal">sha256_password</code> プラグインがデフォルトで使用され、<code class="literal">old_passwords</code> が 2 に設定されます。その結果、アカウント作成時に <code class="literal">CREATE USER</code> ステートメントで <code class="literal">IDENTIFIED BY</code> 句を使用して、パスワードを設定できます。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'sha256user2'@'localhost' IDENTIFIED BY 'Sh@256Pa33';</code></strong>
Query OK, 0 rows affected (0.06 sec)
</pre><p>
        この場合、サーバーは <code class="literal">sha256_password</code> プラグインをアカウントに割り当て、SHA-256 を使用してパスワードを暗号化します。(もう 1 つの結果として、<code class="literal">sha256_password</code> とは異なる認証プラグインを使用するアカウントを作成するには、<code class="literal">CREATE USER</code> ステートメントで <code class="literal">IDENTIFIED BY</code> 句を使用して、そのプラグインを指定し、プラグインに <code class="literal">old_passwords</code> を適切に設定してから、<code class="literal">SET PASSWORD</code> を使用してアカウントのパスワードを設定する必要があります。)
      </p><p>
        <code class="literal">old_passwords</code> および <code class="literal">PASSWORD()</code> についての詳細は、<a class="xref" href="server-administration.html#server-system-variables" title="5.1.4 サーバーシステム変数">セクション5.1.4「サーバーシステム変数」</a>および<a class="xref" href="functions.html#encryption-functions" title="12.13 暗号化関数と圧縮関数">セクション12.13「暗号化関数と圧縮関数」</a>を参照してください。
      </p><p>
        <code class="literal">sha256_password</code> プラグインを使用して認証する任意のアカウントのパスワードを変更するには、<code class="literal">SET PASSWORD</code> を使用する前に、<code class="literal">old_passwords</code> の値が 2 になっていることを確認します。<code class="literal">old_passwords</code> の値が 2 以外になっている場合は、パスワードを設定しようとするとエラーが発生します。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET old_passwords = 0;</code></strong>
mysql&gt; <strong class="userinput"><code>SET PASSWORD FOR 'sha256user'@'localhost' = PASSWORD('NewSh@256Pa33');</code></strong>
ERROR 1827 (HY000): The password hash doesn't have the expected format.
Check if the correct password algorithm is being used with the
PASSWORD() function.
</pre><p>
        SHA-256 のパスワードを使用する <code class="literal">mysql.user</code> テーブル内のアカウントは、<code class="literal">plugin</code> カラム内の <code class="literal">'sha256_password'</code> および <code class="literal">authentication_string</code> カラム内の SHA-256 パスワードハッシュを含む行として識別できます。
      </p><p>
        MySQL は yaSSL と OpenSSL のいずれかを使用して構築でき、<code class="literal">sha256_password</code> プラグインは、いずれかのパッケージを使用して構築された配布で動作します。デフォルトは、yaSSL を使用する方法です。代わりに OpenSSL を使用して MySQL が構築されている場合は、RSA 暗号化が使用可能であり、次のリストに示す追加の機能が <code class="literal">sha256_password</code> に実装されます。(これらの機能を有効にするには、このセクションの後半で示す RSA の構成手順に従う必要もあります。)
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            あとで説明するように、クライアント接続プロセス中に RSA 暗号化を使用すると、クライアントがサーバーにパスワードを送信できます。
          </p></li><li class="listitem"><p>
            サーバーは <code class="literal">sha256_password_private_key_path</code> と <code class="literal">sha256_password_public_key_path</code> の 2 つの追加のシステム変数を公開します。これは、サーバーの起動時にデータベース管理者が、これらを RSA 秘密鍵と公開鍵ファイルの名前に設定するために使用されます。
          </p></li><li class="listitem"><p>
            サーバーは、RSA 公開鍵の値を示すステータス変数 <code class="literal">Rsa_public_key</code> を公開します。
          </p></li><li class="listitem"><p>
            <span class="command"><strong>mysql</strong></span> および <span class="command"><strong>mysqltest</strong></span> クライアントプログラムでは、RSA 公開鍵ファイルを明示的に指定するための <code class="option">--server-public-key-path</code> オプションがサポートされています。(このオプションは、<code class="option">--server-public-key</code> という名前で MySQL 5.6.6 に追加されましたが、5.6.7 で <code class="option">--server-public-key-path</code> という名前に変更されました。)
          </p></li></ul></div><p>
        <code class="literal">sha256_password</code> プラグインを使用するクライアントでは、サーバーへの接続時にパスワードがクリアテキストとして公開されません。パスワードの送信がどのように発生するのかは、SSL 接続が使用されるのかどうか、および RSA 暗号化が使用可能であるかどうかによって異なります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            SSL 接続が使用される場合、パスワードはクリアテキストとして送信されますが、接続は SSL を使用して暗号化されるため、覗き見られる可能性はありません。
          </p></li><li class="listitem"><p>
            SSL 接続は使用されないが、RSA 暗号化が使用可能である場合、パスワードは暗号化されていない接続内に送信されます。ただし、パスワードは覗き見られないように RSA で暗号化されます。サーバーはパスワードを受信すると、それを復号化します。繰り返し攻撃を防ぐために、スクランブルが暗号化で使用されます。
          </p></li><li class="listitem"><p>
            SSL 接続が使用されず、RSA 暗号化が使用可能でない場合、パスワードはクリアテキストとして公開されずに送信できないため、<code class="literal">sha256_password</code> プラグインによる接続の試行に失敗します。
          </p></li></ul></div><p>
        すでに説明したように、RSA のパスワード暗号化は、OpenSSL を使用して MySQL が構築された場合にのみ使用可能です。yaSSL を使用して MySQL 配布を構築したということは、クライアントが SSL 接続を使用してサーバーにアクセスする際にのみ、SHA-256 のパスワードを使用できることを意味します。SSL を使用したサーバーへの接続については、<a class="xref" href="security.html#ssl-connections" title="6.3.10 セキュアな接続のための SSL の使用">セクション6.3.10「セキュアな接続のための SSL の使用」</a>を参照してください。
      </p><p>
        次の手順では、MySQL が OpenSSL を使用して構築されたと仮定して、クライアント接続プロセス中にパスワードの RSA 暗号化を有効にする方法について説明します。
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            RSA の秘密鍵および公開鍵ファイルを作成します。MySQL サーバーを実行する際に使用されるシステムアカウントにログインしている間に、次のコマンドを実行します。これにより、ファイルはそのアカウントによって所有されます。
          </p><pre class="programlisting">
openssl genrsa -out mykey.pem 1024
openssl rsa -in mykey.pem -pubout -out mykey.pub
</pre><p>
            これらのコマンドでは、1,024 ビットの鍵が作成されます。より強固な鍵を作成するには、2,048 のような大きな値を使用します。
          </p></li><li class="listitem"><p>
            鍵ファイルのアクセスモードを設定します。秘密鍵は、サーバーからのみ読み取り可能にするべきです。一方で、公開鍵は、クライアントユーザーに自由に配布できます。
          </p><pre class="programlisting">
chmod 400 mykey.pem
chmod 444 mykey.pub
</pre></li><li class="listitem"><p>
            サーバーのオプションファイルで、鍵ファイルの名前を使用して適切なシステム変数を構成します。サーバーのデータディレクトリにファイルを配置する場合は、完全パス名を指定する必要がありません。
          </p><pre class="programlisting">
[mysqld]
sha256_password_private_key_path=mykey.pem
sha256_password_public_key_path=mykey.pub
</pre><p>
            ファイルがデータディレクトリ内にない場合や、システム変数の値でそれらの場所を明示的に指定する場合は、完全パス名を使用します。
          </p><pre class="programlisting">
[mysqld]
sha256_password_private_key_path=/usr/local/mysql/mykey.pem
sha256_password_public_key_path=/usr/local/mysql/mykey.pub
</pre></li><li class="listitem"><p>
            サーバーを再起動してから、それに接続し、<code class="literal">Rsa_public_key</code> ステータス変数の値をチェックします。値はここで示すものとは異なりますが、空以外を指定するようにしてください。
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Rsa_public_key'\G</code></strong>
*************************** 1. row ***************************
Variable_name: Rsa_public_key
        Value: -----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDO9nRUDd+KvSZgY7cNBZMNpwX6
MvE1PbJFXO7u18nJ9lwc99Du/E7lw6CVXw7VKrXPeHbVQUzGyUNkf45Nz/ckaaJa
aLgJOBCIDmNVnyU54OT/1lcs2xiyfaDMe8fCJ64ZwTnKbY2gkt1IMjUAB5Ogd5kJ
g8aV7EtKwyhHb0c30QIDAQAB
-----END PUBLIC KEY-----
</pre><p>
            値が空の場合は、鍵ファイルに関するいくつかの問題がサーバーで見つかっています。エラーログをチェックして、診断情報を確認してください。
          </p></li></ol></div><p>
        サーバーに RSA 鍵ファイルが構成されると、クライアントはそれらのファイルを使用して、<code class="literal">sha256_password</code> プラグインで認証するアカウントを使用したサーバーに接続できます。すでに説明したように、このようなアカウントは SSL 接続 (この場合、RSA が使用されません)、または RSA を使用してパスワードを暗号化する単純な接続を使用できます。次の説明は、SSL が使用されないことが前提となっています。サーバーに接続するために、クライアント側で特別な準備をする必要はありません。例:
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u sha256user -p</code></strong>
Enter password: <strong class="userinput"><code>Sh@256Pa33</code></strong>
</pre><p>
        <code class="literal">sha256user</code> によって接続を試みる場合、サーバーは <code class="literal">sha256_password</code> が適切な認証プラグインであると判断し、それを呼び出します。接続で SSL が使用されないために、RSA 暗号化を使用してパスワードを送信する必要があることがプラグインによって検出されます。RSA 公開鍵がクライアントに送信され、この鍵を使用してパスワードが暗号化され、結果がサーバーに返されます。このプラグインは、サーバー側の RSA 鍵を使用してパスワードを復号化し、パスワードが正しいかどうかに基づいて接続を承認または拒否します。
      </p><p>
        サーバーは必要に応じて公開鍵をクライアントに送信しますが、クライアントホスト上で RSA 公開鍵のコピーが使用可能である場合は、クライアントはその鍵を使用して、クライアント/サーバープロトコルにラウンドトリップを保存できます。
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u sha256user -p --server-public-key-path=<em class="replaceable"><code>file_name</code></em></code></strong>
</pre><p>
        <code class="option">--server-public-key-path</code> オプションで指定されたファイル内の公開鍵値は、<code class="literal">sha256_password_public_key_path</code> システム変数で指定されたサーバー側のファイル内の鍵値と同じにするようにしてください。鍵ファイルに有効な公開鍵値が含まれているが、その値が正しくない場合は、アクセス拒否のエラーが発生します。鍵ファイルに有効な公開鍵が含まれていない場合は、その鍵をクライアントプログラムで使用できません。この場合、サーバーは <code class="option">--server-public-key-path</code> オプションが指定された場合と同様に、クライアントに公開鍵を送信します。
      </p><p>
        クライアントユーザーは、次の 2 つの方法で RSA 公開鍵を取得できます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            データベース管理者は、公開鍵ファイルのコピーを提供できます。
          </p></li><li class="listitem"><p>
            その他の方法でサーバーに接続できるクライアントユーザーは、<code class="literal">SHOW STATUS LIKE 'Rsa_public_key'</code> ステートメントを使用し、返された鍵値をファイル内に保存できます。
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="pam-authentication-plugin"></a>6.3.8.5 PAM 認証プラグイン</h4></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#pam-authentication-plugin-installation">6.3.8.5.1 PAM 認証プラグインのインストール</a></span></dt><dt><span class="section"><a href="security.html#pam-authentication-plugin-usage">6.3.8.5.2 PAM 認証プラグインの使用</a></span></dt><dt><span class="section"><a href="security.html#pam-authentication-plugin-debugging">6.3.8.5.3 PAM 認証プラグインのデバッグ</a></span></dt></dl></div><a class="indexterm" name="idm139979120090912"></a><a class="indexterm" name="idm139979120089360"></a><a class="indexterm" name="idm139979120087472"></a><a class="indexterm" name="idm139979120085440"></a><a class="indexterm" name="idm139979120083344"></a><a class="indexterm" name="idm139979120082080"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          PAM 認証プラグインは、商用の拡張機能です。商用の製品 (MySQL Enterprise Edition) についてさらに学習するには、http://www.mysql.com/products/ を参照してください。
        </p></div><p>
        MySQL 5.6.10 の時点で、MySQL の商用配布には、MySQL サーバーが PAM (Pluggable Authentication Module) を使用して MySQL ユーザーを認証できる認証プラグインが含まれています。PAM を使用すると、システムは標準インタフェースを使用して、さまざまな種類の認証方式 (Unix パスワードや LDAP ディレクトリなど) にアクセスできます。
      </p><p>
        PAM プラグインでは、MySQL サーバーによって渡される情報 (ユーザー名、ホスト名、パスワード、認証文字列など) に加えて、PAM 検索で使用可能な任意の方式が使用されます。このプラグインは、PAM と照合してユーザー資格情報をチェックし、<code class="literal">「Authentication succeeded, Username is <em class="replaceable"><code>user_name</code></em>」</code>または<code class="literal">「Authentication failed」</code>を返します。
      </p><p>
        PAM 認証プラグインには、次のような機能が備わっています。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            外部認証: このプラグインを使用すると、MySQL サーバーは、MySQL 付与テーブルの外部で定義されたユーザーからの接続を受け入れることができます。
          </p></li><li class="listitem"><p>
            プロキシユーザーのサポート: このプラグインは、外部ユーザーが属するグループおよび指定された認証文字列に基づいて、ログインユーザーとは異なるユーザー名を MySQL に返すことができます。つまり、このプラグインは、外部 PAM で認証されたユーザーが持つべき権限を定義する MySQL ユーザーを返すことができます。たとえば、<code class="literal">joe</code> という名前の PAM ユーザーは接続して、<code class="literal">developer</code> という名前の MySQL ユーザーの権限を持つことができます。
          </p></li></ul></div><p>
        次の表には、プラグインおよびライブラリファイルの名前を示します。ファイル名のサフィクスは、システムによって異なる場合があります。ファイルの場所は、<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリである必要があります。インストールについては、<a class="xref" href="security.html#pam-authentication-plugin-installation" title="6.3.8.5.1 PAM 認証プラグインのインストール">セクション6.3.8.5.1「PAM 認証プラグインのインストール」</a>を参照してください。
      </p><div class="table"><a name="idm139979120066416"></a><p class="title"><b>表 6.11 MySQL PAM 認証プラグイン</b></p><div class="table-contents"><table summary="MySQL PAM 認証プラグイン" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">サーバー側のプラグイン名</td><td><code class="literal">authentication_pam</code></td></tr><tr><td scope="row">クライアント側のプラグイン名</td><td><code class="literal">mysql_clear_password</code></td></tr><tr><td scope="row">ライブラリオブジェクトファイル名</td><td><code class="filename">authentication_pam.so</code></td></tr></tbody></table></div></div><br class="table-break"><p>
        ライブラリファイルには、サーバー側のプラグインのみが含まれています。クライアント側のプラグインは、<code class="literal">libmysqlclient</code> クライアントライブラリに組み込まれています。<a class="xref" href="security.html#cleartext-authentication-plugin" title="6.3.8.7 クライアント側のクリアテキスト認証プラグイン">セクション6.3.8.7「クライアント側のクリアテキスト認証プラグイン」</a>を参照してください。
      </p><p>
        サーバー側の PAM 認証プラグインは、商用配布にのみ含まれています。MySQL コミュニティー配布には含まれていません。サーバー側のプラグインと通信するクライアント側のクリアテキストプラグインは、MySQL クライアントライブラリに組み込まれ、コミュニティー配布を含むすべての配布に含まれています。これにより、5.6.10 以降の任意の配布から、サーバー側のプラグインがロードされたサーバーに接続することがクライアントに許可されます。
      </p><p>
        PAM 認証プラグインは、Linux および Mac OS X 上でテストされています。これには、MySQL Server 5.6.10 以降が必要です。
      </p><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.3.7 プラガブル認証">セクション6.3.7「プラガブル認証」</a>を参照してください。プロキシユーザーについては、<a class="xref" href="security.html#proxy-users" title="6.3.9 プロキシユーザー">セクション6.3.9「プロキシユーザー」</a>を参照してください。
      </p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="pam-authentication-plugin-installation"></a>6.3.8.5.1 PAM 認証プラグインのインストール</h5></div></div></div><p>
          PAM 認証プラグインは、MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) に配置する必要があります。必要に応じて、サーバーの起動時に、プラグインディレクトリの場所をサーバーに指示する <code class="literal">plugin_dir</code> の値を設定します。
        </p><p>
          プラグインを有効にするには、<code class="option">--plugin-load</code> オプションを付けてサーバーを起動します。たとえば、<code class="filename">my.cnf</code> ファイルに次の行を挿入します。オブジェクトファイルのサフィクスがシステム上の <code class="filename">.so</code> と異なる場合は、正しいサフィクスに置き換えてください。
        </p><pre class="programlisting">
[mysqld]
plugin-load=authentication_pam.so
</pre><p>
          このプラグインを使用して認証するべき MySQL アカウントには、<code class="literal">CREATE USER</code> または <code class="literal">GRANT</code> ステートメントの <code class="literal">IDENTIFIED WITH</code> 句の <code class="literal">authentication_pam</code> というプラグイン名を使用します。
        </p><p>
          プラグインのインストールを確認するには、<code class="literal">INFORMATION_SCHEMA.PLUGINS</code> テーブルを調査するか、または <code class="literal">SHOW PLUGINS</code> ステートメントを使用します。<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.1.8.2 サーバープラグイン情報の取得">セクション5.1.8.2「サーバープラグイン情報の取得」</a>を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="pam-authentication-plugin-usage"></a>6.3.8.5.2 PAM 認証プラグインの使用</h5></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#pam-authentication-unix-without-proxy">6.3.8.5.2.1 プロキシユーザーを使用しない Unix パスワード認証</a></span></dt><dt><span class="section"><a href="security.html#pam-authentication-ldap-without-proxy">6.3.8.5.2.2 プロキシユーザーを使用しない LDAP 認証</a></span></dt><dt><span class="section"><a href="security.html#pam-authentication-unix-with-proxy">6.3.8.5.2.3 プロキシユーザーとグループマッピングを使用した Unix パスワード認証</a></span></dt></dl></div><p>
          このセクションでは、PAM 認証プラグインを使用して、MySQL クライアントプログラムからサーバーに接続する方法について説明します。サーバー側のプラグインが有効になっていて、クライアント側のプラグインを追加するのに十分新しいクライアントプログラムであることが前提となっています。
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            PAM プラグインの通信相手であるクライアント側のプラグインは、PAM に渡すことができるように、単純にパスワードをクリアテキストでサーバーに送信します。これにより、一部の構成でセキュリティーの問題が発生する可能性がありますが、サーバー側の PAM ライブラリを使用するためには必要です。パスワードが傍受される可能性がある場合に、問題を回避するには、クライアントは SSL を使用して MySQL サーバーに接続するようにしてください。<a class="xref" href="security.html#cleartext-authentication-plugin" title="6.3.8.7 クライアント側のクリアテキスト認証プラグイン">セクション6.3.8.7「クライアント側のクリアテキスト認証プラグイン」</a>を参照してください。
          </p></div><p>
          <code class="literal">CREATE USER</code> または <code class="literal">GRANT</code> ステートメントの <code class="literal">IDENTIFIED WITH</code> 句で PAM 認証プラグインを参照するには、<code class="literal">authentication_pam</code> という名前を使用します。例:
        </p><pre class="programlisting">
CREATE USER <em class="replaceable"><code>user</code></em>
  IDENTIFIED WITH authentication_pam
  AS '<em class="replaceable"><code>authentication_string</code></em>';
</pre><p>
          認証文字列には、次のタイプの情報が指定されます。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              PAM では、システム管理者が特定のアプリケーション用の認証方式を構成する際に使用できる名前である<span class="quote">「<span class="quote">サービス名</span>」</span>の概念がサポートされています。このような複数の<span class="quote">「<span class="quote">アプリケーション</span>」</span>が単一のデータベースサーバーインスタンスに関連付けられている可能性もあるため、サービス名の選択は SQL アプリケーションの開発者に任されます。PAM を使用して認証するべきアカウントを定義する際は、認証文字列でサービス名を指定します。
            </p></li><li class="listitem"><p>
              PAM では、ログイン時に指定されたログイン名以外の MySQL ユーザー名を PAM モジュールからサーバーに返すための方法が提供されています。認証文字列を使用して、ログイン名と MySQL ユーザー名とのマッピングを制御します。プロキシユーザーの機能を活用するには、この種類のマッピングを認証文字列に含める必要があります。
            </p></li></ul></div><p>
          たとえば、サービス名が <code class="literal">mysql</code> であり、<code class="literal">root</code> および <code class="literal">users</code> PAM グループ内のユーザーを <code class="literal">developer</code> および <code class="literal">data_entry</code> ユーザーにマップする必要がある場合は、それぞれ次のようなステートメントを使用します。
        </p><pre class="programlisting">
CREATE USER <em class="replaceable"><code>user</code></em>
  IDENTIFIED WITH authentication_pam
  AS 'mysql, root=developer, users=data_entry';
</pre><p>
          PAM 認証プラグインでの認証文字列の構文は、次のようなルールに従っています。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              文字列は PAM サービス名で構成され、それぞれグループ名と SQL ユーザー名を指定する 1 つ以上のキーワードと値のペアで構成されるグループマッピングリストがオプションで続きます。
            </p><pre class="programlisting">
<em class="replaceable"><code>pam_service_name</code></em>[,<em class="replaceable"><code>group_name</code></em>=<em class="replaceable"><code>sql_user_name</code></em>]...
</pre></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>group_name</code></em>=<em class="replaceable"><code>sql_user_name</code></em></code> の各ペアの前には、カンマを付ける必要があります。
            </p></li><li class="listitem"><p>
              二重引用符で囲まれていない先頭および末尾の空白文字は、無視されます。
            </p></li><li class="listitem"><p>
              引用符で囲まれていない <em class="replaceable"><code>pam_service_name</code></em>、<em class="replaceable"><code>group_name</code></em>、および <em class="replaceable"><code>sql_user_name</code></em> の値には、等号、カンマ、または空白文字を除く、任意の文字を含めることができます。
            </p></li><li class="listitem"><p>
              <em class="replaceable"><code>pam_service_name</code></em>、<em class="replaceable"><code>group_name</code></em>、または <em class="replaceable"><code>sql_user_name</code></em> の値を二重引用符で囲むと、引用符間のすべての文字が値の一部となります。たとえば、値に空白文字が含まれている場合は、これが必要です。二重引用符およびバックスラッシュ (<code class="literal">'\'</code>) を除く、すべての文字が有効です。どちらかの文字を含めるには、バックスラッシュを使用してエスケープします。
            </p></li></ul></div><p>
          このプラグインは、各ログインチェック時に認証文字列を解析します。オーバーヘッドを最小限に抑えるには、できるだけ文字列を短く保ちます。
        </p><p>
          プラグインが正常にログイン名を認証すると、認証文字列でグループマッピングリストを検索し、そのリストを使用して外部ユーザーがメンバーになっているグループに基づいて MySQL サーバーに別のユーザー名を返します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              認証文字列にグループマッピングリストが含まれていない場合は、プラグインはログイン名を返します。
            </p></li><li class="listitem"><p>
              認証文字列にグループマッピングリストが含まれている場合は、プラグインはリスト内の各 <code class="literal"><em class="replaceable"><code>group_name</code></em>=<em class="replaceable"><code>sql_user_name</code></em></code> ペアを左から右へと調査し、認証済みのユーザーに割り当てられたグループの MySQL 以外のディレクトリ内で、<em class="replaceable"><code>group_name</code></em> 値の一致を見つけようとし、最初に見つかった一致に対応する <em class="replaceable"><code>sql_user_name</code></em> を返します。プラグインが任意のグループの一致を見つけた場合は、ログイン名を返します。プラグインがディレクトリ内のグループを検索できない場合は、グループマッピングリストを無視し、ログイン名を返します。
            </p></li></ul></div><p>
          次のセクションでは、PAM 認証プラグインを使用するいくつかの認証シナリオを設定する方法について説明します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              プロキシユーザーなし。ここでは、ログイン名とパスワードをチェックする際にのみ PAM が使用されます。MySQL サーバーへの接続が許可されている外部ユーザーはすべて、外部 PAM 認証を使用するように定義されている一致する MySQL アカウントを持つべきです。PAM でサポートされているさまざまな方式で、認証を実行できます。この説明では、従来の Unix パスワードおよび LDAP を使用する方法を示します。
            </p><p>
              PAM 認証では、プロキシユーザーまたはグループを介して実行されない場合に、MySQL アカウントは Unix アカウントと同じユーザー名を持つ必要があります。MySQL ユーザー名は 16 文字に制限されているため (<a class="xref" href="security.html#grant-table-structure" title="6.2.2 権限システム付与テーブル">セクション6.2.2「権限システム付与テーブル」</a>を参照してください)、PAM の非プロキシ認証は、最長で 16 文字の名前を持つ Unix アカウントに制限されます。
            </p></li><li class="listitem"><p>
              プロキシログインのみ、およびグループマッピング。このシナリオでは、さまざまな権限セットを定義する数個の MySQL アカウントを作成します。(理想は、これらを使用して直接ログインしないようにすることです。)そのあと、権限セットを保持している数個の MySQL アカウントに、すべての外部ログインをマップする一部のマッピングスキームが (通常は、ユーザーが属する外部グループによって) 使用される PAM を使用して、デフォルトのユーザー認証を定義します。ログインする任意のユーザーは、MySQL アカウントのいずれかにマップされ、その権限を使用します。この説明では、Unix パスワードを使用してこれを設定する方法を示しますが、代わりに LDAP などのその他の PAM 方式が使用される可能性もあります。
            </p></li></ul></div><p>
          これらのシナリオでは、ばらつきがある可能性があります。たとえば、一部のユーザーに直接ログインすることを許可するが、その他のユーザーにはプロキシユーザーを介して接続するように要求できます。
        </p><p>
          この例は、次のことが前提となっています。システムが異なる方法で設定されている場合は、多少の調整が必要になることもあります。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              PAM 構成ディレクトリは <code class="filename">/etc/pam.d</code> です。
            </p></li><li class="listitem"><p>
              PAM サービス名は <code class="literal">mysql</code> です。これは、PAM 構成ディレクトリ内に <code class="filename">mysql</code> という名前の PAM ファイル (存在しない場合はファイルを作成します) を設定する必要があることを意味します。別のサービス名を使用する場合は、ファイル名が異なるため、<code class="literal">CREATE USER</code> および <code class="literal">GRANT</code> ステートメントの <code class="literal">AS</code> 句で別の名前を使用する必要があります。
            </p></li><li class="listitem"><p>
              この例では、<code class="literal">antonio</code> というログイン名と <code class="literal">verysecret</code> というパスワードが使用されています。認証するユーザーに対応するように、これらを変更します。
            </p></li></ul></div><p>
          PAM 認証プラグインは、初期化時に <code class="literal">AUTHENTICATION_PAM_LOG</code> 環境の値が設定されているかどうかをチェックします。その場合、プラグインを使用すると、標準出力への診断メッセージのロギングが有効になります。これらのメッセージは、プラグインが認証を実行するときに発生する PAM 関連の問題をデバッグする際に役立つことがあります。詳細については、<a class="xref" href="security.html#pam-authentication-plugin-debugging" title="6.3.8.5.3 PAM 認証プラグインのデバッグ">セクション6.3.8.5.3「PAM 認証プラグインのデバッグ」</a>を参照してください。
        </p><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="pam-authentication-unix-without-proxy"></a>6.3.8.5.2.1 プロキシユーザーを使用しない Unix パスワード認証</h6></div></div></div><p>
            この認証シナリオでは、Unix ユーザーのログイン名とパスワードをチェックする際にのみ PAM が使用されます。MySQL サーバーへの接続が許可されている外部ユーザーはすべて、外部 PAM 認証を使用するように定義されている一致する MySQL アカウントを持つべきです。
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                PAM の Unix 認証で、パスワード <code class="literal">verysecret</code> を使用して <code class="literal">antonio</code> としてログインすることが許可されていることを確認します。
              </p></li><li class="listitem"><p>
                <code class="literal">mysql</code> サービスを認証するように PAM を設定します。<code class="filename">/etc/pam.d/mysql</code> に次の行を挿入します。
              </p><pre class="programlisting">
#%PAM-1.0
auth            include         password-auth
account         include         password-auth
</pre></li><li class="listitem"><p>
                Unix ログイン名と同じユーザー名を持つ MySQL アカウントを作成し、PAM プラグインを使用して認証するように定義します。
              </p><pre class="programlisting">
CREATE USER 'antonio'@'localhost'
  IDENTIFIED WITH authentication_pam AS 'mysql';
GRANT ALL PRIVILEGES ON mydb.* TO 'antonio'@'localhost';
</pre></li><li class="listitem"><p>
                <span class="command"><strong>mysql</strong></span> コマンド行クライアントを使用して、MySQL サーバーへの接続を試みます。例:
              </p><pre class="programlisting">
mysql --user=antonio --password=verysecret --enable-cleartext-plugin mydb
</pre><p>
                サーバーは接続を許可し、以降のクエリーは次に示すような出力を返すはずです。
              </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-------------------+-------------------+--------------+
| USER()            | CURRENT_USER()    | @@proxy_user |
+-------------------+-------------------+--------------+
| antonio@localhost | antonio@localhost | NULL         |
+-------------------+-------------------+--------------+
</pre><p>
                これは、<code class="literal">antonio</code> が <code class="literal">antonio</code> MySQL アカウントに付与された権限を使用し、プロキシ処理が発生していないことを示します。
              </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="pam-authentication-ldap-without-proxy"></a>6.3.8.5.2.2 プロキシユーザーを使用しない LDAP 認証</h6></div></div></div><p>
            この認証シナリオでは、LDAP ユーザーのログイン名とパスワードをチェックする際にのみ PAM が使用されます。MySQL サーバーへの接続が許可されている外部ユーザーはすべて、外部 PAM 認証を使用するように定義されている一致する MySQL アカウントを持つべきです。
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                PAM の LDAP 認証で、パスワード <code class="literal">verysecret</code> を使用して <code class="literal">antonio</code> としてログインすることが許可されていることを確認します。
              </p></li><li class="listitem"><p>
                LDAP を使用して <code class="literal">mysql</code> サービスを認証するように PAM を設定します。<code class="filename">/etc/pam.d/mysql</code> に次の行を挿入します。
              </p><pre class="programlisting">
#%PAM-1.0
auth        required    pam_ldap.so
account     required    pam_ldap.so
</pre><p>
                PAM オブジェクトファイルのサフィクスがシステム上の <code class="filename">.so</code> と異なる場合は、正しいサフィクスに置き換えてください。
              </p></li><li class="listitem"><p>
                MySQL アカウントの作成およびサーバーへの接続は、<a class="xref" href="security.html#pam-authentication-unix-without-proxy" title="6.3.8.5.2.1 プロキシユーザーを使用しない Unix パスワード認証">セクション6.3.8.5.2.1「プロキシユーザーを使用しない Unix パスワード認証」</a>ですでに説明したものと同じです。
              </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a name="pam-authentication-unix-with-proxy"></a>6.3.8.5.2.3 プロキシユーザーとグループマッピングを使用した Unix パスワード認証</h6></div></div></div><p>
            この認証スキームでは、さまざまな権限セットを定義する数個の MySQL アカウント上に、PAM を使用して MySQL サーバーに接続するユーザーをマップするグループマッピング、およびプロキシ処理が使用されます。ユーザーは、権限を定義するアカウントを使用して直接接続しません。代わりに、権限を保持している数個の MySQL アカウントに、すべての外部ログインをマップするマッピングスキームが使用される PAM を使用して、デフォルトのプロキシユーザー認証を使用して接続します。接続する任意のユーザーは、MySQL アカウントのいずれかにマップされ、その権限を使用します。
          </p><p>
            ここに示す手順では、Unix パスワード認証が使用されます。代わりに LDAP を使用するには、前半で示した<a class="xref" href="security.html#pam-authentication-ldap-without-proxy" title="6.3.8.5.2.2 プロキシユーザーを使用しない LDAP 認証">セクション6.3.8.5.2.2「プロキシユーザーを使用しない LDAP 認証」</a>の手順を参照してください。
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                PAM の Unix 認証で、パスワード <code class="literal">verysecret</code> を使用して <code class="literal">antonio</code> としてログインすることが許可されること、および <code class="literal">antonio</code> が <code class="literal">root</code> または <code class="literal">users</code> のメンバーであることを確認します。
              </p></li><li class="listitem"><p>
                <code class="literal">mysql</code> サービスを認証するように PAM を設定します。<code class="filename">/etc/pam.d/mysql</code> に次の行を挿入します。
              </p><pre class="programlisting">
#%PAM-1.0
auth            include         password-auth
account         include         password-auth
</pre></li><li class="listitem"><p>
                プロキシ対象アカウントに外部 PAM ユーザーをマップするデフォルトのプロキシユーザーを作成します。<code class="literal">root</code> PAM グループから <code class="literal">developer</code> MySQL アカウントに外部ユーザーをマップし、<code class="literal">users</code> PAM グループから <code class="literal">data_entry</code> MySQL アカウントに外部ユーザーをマップします。
              </p><pre class="programlisting">
CREATE USER ''@''
  IDENTIFIED WITH authentication_pam
  AS 'mysql, root=developer, users=data_entry';
</pre><p>
                サービス名のあとのマッピングリストは、プロキシユーザーを設定する際に必要です。それ以外の場合、プラグインは適切なプロキシ対象ユーザー名に PAM グループの名前をマップする方法を指示できません。
              </p></li><li class="listitem"><p>
                データベースにアクセスする際に使用されるプロキシ対象アカウントを作成します。
              </p><pre class="programlisting">
CREATE USER 'developer'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>very secret password</code></em>';
GRANT ALL PRIVILEGES ON mydevdb.* TO 'developer'@'localhost';
CREATE USER 'data_entry'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>very secret password</code></em>';
GRANT ALL PRIVILEGES ON mydb.* TO 'data_entry'@'localhost'; 
</pre><p>
                これらのアカウント用のパスワードをだれにも通知できない場合、ほかのユーザーはこれらのパスワードを使用して、MySQL サーバーに直接接続できません。代わりに、ユーザーは PAM を使用して認証し、自分の PAM グループに基づいてプロキシによる <code class="literal">developer</code> または <code class="literal">data_entry</code> アカウントを使用することが予想されます。
              </p></li><li class="listitem"><p>
                プロキシ対象アカウント用のプロキシアカウントに、<code class="literal">PROXY</code> 権限を付与します。
              </p><pre class="programlisting">
GRANT PROXY ON 'developer'@'localhost' TO ''@'';
GRANT PROXY ON 'data_entry'@'localhost' TO ''@'';
</pre></li><li class="listitem"><p>
                <span class="command"><strong>mysql</strong></span> コマンド行クライアントを使用して、MySQL サーバーへの接続を試みます。例:
              </p><pre class="programlisting">
mysql --user=antonio --password=verysecret --enable-cleartext-plugin mydb
</pre><p>
                サーバーは <code class="literal">''@''</code> アカウントを使用して、接続を認証します。権限 <code class="literal">antonio</code> は、メンバーとして属する PAM グループによって異なります。<code class="option">antonio</code> が <code class="literal">root</code> PAM グループのメンバーである場合、PAM プラグインは、<code class="literal">developer</code> MySQL ユーザー名に <code class="literal">root</code> をマップし、その名前をサーバーに返します。サーバーは、<code class="literal">''@''</code> が <code class="literal">developer</code> に対する <code class="literal">PROXY</code> 権限を持っていることを確認し、接続を許可します。以降のクエリーは、次に示すような出力を返すはずです。
              </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-------------------+---------------------+--------------+
| USER()            | CURRENT_USER()      | @@proxy_user |
+-------------------+---------------------+--------------+
| antonio@localhost | developer@localhost | ''@''        |
+-------------------+---------------------+--------------+
</pre><p>
                これは、<code class="literal">antonio</code> が <code class="literal">developer</code> MySQL アカウントに付与された権限を使用し、デフォルトのプロキシユーザーアカウントからプロキシ処理が発生していないことを示します。
              </p><p>
                <code class="literal">antonio</code> が <code class="literal">root</code> PAM グループのメンバーではないが、<code class="literal">users</code> グループのメンバーである場合にも、同様のプロセスが発生しますが、プラグインは <code class="literal">data_entry</code> MySQL ユーザー名に <code class="literal">user</code> グループメンバーシップをマップし、その名前をサーバーに返します。この場合、<code class="literal">antonio</code> は <code class="literal">data_entry</code> MySQL アカウントの権限を使用します。
              </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-------------------+----------------------+--------------+
| USER()            | CURRENT_USER()       | @@proxy_user |
+-------------------+----------------------+--------------+
| antonio@localhost | data_entry@localhost | ''@''        |
+-------------------+----------------------+--------------+
</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="pam-authentication-plugin-debugging"></a>6.3.8.5.3 PAM 認証プラグインのデバッグ</h5></div></div></div><a class="indexterm" name="idm139979119891104"></a><a class="indexterm" name="idm139979119889568"></a><p>
          PAM 認証プラグインは、初期化時に <code class="literal">AUTHENTICATION_PAM_LOG</code> 環境の値が設定されているかどうかをチェックします (値は問題ありません)。その場合、プラグインを使用すると、標準出力への診断メッセージのロギングが有効になります。これらのメッセージは、プラグインが認証を実行するときに発生する PAM 関連の問題をデバッグする際に役立つことがあります。
        </p><p>
          一部のメッセージには、PAM プラグインソースファイルと行番号への参照が含まれています。これを使用すると、プラグインアクションをそれが発生するコード内の場所に、より緊密に関連付けることができます。
        </p><p>
          次のトランスクリプトでは、ロギングを有効にすると生成される情報の種類を示します。これは、正常なプロキシ認証の試行による結果です。
        </p><pre class="programlisting">
entering auth_pam_server
entering auth_pam_next_token
auth_pam_next_token:reading at [cups,admin=writer,everyone=reader], sep=[,]
auth_pam_next_token:state=PRESPACE, ptr=[cups,admin=writer,everyone=reader],
out=[]
auth_pam_next_token:state=IDENT, ptr=[cups,admin=writer,everyone=reader],
out=[]
auth_pam_next_token:state=AFTERSPACE, ptr=[,admin=writer,everyone=reader],
out=[cups]
auth_pam_next_token:state=DELIMITER, ptr=[,admin=writer,everyone=reader],
out=[cups]
auth_pam_next_token:state=DONE, ptr=[,admin=writer,everyone=reader],
out=[cups]
leaving auth_pam_next_token on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/parser.c:191
auth_pam_server:password 12345qq received
auth_pam_server:pam_start rc=0
auth_pam_server:pam_set_item(PAM_RUSER,gkodinov) rc=0
auth_pam_server:pam_set_item(PAM_RHOST,localhost) rc=0
entering auth_pam_server_conv
auth_pam_server_conv:PAM_PROMPT_ECHO_OFF [Password:] received
leaving auth_pam_server_conv on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/authentication_pam.c:257
auth_pam_server:pam_authenticate rc=0
auth_pam_server:pam_acct_mgmt rc=0
auth_pam_server:pam_setcred(PAM_ESTABLISH_CRED) rc=0
auth_pam_server:pam_get_item rc=0
auth_pam_server:pam_setcred(PAM_DELETE_CRED) rc=0
entering auth_pam_map_groups
entering auth_pam_walk_namevalue_list
auth_pam_walk_namevalue_list:reading at: [admin=writer,everyone=reader]
entering auth_pam_next_token
auth_pam_next_token:reading at [admin=writer,everyone=reader], sep=[=]
auth_pam_next_token:state=PRESPACE, ptr=[admin=writer,everyone=reader], out=[]
auth_pam_next_token:state=IDENT, ptr=[admin=writer,everyone=reader], out=[]
auth_pam_next_token:state=AFTERSPACE, ptr=[=writer,everyone=reader],
out=[admin]
auth_pam_next_token:state=DELIMITER, ptr=[=writer,everyone=reader],
out=[admin]
auth_pam_next_token:state=DONE, ptr=[=writer,everyone=reader], out=[admin]
leaving auth_pam_next_token on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/parser.c:191
auth_pam_walk_namevalue_list:name=[admin]
entering auth_pam_next_token
auth_pam_next_token:reading at [writer,everyone=reader], sep=[,]
auth_pam_next_token:state=PRESPACE, ptr=[writer,everyone=reader], out=[]
auth_pam_next_token:state=IDENT, ptr=[writer,everyone=reader], out=[]
auth_pam_next_token:state=AFTERSPACE, ptr=[,everyone=reader], out=[writer]
auth_pam_next_token:state=DELIMITER, ptr=[,everyone=reader], out=[writer]
auth_pam_next_token:state=DONE, ptr=[,everyone=reader], out=[writer]
leaving auth_pam_next_token on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/parser.c:191
walk, &amp;error_namevalue_list:value=[writer]
entering auth_pam_map_group_to_user
auth_pam_map_group_to_user:pam_user=gkodinov, name=admin, value=writer
examining member root
examining member gkodinov
substitution was made to mysql user writer
leaving auth_pam_map_group_to_user on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/authentication_pam.c:118
auth_pam_walk_namevalue_list:found mapping
leaving auth_pam_walk_namevalue_list on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/parser.c:270
auth_pam_walk_namevalue_list returned 0
leaving auth_pam_map_groups on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/authentication_pam.c:171
auth_pam_server:authenticated_as=writer
auth_pam_server: rc=0
leaving auth_pam_server on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/authentication_pam.c:429
</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="windows-authentication-plugin"></a>6.3.8.6 Windows ネイティブ認証プラグイン</h4></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#windows-authentication-plugin-installation">6.3.8.6.1 Windows 認証プラグインのインストール</a></span></dt><dt><span class="section"><a href="security.html#windows-authentication-plugin-usage">6.3.8.6.2 Windows 認証プラグインの使用</a></span></dt></dl></div><a class="indexterm" name="idm139979119876336"></a><a class="indexterm" name="idm139979119874768"></a><a class="indexterm" name="idm139979119872864"></a><a class="indexterm" name="idm139979119871280"></a><a class="indexterm" name="idm139979119869312"></a><a class="indexterm" name="idm139979119867264"></a><a class="indexterm" name="idm139979119865104"></a><a class="indexterm" name="idm139979119863840"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          Windows 認証プラグインは、商用の拡張機能です。商用の製品 (MySQL Enterprise Edition) についてさらに学習するには、http://www.mysql.com/products/ を参照してください。
        </p></div><p>
        MySQL 5.6.10 の時点で、Windows 向けの MySQL の商用配布には、Windows 上で外部認証を実行する認証プラグインが含まれています。これを使用すると、MySQL サーバーがネイティブの Windows サービスを使用して、クライアント接続を認証できます。Windows にログインしたユーザーは、追加のパスワードを指定せずに、自分の環境内の情報に基づいて MySQL クライアントプログラムからサーバーに接続できます。
      </p><p>
        クライアントとサーバーは、認証ハンドシェイクでデータパケットを交換します。この交換の結果として、サーバーは Windows OS 内のクライアントのアイデンティティーを表すセキュリティーコンテキストオブジェクトを作成します。このアイデンティティーには、クライアントアカウントの名前が含まれています。Windows 認証プラグインはクライアントのアイデンティティーを使用して、特定のアカウントまたはグループのメンバーであるのかどうかをチェックします。デフォルトでは、認証のネゴシエーションに Kerberos が使用されます。Kerberos が使用できない場合は、NTLM が使用されます。
      </p><p>
        Windows 認証プラグインには、次のような機能が備わっています。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            外部認証: このプラグインを使用すると、MySQL サーバーは、MySQL 付与テーブルの外部で定義されたユーザーからの接続を受け入れることができます。
          </p></li><li class="listitem"><p>
            プロキシユーザーのサポート: このプラグインは、クライアントユーザーとは異なるユーザー名を MySQL に返すことができます。つまり、このプラグインは、外部の Windows で認証されたユーザーが持つべき権限を定義する MySQL ユーザーを返すことができます。たとえば、<code class="literal">joe</code> という名前の Windows ユーザーは接続して、<code class="literal">developer</code> という名前の MySQL ユーザーの権限を持つことができます。
          </p></li></ul></div><p>
        次の表には、プラグインおよびライブラリファイルの名前を示します。ファイルの場所は、<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリである必要があります。インストールに関する情報については、<a class="xref" href="security.html#windows-authentication-plugin-installation" title="6.3.8.6.1 Windows 認証プラグインのインストール">セクション6.3.8.6.1「Windows 認証プラグインのインストール」</a>を参照してください。
      </p><div class="table"><a name="idm139979119849136"></a><p class="title"><b>表 6.12 MySQL Windows 認証プラグイン</b></p><div class="table-contents"><table summary="MySQL Windows 認証プラグイン" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">サーバー側のプラグイン名</td><td><code class="literal">authentication_windows</code></td></tr><tr><td scope="row">クライアント側のプラグイン名</td><td><code class="literal">authentication_windows_client</code></td></tr><tr><td scope="row">ライブラリオブジェクトファイル名</td><td><code class="filename">authentication_windows.dll</code></td></tr></tbody></table></div></div><br class="table-break"><p>
        ライブラリファイルには、サーバー側のプラグインのみが含まれています。クライアント側のプラグインは、<code class="literal">libmysqlclient</code> クライアントライブラリに組み込まれています。
      </p><p>
        サーバー側の Windows 認証プラグインは、商用配布にのみ含まれています。MySQL コミュニティー配布には含まれていません。クライアント側のプラグインは、コミュニティー配布を含むすべての配布に含まれています。これにより、任意の配布から、サーバー側のプラグインがロードされたサーバーに接続することがクライアントに許可されます。
      </p><p>
        Windows 認証プラグインは、MySQL 5.6 でサポートされている任意のバージョンの Windows でサポートされています (<a class="ulink" href="http://www.mysql.com/support/supportedplatforms/database.html" target="_top">http://www.mysql.com/support/supportedplatforms/database.html</a>を参照してください)。これには、MySQL Server 5.6.10 以降が必要です。
      </p><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.3.7 プラガブル認証">セクション6.3.7「プラガブル認証」</a>を参照してください。プロキシユーザーについては、<a class="xref" href="security.html#proxy-users" title="6.3.9 プロキシユーザー">セクション6.3.9「プロキシユーザー」</a>を参照してください。
      </p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="windows-authentication-plugin-installation"></a>6.3.8.6.1 Windows 認証プラグインのインストール</h5></div></div></div><p>
          Windows 認証プラグインは、MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) にインストールする必要があります。必要に応じて、サーバーの起動時に、プラグインディレクトリの場所をサーバーに指示する <code class="literal">plugin_dir</code> の値を設定します。
        </p><p>
          プラグインを有効にするには、<code class="option">--plugin-load</code> オプションを付けてサーバーを起動します。たとえば、<code class="filename">my.ini</code> ファイルに次の行を挿入します。
        </p><pre class="programlisting">
[mysqld]
plugin-load=authentication_windows.dll
</pre><p>
          このプラグインを使用して認証される MySQL アカウントには、<code class="literal">CREATE USER</code> または <code class="literal">GRANT</code> ステートメントの <code class="literal">IDENTIFIED WITH</code> 句のプラグイン名 <code class="literal">authentication_windows</code> を使用します。
        </p><p>
          プラグインのインストールを確認するには、<code class="literal">INFORMATION_SCHEMA.PLUGINS</code> テーブルを調査するか、または <code class="literal">SHOW PLUGINS</code> ステートメントを使用します。<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.1.8.2 サーバープラグイン情報の取得">セクション5.1.8.2「サーバープラグイン情報の取得」</a>を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="windows-authentication-plugin-usage"></a>6.3.8.6.2 Windows 認証プラグインの使用</h5></div></div></div><p>
          Windows 認証プラグインでは、Windows にログインしたユーザーが追加のパスワードを指定しなくても、MySQL サーバーに接続できるように、MySQL アカウントの使用がサポートされています。サーバー側のプラグインが有効になっていて、クライアントプログラムが <code class="literal">libmysqlclient</code> に組み込まれたクライアント側のプラグインを追加するために十分新しいバージョンであることが前提となっています。DBA がサーバー側のプラグインを有効にして、それを使用するようにアカウントを設定すると、クライアントは自分の側でその他の設定を行う必要なしで、これらのアカウントを使用して接続できます。
        </p><p>
          <code class="literal">CREATE USER</code> または <code class="literal">GRANT</code> ステートメントの <code class="literal">IDENTIFIED WITH</code> 句で Windows 認証プラグインを参照するには、<code class="literal">authentication_windows</code> という名前を使用します。<code class="literal">Rafal</code> と <code class="literal">Tasha</code> という Windows ユーザー、および <code class="literal">Administrators</code> または <code class="literal">Power Users</code> グループ内の任意のユーザーが MySQL への接続が許可されるべきであると仮定します。このように設定するには、Windows プラグインを使用して認証する <code class="literal">sql_admin</code> という名前の MySQL アカウントを作成します。
        </p><pre class="programlisting">
CREATE USER sql_admin
  IDENTIFIED WITH authentication_windows
  AS 'Rafal, Tasha, Administrators, "Power Users"';
</pre><p>
          プラグイン名は <code class="literal">authentication_windows</code> です。<code class="literal">AS</code> キーワードに続く文字列は、認証文字列です。<code class="literal">Rafal</code> または <code class="literal">Tasha</code> という名前の Windows ユーザー、および <code class="literal">Administrators</code> または <code class="literal">Power Users</code> グループ内の任意の Windows ユーザーが MySQL ユーザー <code class="literal">sql_admin</code> として、サーバーへの認証が許可されるように指定されます。後者のグループ名には空白文字が含まれているため、二重引用符で囲む必要があります。
        </p><p>
          <code class="literal">sql_admin</code> アカウントを作成したあとは、Windows にログインしたユーザーはそのアカウントを使用して、サーバーへの接続を試みることができます。
        </p><pre class="programlisting">
C:\&gt; <strong class="userinput"><code>mysql --user=sql_admin</code></strong>
</pre><p>
          ここでは、パスワードは必要ありません。<code class="literal">authentication_windows</code> プラグインは Windows のセキュリティー API を使用して、接続中の Windows ユーザーをチェックします。そのユーザーが <code class="literal">Rafal</code> または <code class="literal">Tasha</code> という名前であるか、<code class="literal">Administrators</code> または <code class="literal">Power Users</code> グループに属する場合、サーバーはアクセス権を付与し、クライアントは <code class="literal">sql_admin</code> として認証され、<code class="literal">sql_admin</code> アカウントに付与される任意の権限を持ちます。それ以外の場合、サーバーはアクセスを拒否します。
        </p><p>
          Windows 認証プラグインでの認証文字列の構文は、次のようなルールに従っています。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              文字列は、カンマで区切られた 1 つ以上のユーザーマッピングで構成されます。
            </p></li><li class="listitem"><p>
              各ユーザーマッピングによって、Windows ユーザー名またはグループ名が MySQL ユーザー名に関連付けられます。
            </p><pre class="programlisting">
<em class="replaceable"><code>win_user_or_group_name=sql_user_name</code></em>
<em class="replaceable"><code>win_user_or_group_name</code></em>
</pre><p>
              後者の構文に <em class="replaceable"><code>sql_user_name</code></em> 値を指定しない場合、値は暗黙的に、<code class="literal">CREATE USER</code> ステートメントで作成された MySQL ユーザーとなります。したがって、次のステートメントは同等です。
            </p><pre class="programlisting">
CREATE USER sql_admin
  IDENTIFIED WITH authentication_windows
  AS 'Rafal, Tasha, Administrators, "Power Users"';

CREATE USER sql_admin
  IDENTIFIED WITH authentication_windows
  AS 'Rafal=sql_admin, Tasha=sql_admin, Administrators=sql_admin,
      "Power Users"=sql_admin';
</pre></li><li class="listitem"><p>
              MySQL の文字列ではバックスラッシュ (<code class="literal">'\'</code>) はエスケープ文字であるため、値内の各バックスラッシュは二重に入力する必要があります。
            </p></li><li class="listitem"><p>
              二重引用符で囲まれていない先頭および末尾の空白文字は、無視されます。
            </p></li><li class="listitem"><p>
              引用符で囲まれていない <em class="replaceable"><code>win_user_or_group_name</code></em> および <em class="replaceable"><code>sql_user_name</code></em> の値には、等号、カンマ、または空白文字を除く、任意の文字を含めることができます。
            </p></li><li class="listitem"><p>
              <em class="replaceable"><code>win_user_or_group_name</code></em> または <em class="replaceable"><code>sql_user_name</code></em> の値を二重引用符で囲むと、引用符間のすべての文字が値の一部となります。たとえば、名前に空白文字が含まれている場合は、これが必要です。二重引用符およびバックスラッシュを除く、二重引用符内のすべての文字が有効です。どちらかの文字を含めるには、バックスラッシュを使用してエスケープします。
            </p></li><li class="listitem"><p>
              <em class="replaceable"><code>win_user_or_group_name</code></em> 値では、Windows 主体 (ローカルまたはドメイン内) 用の従来の構文が使用されます。例 (バックスラッシュを二重にすることに注意してください):
            </p><pre class="programlisting">
domain\\user
.\\user
domain\\group
.\\group
BUILTIN\\WellKnownGroup
</pre></li></ul></div><p>
          クライアントを認証するためにサーバーから呼び出されると、プラグインは認証文字列を左から右へとスキャンして、Windows ユーザーとのユーザーまたはグループの一致があるかどうかを確認します。一致がある場合、このプラグインは対応する <em class="replaceable"><code>sql_user_name</code></em> を MySQL サーバーに返します。一致がない場合は、認証に失敗します。
        </p><p>
          ユーザー名の一致は、グループ名の一致よりも優先されます。<code class="literal">win_user</code> という名前の Windows ユーザーが <code class="literal">win_group</code> のメンバーであり、認証文字列が次のとおりであると仮定します。
        </p><pre class="programlisting">
'win_group = sql_user1, win_user = sql_user2'
</pre><p>
          <code class="literal">win_user</code> が MySQL サーバーに接続すると、<code class="literal">win_group</code> と <code class="literal">win_user</code> の両方への一致があります。グループが認証文字列の最初に一覧表示されますが、より具体的なユーザーの一致がグループの一致よりも優先されるため、プラグインは <code class="literal">sql_user2</code> としてユーザーを認証します。
        </p><p>
          サーバーが実行されているものと同じコンピュータからの接続では、Windows 認証は常に機能します。コンピュータ間の接続では、両方のコンピュータを Windows Active Directory に登録する必要があります。同じ Windows ドメイン内にある場合は、ドメイン名を指定する必要はありません。次の例に示すように、別のドメインからの接続を許可することもできます。
        </p><pre class="programlisting">
CREATE USER sql_accounting
  IDENTIFIED WITH authentication_windows
  AS 'SomeDomain\\Accounting';
</pre><p>
          ここで、<code class="literal">SomeDomain</code> は別のドメインの名前です。バックスラッシュ文字は文字列内の MySQL エスケープ文字であるため、二重に入力されています。
        </p><p>
          MySQL では、クライアントは 1 つのアカウントを使用して MySQL サーバーに接続して認証できるが、接続されると別のアカウントの権限を持つというプロキシユーザーの概念がサポートされています (<a class="xref" href="security.html#proxy-users" title="6.3.9 プロキシユーザー">セクション6.3.9「プロキシユーザー」</a>を参照してください)。次のように、Windows ユーザーは単一のユーザー名を使用して接続するが、Windows ユーザー名およびグループ名に基づいて特定の MySQL アカウント上にマップされると仮定します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">local_user</code> および <code class="literal">MyDomain\domain_user</code> というローカルおよびドメインの Windows ユーザーは、<code class="literal">local_wlad</code> MySQL アカウントにマップするべきです。
            </p></li><li class="listitem"><p>
              <code class="literal">MyDomain\Developers</code> ドメイングループ内のユーザーは、<code class="literal">local_dev</code> MySQL アカウントにマップするべきです。
            </p></li><li class="listitem"><p>
              ローカルマシンの管理者は、<code class="literal">local_admin</code> MySQL アカウントにマップするべきです。
            </p></li></ul></div><p>
          このように設定するには、接続先の Windows ユーザーのプロキシアカウントを作成し、ユーザーとグループが適切な MySQL アカウント (<code class="literal">local_wlad</code>、<code class="literal">local_dev</code>、<code class="literal">local_admin</code>) にマップされるように、このアカウントを構成します。さらに、実行する必要がある操作に適した権限を MySQL アカウントに付与します。次の手順では、プロキシアカウントとして <code class="literal">win_proxy</code> が使用され、プロキシ対象アカウントとして <code class="literal">local_wlad</code>、<code class="literal">local_dev</code>、および <code class="literal">local_admin</code> が使用されています。
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              プロキシ MySQL アカウントを作成します。
            </p><pre class="programlisting">
CREATE USER win_proxy
  IDENTIFIED WITH  authentication_windows
  AS 'local_user = local_wlad,
      MyDomain\\domain_user = local_wlad,
      MyDomain\\Developers = local_dev,
      BUILTIN\\Administrators = local_admin';
</pre></li><li class="listitem"><p>
              プロキシ処理が動作するには、プロキシ対象アカウントが存在する必要があるため、次のように作成します。
            </p><pre class="programlisting">
CREATE USER local_wlad IDENTIFIED BY 'wlad_pass';
CREATE USER local_dev IDENTIFIED BY 'dev_pass';
CREATE USER local_admin IDENTIFIED BY  'admin_pass';
</pre><p>
              これらのアカウント用のパスワードをだれにも通知できない場合、ほかのユーザーはこれらのパスワードを使用して、MySQL サーバーに直接接続できません。
            </p><p>
              また、必要な権限を各プロキシ対象アカウントに付与する <code class="literal">GRANT</code> ステートメント (非表示) も発行するようにしてください。
            </p></li><li class="listitem"><p>
              プロキシアカウントは、プロキシ対象アカウントごとに <code class="literal">PROXY</code> 権限を持つ必要があります。
            </p><pre class="programlisting">
GRANT PROXY ON local_wlad TO win_proxy;
GRANT PROXY ON local_dev TO win_proxy;
GRANT PROXY ON local_admin TO win_proxy;
</pre></li></ol></div><p>
          この時点で、<code class="literal">local_user</code> および <code class="literal">MyDomain\domain_user</code> という Windows ユーザーは、<code class="literal">win_proxy</code> として MySQL サーバーに接続でき、認証されると、認証文字列 (この場合は <code class="literal">local_wlad</code>) に指定されたアカウントの権限を持ちます。<code class="literal">win_proxy</code> として接続する <code class="literal">MyDomain\Developers</code> グループ内のユーザーは、<code class="literal">local_dev</code> アカウントの権限を持っています。<code class="literal">BUILTIN\Administrators</code> グループ内のユーザーは、<code class="literal">local_admin</code> アカウントの権限を持っています。
        </p><p>
          自分の MySQL アカウントを持っていないのすべての Windows ユーザーがプロキシアカウントを通過するように認証を構成するには、前述の手順で、<code class="literal">win_proxy</code> をデフォルトのプロキシユーザー (<code class="literal">''@''</code>) に置き換えてください。デフォルトのプロキシユーザーについては、<a class="xref" href="security.html#proxy-users" title="6.3.9 プロキシユーザー">セクション6.3.9「プロキシユーザー」</a>を参照してください。
        </p><p>
          Connection/Net 6.4.4 以上で、Connector/Net 接続文字列とともに Windows 認証プラグインを使用する方法については、<a class="ulink" href="http://dev.mysql.com/doc/connector-net/en/connector-net-programming-authentication-windows-native.html" target="_top">Using the Windows Native Authentication Plugin</a>を参照してください。
        </p><p>
          <code class="literal">authentication_windows_use_principal_name</code> および <code class="literal">authentication_windows_log_level</code> システム変数では、Windows 認証プラグインへの追加の制御が提供されています。<a class="xref" href="server-administration.html#server-system-variables" title="5.1.4 サーバーシステム変数">セクション5.1.4「サーバーシステム変数」</a>を参照してください。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cleartext-authentication-plugin"></a>6.3.8.7 クライアント側のクリアテキスト認証プラグイン</h4></div></div></div><a class="indexterm" name="idm139979119719536"></a><a class="indexterm" name="idm139979119718016"></a><p>
        MySQL 5.6.2 の時点では、ハッシュ化または暗号化なしでサーバーにパスワードを送信するクライアント側の認証プラグインが使用可能です。このプラグインは、MySQL クライアントライブラリに組み込まれています。
      </p><p>
        次の表に、プラグイン名を示します。
      </p><div class="table"><a name="idm139979119714576"></a><p class="title"><b>表 6.13 MySQL クリアテキスト認証プラグイン</b></p><div class="table-contents"><table summary="MySQL クリアテキスト認証プラグイン" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">サーバー側のプラグイン名</td><td>なし (説明を参照してください)</td></tr><tr><td scope="row">クライアント側のプラグイン名</td><td><code class="literal">mysql_clear_password</code></td></tr><tr><td scope="row">ライブラリオブジェクトファイル名</td><td>なし (プラグインは組み込み済みです)</td></tr></tbody></table></div></div><br class="table-break"><p>
        ネイティブの MySQL 認証では、クライアントはパスワードに一方向のハッシュ化を実行してから、それをサーバーに送信します。これにより、クライアントがパスワードをクリアテキストで送信することを回避できます。<a class="xref" href="security.html#password-hashing" title="6.1.2.4 MySQL でのパスワードハッシュ">セクション6.1.2.4「MySQL でのパスワードハッシュ」</a>を参照してください。ただし、ハッシュアルゴリズムは一方向であるため、サーバー側で元のパスワードをリカバリできません。
      </p><p>
        クライアント側で入力されたパスワードを受信するようにサーバーに要求する認証スキームの場合、一方向のハッシュ化を実行できません。このような場合、クライアント側のプラグイン <code class="literal">mysql_clear_password</code> を使用すると、パスワードをクリアテキストでサーバーに送信できます。対応するサーバー側のプラグインはありません。その上、クライアント側のプラグインは、クリアテキストのパスワードを必要とする任意のサーバー側のプラグインで使用できます。(PAM 認証プラグインは、このような例の 1 つです。<a class="xref" href="security.html#pam-authentication-plugin" title="6.3.8.5 PAM 認証プラグイン">セクション6.3.8.5「PAM 認証プラグイン」</a>を参照してください。)
      </p><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.3.7 プラガブル認証">セクション6.3.7「プラガブル認証」</a>を参照してください。
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          クリアテキストでパスワードを送信すると、一部の構成でセキュリティーの問題が発生する可能性があります。パスワードが傍受される可能性がある場合に問題を回避するには、クライアントはパスワードが保護される方式を使用して、MySQL サーバーに接続するようにしてください。SSL (<a class="xref" href="security.html#ssl-connections" title="6.3.10 セキュアな接続のための SSL の使用">セクション6.3.10「セキュアな接続のための SSL の使用」</a>を参照)、IPsec、またはプライベートネットワークでも発生する可能性があります。
        </p></div><p>
        MySQL 5.6.7 の時点で、このプラグインが不注意に使用される可能性を低くするには、クライアントが明示的に有効にする必要があります。これは、複数の方法で実行できます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">LIBMYSQL_ENABLE_CLEARTEXT_PLUGIN</code> 環境変数を <code class="literal">1</code>、<code class="literal">Y</code>、または <code class="literal">y</code> で始まる値に設定します。これにより、すべてのクライアント接続でプラグインが有効になります。
          </p></li><li class="listitem"><p>
            <span class="command"><strong>mysql</strong></span>、<span class="command"><strong>mysqladmin</strong></span>、および <span class="command"><strong>mysqlslap</strong></span> クライアントプログラムでは、呼び出すたびにプラグインを有効にする <code class="option">--enable-cleartext-plugin</code> オプションがサポートされています。
          </p></li><li class="listitem"><p>
            <code class="literal">mysql_options()</code> C API 関数では、接続するたびにプラグインを有効にする <code class="literal">MYSQL_ENABLE_CLEARTEXT_PLUGIN</code> オプションがサポートされています。また、クライアントライブラリによって読み取られるオプショングループ内に <code class="literal">enable-cleartext-plugin</code> を含めると、<code class="literal">libmysqlclient</code> を使用し、オプションファイルを読み取る任意のプログラムでプラグインを有効にすることができます。
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="socket-authentication-plugin"></a>6.3.8.8 ソケットピア証明書認証プラグイン</h4></div></div></div><a class="indexterm" name="idm139979119684320"></a><a class="indexterm" name="idm139979119682784"></a><p>
        MySQL 5.6.2 の時点では、Unix ソケットファイル経由でローカルホストから接続するクライアントを認証するサーバー側の認証プラグインが使用可能です。
      </p><p>
        このプラグインのソースコードは、ロード可能な認証プラグインを記述する方法を示す比較的単純な例として調査できます。
      </p><p>
        次の表には、プラグインおよびライブラリファイルの名前を示します。ファイル名のサフィクスは、システムによって異なる場合があります。ファイルの場所は、<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリです。インストールに関する情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.3.7 プラガブル認証">セクション6.3.7「プラガブル認証」</a>を参照してください。
      </p><div class="table"><a name="idm139979119676496"></a><p class="title"><b>表 6.14 MySQL ソケットピア証明書認証プラグイン</b></p><div class="table-contents"><table summary="MySQL ソケットピア証明書認証プラグイン" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">サーバー側のプラグイン名</td><td><code class="literal">auth_socket</code></td></tr><tr><td scope="row">クライアント側のプラグイン名</td><td>なし (説明を参照してください)</td></tr><tr><td scope="row">ライブラリオブジェクトファイル名</td><td><code class="filename">auth_socket.so</code></td></tr></tbody></table></div></div><br class="table-break"><p>
        <code class="literal">auth_socket</code> 認証プラグインは、Unix ソケットファイル経由でローカルホストから接続するクライアントを認証します。このプラグインは <code class="literal">SO_PEERCRED</code> ソケットオプションを使用して、クライアントプログラムを実行しているユーザーに関する情報を取得します。このプラグインは、ユーザー名がサーバーへのクライアントプログラムで指定された MySQL ユーザー名と一致するかどうかをチェックし、その名前が一致する場合にのみ接続を許可します。<code class="literal">SO_PEERCRED</code> オプションがサポートされているシステム (Linux など) 上でのみ、このプラグインを構築できます。
      </p><p>
        ソケットファイル経由でローカルホストから接続する際に、<code class="literal">auth_socket</code> プラグインで認証される <code class="literal">valerie</code> という名前のユーザー用に、MySQL アカウントが作成されると仮定します。
      </p><pre class="programlisting">
CREATE USER 'valerie'@'localhost' IDENTIFIED WITH auth_socket;
</pre><p>
        <code class="literal">stefanie</code> というログイン名を持つローカルホスト上のユーザーが <code class="option">--user=valerie</code> オプションを付けて <span class="command"><strong>mysql</strong></span> を呼び出して、ソケットファイル経由で接続する場合、サーバーは <code class="literal">auth_socket</code> を使用してクライアントを認証します。このプラグインは、<code class="option">--user</code> オプションの値 (<code class="literal">valerie</code>) がクライアントユーザー名 (<code class="literal">stephanie</code>) とは異なると判断し、接続を拒否します。<code class="literal">valerie</code> という名前のユーザーが同じことを試みた場合、プラグインはユーザー名と MySQL ユーザー名が両方とも <code class="literal">valerie</code> であると判断し、接続を許可します。ただし、TCP/IP などの別のプロトコルを使用して接続されると、<code class="literal">valerie</code> の場合でもプラグインは接続を拒否します。
      </p><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.3.7 プラガブル認証">セクション6.3.7「プラガブル認証」</a>を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="test-authentication-plugin"></a>6.3.8.9 テスト認証プラグイン</h4></div></div></div><a class="indexterm" name="idm139979119651408"></a><a class="indexterm" name="idm139979119649856"></a><a class="indexterm" name="idm139979119647920"></a><a class="indexterm" name="idm139979119646368"></a><p>
        MySQL には、MySQL ネイティブ認証を使用して認証するテストプラグインが含まれていますが、(組み込まれていない) ロード可能なプラグインであるため、使用する前にインストールする必要があります。標準または古い (短い) パスワードのハッシュ値と照合して認証できます。
      </p><p>
        このプラグインは、テストおよび開発のために使用され、本番環境では使用されません。テストプラグインのソースコードは組み込みのネイティブプラグインとは異なり、サーバーソースとは別々のものであるため、ロード可能な認証プラグインを記述する方法を示す比較的単純な例として調査できます。
      </p><p>
        次の表には、プラグインおよびライブラリファイルの名前を示します。ファイル名のサフィクスは、システムによって異なる場合があります。ファイルの場所は、<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリです。インストールに関する情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.3.7 プラガブル認証">セクション6.3.7「プラガブル認証」</a>を参照してください。
      </p><div class="table"><a name="idm139979119639568"></a><p class="title"><b>表 6.15 MySQL テスト認証プラグイン</b></p><div class="table-contents"><table summary="MySQL テスト認証プラグイン" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">サーバー側のプラグイン名</td><td><code class="literal">test_plugin_server</code></td></tr><tr><td scope="row">クライアント側のプラグイン名</td><td><code class="literal">auth_test_plugin</code></td></tr><tr><td scope="row">ライブラリオブジェクトファイル名</td><td><code class="filename">auth_test_plugin.so</code></td></tr></tbody></table></div></div><br class="table-break"><p>
        テストプラグインでは、ネイティブの MySQL 認証と同じ方法で認証されるため、サーバーに接続する際に、ネイティブ認証を使用するアカウント用に一般的に使用される通常の <code class="option">--user</code> および <code class="option">--password</code> オプションを指定します。例:
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=<em class="replaceable"><code>your_name</code></em> --password=<em class="replaceable"><code>your_pass</code></em></code></strong>
</pre><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.3.7 プラガブル認証">セクション6.3.7「プラガブル認証」</a>を参照してください。
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="proxy-users"></a>6.3.9 プロキシユーザー</h3></div></div></div><p>
      認証プラグインを使用した MySQL サーバーへの認証が発生すると、接続中の (外部) ユーザーを権限チェックのために別のユーザーとして処理するようにプラグインから要求されることがあります。これにより、外部ユーザーを 2 番目のユーザーのプロキシにすることができます。つまり、2 番目のユーザーの権限を持つことができます。言い換えると、外部ユーザーは<span class="quote">「<span class="quote">プロキシユーザー</span>」</span> (偽装できるユーザーまたは別のユーザーと呼ばれるようになるユーザー) であり、2 番目のユーザーは<span class="quote">「<span class="quote">プロキシ対象ユーザー</span>」</span> (プロキシユーザーが実行できるアイデンティティーを持つユーザー) です。
    </p><p>
      このセクションでは、プロキシユーザー機能の動作について説明します。認証プラグインに関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.3.7 プラガブル認証">セクション6.3.7「プラガブル認証」</a>を参照してください。プロキシユーザーがサポートされている独自の認証プラグインを作成することに関心がある場合は、<a class="xref" href="extending-mysql.html#writing-authentication-plugins-proxy-users" title="24.2.4.9.4 認証プラグインでのプロキシユーザーサポートの実装">セクション24.2.4.9.4「認証プラグインでのプロキシユーザーサポートの実装」</a>を参照してください。
    </p><p>
      プロキシ処理を発生させるには、次の条件を満たす必要があります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          接続中のクライアントがプロキシユーザーとして処理されるときに、プラグインはプロキシ対象ユーザーの名前を示すために、別の名前を返す必要があります。
        </p></li><li class="listitem"><p>
          プロキシユーザーのアカウントがプラグインで認証されるように設定する必要があります。<code class="literal">CREATE USER</code> または <code class="literal">GRANT</code> ステートメントを使用して、アカウントをプラグインに関連付けます。
        </p></li><li class="listitem"><p>
          プロキシユーザーのアカウントは、プロキシ対象アカウントの <code class="literal">PROXY</code> 権限を持つ必要があります。これを行うには、<code class="literal">GRANT</code> ステートメントを使用します。
        </p></li></ul></div><p>
      次のような定義について検討します。
    </p><pre class="programlisting">
CREATE USER 'empl_external'@'localhost'
  IDENTIFIED WITH auth_plugin AS 'auth_string';
CREATE USER 'employee'@'localhost'
  IDENTIFIED BY 'employee_pass';
GRANT PROXY
  ON 'employee'@'localhost'
  TO 'empl_external'@'localhost';
</pre><p>
      クライアントがローカルホストから <code class="literal">empl_external</code> として接続すると、MySQL は <code class="literal">auth_plugin</code> を使用して認証を実行します。<code class="literal">auth_plugin</code> が (<code class="literal">'auth_string'</code> の内容に基づいて、おそらく一部の外部認証システムを参照することで) サーバーに <code class="literal">employee</code> というユーザー名を返す場合は、このクライアントを権限チェックのために、<code class="literal">employee</code> ローカルユーザーとして処理するように求めるサーバーへのリクエストとして機能します。
    </p><p>
      この場合、<code class="literal">empl_external</code> はプロキシユーザー、<code class="literal">employee</code> はプロキシ対象ユーザーです。
    </p><p>
      サーバーは <code class="literal">empl_external</code> が <code class="literal">employee</code> に対する <code class="literal">PROXY</code> 権限を持っているかどうかをチェックすることで、<code class="literal">empl_external</code> ユーザーに対して <code class="literal">employee</code> のプロキシ認証を実行できることを確認します。(この権限が付与されていない場合は、エラーが発生します。)
    </p><p>
      プロキシ処理が発生したときに、<code class="literal">USER()</code> および <code class="literal">CURRENT_USER()</code> 関数を使用すると、接続中のユーザーと現在のセッション中に権限が適用されるアカウントとの相違点を確認できます。先ほど説明した例では、これらの関数は次の値を返します。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+-------------------------+--------------------+
| USER()                  | CURRENT_USER()     |
+-------------------------+--------------------+
| empl_external@localhost | employee@localhost |
+-------------------------+--------------------+
</pre><p>
      認証プラグインの名前を指定する <code class="literal">IDENTIFIED WITH</code> 句のあとに、ユーザーの接続時にサーバーがプラグインに渡す文字列を指定する <code class="literal">AS</code> 句が続く場合があります。<code class="literal">AS</code> 句が必要であるかどうかは、各プラグインに依存します。必要な場合、認証文字列の形式は、プラグインを使用する目的によって異なります。許可される認証文字列の値については、特定のプラグインに関するドキュメントを参照してください。
    </p><h4><a name="idm139979119589424"></a>プロキシ権限の付与</h4><p>
      外部ユーザーが別のユーザーとして接続し、その権限を持つことができるようにするには、特別な <code class="literal">PROXY</code> 権限が必要です。この権限を付与するには、<code class="literal">GRANT</code> ステートメントを使用します。例:
    </p><pre class="programlisting">
GRANT PROXY ON '<em class="replaceable"><code>proxied_user</code></em>' TO '<em class="replaceable"><code>proxy_user</code></em>';
</pre><p>
      <em class="replaceable"><code>proxy_user</code></em> は、接続時に外部で認証された有効な MySQL ユーザーを表している必要があります。そうでない場合は、接続の試行に失敗します。<em class="replaceable"><code>proxied_user</code></em> は、接続時にローカルで認証された有効なユーザーを表している必要があります。そうでない場合は、接続の試行に失敗します。
    </p><p>
      対応する <code class="literal">REVOKE</code> 構文は次のとおりです。
    </p><pre class="programlisting">
REVOKE PROXY ON '<em class="replaceable"><code>proxied_user</code></em>' FROM '<em class="replaceable"><code>proxy_user</code></em>';
</pre><p>
      MySQL <code class="literal">GRANT</code> および <code class="literal">REVOKE</code> 構文の拡張機能は、通常どおりに動作します。例:
    </p><pre class="programlisting">
GRANT PROXY ON 'a' TO 'b', 'c', 'd';
GRANT PROXY ON 'a' TO 'd' IDENTIFIED BY ...;
GRANT PROXY ON 'a' TO 'd' WITH GRANT OPTION;
GRANT PROXY ON 'a' TO ''@'';
REVOKE PROXY ON 'a' FROM 'b', 'c', 'd';
</pre><p>
      前述の例では、<code class="literal">''@''</code> はデフォルトのプロキシユーザーであり、<span class="quote">「<span class="quote">任意のユーザー</span>」</span>を意味します。デフォルトのプロキシユーザーについては、このセクションの後半で説明します。
    </p><p>
      次のような場合に、<code class="literal">PROXY</code> 権限を付与できます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          自分で <em class="replaceable"><code>proxied_user</code></em> による: アカウント名のユーザー名とホスト名の両方の部分で、<code class="literal">USER()</code> の値が <code class="literal">CURRENT_USER()</code> および <em class="replaceable"><code>proxied_user</code></em> と完全に一致する必要があります。
        </p></li><li class="listitem"><p>
          <em class="replaceable"><code>proxied_user</code></em> に対する <code class="literal">GRANT PROXY ... WITH GRANT OPTION</code> を持つユーザーによる。
        </p></li></ul></div><p>
      MySQL のインストール時にデフォルトで作成された <code class="literal">root</code> アカウントは、<code class="literal">''@''</code> (つまり、すべてのユーザー) に対する <code class="literal">PROXY ... WITH GRANT OPTION</code> 権限を持っています。これにより、<code class="literal">root</code> はプロキシユーザーを設定したり、プロキシユーザーを設定するための権限をほかのアカウントに委任したりできます。たとえば、<code class="literal">root</code> は次の操作を実行できます。
    </p><pre class="programlisting">
CREATE USER 'admin'@'localhost' IDENTIFIED BY 'test';
GRANT PROXY ON ''@'' TO 'admin'@'localhost' WITH GRANT OPTION;
</pre><p>
      この時点で、<code class="literal">admin</code> ユーザーは特定のすべての <code class="literal">GRANT PROXY</code> マッピングを管理できます。たとえば、<code class="literal">admin</code> は次の操作を実行できます。
    </p><pre class="programlisting">
GRANT PROXY ON sally TO joe;
</pre><h4><a name="idm139979119556976"></a>デフォルトのプロキシユーザー</h4><p>
      一部またはすべてのユーザーが特定の外部プラグインを使用して接続するように指定するには、<span class="quote">「<span class="quote">空白の</span>」</span> MySQL ユーザーを作成し、そのプラグインを使用して認証するように設定し、(空白のユーザーとは異なる場合に) プラグインが認証された実際のユーザー名を返すことができるようにします。たとえば、LDAP 認証を実装する <code class="literal">ldap_auth</code> という名前の仮のプラグインが存在すると仮定します。
    </p><pre class="programlisting">
CREATE USER ''@'' IDENTIFIED WITH ldap_auth AS 'O=Oracle, OU=MySQL';
CREATE USER 'developer'@'localhost' IDENTIFIED BY 'developer_pass';
CREATE USER 'manager'@'localhost' IDENTIFIED BY 'manager_pass';
GRANT PROXY ON 'manager'@'localhost' TO ''@'';
GRANT PROXY ON 'developer'@'localhost' TO ''@'';
</pre><p>
      ここで、クライアントが次のように接続を試みるとします。
    </p><pre class="programlisting">
mysql --user=myuser --password='myuser_pass' ...
</pre><p>
      サーバーでは、MySQL ユーザーとして定義された <code class="literal">myuser</code> が見つかりません。ただし、クライアントのユーザー名およびホスト名と一致する空白のユーザーアカウント (<code class="literal">''@''</code>) があるため、サーバーはそのアカウントと照合してクライアントを認証します。サーバーは <code class="literal">ldap_auth</code> を呼び出して、それをユーザー名とパスワードとして <code class="literal">myuser</code> および <code class="literal">myuser_pass</code> に渡します。
    </p><p>
      <code class="literal">ldap_auth</code> プラグインによって、<code class="literal">myuser_pass</code> が <code class="literal">myuser</code> の正しいパスワードでないことが LDAP ディレクトリで検出された場合は、認証に失敗し、サーバーは接続を拒否します。
    </p><p>
      パスワードが正しく、<code class="literal">ldap_auth</code> によって <code class="literal">myuser</code> が開発者であることが検出された場合は、MySQL サーバーに <code class="literal">myuser</code> ではなく、<code class="literal">developer</code> というユーザー名が返されます。サーバーは、(実行するための <code class="literal">PROXY</code> 権限を持っているため) <code class="literal">''@''</code> が <code class="literal">developer</code> として認証できることを確認し、接続を受け入れます。セッションは、<code class="literal">developer</code> の権限を持っている <code class="literal">myuser</code> で続行されます。(これらの権限は、DBA が <code class="literal">GRANT</code> ステートメントを使用して設定するべきですが、表示されません。)<code class="literal">USER()</code> および <code class="literal">CURRENT_USER()</code> 関数は、次の値を返します。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+------------------+---------------------+
| USER()           | CURRENT_USER()      |
+------------------+---------------------+
| myuser@localhost | developer@localhost |
+------------------+---------------------+
</pre><p>
      代わりに、プラグインによって <code class="literal">myuser</code> がマネージャーであることが LDAP ディレクトリで検出された場合は、ユーザー名として <code class="literal">manager</code> が返され、セッションは <code class="literal">manager</code> の権限を持つ <code class="literal">myuser</code> で続行されます。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+------------------+-------------------+
| USER()           | CURRENT_USER()    |
+------------------+-------------------+
| myuser@localhost | manager@localhost |
+------------------+-------------------+
</pre><p>
      単純にするために、外部認証はマルチレベルで実行できません。前述の例では、<code class="literal">developer</code> の証明書も、<code class="literal">manager</code> の証明書も考慮されません。ただし、クライアントが <code class="literal">developer</code> または <code class="literal">manager</code> アカウントと照合して直接認証を試みる場合は、引き続き使用されます (そのため、これらのアカウントにはパスワードを割り当てられるはずです)。
    </p><p>
      デフォルトのプロキシアカウントは、任意のホストと一致する <code class="literal">''</code> をホスト部分で使用します。デフォルトのプロキシユーザーを設定する場合は、ホスト部分で <code class="literal">'%'</code> を含むアカウントもチェックするように注意してください。その理由は、これらのアカウントは任意のホストにも一致しますが、サーバー内部でアカウント行をソートする際に使用されるルールによって、<code class="literal">''</code> よりも優先されるためです (<a class="xref" href="security.html#connection-access" title="6.2.4 アクセス制御、ステージ 1: 接続の検証">セクション6.2.4「アクセス制御、ステージ 1: 接続の検証」</a>を参照してください)。
    </p><p>
      MySQL のインストールに、次の 2 つのアカウントが含まれていると仮定します。
    </p><pre class="programlisting">
CREATE USER ''@'' IDENTIFIED WITH some_plugin;
CREATE USER ''@'%' IDENTIFIED BY 'some_password';
</pre><p>
      1 番目のアカウントの目的は、それ以外の場合は、より具体的なアカウントと一致しないユーザーの接続を認証する際に使用されるデフォルトのプロキシユーザーとして機能することです。2 番目のアカウントは、たとえば、匿名ユーザーとして独自のアカウントを持っていないユーザーを有効にするために、作成されることがあります。
    </p><p>
      ただし、この構成では、一致のルールによって <code class="literal">''@''</code> よりも先に <code class="literal">''@'%'</code> がソートされるため、1 番目のアカウントは使用されません。より具体的などのアカウントにも一致しないアカウントの場合、サーバーは <code class="literal">''@''</code> ではなく、<code class="literal">''@'%'</code> と照合して認証を試みます。
    </p><p>
      デフォルトのプロキシユーザーを作成する場合は、デフォルトのプロキシユーザーよりも優先されるために、そのユーザーが目的どおりに動作することを妨げるその他の既存の<span class="quote">「<span class="quote">任意のユーザーに一致する</span>」</span>アカウントがないかどうかチェックします。このようなアカウントをすべて削除する必要がある場合もあります。
    </p><h4><a name="idm139979119509760"></a>プロキシユーザーのシステム変数</h4><p>
      次の 2 つのシステム変数は、プロキシのログインプロセスをトレースする際に役立ちます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">proxy_user</code>: プロキシ処理が使用されていない場合、この値は <code class="literal">NULL</code> です。それ以外の場合は、プロキシユーザーのアカウントを示します。たとえば、クライアントがデフォルトのプロキシアカウントを使用して認証する場合、この変数は次のように設定されます。
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @@proxy_user;</code></strong>
+--------------+
| @@proxy_user |
+--------------+
| ''@''        |
+--------------+
</pre></li><li class="listitem"><p>
          <code class="literal">external_user</code>: 認証プラグインは外部ユーザーを使用して、MySQL サーバーへの認証を行うことがあります。たとえば、Windows のネイティブ認証を使用するときは、Windows の API を使用して認証するプラグインに、ログイン ID を渡す必要がありません。ただし、認証には引き続き Windows ユーザー ID が使用されます。このプラグインは、読み取り専用のセッション変数 <code class="literal">external_user</code> を使用して、この外部ユーザー ID (または最初の 512 UTF-8 バイト) をサーバーに返すことがあります。プラグインがこの変数を設定しない場合、その値は <code class="literal">NULL</code> です。
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ssl-connections"></a>6.3.10 セキュアな接続のための SSL の使用</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#ssl-basics">6.3.10.1 基本的な SSL の概念</a></span></dt><dt><span class="section"><a href="security.html#configuring-for-ssl">6.3.10.2 SSL を使用するための MySQL の構成</a></span></dt><dt><span class="section"><a href="security.html#using-ssl-connections">6.3.10.3 SSL 接続の使用</a></span></dt><dt><span class="section"><a href="security.html#ssl-options">6.3.10.4 SSL コマンドのオプション</a></span></dt><dt><span class="section"><a href="security.html#creating-ssl-certs">6.3.10.5 MySQL での SSL 証明書および鍵の設定</a></span></dt></dl></div><a class="indexterm" name="idm139979119497952"></a><a class="indexterm" name="idm139979119496656"></a><p>
      MySQL では、Secure Sockets Layer (SSL) プロトコルを使用した、MySQL クライアントとサーバー間のセキュアな (暗号化された) 接続がサポートされています。このセクションでは、SSL 接続を使用する方法について説明します。SSL 接続を使用するようにユーザーに要求する方法については、<a class="xref" href="sql-syntax.html#grant" title="13.7.1.4 GRANT 構文">セクション13.7.1.4「GRANT 構文」</a>で、<code class="literal">GRANT</code> ステートメントの <code class="literal">REQUIRE</code> 句の説明を参照してください。
    </p><p>
      MySQL の標準構成の目的は、できるかぎり高速にすることであるため、デフォルトでは暗号化された接続が使用されません。暗号化された接続で提供されるセキュリティーがアプリケーションで必要である場合は、データを暗号化する際に追加の計算を行なってみる価値があります。
    </p><p>
      MySQL では、接続ごとに暗号化できます。各アプリケーションの要件に従って、暗号化されていない接続または暗号化されたセキュアな SSL 接続を選択できます。
    </p><p>
      セキュアな接続は OpenSSL API に基づいており、MySQL C API を介して使用できます。レプリケーションでは C API が使用されるため、マスターサーバーとスレーブサーバー間でセキュアな接続を使用できます。<a class="xref" href="replication.html#replication-solutions-ssl" title="17.3.7 SSL を使用してレプリケーションをセットアップする">セクション17.3.7「SSL を使用してレプリケーションをセットアップする」</a>を参照してください。
    </p><p>
      セキュアに接続するためのもう 1 つの方法は、SSH 接続内から MySQL サーバーホストに接続することです。例については、<a class="xref" href="security.html#windows-and-ssh" title="6.3.11 SSH を使用した Windows から MySQL へのリモート接続">セクション6.3.11「SSH を使用した Windows から MySQL へのリモート接続」</a>を参照してください。
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="ssl-basics"></a>6.3.10.1 基本的な SSL の概念</h4></div></div></div><a class="indexterm" name="idm139979119485312"></a><p>
        どのように MySQL で SSL が使用されるのかを理解するには、SSL と X509 の基本概念についていくつか説明する必要があります。これらの概念に精通しているユーザーは、説明のこの部分をスキップできます。
      </p><p>
        MySQL のデフォルトでは、クライアントとサーバー間で暗号化されていない接続が使用されます。つまり、ネットワークへのアクセス権を持っているユーザーは、すべてのトラフィックを監視し、送受信されるデータを調査できます。クライアントとサーバー間で送受信中のデータでも変更できます。
      </p><a class="indexterm" name="idm139979119481248"></a><p>
        セキュアな方法でネットワーク経由で情報を移動する必要がある場合は、暗号化されていない接続が許可されません。暗号化は、すべての種類のデータを読み取り不可にする方法です。暗号化されたメッセージの順序を変更したり、データを 2 回再生したりするなどの、多くの種類の既知の攻撃に対抗するために、暗号化アルゴリズムには、セキュリティー要素を含める必要があります。
      </p><p>
        SSL は、パブリックネットワーク経由で受信したデータを信頼できるようにするために、さまざまな暗号化アルゴリズムが使用されたプロトコルです。すべてのデータの変更、損失、または再生を検出するためのメカニズムが備わっています。SSL には、X509 標準を使用してアイデンティティーを検証するアルゴリズムも組み込まれています。
      </p><a class="indexterm" name="idm139979119477856"></a><p>
        X509 を使用すると、インターネット上の人物を識別できます。電子商取引アプリケーションで、もっとも一般的に使用されます。基本的な用語には、必要とするすべてのユーザーに電子証明書を割り当てる<span class="quote">「<span class="quote">認証局</span>」</span> (CA) と呼ばれるエンティティーがいくつか存在するはずです。証明書は、2 つの暗号化鍵 (公開鍵と秘密鍵) を持つ非対称の暗号化アルゴリズムに依存しています。証明書の所有者は、アイデンティティーの証明として別のパーティーに証明書を表示できます。証明書は、所有者の公開鍵で構成されます。この公開鍵を使用して暗号化されたデータはすべて、対応する秘密鍵 (証明書の所有者が保持しています) を使用しなければ復号化できません。
      </p><p>
        SSL、X509、暗号化、または公開鍵暗号についての詳細は、インターネット検索を実行して関心のあるキーワードを調べてください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="configuring-for-ssl"></a>6.3.10.2 SSL を使用するための MySQL の構成</h4></div></div></div><a class="indexterm" name="idm139979119472448"></a><a class="indexterm" name="idm139979119470400"></a><a class="indexterm" name="idm139979119469168"></a><p>
        MySQL サーバーとクライアントプログラム間で SSL 接続を使用するには、システムで OpenSSL または yaSSL がサポートされている必要があります。MySQL 5.6.6 の時点では、SSL サポートがデフォルトで含まれています。
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          MySQL Community Edition は yaSSL にバンドルされていますが、ソース配布から構築する際に、OpenSSL を使用するように構成できます。MySQL Enterprise Edition は OpenSSL にバンドルされています。MySQL Enterprise Edition では yaSSL を使用できません。
        </p></div><p>
        OpenSSL サポートを使用して MySQL サーバーを構築するには、次を実行する必要があります。
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            システムに openSSL 1.0.1 以上がインストールされていることを確認します。OpenSSL を入手するには、<a class="ulink" href="http://www.openssl.org" target="_top">http://www.openssl.org</a> にアクセスします。
          </p></li><li class="listitem"><p>
            次の方法で <span class="command"><strong>CMake</strong></span> を呼び出して、openSSL が使用されるように MySQL ソース配布を構成します。

</p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>cmake . -DWITH_SSL=system</code></strong>
</pre><p>
          </p><p>
            このコマンドは、インストールされた OpenSSL ライブラリが使用されるように配布を構成します。<a class="xref" href="installing.html#source-configuration-options" title="2.9.4 MySQL ソース構成オプション">セクション2.9.4「MySQL ソース構成オプション」</a>を参照してください。<code class="literal">-DWITH_SSL</code> を指定しない場合は、yaSSL がデフォルトで使用されます。
          </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
              インストールされた OpenSSL のバージョンが 1.0.1 よりも小さい場合は、<span class="command"><strong>CMake</strong></span> でエラーが生成されます。
            </p></div></li><li class="listitem"><p>
            配布をコンパイルし、インストールします。
          </p></li></ol></div><p>
        <span class="command"><strong>mysqld</strong></span> サーバーで SSL がサポートされているかどうかチェックするには、<code class="literal">have_ssl</code> システム変数の値を調査します。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'have_ssl';</code></strong>
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| have_ssl      | YES   |
+---------------+-------+
</pre><p>
        値が <code class="literal">YES</code> の場合は、サーバーで SSL 接続がサポートされています。値が <code class="literal">DISABLED</code> の場合、サーバーは SSL 接続をサポートできますが、SSL 接続の使用が有効になるように、適切な <code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code> オプションを付けて起動されませんでした。<a class="xref" href="security.html#using-ssl-connections" title="6.3.10.3 SSL 接続の使用">セクション6.3.10.3「SSL 接続の使用」</a>を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="using-ssl-connections"></a>6.3.10.3 SSL 接続の使用</h4></div></div></div><a class="indexterm" name="idm139979119444848"></a><p>
        SSL 接続を有効にするには、<a class="xref" href="security.html#configuring-for-ssl" title="6.3.10.2 SSL を使用するための MySQL の構成">セクション6.3.10.2「SSL を使用するための MySQL の構成」</a>で説明するように、SSL サポートを使用して MySQL 配布を構築します。さらに、適切な証明書および鍵ファイルを指定するには、適切な SSL 関連のオプションを使用する必要があります。SSL オプションの完全なリストについては、<a class="xref" href="security.html#ssl-options" title="6.3.10.4 SSL コマンドのオプション">セクション6.3.10.4「SSL コマンドのオプション」</a>を参照してください。
      </p><p>
        SSL を使用した接続がクライアントに許可されるように MySQL サーバーを起動するには、セキュアな接続を確立する際に、サーバーで使用される証明書および鍵ファイルを識別するオプションを使用します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="option">--ssl-ca</code> は、認証局 (CA) 証明書を識別します。
          </p></li><li class="listitem"><p>
            <code class="option">--ssl-cert</code> は、サーバーの公開鍵証明書を識別します。これをクライアントに送信し、それに含まれる CA 証明書と照合して認証できます。
          </p></li><li class="listitem"><p>
            <code class="option">--ssl-key</code> は、サーバーの秘密鍵を識別します。
          </p></li></ul></div><p>
        たとえば、次のようにサーバーを起動します。
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysqld --ssl-ca=<em class="replaceable"><code>ca-cert.pem</code></em> \</code></strong>
         <strong class="userinput"><code>--ssl-cert=<em class="replaceable"><code>server-cert.pem</code></em> \</code></strong>
         <strong class="userinput"><code>--ssl-key=<em class="replaceable"><code>server-key.pem</code></em></code></strong>
</pre><p>
        各オプションには、PEM 形式のファイル名が指定されます。必要な SSL 証明書および鍵ファイルを生成する手順については、<a class="xref" href="security.html#creating-ssl-certs" title="6.3.10.5 MySQL での SSL 証明書および鍵の設定">セクション6.3.10.5「MySQL での SSL 証明書および鍵の設定」</a>を参照してください。MySQL ソース配布を持っている場合は、配布の <code class="filename">mysql-test/std_data</code> ディレクトリで、デモ用の証明書および鍵ファイルを使用して設定をテストすることもできます。
      </p><p>
        クライアント側でも同様オプションが使用されますが、<code class="option">--ssl-cert</code> および <code class="option">--ssl-key</code> は、クライアントの公開鍵と秘密鍵を識別します。認証局の証明書を指定する場合は、サーバーで使用されるときと同じ形式で指定する必要があります。
      </p><p>
        SSL サポートを使用して MySQL サーバーへのセキュアな接続を確立するために、クライアントが指定する必要があるオプションは、クライアントで使用される MySQL アカウントの SSL 要件によって異なります。(<a class="xref" href="sql-syntax.html#grant" title="13.7.1.4 GRANT 構文">セクション13.7.1.4「GRANT 構文」</a>で、<code class="literal">REQUIRE</code> 句の説明を参照してください。)
      </p><p>
        特別な SSL 要件を持っていないアカウント、または <code class="literal">REQUIRE SSL</code> オプションを含む <code class="literal">GRANT</code> ステートメントを使用して作成されたアカウントを使用して接続すると仮定します。推奨される SSL オプションセットとして、少なくとも <code class="option">--ssl-cert</code> と <code class="option">--ssl-key</code> を付けてサーバーを起動し、<code class="option">--ssl-ca</code> を使用してクライアントを呼び出します。次のように、クライアントはセキュアに接続できます。
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --ssl-ca=<em class="replaceable"><code>ca-cert.pem</code></em></code></strong>
</pre><p>
        クライアント証明書も指定されるように要求するには、<code class="literal">REQUIRE X509</code> オプションを使用してアカウントを作成します。そのあと、クライアントは適切なクライアント鍵および証明書ファイルを指定する必要があります。そうしない場合、サーバーは接続を拒否します。
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --ssl-ca=<em class="replaceable"><code>ca-cert.pem</code></em> \</code></strong>
       <strong class="userinput"><code>--ssl-cert=<em class="replaceable"><code>client-cert.pem</code></em> \</code></strong>
       <strong class="userinput"><code>--ssl-key=<em class="replaceable"><code>client-key.pem</code></em></code></strong>
</pre><p>
        SSL の使用を回避し、その他の SSL オプションをオーバーライドするには、<code class="option">--ssl=0</code> またはシノニム (<code class="option">--skip-ssl</code>、<code class="option">--disable-ssl</code>) を使用してクライアントプログラムを呼び出します。
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --ssl=0</code></strong>
</pre><p>
        クライアントは <code class="literal">Ssl_cipher</code> ステータス変数の値をチェックすることで、サーバーとの現在の接続で SSL が使用されているかどうかを確認できます。SSL が使用されている場合は、値が空以外になります。それ以外の場合は、空になります。例:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Ssl_cipher';</code></strong>
+---------------+--------------------+
| Variable_name | Value              |
+---------------+--------------------+
| Ssl_cipher    | DHE-RSA-AES256-SHA |
+---------------+--------------------+
</pre><p>
        <span class="command"><strong>mysql</strong></span> クライアントの場合は、代わりに <code class="literal">STATUS</code> または <code class="literal">\s</code> コマンドを使用して、<code class="literal">SSL</code> 行をチェックすることもできます。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>\s</code></strong>
...
SSL: Cipher in use is DHE-RSA-AES256-SHA
...
</pre><p>
        または、
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>\s</code></strong>
...
SSL: Not in use
...
</pre><p>
        C API を使用すると、アプリケーションプログラムで SSL を使用できます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            セキュアな接続を確立するには、<code class="literal">mysql_real_connect()</code> を呼び出す前に、<code class="literal">mysql_ssl_set()</code> C API 関数を使用して、適切な証明書オプションを設定します。<a class="xref" href="connectors-apis.html#mysql-ssl-set" title="23.8.7.68 mysql_ssl_set()">セクション23.8.7.68「mysql_ssl_set()」</a>を参照してください。
          </p></li><li class="listitem"><p>
            接続が確立されたあとに、SSL が使用中であるかどうかを判断するには、<code class="literal">mysql_get_ssl_cipher()</code> を使用します。<code class="literal">NULL</code> 以外の戻り値は、セキュアな接続であることを示し、暗号化に使用される SSL 暗号の名前を示します。<code class="literal">NULL</code> の戻り値は、SSL が使用されていないことを示します。<a class="xref" href="connectors-apis.html#mysql-get-ssl-cipher" title="23.8.7.33 mysql_get_ssl_cipher()">セクション23.8.7.33「mysql_get_ssl_cipher()」</a>を参照してください。
          </p></li></ul></div><p>
        レプリケーションでは C API が使用されるため、マスターサーバーとスレーブサーバー間でセキュアな接続を使用できます。<a class="xref" href="replication.html#replication-solutions-ssl" title="17.3.7 SSL を使用してレプリケーションをセットアップする">セクション17.3.7「SSL を使用してレプリケーションをセットアップする」</a>を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="ssl-options"></a>6.3.10.4 SSL コマンドのオプション</h4></div></div></div><a class="indexterm" name="idm139979119382064"></a><p>
        このセクションでは、SSL を使用するかどうかを指定するオプションと、SSL 証明書および鍵ファイルの名前を指定するオプションについて説明します。これらのオプションは、コマンド行またはオプションファイルで指定できます。MySQL が SSL サポートを使用して構築されていない場合は、これらを使用できません。<a class="xref" href="security.html#configuring-for-ssl" title="6.3.10.2 SSL を使用するための MySQL の構成">セクション6.3.10.2「SSL を使用するための MySQL の構成」</a>を参照してください。推奨される使用例および接続がセキュアであるかどうかをチェックする方法については、<a class="xref" href="security.html#using-ssl-connections" title="6.3.10.3 SSL 接続の使用">セクション6.3.10.3「SSL 接続の使用」</a>を参照してください。
      </p><div class="table"><a name="idm139979119377552"></a><p class="title"><b>表 6.16 SSL オプション/変数のサマリー</b></p><div class="table-contents"><table summary="SSL オプション/変数のサマリー" border="1"><colgroup><col class="name"><col class="cmd-line"><col class="option_file"><col class="system_var"><col class="status_var"><col class="var_scope"><col class="dynamic"></colgroup><thead><tr><th scope="col">名前</th><th scope="col">コマンド行</th><th scope="col">オプションファイル</th><th scope="col">システム変数</th><th scope="col">ステータス変数</th><th scope="col">変数スコープ</th><th scope="col">動的</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_have_openssl">have_openssl</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_have_ssl">have_ssl</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl">skip-ssl</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl">ssl</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-ca">ssl-ca</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"> - <span class="emphasis"><em>変数</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_ca">ssl_ca</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-capath">ssl-capath</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"> - <span class="emphasis"><em>変数</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_capath">ssl_capath</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-cert">ssl-cert</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"> - <span class="emphasis"><em>変数</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_cert">ssl_cert</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-cipher">ssl-cipher</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"> - <span class="emphasis"><em>変数</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_cipher">ssl_cipher</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-crl">ssl-crl</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"> - <span class="emphasis"><em>変数</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_crl">ssl_crl</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-crlpath">ssl-crlpath</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"> - <span class="emphasis"><em>変数</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_crlpath">ssl_crlpath</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-key">ssl-key</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"> - <span class="emphasis"><em>変数</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_key">ssl_key</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr></tbody></table></div></div><br class="table-break"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_general_ssl"></a>
            <a class="indexterm" name="idm139979119305328"></a> <a class="indexterm" name="idm139979119303888"></a> <code class="option">--ssl</code>
          </p><p>
            サーバーに対して、このオプションを指定すると、サーバーで SSL 接続が許可されますが、必須にはなりません。
          </p><p>
            クライアントプログラムに対して、このオプションを指定すると、SSL を使用してサーバーに接続することがクライアントに許可されますが、必須にはなりません。したがって、このオプションだけでは、SSL 接続を使用させるのに十分ではありません。たとえば、このオプションをクライアントプログラムに対して指定するが、サーバーは SSL 接続が許可されるよう構成されていない場合は、暗号化されていない接続が使用されます。
          </p><p>
            SSL 接続を有効にするための推奨される SSL オプションセットとして、サーバー側で少なくとも <code class="option">--ssl-cert</code> と <code class="option">--ssl-key</code> を使用し、クライアント側で <code class="option">--ssl-ca</code> を使用します。<a class="xref" href="security.html#using-ssl-connections" title="6.3.10.3 SSL 接続の使用">セクション6.3.10.3「SSL 接続の使用」</a>を参照してください。
          </p><p>
            その他の <code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code> オプションに関する説明で示したように、これらのオプションによって、<code class="option">--ssl</code> が暗黙的に指定されている可能性があります。
          </p><p>
            <code class="option">--ssl</code> オプションをネストされた形式で指定すると、その他の SSL をオーバーライドし、SSL が使用され<span class="emphasis"><em>ない</em></span>ように指定できます。これを行うには、<code class="option">--ssl=0</code> またはシノニム (<code class="option">--skip-ssl</code>、<code class="option">--disable-ssl</code>) としてオプションを指定します。たとえば、MySQL クライアントプログラムを呼び出し時にデフォルトで SSL 接続が使用されるように、SSL オプションをオプションファイルの <code class="literal">[client]</code> グループに指定することがあります。代わりに、暗号化されていない接続を使用するには、コマンド行で <code class="option">--skip-ssl</code> を指定してクライアントプログラムを呼び出して、オプションファイルのオプションをオーバーライドします。
          </p><p>
            MySQL アカウントに対して SSL 接続の使用を要求にするには、そのアカウントに対して、少なくとも <code class="literal">REQUIRE SSL</code> 句を含む <code class="literal">GRANT</code> ステートメントを発行します。MySQL で SSL 接続がサポートされ、サーバーとクライアントが適切な SSL オプションを付けて起動されていない場合は、アカウントの接続が拒否されます。
          </p><p>
            <code class="literal">REQUIRE</code> 句は、その他の SSL 関連のオプションを許可します。これを使用すれば、<code class="literal">REQUIRE SSL</code> よりも厳密な要件を強制的に適用できます。さまざまな <code class="literal">REQUIRE</code> オプションを使用して構成されているアカウントを使用して接続するクライアントが、どの SSL コマンドオプションを指定する可能性があるのか、またはどのオプションを指定する必要があるのかについての詳細は、<a class="xref" href="sql-syntax.html#grant" title="13.7.1.4 GRANT 構文">セクション13.7.1.4「GRANT 構文」</a>で <code class="literal">REQUIRE</code> の説明を参照してください。
          </p></li><li class="listitem"><p><a name="option_general_ssl-ca"></a>
            <a class="indexterm" name="idm139979119278128"></a> <code class="option">--ssl-ca=<em class="replaceable"><code>file_name</code></em></code>
          </p><p>
            信頼できる SSL 証明書認証局のリストを含む PEM 形式のファイルへのパス。このオプションは、暗黙的に <code class="option">--ssl</code> を示します。
          </p><p>
            クライアント接続を確立する際に SSL を使用して、サーバー証明書を認証しないようにクライアントに指示する場合は、<code class="option">--ssl-ca</code> も <code class="option">--ssl-capath</code> も指定しません。サーバーは引き続き、クライアントアカウントに対して <code class="literal">GRANT</code> ステートメントを使用して確立された適用可能な要件に応じてクライアントを検証し、サーバーの起動時に指定された <code class="option">--ssl-ca</code> または <code class="option">--ssl-capath</code> オプションの値を使用します。
          </p></li><li class="listitem"><p><a name="option_general_ssl-capath"></a>
            <a class="indexterm" name="idm139979119267904"></a> <code class="option">--ssl-capath=<em class="replaceable"><code>dir_name</code></em></code>
          </p><p>
            PEM 形式の信頼できる SSL 認証機関証明書を含むディレクトリへのパス。このオプションは、暗黙的に <code class="option">--ssl</code> を示します。
          </p><p>
            クライアント接続を確立する際に SSL を使用して、サーバー証明書を認証しないようにクライアントに指示する場合は、<code class="option">--ssl-ca</code> も <code class="option">--ssl-capath</code> も指定しません。サーバーは引き続き、クライアントアカウントに対して <code class="literal">GRANT</code> ステートメントを使用して確立された適用可能な要件に応じてクライアントを検証し、サーバーの起動時に指定された <code class="option">--ssl-ca</code> または <code class="option">--ssl-capath</code> オプションの値を使用します。
          </p><p>
            OpenSSL サポートを使用して構築された MySQL 配布では、<code class="option">--ssl-capath</code> オプションがサポートされています。yaSSL は、どのディレクトリにも表示されず、チェーン証明書ツリーをたどらないため、yaSSL を使用して構築された配布ではサポートされません。yaSSL では、CA 証明書ツリーのコンポーネントをすべて単一の CA 証明書ツリー内に含め、そのファイル内の各証明書は一意の SubjectName 値を持つ必要があります。このような yaSSL の制限を回避するには、証明書ツリーを構成する個々の証明書ファイルを新しいファイルに連結し、そのファイルを <code class="option">--ssl-ca</code> オプションの値として指定します。
          </p></li><li class="listitem"><p><a name="option_general_ssl-cert"></a>
            <a class="indexterm" name="idm139979119254272"></a> <code class="option">--ssl-cert=<em class="replaceable"><code>file_name</code></em></code>
          </p><p>
            セキュアな接続を確立する際に使用される PEM 形式の SSL 証明書ファイルの名前。このオプションは、暗黙的に <code class="option">--ssl</code> を示します。
          </p></li><li class="listitem"><p><a name="option_general_ssl-cipher"></a>
            <a class="indexterm" name="idm139979119249168"></a> <code class="option">--ssl-cipher=<em class="replaceable"><code>cipher_list</code></em></code>
          </p><p>
            SSL 暗号化に使用する許可されている暗号のリスト。リスト内の暗号がサポートされていない場合は、SSL 接続が機能しません。このオプションは、暗黙的に <code class="option">--ssl</code> を示します。
          </p><p>
            移植性を最大にするには、<em class="replaceable"><code>cipher_list</code></em> をコロンで区切った 1 つ以上の暗号名のリストで指定するようにしてください。この形式は、OpenSSL と yaSSL の両方で認識されます。例:
          </p><pre class="programlisting">
--ssl-cipher=AES128-SHA
--ssl-cipher=DHE-RSA-AES256-SHA:AES128-SHA
</pre><p>
            <a class="ulink" href="http://www.openssl.org/docs/apps/ciphers.html" target="_top">http://www.openssl.org/docs/apps/ciphers.html</a> にある OpenSSL のドキュメントで説明されているように、OpenSSL では、暗号を指定するためのより柔軟な構文がサポートされています。ただし、yaSSL ではサポートされてないため、yaSSL を使用して構築された MySQL 配布で拡張構文の使用を試みると失敗します。
          </p><p>
            OpenSSL では、サーバーがリンクされているバージョンによって、サポートされている暗号が異なる場合があります。たとえば、リストには次の暗号が含まれている可能性があります。
          </p><pre class="programlisting">
AES256-GCM-SHA384
AES256-SHA
AES256-SHA256
CAMELLIA256-SHA
DES-CBC3-SHA
DHE-DSS-AES256-GCM-SHA384
DHE-DSS-AES256-SHA
DHE-DSS-AES256-SHA256
DHE-DSS-CAMELLIA256-SHA
DHE-RSA-AES256-GCM-SHA384
DHE-RSA-AES256-SHA
DHE-RSA-AES256-SHA256
DHE-RSA-CAMELLIA256-SHA
ECDH-ECDSA-AES256-GCM-SHA384
ECDH-ECDSA-AES256-SHA
ECDH-ECDSA-AES256-SHA384
ECDH-ECDSA-DES-CBC3-SHA
ECDH-RSA-AES256-GCM-SHA384
ECDH-RSA-AES256-SHA
ECDH-RSA-AES256-SHA384
ECDH-RSA-DES-CBC3-SHA
ECDHE-ECDSA-AES128-GCM-SHA256
ECDHE-ECDSA-AES128-SHA
ECDHE-ECDSA-AES128-SHA256
ECDHE-ECDSA-AES256-GCM-SHA384
ECDHE-ECDSA-AES256-SHA
ECDHE-ECDSA-AES256-SHA384
ECDHE-ECDSA-DES-CBC3-SHA
ECDHE-RSA-AES128-GCM-SHA256
ECDHE-RSA-AES128-SHA
ECDHE-RSA-AES128-SHA256
ECDHE-RSA-AES256-GCM-SHA384
ECDHE-RSA-AES256-SHA
ECDHE-RSA-AES256-SHA384
ECDHE-RSA-DES-CBC3-SHA
EDH-DSS-DES-CBC3-SHA
EDH-RSA-DES-CBC3-SHA
PSK-3DES-EDE-CBC-SHA
PSK-AES256-CBC-SHA
SRP-DSS-3DES-EDE-CBC-SHA
SRP-DSS-AES-128-CBC-SHA
SRP-DSS-AES-256-CBC-SHA
SRP-RSA-3DES-EDE-CBC-SHA
SRP-RSA-AES-128-CBC-S
SRP-RSA-AES-256-CBC-SHA
</pre><p>
            yaSSL では、次の暗号がサポートされています。
          </p><pre class="programlisting">
AES128-RMD
AES128-SHA
AES256-RMD
AES256-SHA
DES-CBC-SHA
DES-CBC3-RMD
DES-CBC3-SHA
DHE-RSA-AES128-RMD
DHE-RSA-AES128-SHA
DHE-RSA-AES256-RMD
DHE-RSA-AES256-SHA
DHE-RSA-DES-CBC3-RMD
EDH-RSA-DES-CBC-SHA
EDH-RSA-DES-CBC3-SHA
RC4-MD5
RC4-SHA
</pre><p>
            特定のサーバーでサポートされている暗号を正確に確認するには、次のクエリーを使用して <code class="literal">Ssl_cipher_list</code> ステータス変数の値をチェックします。
          </p><pre class="programlisting">
SHOW STATUS LIKE 'Ssl_cipher_list';
</pre></li><li class="listitem"><p><a name="option_general_ssl-crl"></a>
            <a class="indexterm" name="idm139979119233776"></a> <code class="option">--ssl-crl=<em class="replaceable"><code>file_name</code></em></code>
          </p><p>
            証明書失効リストを含む PEM 形式のファイルへのパス。このオプションは、暗黙的に <code class="option">--ssl</code> を示します。
          </p><p>
            <code class="option">--ssl-crl</code> も <code class="option">--ssl-crlpath</code> も指定されていない場合は、CA パスに証明書失効リストが含まれていても、CRL チェックが実行されません。
          </p><p>
            OpenSSL を使用して構築された MySQL 配布では、<code class="option">--ssl-crl</code> オプションがサポートされています。yaSSL では証明書失効リストが機能しないため、yaSSL を使用して構築された配布ではサポートされません。
          </p><p>
            このオプションは MySQL 5.6.3 で追加されました。
          </p></li><li class="listitem"><p><a name="option_general_ssl-crlpath"></a>
            <a class="indexterm" name="idm139979119224368"></a> <code class="option">--ssl-crlpath=<em class="replaceable"><code>dir_name</code></em></code>
          </p><p>
            証明書失効リストを含む PEM 形式のファイルが含まれるディレクトリへのパス。このオプションは、暗黙的に <code class="option">--ssl</code> を示します。
          </p><p>
            <code class="option">--ssl-crl</code> も <code class="option">--ssl-crlpath</code> も指定されていない場合は、CA パスに証明書失効リストが含まれていても、CRL チェックが実行されません。
          </p><p>
            OpenSSL を使用して構築された MySQL 配布では、<code class="option">--ssl-crlpath</code> オプションがサポートされています。yaSSL では証明書失効リストが機能しないため、yaSSL を使用して構築された配布ではサポートされません。
          </p><p>
            このオプションは MySQL 5.6.3 で追加されました。
          </p></li><li class="listitem"><p><a name="option_general_ssl-key"></a>
            <a class="indexterm" name="idm139979119215024"></a> <code class="option">--ssl-key=<em class="replaceable"><code>file_name</code></em></code>
          </p><p>
            セキュアな接続を確立する際に使用される PEM 形式の SSL 鍵ファイルの名前。このオプションは、暗黙的に <code class="option">--ssl</code> を示します。
          </p><p>
            MySQL 配布が OpenSSL または (MySQL 5.6.3 時点の) yaSSL を使用して構築され、鍵ファイルがパスフレーズで保護されている場合は、プログラムからパスフレーズを求めるプロンプトがユーザーに表示されます。パスワードは対話形式で指定する必要があり、ファイルには格納できません。パスフレーズが正しくない場合は、鍵を読み取ることができない場合と同様に、プログラムが続行されます。MySQL 5.6.3 よりも前では、MySQL 配布が yaSSL を使用して構築され、鍵ファイルがパスフレーズで保護されている場合は、エラーが発生します。
          </p></li><li class="listitem"><p><a name="option_general_ssl-verify-server-cert"></a>
            <a class="indexterm" name="idm139979119207968"></a> <code class="option">--ssl-verify-server-cert</code>
          </p><p>
            このオプションはクライアントプログラムでのみ使用でき、サーバーでは使用できません。これにより、サーバーがクライアントに送信する証明書内のサーバーの Common Name 値がクライアントによってチェックされます。クライアントは、サーバーへの接続時にクライアントで使用されるホスト名と照合してその名前を検証し、一致が見つからない場合は接続に失敗します。この機能は、中間者攻撃を防ぐために使用できます。検証はデフォルトで無効になっています。
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="creating-ssl-certs"></a>6.3.10.5 MySQL での SSL 証明書および鍵の設定</h4></div></div></div><p>
        このセクションでは、MySQL サーバーおよびクライアントで使用される SSL 証明書および鍵ファイルを設定する方法を示します。1 番目の例は、コマンド行から使用する場合などの単純化された手順を示しています。2 番目では、より詳細なものを含むスクリプトを示します。最初の 2 つの例は、Unix で使用するためのものであり、どちらの例でも OpenSSL の一部である <span class="command"><strong>openssl</strong></span> コマンドが使用されます。3 番目の例では、Windows 上で SSL ファイルを設定する方法について説明します。
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          証明書および鍵ファイルを生成する際にどの方法を使用するのかには関係なく、サーバーおよびクライアントの証明書と鍵で使用される Common Name の値はそれぞれ、CA 証明書で使用されている Common Name の値と異なる必要があります。それ以外の場合は、OpenSSL を使用してコンパイルされたサーバーで証明書および鍵ファイルが機能しません。この場合の一般的なエラーは、次のとおりです。
        </p><pre class="programlisting">
ERROR 2026 (HY000): SSL connection error:
error:00000001:lib(0):func(0):reason(1)
</pre></div><h5><a name="idm139979119198128"></a>例 1: Unix でコマンド行から SSL ファイルを作成する</h5><p>
        次の例には、MySQL サーバーおよびクライアントの証明書および鍵ファイルを作成するためのコマンドセットを示します。<span class="command"><strong>openssl</strong></span> コマンドで複数のプロンプトに回答する必要があります。すべてのプロンプトに対して Enter キーを押せば、テストファイルを生成できます。本番環境用のファイルを生成するには、空でない回答を提供するようにしてください。
      </p><pre class="programlisting">
# Create clean environment
shell&gt; <strong class="userinput"><code>rm -rf newcerts</code></strong>
shell&gt; <strong class="userinput"><code>mkdir newcerts &amp;&amp; cd newcerts</code></strong>

# Create CA certificate
shell&gt; <strong class="userinput"><code>openssl genrsa 2048 &gt; ca-key.pem</code></strong>
shell&gt; <strong class="userinput"><code>openssl req -new -x509 -nodes -days 3600 \</code></strong>
         <strong class="userinput"><code>-key ca-key.pem -out ca-cert.pem</code></strong>

# Create server certificate, remove passphrase, and sign it
# server-cert.pem = public key, server-key.pem = private key
shell&gt; <strong class="userinput"><code>openssl req -newkey rsa:2048 -days 3600 \</code></strong>
         <strong class="userinput"><code>-nodes -keyout server-key.pem -out server-req.pem</code></strong>
shell&gt; <strong class="userinput"><code>openssl rsa -in server-key.pem -out server-key.pem</code></strong>
shell&gt; <strong class="userinput"><code>openssl x509 -req -in server-req.pem -days 3600 \</code></strong>
         <strong class="userinput"><code>-CA ca-cert.pem -CAkey ca-key.pem -set_serial 01 -out server-cert.pem</code></strong>

# Create client certificate, remove passphrase, and sign it
# client-cert.pem = public key, client-key.pem = private key
shell&gt; <strong class="userinput"><code>openssl req -newkey rsa:2048 -days 3600 \</code></strong>
         <strong class="userinput"><code>-nodes -keyout client-key.pem -out client-req.pem</code></strong>
shell&gt; <strong class="userinput"><code>openssl rsa -in client-key.pem -out client-key.pem</code></strong>
shell&gt; <strong class="userinput"><code>openssl x509 -req -in client-req.pem -days 3600 \</code></strong>
         <strong class="userinput"><code>-CA ca-cert.pem -CAkey ca-key.pem -set_serial 01 -out client-cert.pem</code></strong>
</pre><p>
        証明書が生成されたら、それらを確認します。
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>openssl verify -CAfile ca-cert.pem server-cert.pem client-cert.pem</code></strong>
server-cert.pem: OK
client-cert.pem: OK
</pre><p>
        この時点で、次のようなファイルセットを使用できます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="filename">ca-cert.pem</code>: これは、サーバー側とクライアント側で <code class="option">--ssl-ca</code> への引数として使用します。(CA 証明書を使用する場合は、両側で同じものを指定する必要があります。)
          </p></li><li class="listitem"><p>
            <code class="filename">server-cert.pem</code>、<code class="filename">server-key.pem</code>: これらは、サーバー側で <code class="option">--ssl-cert</code> および <code class="option">--ssl-key</code> への引数として使用します。
          </p></li><li class="listitem"><p>
            <code class="filename">client-cert.pem</code>、<code class="filename">client-key.pem</code>: これらは、クライアント側で <code class="option">--ssl-cert</code> および <code class="option">--ssl-key</code> への引数として使用します。
          </p></li></ul></div><p>
        ファイルを使用して SSL 接続をテストする方法については、<a class="xref" href="security.html#using-ssl-connections" title="6.3.10.3 SSL 接続の使用">セクション6.3.10.3「SSL 接続の使用」</a>を参照してください。
      </p><h5><a name="idm139979119168480"></a>例 2: Unix でスクリプトを使用して SSL ファイルを作成する</h5><p>
        次に、MySQL に SSL 証明書および鍵ファイルを設定する方法を示したサンプルスクリプトを示します。スクリプトを実行したあとに、<a class="xref" href="security.html#using-ssl-connections" title="6.3.10.3 SSL 接続の使用">セクション6.3.10.3「SSL 接続の使用」</a>で説明するように、ファイルを使用して SSL 接続をテストします。
      </p><pre class="programlisting">
DIR=`pwd`/openssl
PRIV=$DIR/private

mkdir $DIR $PRIV $DIR/newcerts
cp /usr/share/ssl/openssl.cnf $DIR
replace ./demoCA $DIR -- $DIR/openssl.cnf

# Create necessary files: $database, $serial and $new_certs_dir
# directory (optional)

touch $DIR/index.txt
echo "01" &gt; $DIR/serial

#
# Generation of Certificate Authority(CA)
#

openssl req -new -x509 -keyout $PRIV/cakey.pem -out $DIR/ca-cert.pem \
    -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# ................++++++
# .........++++++
# writing new private key to '/home/monty/openssl/private/cakey.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be
# incorporated into your certificate request.
# What you are about to enter is what is called a Distinguished Name
# or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL admin
# Email Address []:

#
# Create server request and key
#
openssl req -new -keyout $DIR/server-key.pem -out \
    $DIR/server-req.pem -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# ..++++++
# ..........++++++
# writing new private key to '/home/monty/openssl/server-key.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be
# incorporated into your certificate request.
# What you are about to enter is what is called a Distinguished Name
# or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL server
# Email Address []:
#
# Please enter the following 'extra' attributes
# to be sent with your certificate request
# A challenge password []:
# An optional company name []:

#
# Remove the passphrase from the key
#
openssl rsa -in $DIR/server-key.pem -out $DIR/server-key.pem

#
# Sign server cert
#
openssl ca -cert $DIR/ca-cert.pem -policy policy_anything \
    -out $DIR/server-cert.pem -config $DIR/openssl.cnf \
    -infiles $DIR/server-req.pem

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Enter PEM pass phrase:
# Check that the request matches the signature
# Signature ok
# The Subjects Distinguished Name is as follows
# countryName           :PRINTABLE:'FI'
# organizationName      :PRINTABLE:'MySQL AB'
# commonName            :PRINTABLE:'MySQL admin'
# Certificate is to be certified until Sep 13 14:22:46 2003 GMT
# (365 days)
# Sign the certificate? [y/n]:y
#
#
# 1 out of 1 certificate requests certified, commit? [y/n]y
# Write out database with 1 new entries
# Data Base Updated

#
# Create client request and key
#
openssl req -new -keyout $DIR/client-key.pem -out \
    $DIR/client-req.pem -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# .....................................++++++
# .............................................++++++
# writing new private key to '/home/monty/openssl/client-key.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be
# incorporated into your certificate request.
# What you are about to enter is what is called a Distinguished Name
# or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL user
# Email Address []:
#
# Please enter the following 'extra' attributes
# to be sent with your certificate request
# A challenge password []:
# An optional company name []:

#
# Remove the passphrase from the key
#
openssl rsa -in $DIR/client-key.pem -out $DIR/client-key.pem

#
# Sign client cert
#

openssl ca -cert $DIR/ca-cert.pem -policy policy_anything \
    -out $DIR/client-cert.pem -config $DIR/openssl.cnf \
    -infiles $DIR/client-req.pem

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Enter PEM pass phrase:
# Check that the request matches the signature
# Signature ok
# The Subjects Distinguished Name is as follows
# countryName           :PRINTABLE:'FI'
# organizationName      :PRINTABLE:'MySQL AB'
# commonName            :PRINTABLE:'MySQL user'
# Certificate is to be certified until Sep 13 16:45:17 2003 GMT
# (365 days)
# Sign the certificate? [y/n]:y
#
#
# 1 out of 1 certificate requests certified, commit? [y/n]y
# Write out database with 1 new entries
# Data Base Updated

#
# Create a my.cnf file that you can use to test the certificates
#

cat &lt;&lt;EOF &gt; $DIR/my.cnf
[client]
ssl-ca=$DIR/ca-cert.pem
ssl-cert=$DIR/client-cert.pem
ssl-key=$DIR/client-key.pem
[mysqld]
ssl-ca=$DIR/ca-cert.pem
ssl-cert=$DIR/server-cert.pem
ssl-key=$DIR/server-key.pem
EOF
</pre><h5><a name="idm139979119152496"></a>例 3: Windows で SSL ファイルを作成する</h5><p>
        Windows 用の OpenSSL がシステムにインストールされていない場合は、それをダウンロードします。次に、使用可能なパッケージの概要を示します。
      </p><pre class="programlisting">
<a class="ulink" href="http://www.slproweb.com/products/Win32OpenSSL.html" target="_top">http://www.slproweb.com/products/Win32OpenSSL.html</a>
</pre><p>
        アーキテクチャー (32 ビットまたは 64 ビット) に応じて、Win32 OpenSSL Light または Win64 OpenSSL Light パッケージを選択します。デフォルトのインストール場所は、ダウンロードしたパッケージに応じて、<code class="literal">C:\OpenSSL-Win32</code> または <code class="literal">C:\OpenSSL-Win64</code> です。次の手順では、デフォルトの場所が <code class="literal">C:\OpenSSL-Win32</code> であることが前提となっています。64 ビットのパッケージを使用している場合は、必要に応じて、これを変更します。
      </p><p>
        設定中に<code class="literal">「...critical component is missing: Microsoft Visual C++ 2008 Redistributables」</code>というメッセージが発生した場合は、設定を取り消し、アーキテクチャー (32 ビットまたは 64 ビット) に応じて、次のパッケージのいずれかをダウンロードします。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Visual C++ 2008 Redistributables (x86) (次の場所で入手可能):
          </p><pre class="programlisting">
<a class="ulink" href="http://www.microsoft.com/downloads/details.aspx?familyid=9B2DA534-3E03-4391-8A4D-074B9F2BC1BF" target="_top">http://www.microsoft.com/downloads/details.aspx?familyid=9B2DA534-3E03-4391-8A4D-074B9F2BC1BF</a>
</pre></li><li class="listitem"><p>
            Visual C++ 2008 Redistributables (x64) (次の場所で入手可能):
          </p><pre class="programlisting">
<a class="ulink" href="http://www.microsoft.com/downloads/details.aspx?familyid=bd2a6171-e2d6-4230-b809-9a8d7548c1b6" target="_top">http://www.microsoft.com/downloads/details.aspx?familyid=bd2a6171-e2d6-4230-b809-9a8d7548c1b6</a>
</pre></li></ul></div><p>
        追加のパッケージをインストールしたら、OpenSSL の設定手順を再開します。
      </p><p>
        インストール時に、インストールパスとしてデフォルトの <code class="filename">C:\OpenSSL-Win32</code> のままにして、デフォルトの<code class="literal">「Copy OpenSSL DLL files to the Windows system directory」</code>オプションも選択されたままにします。
      </p><p>
        インストールが完了したら、サーバーの Windows システムパス変数に <code class="filename">C:\OpenSSL-Win32\bin</code> を追加します。
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            Windows デスクトップ上で<span class="guiicon">「マイ コンピューター」</span>アイコンを右クリックして、<span class="guimenuitem">「プロパティ」</span>を選択します。
          </p></li><li class="listitem"><p>
            表示された<span class="guimenu">「システムのプロパティ」</span>メニューから<span class="guimenuitem">「詳細設定」</span>タブを選択し、<span class="guibutton">「環境変数」</span>ボタンをクリックします。
          </p></li><li class="listitem"><p>
            <span class="guilabel">「システム変数」</span>で<span class="guimenuitem">「パス」</span>を選択してから、<span class="guibutton">「編集」</span>ボタンをクリックします。<span class="guimenu">「システム変数の編集」</span>ダイアログが表示されるはずです。
          </p></li><li class="listitem"><p>
            末尾に<code class="literal">「;C:\OpenSSL-Win32\bin」</code>を追加します (セミコロンに注意してください)。
          </p></li><li class="listitem"><p>
            「OK」を 3 回押します。
          </p></li><li class="listitem"><p>
            新しいコマンドコンソール (<span class="command"><strong>Start&gt;Run&gt;cmd.exe</strong></span>) を開いて、OpenSSL が使用可能であることを確認することで、OpenSSL が Path 変数に正しく統合されたことをチェックします。
          </p><pre class="programlisting">
Microsoft Windows [Version ...]
Copyright (c) 2006 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;<strong class="userinput"><code>cd \</code></strong>

C:\&gt;<strong class="userinput"><code>openssl</code></strong>
OpenSSL&gt; <strong class="userinput"><code>exit</code></strong> &lt;&lt;&lt; If you see the OpenSSL prompt, installation was successful.

C:\&gt;
</pre></li></ol></div><p>
        Windows のバージョンに応じて、前述のパス設定手順が多少異なる場合があります。
      </p><p>
        OpenSSL がインストールされたら、(このセクションの前半で示した) 例 1 と同様の手順を次のように変更して使用します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            次のように Unix コマンドを変更します。
          </p><pre class="programlisting">
# Create clean environment
shell&gt; <strong class="userinput"><code>rm -rf newcerts</code></strong>
shell&gt; <strong class="userinput"><code>mkdir newcerts &amp;&amp; cd newcerts</code></strong>
</pre><p>
            Windows では、代わりに次のコマンドを使用します。
          </p><pre class="programlisting">
# Create clean environment
shell&gt; <strong class="userinput"><code>md c:\newcerts</code></strong>
shell&gt; <strong class="userinput"><code>cd c:\newcerts</code></strong>
</pre></li><li class="listitem"><p>
            コマンド行の末尾に<code class="literal">「\」</code>文字が表示されたら、この<code class="literal">「\」</code>文字を削除し、コマンド行をすべて 1 行で入力する必要があります。
          </p></li></ul></div><p>
        証明書および鍵ファイルが生成されたあとに、それらを使用して SSL 接続をテストする方法については、<a class="xref" href="security.html#using-ssl-connections" title="6.3.10.3 SSL 接続の使用">セクション6.3.10.3「SSL 接続の使用」</a>を参照してください。
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="windows-and-ssh"></a>6.3.11 SSH を使用した Windows から MySQL へのリモート接続</h3></div></div></div><a class="indexterm" name="idm139979119105056"></a><a class="indexterm" name="idm139979119103808"></a><a class="indexterm" name="idm139979119101600"></a><p>
      このセクションでは、SSH を使用してリモートの MySQL サーバーへのセキュアな接続を確立する方法について説明します。元の情報は、David Carlson <code class="email">&lt;<a class="email" href="mailto:dcarlson@mplcomm.com">dcarlson@mplcomm.com</a>&gt;</code> によって提供されました。
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          Windows マシン上に SSH クライアントをインストールします。SSH クライアントの比較については、<a class="ulink" href="http://en.wikipedia.org/wiki/Comparison_of_SSH_clients" target="_top">http://en.wikipedia.org/wiki/Comparison_of_SSH_clients</a>を参照してください。
        </p></li><li class="listitem"><p>
          Windows SSH クライアントを起動します。<code class="literal">Host_Name = <em class="replaceable"><code>yourmysqlserver_URL_or_IP</code></em></code> を設定します。サーバーにログインする <code class="literal">userid=<em class="replaceable"><code>your_userid</code></em></code> を設定します。この <code class="literal">userid</code> 値は、MySQL アカウントのユーザー名と同じでない可能性があります。
        </p></li><li class="listitem"><p>
          ポートフォワーディングを設定します。リモート転送 (<code class="literal">local_port: 3306</code>、<code class="literal">remote_host: <em class="replaceable"><code>yourmysqlservername_or_ip</code></em></code>、<code class="literal">remote_port: 3306</code> を設定します) とローカル転送 (<code class="literal">port: 3306</code>、<code class="literal">host: localhost</code>、<code class="literal">remote port: 3306</code> を設定します) のいずれかを実行します。
        </p></li><li class="listitem"><p>
          すべてを保存します。そうしない場合は、次回やり直す必要があります。
        </p></li><li class="listitem"><p>
          作成した SSH セッションを使用して、サーバーにログインします。
        </p></li><li class="listitem"><p>
          Windows マシン上で、いくつかの ODBC アプリケーション (Access など) を起動します。
        </p></li><li class="listitem"><p>
          通常と同じ方法で、Windows で新しいファイルを作成し、ODBC ドライバを使用して MySQL へのリンクを作成します。ただし、MySQL ホストサーバーでは、<em class="replaceable"><code>yourmysqlservername</code></em> ではなく、<code class="literal">localhost</code> に入力します。
        </p></li></ol></div><p>
      この時点で、MySQL への ODBC 接続が SSH を使用して暗号化されているはずです。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="audit-log-plugin"></a>6.3.12 MySQL Enterprise Audit ログプラグイン</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#audit-log-plugin-installation">6.3.12.1 監査ログプラグインのインストール</a></span></dt><dt><span class="section"><a href="security.html#audit-log-security">6.3.12.2 監査ログプラグインのセキュリティーに関する考慮事項</a></span></dt><dt><span class="section"><a href="security.html#audit-log-file">6.3.12.3 監査ログファイル</a></span></dt><dt><span class="section"><a href="security.html#audit-log-plugin-logging-control">6.3.12.4 監査ログプラグインのロギング制御</a></span></dt><dt><span class="section"><a href="security.html#audit-log-plugin-option-variable-reference">6.3.12.5 監査ログプラグインのオプションおよび変数のリファレンス</a></span></dt><dt><span class="section"><a href="security.html#audit-log-plugin-options-variables">6.3.12.6 監査ログプラグインのオプションおよびシステム変数</a></span></dt><dt><span class="section"><a href="security.html#audit-log-status-variables">6.3.12.7 監査ログプラグインのステータス変数</a></span></dt><dt><span class="section"><a href="security.html#audit-log-plugin-restrictions">6.3.12.8 監査ログプラグインの制限事項</a></span></dt></dl></div><a class="indexterm" name="idm139979119079264"></a><a class="indexterm" name="idm139979119077808"></a><a class="indexterm" name="idm139979119075776"></a><a class="indexterm" name="idm139979119074544"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        MySQL Enterprise Audit は、商用の拡張機能です。商用の製品 (MySQL Enterprise Edition) についてさらに学習するには、http://www.mysql.com/products/ を参照してください。
      </p></div><p>
      MySQL 5.6.10 の時点で、MySQL Enterprise Edition には、<code class="literal">audit_log</code> という名前のサーバープラグインを使用して実装された MySQL Enterprise Audit が含まれています。MySQL Enterprise Audit では、特定の MySQL サーバーで実行される接続およびクエリーアクティビティーのポリシーベースの標準モニタリングおよびロギングを有効にする際に、MySQL Audit API が使用されます。MySQL Enterprise Audit は、オラクルの監査仕様を満たすように設計されており、内部および外部の規制ガイドラインの両方に管理されているアプリケーションに対して、そのままで簡単に使用できる監査およびコンプライアンスのソリューションを提供しています。
    </p><p>
      インストール時に監査プラグインを使用すると、MySQL サーバーはサーバーアクティビティーの監査レコードを含むログファイルを生成できます。ログの内容には、クライアントが接続および切断したとき、および接続中に実行されたアクション (アクセスされたデータベースやテーブルなど) が含まれます。
    </p><p>
      プラグインをインストールすると (<a class="xref" href="security.html#audit-log-plugin-installation" title="6.3.12.1 監査ログプラグインのインストール">セクション6.3.12.1「監査ログプラグインのインストール」</a>を参照してください)、監査ログファイルが書き込まれます。デフォルトでは、そのファイルはサーバーのデータディレクトリ内の <code class="filename">audit.log</code> という名前です。ファイルの名前を変更するには、サーバーの起動時に <code class="literal">audit_log_file</code> システム変数を設定します。
    </p><p>
      監査ログファイルの内容は暗号化されません。<a class="xref" href="security.html#audit-log-security" title="6.3.12.2 監査ログプラグインのセキュリティーに関する考慮事項">セクション6.3.12.2「監査ログプラグインのセキュリティーに関する考慮事項」</a>を参照してください。
    </p><p>
      監査ログファイルは、<code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素としてエンコードされた監査可能なイベントとともに、XML 形式で書き込まれます。ファイル形式を選択するには、サーバーの起動時に <code class="literal">audit_log_format</code> システム変数を設定します。ファイルの形式および内容についての詳細は、<a class="xref" href="security.html#audit-log-file" title="6.3.12.3 監査ログファイル">セクション6.3.12.3「監査ログファイル」</a>を参照してください。
    </p><p>
      <code class="literal">audit_log</code> によってログファイルに書き込まれる情報の内容を制御するには、<code class="literal">audit_log_policy</code> システム変数を設定します。この変数はデフォルトで、<code class="literal">ALL</code> (監査可能なイベントをすべて書き込む) に設定されていますが、ログインまたはクエリーイベントのログのみを記録する <code class="literal">LOGINS</code> または <code class="literal">QUERIES</code> や、ロギングを無効にする <code class="literal">NONE</code> の値も許可されています。
    </p><p>
      ロギングが発生する方法の制御についての詳細は、<a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.12.4 監査ログプラグインのロギング制御">セクション6.3.12.4「監査ログプラグインのロギング制御」</a>を参照してください。監査ログプラグインを構成する際に使用されるパラメータについては、<a class="xref" href="security.html#audit-log-plugin-options-variables" title="6.3.12.6 監査ログプラグインのオプションおよびシステム変数">セクション6.3.12.6「監査ログプラグインのオプションおよびシステム変数」</a>を参照してください。
    </p><p>
      <code class="literal">audit_log</code> プラグインが有効になっている場合は、パフォーマンススキーマ (<a class="xref" href="performance-schema.html" title="第 22 章 MySQL パフォーマンススキーマ">第22章「<i>MySQL パフォーマンススキーマ</i>」</a>を参照してください) に監査ログプラグイン用のインストゥルメンテーションが追加されます。関連するインストゥルメントを識別するには、次のクエリーを使用します。
    </p><pre class="programlisting">
SELECT NAME FROM performance_schema.setup_instruments
WHERE NAME LIKE '%/alog/%';
</pre><h4><a name="idm139979119048432"></a>古い監査ログプラグインのバージョンからの変更</h4><p>
      MySQL 5.6.14 では、Oracle Audit Vault との互換性を高くするために、監査ログプラグインにいくつかの変更が行われました。
    </p><p>
      新しい監査ログファイルの形式が実装されました。<code class="literal">audit_log_format</code> システム変数を使用すれば、古い形式または新しい形式を選択できます。この変数では、<code class="literal">OLD</code> および <code class="literal">NEW</code> (デフォルトは <code class="literal">OLD</code>) の値が許可されています。2 つの形式の相違点は次のとおりです。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          属性を使用した古い形式で書き込まれた <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素内の情報は、サブ要素を使用した新しい形式で書き込まれます。
        </p></li><li class="listitem"><p>
          新しい形式には、<code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素の詳細な情報が含まれています。各要素には、一意の識別子を提供する <code class="literal">RECORD_ID</code> 値が含まれています。<code class="literal">TIMESTAMP</code> 値には、タイムゾーンの情報が含まれています。クエリーレコードには、<code class="literal">HOST</code>、<code class="literal">IP</code>、<code class="literal">OS_LOGIN</code>、<code class="literal">USER</code> の情報、および <code class="literal">COMMAND_CLASS</code> と <code class="literal">STATUS_CODE</code> の値が含まれています。
        </p></li></ul></div><p>
      古い <code class="literal">&lt;AUDIT_RECORD&gt;</code> 形式の例:
    </p><pre class="programlisting">
&lt;AUDIT_RECORD
 TIMESTAMP="2013-09-15T15:27:27"
 NAME="Query"
 CONNECTION_ID="3"
 STATUS="0"
 SQLTEXT="SELECT 1"
/&gt;
</pre><p>
      新しい <code class="literal">&lt;AUDIT_RECORD&gt;</code> 形式の例:
    </p><pre class="programlisting">
&lt;AUDIT_RECORD&gt;
 &lt;TIMESTAMP&gt;2013-09-15T15:27:27 UTC&lt;/TIMESTAMP&gt;
 &lt;RECORD_ID&gt;3998_2013-09-15T15:27:27&lt;/RECORD_ID&gt;
 &lt;NAME&gt;Query&lt;/NAME&gt;
 &lt;CONNECTION_ID&gt;3&lt;/CONNECTION_ID&gt;
 &lt;STATUS&gt;0&lt;/STATUS&gt;
 &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
 &lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
 &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
 &lt;HOST&gt;localhost&lt;/HOST&gt;
 &lt;IP&gt;127.0.0.1&lt;/IP&gt;
 &lt;COMMAND_CLASS&gt;select&lt;/COMMAND_CLASS&gt;
 &lt;SQLTEXT&gt;SELECT 1&lt;/SQLTEXT&gt;
&lt;/AUDIT_RECORD&gt;
</pre><p>
      監査ログプラグインによって監査ログファイルがローテーションされると、別のファイル名形式が使用されます。<code class="filename">audit.log</code> という名前のログファイルの場合、以前はプラグインによってファイル名が <code class="filename">audit.log.<em class="replaceable"><code>TIMESTAMP</code></em></code> に変更されました。現在は、プラグインによってファイル名は XML ファイルであることを示す <code class="filename">audit.log.<em class="replaceable"><code>TIMESTAMP</code></em>.xml</code> に変更されます。
    </p><p>
      <code class="literal">audit_log_format</code> の値を変更する場合は、次の手順を使用して、ある形式のログエントリが別の形式のエントリを含む既存のログファイルに書き込まれることを回避します。
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          サーバーを停止します。
        </p></li><li class="listitem"><p>
          現在の監査ログファイルの名前を手動で変更します。
        </p></li><li class="listitem"><p>
          新しい <code class="literal">audit_log_format</code> の値でサーバーを再起動します。監査ログプラグインによって、選択した形式のログエントリを含む新しいログファイルが作成されます。
        </p></li></ol></div><p>
      監査プラグインを記述するための API も変更されました。<code class="literal">mysql_event_general</code> の構造には、クライアントのホスト名と IP アドレス、コマンドのクラス、および外部ユーザーを表す新しいメンバーが含まれています。詳細については、<a class="xref" href="extending-mysql.html#writing-audit-plugins" title="24.2.4.8 監査プラグインの作成">セクション24.2.4.8「監査プラグインの作成」</a>を参照してください。
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-plugin-installation"></a>6.3.12.1 監査ログプラグインのインストール</h4></div></div></div><p>
        監査ログプラグインは、<code class="literal">audit_log</code> という名前です。サーバーで使用可能にするには、プラグインライブラリオブジェクトファイルを MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) に配置する必要があります。必要に応じて、サーバーの起動時に、プラグインディレクトリの場所をサーバーに指示する <code class="literal">plugin_dir</code> の値を設定します。
      </p><p>
        サーバーの起動時にプラグインをロードするには、<code class="option">--plugin-load</code> オプションを使用して、プラグインを含むオブジェクトファイルの名前を指定します。このプラグインのロード方式では、サーバーを起動するたびにオプションを指定する必要があります。たとえば、<code class="filename">my.cnf</code> ファイルに次の行を挿入します。
      </p><pre class="programlisting">
[mysqld]
plugin-load=audit_log.so
</pre><p>
        システム上のオブジェクトファイルのサフィクスが <code class="filename">.so</code> とは異なる場合、正しいサフィクスに置き換えてください (たとえば Windows の場合は <code class="filename">.dll</code>)。
      </p><p>
        また、実行時にプラグインを登録するには、次のステートメントを使用します (必要に応じて、サフィクスを変更します)。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN audit_log SONAME 'audit_log.so';</code></strong>
</pre><p>
        <code class="literal">INSTALL PLUGIN</code> は、プラグインをロードします。また、後続の通常のサーバー起動のたびにプラグインがロードされるように、そのプラグインを <code class="literal">mysql.plugins</code> テーブルに登録します。
      </p><p>
        プラグインが <code class="option">--plugin-load</code> を使用してロードされている場合、または <code class="literal">INSTALL PLUGIN</code> を使用して事前に登録されている場合は、サーバーの起動時に <code class="option">--audit-log</code> オプションを使用すると、プラグインのアクティブ化を制御できます。たとえば、プラグインをロードして、実行時に削除されないようにするには、次のオプションを使用します。
      </p><pre class="programlisting">
[mysqld]
plugin-load=audit_log.so
audit-log=FORCE_PLUS_PERMANENT
</pre><p>
        監査プラグインを使用せずにサーバーが実行されることを回避する必要がある場合は、<code class="literal">FORCE</code> または <code class="literal">FORCE_PLUS_PERMANENT</code> の値とともに <code class="option">--audit-log</code> を使用して、プラグインが正常に初期化されない場合にサーバーの起動を強制的に失敗させます。
      </p><p>
        プラグインのインストールについての一般的な情報は、<a class="xref" href="server-administration.html#server-plugins" title="5.1.8 サーバープラグイン">セクション5.1.8「サーバープラグイン」</a>を参照してください。プラグインのインストールを確認するには、<code class="literal">INFORMATION_SCHEMA.PLUGINS</code> テーブルを調査するか、または <code class="literal">SHOW PLUGINS</code> ステートメントを使用します。<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.1.8.2 サーバープラグイン情報の取得">セクション5.1.8.2「サーバープラグイン情報の取得」</a>を参照してください。
      </p><p>
        監査ログファイルの内容は暗号化されません。<a class="xref" href="security.html#audit-log-security" title="6.3.12.2 監査ログプラグインのセキュリティーに関する考慮事項">セクション6.3.12.2「監査ログプラグインのセキュリティーに関する考慮事項」</a>を参照してください。
      </p><p>
        <code class="literal">audit_log</code> プラグインの操作を構成する際に使用されるパラメータに関する追加情報については、<a class="xref" href="security.html#audit-log-plugin-options-variables" title="6.3.12.6 監査ログプラグインのオプションおよびシステム変数">セクション6.3.12.6「監査ログプラグインのオプションおよびシステム変数」</a>を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-security"></a>6.3.12.2 監査ログプラグインのセキュリティーに関する考慮事項</h4></div></div></div><p>
        <code class="literal">audit_log</code> 監査ログプラグインによって生成された監査ログファイルの内容は、暗号化されません。この内容には、SQL ステートメントのテキストなどの機密情報が含まれている可能性があります。セキュリティー上の理由から、このファイルは MySQL サーバーおよびログを表示する正当な理由を持つユーザーからのみアクセス可能なディレクトリに書き込むようにしてください。デフォルトのファイルは、データディレクトリ内の <code class="filename">audit.log</code> です。これは、サーバーの起動時に <code class="literal">audit_log_file</code> システム変数を設定することで変更できます。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-file"></a>6.3.12.3 監査ログファイル</h4></div></div></div><p>
        監査ログファイルの内容は暗号化されません。<a class="xref" href="security.html#audit-log-security" title="6.3.12.2 監査ログプラグインのセキュリティーに関する考慮事項">セクション6.3.12.2「監査ログプラグインのセキュリティーに関する考慮事項」</a>を参照してください。
      </p><p>
        監査ログファイルは、UTF-8 (1 文字当たり最大 4 バイト) を使用した XML として記述されています。ルート要素は、<code class="literal">&lt;AUDIT&gt;</code> です。監査プラグインログの終了時に、ルート要素の終了タグ <code class="literal">&lt;/AUDIT&gt;</code> が書き込まれます。そのため、このタグは、プラグインがアクティブになっている間はファイル内に存在しません。
      </p><p>
        ルート要素には、<code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素が含まれています。この要素のそれぞれは、監査対象のイベントに関する情報を提供します。
      </p><p>
        MySQL 5.6.14 では、Oracle Audit Vault との互換性を高くするために、新しい監査ログファイルの形式が導入されました。<code class="literal">audit_log_format</code> システム変数を使用すれば、古い形式または新しい形式を選択できます。この変数では、<code class="literal">OLD</code> および <code class="literal">NEW</code> (デフォルトは <code class="literal">OLD</code>) の値が許可されています。
      </p><p>
        <code class="literal">audit_log_format</code> の値を変更する場合は、次の手順を使用して、ある形式のログエントリが別の形式のエントリを含む既存のログファイルに書き込まれることを回避します。
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            サーバーを停止します。
          </p></li><li class="listitem"><p>
            現在の監査ログファイルの名前を手動で変更します。
          </p></li><li class="listitem"><p>
            新しい <code class="literal">audit_log_format</code> の値でサーバーを再起動します。監査ログプラグインによって、選択した形式のログエントリを含む新しいログファイルが作成されます。
          </p></li></ol></div><p>
        次に、デフォルトの (古い) 形式のサンプルログファイルを示します。ただし、読みやすくするために形式が若干変更されています。
      </p><pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;AUDIT&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2012-08-02T14:52:12"
    NAME="Audit"
    SERVER_ID="1"
    VERSION="1"
    STARTUP_OPTIONS="--port=3306"
    OS_VERSION="i686-Linux"
    MYSQL_VERSION="5.6.10-log"/&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2012-08-02T14:52:41"
    NAME="Connect"
    CONNECTION_ID="1"
    STATUS="0"
    USER="root"
    PRIV_USER="root"
    OS_LOGIN=""
    PROXY_USER=""
    HOST="localhost"
    IP="127.0.0.1"
    DB=""/&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2012-08-02T14:53:45"
    NAME="Query"
    CONNECTION_ID="1"
    STATUS="0"
    SQLTEXT="INSERT INTO t1 () VALUES()"/&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2012-08-02T14:53:51"
    NAME="Quit"
    CONNECTION_ID="1"
    STATUS="0"/&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2012-08-06T14:21:03"
    NAME="NoAudit"
    SERVER_ID="1"/&gt;
&lt;/AUDIT&gt;
</pre><p>
        次に、新しい形式のサンプルログファイルを示します。ただし、読みやすくするために形式が若干変更されています。
      </p><pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;AUDIT&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:24 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;1_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Audit&lt;/NAME&gt;
  &lt;SERVER_ID&gt;1&lt;/SERVER_ID&gt;
  &lt;VERSION&gt;1&lt;/VERSION&gt;
  &lt;STARTUP_OPTIONS&gt;/usr/local/mysql/bin/mysqld
    --socket=/usr/local/mysql/mysql.sock
    --port=3306&lt;/STARTUP_OPTIONS&gt;
  &lt;OS_VERSION&gt;x86_64-osx10.6&lt;/OS_VERSION&gt;
  &lt;MYSQL_VERSION&gt;5.7.2-m12-log&lt;/MYSQL_VERSION&gt;
 &lt;/AUDIT_RECORD&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:40 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;2_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Connect&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;2&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root&lt;/USER&gt;
  &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;connect&lt;/COMMAND_CLASS&gt;
  &lt;PRIV_USER&gt;root&lt;/PRIV_USER&gt;
  &lt;PROXY_USER&gt;&lt;/PROXY_USER&gt;
  &lt;DB&gt;test&lt;/DB&gt;
 &lt;/AUDIT_RECORD&gt;

...

 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:41 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;4_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Query&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;2&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
  &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;drop_table&lt;/COMMAND_CLASS&gt;
  &lt;SQLTEXT&gt;DROP TABLE IF EXISTS t&lt;/SQLTEXT&gt;
 &lt;/AUDIT_RECORD&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:41 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;5_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Query&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;2&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
  &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;create_table&lt;/COMMAND_CLASS&gt;
  &lt;SQLTEXT&gt;CREATE TABLE t (i INT)&lt;/SQLTEXT&gt;
 &lt;/AUDIT_RECORD&gt;

...

 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:41 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;7_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Quit&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;2&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;&lt;/USER&gt;
  &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
  &lt;HOST&gt;&lt;/HOST&gt;
  &lt;IP&gt;&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;connect&lt;/COMMAND_CLASS&gt;
 &lt;/AUDIT_RECORD&gt;

...

 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:47 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;9_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Shutdown&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;3&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
  &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;&lt;/COMMAND_CLASS&gt;
 &lt;/AUDIT_RECORD&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:47 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;10_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Quit&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;3&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;&lt;/USER&gt;
  &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
  &lt;HOST&gt;&lt;/HOST&gt;
  &lt;IP&gt;&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;connect&lt;/COMMAND_CLASS&gt;
 &lt;/AUDIT_RECORD&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:49 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;11_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;NoAudit&lt;/NAME&gt;
  &lt;SERVER_ID&gt;1&lt;/SERVER_ID&gt;
 &lt;/AUDIT_RECORD&gt;
&lt;/AUDIT&gt;
</pre><p>
        <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素の属性には、次のような特性があります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            一部の属性はすべての要素に表示されますが、大部分はオプションであり、必ずしもすべての要素に表示されるとはかぎりません。
          </p></li><li class="listitem"><p>
            要素内の属性の順序は保証されません。
          </p></li><li class="listitem"><p>
            属性値は固定長ではありません。あとで属性の説明で示すように、長い値は切り捨てられる可能性があります。
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;</code>、<code class="literal">&gt;</code>、<code class="literal">"</code>、および <code class="literal">&amp;</code> 文字は、それぞれ <code class="literal">&amp;lt;</code>、<code class="literal">&amp;gt;</code>、<code class="literal">&amp;quot;</code>、および <code class="literal">&amp;amp;</code> としてエンコードされます。NUL バイト (U+00) は、<code class="literal">?</code> 文字としてエンコードされます。
          </p></li><li class="listitem"><p>
            XML 文字として有効でない文字は、数値の文字参照を使用してエンコードされます。有効な XML 文字は次のとおりです。
          </p><pre class="programlisting">
#x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]
</pre></li></ul></div><h5><a name="idm139979118940384"></a>新しい監査ログファイル形式</h5><p>
        すべての <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素には、必須の要素セットが含まれています。監査レコードのタイプに応じて、その他のオプションの要素が表示される場合もあります。
      </p><p>
        次の要素は、すべての <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素で必須です。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">&lt;NAME&gt;</code>
          </p><p>
            監査イベントを生成した命令 (サーバーがクライアントから受信したコマンドなど) のタイプを表す文字列。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;NAME&gt;Query&lt;/NAME&gt;
</pre><p>
            一部の一般的な <code class="literal">&lt;NAME&gt;</code> 値:
          </p><pre class="programlisting">
Audit    When auditing starts, which may be server startup time
Connect  When a client connects, also known as logging in
Query    An SQL statement (executed directly)
Prepare  Preparation of an SQL statement; usually followed by Execute
Execute  Execution of an SQL statement; usually follows Prepare
Shutdown Server shutdown
Quit     When a client disconnects
NoAudit  Auditing has been turned off
</pre><p>
            指定可能な値は <code class="literal">Audit</code>、<code class="literal">Binlog Dump</code>、<code class="literal">Change user</code>、<code class="literal">Close stmt</code>、<code class="literal">Connect Out</code>、<code class="literal">Connect</code>、<code class="literal">Create DB</code>、<code class="literal">Daemon</code>、<code class="literal">Debug</code>、<code class="literal">Delayed insert</code>、<code class="literal">Drop DB</code>、<code class="literal">Execute</code>、<code class="literal">Fetch</code>、<code class="literal">Field List</code>、<code class="literal">Init DB</code>、<code class="literal">Kill</code>、<code class="literal">Long Data</code>、<code class="literal">NoAudit</code>、<code class="literal">Ping</code>、<code class="literal">Prepare</code>、<code class="literal">Processlist</code>、<code class="literal">Query</code>、<code class="literal">Quit</code>、<code class="literal">Refresh</code>、<code class="literal">Register Slave</code>、<code class="literal">Reset stmt</code>、<code class="literal">Set option</code>、<code class="literal">Shutdown</code>、<code class="literal">Sleep</code>、<code class="literal">Statistics</code>、<code class="literal">Table Dump</code>、<code class="literal">Time</code> です。
          </p><p>
            <code class="literal">Audit</code> と <code class="literal">NoAudit</code> を除いて、これらの値は <code class="filename">mysql_com.h</code> ヘッダーファイルに一覧表示された <code class="literal">COM_<em class="replaceable"><code>xxx</code></em></code> コマンドの値に対応します。たとえば、<code class="literal">Create DB</code> と <code class="literal">Shutdown</code> は、それぞれ <code class="literal">COM_CREATE_DB</code> と <code class="literal">COM_SHUTDOWN</code> に対応します。
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;RECORD_ID&gt;</code>
          </p><p>
            監査レコードを表す一意の識別子。この値はシーケンス番号とタイムスタンプで構成され、形式は <code class="literal"><em class="replaceable"><code>SEQ_TIMESTAMP</code></em></code> です。シーケンス番号は、監査ログプラグインによって開かれ、レコードのログが記録されるたびに 1 ずつ増分されると、監査ログファイルのサイズに初期化されます。タイムスタンプは、監査ログプラグインによってファイルが開かれた時間を示す <code class="literal"><em class="replaceable"><code>yyyy-mm-dd</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em></code> 形式の UTC 値です。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;RECORD_ID&gt;28743_2013-09-18T21:03:24&lt;/RECORD_ID&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;TIMESTAMP&gt;</code>
          </p><p>
            監査イベントが生成された日付と時間。たとえば、クライアントから受信された SQL ステートメントの実行に対応するイベントでは、<code class="literal">&lt;TIMESTAMP&gt;</code> 値はステートメントが受信されたときではなく、終了したあとに生成されます。この値の形式は、<code class="literal"><em class="replaceable"><code>yyyy-mm-dd</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em> UTC</code> (<code class="literal">T</code> の場合は小数点不可) です。この形式の末尾には、タイムゾーン指定子が含まれています。現在、タイムゾーンは常に UTC です。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;TIMESTAMP&gt;2013-09-17T15:03:49 UTC&lt;/TIMESTAMP&gt;
</pre></li></ul></div><p>
        次の要素は、<code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素ではオプションです。これらの多くは、特定の <code class="literal">&lt;NAME&gt;</code> 値でのみ発生します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">&lt;COMMAND_CLASS&gt;</code>
          </p><p>
            実行されたアクションのタイプを示す文字列。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;COMMAND_CLASS&gt;drop_table&lt;/COMMAND_CLASS&gt;
</pre><p>
            この値は、MySQL ソース配布の <code class="filename">sql/mysqld.cc</code> ファイル内の <code class="literal">com_status_vars</code> 配列から取得されます。これらは、このステートメントで表示されるステータス変数に対応します。
          </p><pre class="programlisting">
SHOW STATUS LIKE 'Com%';
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;CONNECTION_ID&gt;</code>
          </p><p>
            クライアント接続識別子を表す符号なし整数。これは、セッション内の <code class="literal">CONNECTION_ID()</code> 関数の値と同じです。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;CONNECTION_ID&gt;127&lt;/CONNECTION_ID&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;DB&gt;</code>
          </p><p>
            デフォルトのデータベース名を表す文字列。この要素は、<code class="literal">&lt;NAME&gt;</code> 値が <code class="literal">Connect</code> または <code class="literal">Change user</code> である場合にのみ表示されます。
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;HOST&gt;</code>
          </p><p>
            クライアントのホスト名を表す文字列。この要素は、<code class="literal">&lt;NAME&gt;</code> 値が <code class="literal">Connect</code>、<code class="literal">Change user</code>、または <code class="literal">Query</code> である場合にのみ表示されます。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;HOST&gt;localhost&lt;/HOST&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;IP&gt;</code>
          </p><p>
            クライアントの IP アドレスを表す文字列。この要素は、<code class="literal">&lt;NAME&gt;</code> 値が <code class="literal">Connect</code>、<code class="literal">Change user</code>、または <code class="literal">Query</code> である場合にのみ表示されます。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;IP&gt;127.0.0.1&lt;/IP&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;MYSQL_VERSION&gt;</code>
          </p><p>
            MySQL サーバーのバージョンを表す文字列。これは、セッション内の <code class="literal">VERSION()</code> 関数または <code class="literal">version</code> システム変数の値と同じです。この要素は、<code class="literal">&lt;NAME&gt;</code> 値が <code class="literal">Audit</code> である場合にのみ表示されます。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;MYSQL_VERSION&gt;5.7.1-m11-log&lt;/MYSQL_VERSION&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;OS_LOGIN&gt;</code>
          </p><p>
            外部ユーザーを表す文字列 (none の場合は空です)。たとえば、サーバーが外部の認証方式を使用してクライアントを認証する場合は、この値が <code class="literal">&lt;USER&gt;</code> の値と異なる可能性があります。この要素は、<code class="literal">&lt;NAME&gt;</code> 値が <code class="literal">Connect</code>、<code class="literal">Change user</code>、または <code class="literal">Query</code> である場合にのみ表示されます。
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;OS_VERSION&gt;</code>
          </p><p>
            サーバーが構築された、または実行されているオペレーティングシステムを表す文字列。この要素は、<code class="literal">&lt;NAME&gt;</code> 値が <code class="literal">Audit</code> である場合にのみ表示されます。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;OS_VERSION&gt;x86_64-Linux&lt;/OS_VERSION&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;PRIV_USER&gt;</code>
          </p><p>
            サーバーがクライアントを認証する際に使用したユーザーを表す文字列。これは、サーバーが権限チェックを行う際に使用するユーザー名であり、<code class="literal">&lt;USER&gt;</code> の値とは異なる可能性があります。この要素は、<code class="literal">&lt;NAME&gt;</code> 値が <code class="literal">Connect</code> または <code class="literal">Change user</code> である場合にのみ表示されます。
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;PROXY_USER&gt;</code>
          </p><p>
            プロキシユーザーを表す文字列。ユーザーのプロキシ処理が有効になっていない場合は、値が空です。この要素は、<code class="literal">&lt;NAME&gt;</code> 値が <code class="literal">Connect</code> または <code class="literal">Change user</code> である場合にのみ表示されます。
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;SERVER_ID&gt;</code>
          </p><p>
            サーバー ID を表す符号なし整数。これは、<code class="literal">server_id</code> システム変数の値と同じです。この要素は、<code class="literal">&lt;NAME&gt;</code> 値が <code class="literal">Audit</code> または <code class="literal">NoAudit</code> である場合にのみ表示されます。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;SERVER_ID&gt;1&lt;/SERVER_ID&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;SQLTEXT&gt;</code>
          </p><p>
            SQL ステートメントのテキストを表す文字列。この値は、空にすることができます。長い値は、切り捨てられる可能性があります。この要素は、<code class="literal">&lt;NAME&gt;</code> 値が <code class="literal">Query</code> または <code class="literal">Execute</code> である場合にのみ表示されます。
          </p><p>
            監査ログファイル自体などの文字列は、UTF-8 (1 文字当たり最大 4 バイト) を使用して記述されるため、この値が変換の結果となる場合があります。たとえば、元のステートメントは、SJIS 文字列としてクライアントから受信された可能性があります。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;SQLTEXT&gt;DELETE FROM t1&lt;/SQLTEXT&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;STARTUP_OPTIONS&gt;</code>
          </p><p>
            MySQL サーバーの起動時に、コマンド行またはオプションファイルで指定されたオプションを表す文字列。この要素は、<code class="literal">&lt;NAME&gt;</code> 値が <code class="literal">Audit</code> である場合にのみ表示されます。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;STARTUP_OPTIONS&gt;/usr/local/mysql/bin/mysqld
  --port=3306 --log-output=FILE&lt;/STARTUP_OPTIONS&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;STATUS&gt;</code>
          </p><p>
            コマンドのステータスを表す符号なし整数 (成功した場合は 0、エラーが発生した場合はゼロ以外)。これは、<code class="literal">mysql_errno()</code> C API 関数の値と同じです。
          </p><p>
            監査ログには、SQLSTATE 値またはエラーメッセージが含まれていません。エラーコード、SQLSTATE 値、およびメッセージ間の関連性を確認する方法については、<a class="xref" href="error-handling.html#error-messages-server" title="B.3 サーバーのエラーコードおよびメッセージ">セクションB.3「サーバーのエラーコードおよびメッセージ」</a>を参照してください。
          </p><p>
            警告のログは記録されません。
          </p><p>
            <code class="literal">&lt;STATUS&gt;</code> と異なる点については、<code class="literal">&lt;STATUS_CODE&gt;</code> の説明を参照してください。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;STATUS&gt;1051&lt;/STATUS&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;STATUS_CODE&gt;</code>
          </p><p>
            コマンドのステータスを表す符号なし整数 (成功した場合は 0、エラーが発生した場合は 1)。
          </p><p>
            <code class="literal">STATUS_CODE</code> の値は、<code class="literal">STATUS</code> の値とは異なります。<code class="literal">STATUS_CODE</code> は、成功した場合は 0、エラーが発生した場合は 1 であり、Audit Vault の EZ_collector コンシューマとの互換性があります。<code class="literal">STATUS</code> は、<code class="literal">mysql_errno()</code> C API 関数の値です。これは、成功した場合は 0、エラーが発生した場合はゼロ以外です。そのため、エラーが発生した場合、必ずしも 1 であるとはかぎりません。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;USER&gt;</code>
          </p><p>
            クライアントによって送信されたユーザー名を表す文字列。これは、<code class="literal">&lt;PRIV_USER&gt;</code> の値とは異なる可能性があります。この要素は、<code class="literal">&lt;NAME&gt;</code> 値が <code class="literal">Connect</code>、<code class="literal">Change user</code>、または <code class="literal">Query</code> である場合にのみ表示されます。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;VERSION&gt;</code>
          </p><p>
            監査ログファイル形式のバージョンを表す符号なし整数。この要素は、<code class="literal">&lt;NAME&gt;</code> 値が <code class="literal">Audit</code> である場合にのみ表示されます。
          </p><p>
            例:
          </p><pre class="programlisting">
&lt;VERSION&gt;1&lt;/VERSION&gt;
</pre></li></ul></div><h5><a name="idm139979118782720"></a>古い監査ログファイル形式</h5><p>
        すべての <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素には、必須の属性セットが含まれています。監査レコードのタイプに応じて、その他のオプションの属性が表示される場合もあります。
      </p><p>
        次の属性は、すべての <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素で必須です。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">NAME</code>
          </p><p>
            監査イベントを生成した命令 (サーバーがクライアントから受信したコマンドなど) のタイプを表す文字列。
          </p><p>
            例: <code class="literal">NAME="Query"</code>
          </p><p>
            一部の一般的な <code class="literal">NAME</code> 値:
          </p><pre class="programlisting">
"Audit"    When auditing starts, which may be server startup time
"Connect"  When a client connects, also known as logging in
"Query"    An SQL statement (executed directly)
"Prepare"  Preparation of an SQL statement; usually followed by Execute
"Execute"  Execution of an SQL statement; usually follows Prepare
"Shutdown" Server shutdown
"Quit"     When a client disconnects
"NoAudit"  Auditing has been turned off
</pre><p>
            指定可能な値は <code class="literal">"Audit"</code>、<code class="literal">"Binlog Dump"</code>、<code class="literal">"Change user"</code>、<code class="literal">"Close stmt"</code>、<code class="literal">"Connect Out"</code>、<code class="literal">"Connect"</code>、<code class="literal">"Create DB"</code>、<code class="literal">"Daemon"</code>、<code class="literal">"Debug"</code>、<code class="literal">"Delayed insert"</code>、<code class="literal">"Drop DB"</code>、<code class="literal">"Execute"</code>、<code class="literal">"Fetch"</code>、<code class="literal">"Field List"</code>、<code class="literal">"Init DB"</code>、<code class="literal">"Kill"</code>、<code class="literal">"Long Data"</code>、<code class="literal">"NoAudit"</code>、<code class="literal">"Ping"</code>、<code class="literal">"Prepare"</code>、<code class="literal">"Processlist"</code>、<code class="literal">"Query"</code>、<code class="literal">"Quit"</code>、<code class="literal">"Refresh"</code>、<code class="literal">"Register Slave"</code>、<code class="literal">"Reset stmt"</code>、<code class="literal">"Set option"</code>、<code class="literal">"Shutdown"</code>、<code class="literal">"Sleep"</code>、<code class="literal">"Statistics"</code>、<code class="literal">"Table Dump"</code>、<code class="literal">"Time"</code> です。
          </p><p>
            <code class="literal">"Audit"</code> と <code class="literal">"NoAudit"</code> を除いて、これらの値は <code class="filename">mysql_com.h</code> ヘッダーファイルに一覧表示された <code class="literal">COM_<em class="replaceable"><code>xxx</code></em></code> コマンドの値に対応します。たとえば、<code class="literal">"Create DB"</code> と <code class="literal">"Shutdown"</code> は、それぞれ <code class="literal">COM_CREATE_DB</code> と <code class="literal">COM_SHUTDOWN</code> に対応します。
          </p></li><li class="listitem"><p>
            <code class="literal">TIMESTAMP</code>
          </p><p>
            監査イベントが生成された日付と時間。たとえば、クライアントから受信された SQL ステートメントの実行に対応するイベントでは、<code class="literal">TIMESTAMP</code> 値はステートメントが受信されたときではなく、終了したあとに生成されます。この値は、<code class="literal"><em class="replaceable"><code>yyyy-mm-dd</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em></code> 形式 (<code class="literal">T</code> の場合は小数点不可) の UTC です。
          </p><p>
            例: <code class="literal">TIMESTAMP="2012-08-09T12:55:16"</code>
          </p></li></ul></div><p>
        次の属性は、<code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素ではオプションです。これらの多くは、<code class="literal">NAME</code> 属性の特定の値を含む要素でのみ発生します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">CONNECTION_ID</code>
          </p><p>
            クライアント接続識別子を表す符号なし整数。これは、セッション内の <code class="literal">CONNECTION_ID()</code> 関数の値と同じです。
          </p><p>
            例: <code class="literal">CONNECTION_ID="127"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">DB</code>
          </p><p>
            デフォルトのデータベース名を表す文字列。この属性は、<code class="literal">NAME</code> 値が <code class="literal">"Connect"</code> または <code class="literal">"Change user"</code> である場合にのみ表示されます。
          </p></li><li class="listitem"><p>
            <code class="literal">HOST</code>
          </p><p>
            クライアントのホスト名を表す文字列。この属性は、<code class="literal">NAME</code> 値が <code class="literal">"Connect"</code> または <code class="literal">"Change user"</code> である場合にのみ表示されます。
          </p><p>
            例: <code class="literal">HOST="localhost"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">IP</code>
          </p><p>
            クライアントの IP アドレスを表す文字列。この属性は、<code class="literal">NAME</code> 値が <code class="literal">"Connect"</code> または <code class="literal">"Change user"</code> である場合にのみ表示されます。
          </p><p>
            例: <code class="literal">IP="127.0.0.1"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">MYSQL_VERSION</code>
          </p><p>
            MySQL サーバーのバージョンを表す文字列。これは、セッション内の <code class="literal">VERSION()</code> 関数または <code class="literal">version</code> システム変数の値と同じです。この属性は、<code class="literal">NAME</code> 値が <code class="literal">"Audit"</code> である場合にのみ表示されます。
          </p><p>
            例: <code class="literal">MYSQL_VERSION="5.6.11-log"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">OS_LOGIN</code>
          </p><p>
            外部ユーザーを表す文字列 (none の場合は空です)。たとえば、サーバーが外部の認証方式を使用してクライアントを認証する場合は、この値が <code class="literal">USER</code> と異なる可能性があります。この属性は、<code class="literal">NAME</code> 値が <code class="literal">"Connect"</code> または <code class="literal">"Change user"</code> である場合にのみ表示されます。
          </p></li><li class="listitem"><p>
            <code class="literal">OS_VERSION</code>
          </p><p>
            サーバーが構築された、または実行されているオペレーティングシステムを表す文字列。この属性は、<code class="literal">NAME</code> 値が <code class="literal">"Audit"</code> である場合にのみ表示されます。
          </p><p>
            例: <code class="literal">OS_VERSION="x86_64-Linux"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">PRIV_USER</code>
          </p><p>
            サーバーがクライアントを認証する際に使用したユーザーを表す文字列。これは、サーバーが権限チェックを行う際に使用するユーザー名であり、<code class="literal">USER</code> の値とは異なる可能性があります。この属性は、<code class="literal">NAME</code> 値が <code class="literal">"Connect"</code> または <code class="literal">"Change user"</code> である場合にのみ表示されます。
          </p></li><li class="listitem"><p>
            <code class="literal">PROXY_USER</code>
          </p><p>
            プロキシユーザーを表す文字列。ユーザーのプロキシ処理が有効になっていない場合は、値が空です。この属性は、<code class="literal">NAME</code> 値が <code class="literal">"Connect"</code> または <code class="literal">"Change user"</code> である場合にのみ表示されます。
          </p></li><li class="listitem"><p>
            <code class="literal">SERVER_ID</code>
          </p><p>
            サーバー ID を表す符号なし整数。これは、<code class="literal">server_id</code> システム変数の値と同じです。この属性は、<code class="literal">NAME</code> 値が <code class="literal">"Audit"</code> または <code class="literal">"NoAudit"</code> である場合にのみ表示されます。
          </p><p>
            例: <code class="literal">SERVER_ID="1"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">SQLTEXT</code>
          </p><p>
            SQL ステートメントのテキストを表す文字列。この値は、空にすることができます。長い値は、切り捨てられる可能性があります。この属性は、<code class="literal">NAME</code> 値が <code class="literal">"Query"</code> または <code class="literal">"Execute"</code> である場合にのみ表示されます。
          </p><p>
            監査ログファイル自体などの文字列は、UTF-8 (1 文字当たり最大 4 バイト) を使用して記述されるため、この値が変換の結果となる場合があります。たとえば、元のステートメントは、SJIS 文字列としてクライアントから受信された可能性があります。
          </p><p>
            例: <code class="literal">SQLTEXT="DELETE FROM t1"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">STARTUP_OPTIONS</code>
          </p><p>
            MySQL サーバーの起動時に、コマンド行またはオプションファイルで指定されたオプションを表す文字列。この属性は、<code class="literal">NAME</code> 値が <code class="literal">"Audit"</code> である場合にのみ表示されます。
          </p><p>
            例: <code class="literal">STARTUP_OPTIONS="--port=3306 --log-output=FILE"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">STATUS</code>
          </p><p>
            コマンドのステータスを表す符号なし整数 (成功した場合は 0、エラーが発生した場合はゼロ以外)。これは、<code class="literal">mysql_errno()</code> C API 関数の値と同じです。
          </p><p>
            監査ログには、SQLSTATE 値またはエラーメッセージが含まれていません。エラーコード、SQLSTATE 値、およびメッセージ間の関連性を確認する方法については、<a class="xref" href="error-handling.html#error-messages-server" title="B.3 サーバーのエラーコードおよびメッセージ">セクションB.3「サーバーのエラーコードおよびメッセージ」</a>を参照してください。
          </p><p>
            警告のログは記録されません。
          </p><p>
            例: <code class="literal">STATUS="1051"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">USER</code>
          </p><p>
            クライアントによって送信されたユーザー名を表す文字列。これは、<code class="literal">PRIV_USER</code> の値とは異なる可能性があります。この属性は、<code class="literal">NAME</code> 値が <code class="literal">"Connect"</code> または <code class="literal">"Change user"</code> である場合にのみ表示されます。
          </p></li><li class="listitem"><p>
            <code class="literal">VERSION</code>
          </p><p>
            監査ログファイル形式のバージョンを表す符号なし整数。この属性は、<code class="literal">NAME</code> 値が <code class="literal">"Audit"</code> である場合にのみ表示されます。
          </p><p>
            例: <code class="literal">VERSION="1"</code>
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-plugin-logging-control"></a>6.3.12.4 監査ログプラグインのロギング制御</h4></div></div></div><p>
        このセクションでは、<code class="literal">audit_log</code> プラグインでロギングを実行する方法、およびロギングの発生方法を制御するシステム変数について説明します。<a class="xref" href="security.html#audit-log-file" title="6.3.12.3 監査ログファイル">セクション6.3.12.3「監査ログファイル」</a>で説明したログファイル形式に精通していることが前提となっています。
      </p><p>
        監査ログプラグインはそのログファイルを開くと、XML 宣言および開始ルート要素タグ <code class="literal">&lt;AUDIT&gt;</code> を書き込む必要があるかどうかをチェックし、その場合はそれらのタグを書き込みます。監査ログプラグインが終了すると、終了タグ <code class="literal">&lt;/AUDIT&gt;</code> をファイルに書き込みます。
      </p><p>
        ログファイルを開くときに存在すれば、プラグインはファイルが <code class="literal">&lt;/AUDIT&gt;</code> タグで終了しているかどうかをチェックし、その場合はそれを切り捨ててから、任意の <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素を書き込みます。ログファイルが存在するが、<code class="literal">&lt;/AUDIT&gt;</code> タグで終了していない場合や、<code class="literal">&lt;/AUDIT&gt;</code> タグを切り捨てることができない場合、プラグインではファイル形式が不正であり、初期化に失敗したとみなされます。これは、サーバーがクラッシュした場合や、監査ログプラグインの実行中に強制終了された場合に発生する可能性があります。ロギングは、問題が修正されるまで発生しません。エラーログをチェックして、診断情報を確認してください。
      </p><a class="indexterm" name="idm139979118643056"></a><pre class="programlisting">
[ERROR] Plugin 'audit_log' init function returned error.
</pre><p>
        この問題に対処するには、不正な形式のログファイルを削除するか、ファイル名を変更してから、サーバーを再起動する必要があります。
      </p><p>
        MySQL サーバーは、クライアントから受信された SQL ステートメントの実行が完了するときなど、監査可能なイベントが発生するたびに監査ログプラグインを呼び出して、<code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素を書き込みます。一般に、サーバーの起動後に最初に書き込まれた <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素には、サーバーの説明および起動オプションが含まれています。そのあとの要素は、クライアントの接続および切断イベント、SQL ステートメントの実行などのイベントを表します。最上位のステートメントのみのログが記録され、トリガーやストアドプロシージャーなどのストアドプログラム内のステートメントのログは記録されません。<code class="literal">LOAD DATA INFILE</code> などのステートメントから参照されるファイルの内容は、記録されません。
      </p><p>
        ロギングの発生方法に対する制御を許可するために、<code class="literal">audit_log</code> プラグインには、次に説明するような複数のシステム変数が用意されています。詳細については、<a class="xref" href="security.html#audit-log-plugin-options-variables" title="6.3.12.6 監査ログプラグインのオプションおよびシステム変数">セクション6.3.12.6「監査ログプラグインのオプションおよびシステム変数」</a>を参照してください。
      </p><h5><a name="idm139979118632464"></a>監査ログファイル名の指定</h5><p>
        監査ログファイル名を制御するには、サーバーの起動時に <code class="literal">audit_log_file</code> システム変数を設定します。デフォルトでは、サーバーのデータディレクトリ内の <code class="filename">audit.log</code> という名前です。セキュリティー上の理由から、監査ログファイルは、MySQL サーバーおよびログを表示する正当な理由を持つユーザーにのみアクセス可能なディレクトリに書き込まれるべきです。
      </p><h5><a name="idm139979118628720"></a>監査ロギングの戦略</h5><p>
        監査プラグインは、ログの書き込みに関する複数の戦略のいずれかを使用できます。戦略を指定するには、サーバーの起動時に <code class="literal">audit_log_strategy</code> システム変数を設定します。デフォルトでは、戦略の値は <code class="literal">ASYNCHRONOUS</code> であり、プラグインは非同期的にログをバッファーに記録し、バッファーがいっぱいの場合は待機します。ファイルシステムのキャッシュ処理を使用するか (<code class="literal">SEMISYNCHRONOUS</code>)、各書き込みリクエストのあとに <code class="literal">sync()</code> を呼び出して出力を強制すれば (<code class="literal">SYNCHRONOUS</code>)、待機しないように (<code class="literal">PERFORMANCE</code>)、または同期的にログを記録するようにプラグインに指示できます。
      </p><p>
        非同期ロギングの戦略には、次のような特性があります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバーのパフォーマンスと拡張性への影響が最小限です。
          </p></li><li class="listitem"><p>
            できるかぎり最短の時間 (つまり、バッファーを割り当てる時間とそのバッファーにイベントをコピーする時間を足した時間) で、監査イベントを生成するスレッドをブロックします。
          </p></li><li class="listitem"><p>
            出力はバッファーに書き込まれます。個別のスレッドがバッファーからログファイルへの書き込みに対処します。
          </p></li></ul></div><p>
        <code class="literal">PERFORMANCE</code> 戦略のデメリットは、バッファーがいっぱいの場合にイベントが破棄される点です。負荷の高いサーバーでは、監査ログでイベントが欠落する可能性が高くなります。
      </p><p>
        非同期ロギングを使用すると、ファイルへの書き込み中に問題が発生した場合や、プラグインが正常にシャットダウンされない場合 (たとえば、サーバーホストがクラッシュした場合) に、ログファイルの完全性が危険にさらされる可能性があります。このリスクを減らすには、同期ロギングが使用されるように <code class="literal">audit_log_strategy</code> を設定します。戦略に関係なく、ロギングはベストエフォートベーシスで発生するため、一貫性は保証されません。
      </p><h5><a name="idm139979118613360"></a>監査ログ領域の管理</h5><p>
        監査ログプラグインには、そのログファイルで使用される領域を管理できる複数のシステム変数が用意されています。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">audit_log_buffer_size</code>: 非同期ロギング用のバッファーサイズを設定するには、この変数をサーバーの起動時に設定します。このプラグインでは、初期化時に割り当てられ、終了時に削除される単一のバッファーが使用されます。このプラグインは、ロギングが非同期の場合にのみ、このバッファーを割り当てます。
          </p></li><li class="listitem"><p>
            <code class="literal">audit_log_rotate_on_size</code>、<code class="literal">audit_log_flush</code>: これらの変数を使用すると、監査ログファイルのローテーションおよびフラッシュが許可されます。監査ログファイルが非常に大きくなり、大量のディスク領域が消費される可能性があります。使用される領域を管理するには、自動的なログのローテーションを有効にするか、手動で監査ファイルの名前を変更し、ログをフラッシュして新しいファイルを開きます。必要に応じて、名前が変更されたファイルを削除したり、バックアップしたりできます。
          </p><p>
            デフォルトでは、<code class="literal">audit_log_rotate_on_size=0</code> であり、ログのローテーションは発生しません。この場合、<code class="literal">audit_log_flush</code> の値が無効から有効に変更されると、監査ログプラグインはログファイルを閉じてから再度開きます。ログファイル名の変更は、サーバーの外部で実行される必要があります。名前を <code class="filename">audit.log.1</code> から <code class="filename">audit.log.3</code> で循環させる 3 つの最近のログファイルを保持すると仮定します。Unix 上で、次のように手動でローテーションを実行します。
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                コマンド行から、現在のログファイル名を変更します。
              </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mv audit.log.2 audit.log.3</code></strong>
shell&gt; <strong class="userinput"><code>mv audit.log.1 audit.log.2</code></strong>
shell&gt; <strong class="userinput"><code>mv audit.log audit.log.1</code></strong>
</pre><p>
                この時点で、プラグインは引き続き、<code class="filename">audit.log.1</code> に名前が変更された現在のログファイルに書き込みます。
              </p></li><li class="listitem"><p>
                サーバーに接続し、ログファイルをフラッシュします。これにより、プラグインはログファイルを閉じて、新しい <code class="filename">audit.log</code> ファイルログを再度開きます。
              </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL audit_log_flush = ON;</code></strong>
</pre></li></ol></div><p>
            <code class="literal">audit_log_rotate_on_size</code> が 0 よりも大きい場合は、<code class="literal">audit_log_flush</code> を設定しても効果がありません。この場合、ファイルへの書き込みによってそのサイズが <code class="literal">audit_log_rotate_on_size</code> の値を超えるたびに、監査ログプラグインはそのログファイルを閉じてから再度開きます。このプラグインは、タイムスタンプ拡張子が追加されるように元のファイル名を変更します。たとえば、<code class="filename">audit.log</code> は <code class="filename">audit.log.13440033615657730</code> という名前に変更される可能性があります。最後の 7 桁は小数部です。最初の 10 桁は、<code class="literal">FROM_UNIXTIME()</code> 関数を使用して解釈できる Unix タイムスタンプ値です。
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT FROM_UNIXTIME(1344003361);</code></strong>
+---------------------------+
| FROM_UNIXTIME(1344003361) |
+---------------------------+
| 2012-08-03 09:16:01       |
+---------------------------+
</pre></li></ul></div><h5><a name="idm139979118582112"></a>監査ログのフィルタリング</h5><p>
        監査ログプラグインは、監査対象イベントをフィルタリングできます。これにより、イベントの発生元のアカウントやイベントのステータスに基づいて、監査ログファイルにイベントを書き込むかどうかを制御できます。ステータスのフィルタリングは、接続イベントおよびステートメントイベントごとに個別に発生します。
      </p><h5><a name="idm139979118580368"></a>アカウント別のイベントフィルタリング</h5><p>
        MySQL 5.6.20 の時点で、発生元のアカウントに基づいて監査対象イベントをフィルタリングするには、サーバーの起動時または実行時に、次のシステム変数のいずれかを設定します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">audit_log_include_accounts</code>: 監査ロギングに含めるアカウント。この変数が設定されている場合は、これらのアカウントのみが監査されます。
          </p></li><li class="listitem"><p>
            <code class="literal">audit_log_exclude_accounts</code>: 監査ロギングから除外するアカウント。この変数が設定されている場合は、これらのアカウント以外がすべて監査されます。
          </p></li></ul></div><p>
        いずれかの変数の値には、<code class="literal">NULL</code> またはカンマで区切った 1 つ以上のアカウント名を含む文字列を指定できます。それぞれの形式は <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code> です。デフォルトでは、両方の変数が <code class="literal">NULL</code> になっています。この場合、アカウントのフィルタリングは実行されず、すべてのアカウントで監査が発生します。
      </p><p>
        例: <code class="literal">user1</code> および <code class="literal">user2</code> ローカルホストのアカウントでのみ監査ロギングを有効にするには、次のように <code class="literal">audit_log_include_accounts</code> システム変数を設定します。
      </p><pre class="programlisting">
SET GLOBAL audit_log_include_accounts = 'user1@localhost,user2@localhost';
</pre><p>
        同時に <code class="literal">NULL</code> 以外に設定できるのは、<code class="literal">audit_log_include_accounts</code> と <code class="literal">audit_log_exclude_accounts</code> のいずれかのみです。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">audit_log_include_accounts</code> を設定すると、サーバーは <code class="literal">audit_log_exclude_accounts</code> を <code class="literal">NULL</code> に設定します。
          </p></li><li class="listitem"><p>
            <code class="literal">audit_log_include_accounts</code> が <code class="literal">NULL</code> でない場合を除いて、<code class="literal">audit_log_exclude_accounts</code> を設定しようとするとエラーが発生します。この場合は、まず <code class="literal">audit_log_include_accounts</code> を <code class="literal">NULL</code> に設定することでクリアする必要があります。
          </p></li></ul></div><pre class="programlisting">
-- This sets audit_log_exclude_accounts to NULL
SET GLOBAL audit_log_include_accounts = <em class="replaceable"><code>value</code></em>;

-- This fails because audit_log_include_accounts is not NULL
SET GLOBAL audit_log_exclude_accounts = <em class="replaceable"><code>value</code></em>;

-- To set audit_log_exclude_accounts, first set
-- audit_log_include_accounts to NULL
SET GLOBAL audit_log_include_accounts = NULL;
SET GLOBAL audit_log_exclude_accounts = <em class="replaceable"><code>value</code></em>;
</pre><p>
        いずれかの変数の値を調査する場合は、<code class="literal">SHOW VARIABLES</code> で <code class="literal">NULL</code> が空の文字列として表示されることに注意してください。これを回避するには、代わりに <code class="literal">SELECT</code> を使用してください。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'audit_log_include_accounts';</code></strong>
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
| audit_log_include_accounts |       |
+----------------------------+-------+
mysql&gt; <strong class="userinput"><code>SELECT @@audit_log_include_accounts;</code></strong>
+------------------------------+
| @@audit_log_include_accounts |
+------------------------------+
| NULL                         |
+------------------------------+
</pre><p>
        カンマ、スペース、またはその他の特殊文字が含まれているために、ユーザー名やホスト名を引用符で囲む必要がある場合は、一重引用符を使用して囲みます。変数の値自体が一重引用符で囲まれている場合は、内側の各一重引用符を二重に入力するか、バックスラッシュを使用してエスケープします。次のステートメントはそれぞれ、ローカルの <code class="literal">root</code> アカウントの監査ロギングを有効にします。引用符のスタイルが異なりますが、いずれも同等です。
      </p><pre class="programlisting">
SET GLOBAL audit_log_include_accounts = 'root@localhost';
SET GLOBAL audit_log_include_accounts = '''root''@''localhost''';
SET GLOBAL audit_log_include_accounts = '\'root\'@\'localhost\'';
SET GLOBAL audit_log_include_accounts = "'root'@'localhost'";
</pre><p>
        <code class="literal">ANSI_QUOTES</code> SQL モードでは、二重引用符は文字列の引用ではなく、識別子の引用を示すため、このモードが有効になっている場合は、最後のステートメントが機能しません。
      </p><h5><a name="idm139979118540416"></a>ステータス別のイベントフィルタリング</h5><p>
        MySQL 5.6.20 の時点で、ステータスに基づいて監査対象イベントをフィルタリングするには、サーバーの起動時または実行時に、次のシステム変数を設定します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">audit_log_connection_policy</code>: 接続イベントのロギングポリシーです
          </p></li><li class="listitem"><p>
            <code class="literal">audit_log_statement_policy</code>: ステートメントイベントのロギングポリシーです
          </p></li></ul></div><p>
        各変数には、<code class="literal">ALL</code> (関連付けられたすべてのイベントのログを記録します。これがデフォルトです)、<code class="literal">ERRORS</code> (失敗したイベントのログのみを記録します)、または <code class="literal">NONE</code> (イベントのログを記録しません) の値が指定されます。たとえば、ステートメントイベントのログはすべて記録するが、接続イベントのログは失敗したもののみを記録する場合は、次の設定を使用します。
      </p><pre class="programlisting">
SET GLOBAL audit_log_statement_policy = ALL;
SET GLOBAL audit_log_connection_policy = ERRORS;
</pre><p>
        MySQL 5.6.20 よりも前では、<code class="literal">audit_log_connection_policy</code> および <code class="literal">audit_log_statement_policy</code> を使用できません。代わりに、サーバーの起動時または実行時に <code class="literal">audit_log_policy</code> を使用します。これには、<code class="literal">ALL</code> (すべてのイベントのログを記録します。これがデフォルトです)、<code class="literal">LOGINS</code> (接続イベントのログを記録します)、<code class="literal">QUERIES</code> (ステートメントイベントのログを記録します)、または <code class="literal">NONE</code> (イベントのログを記録しません) の値が指定されます。これらの値のいずれを指定しても、監査ログプラグインは成功と失敗を区別せずに、選択したイベントのログをすべて記録します。
      </p><p>
        MySQL 5.6.20 の時点で、<code class="literal">audit_log_policy</code> は引き続き使用可能ですが、サーバーの起動時にしか設定できません。実行時は、読み取り専用の変数です。起動時に使用すると、次のように動作します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">audit_log_policy</code> を設定しない場合や、デフォルト値の <code class="literal">ALL</code> に設定した場合でも、<code class="literal">audit_log_connection_policy</code> または <code class="literal">audit_log_statement_policy</code> を明示的に設定すれば、指定どおりに適用されます。指定しない場合は、デフォルトが <code class="literal">ALL</code> に設定されます。
          </p></li><li class="listitem"><p>
            <code class="literal">audit_log_policy</code> を <code class="literal">ALL</code> 以外の値に設定した場合は、次の表に示すように、その値が優先され、<code class="literal">audit_log_connection_policy</code> および <code class="literal">audit_log_statement_policy</code> を設定する際に使用されます。また、これらの変数のいずれかをデフォルトの <code class="literal">ALL</code> 以外の値に設定する場合、サーバーはそれらの値がオーバーライドされることを示すメッセージをエラーログに書き込みます。
          </p><div class="informaltable"><table summary="この表は、サーバーの起動時に audit_log_policy を使用して audit_log_connection_policy および audit_log_statement_policy を設定する方法を示しています。" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">起動時の audit_log_policy 値</th><th scope="col">結果として返される audit_log_connection_policy 値</th><th scope="col">結果として返される audit_log_statement_policy 値</th></tr></thead><tbody><tr><td scope="row"><code class="literal">LOGINS</code></td><td><code class="literal">ALL</code></td><td><code class="literal">NONE</code></td></tr><tr><td scope="row"><code class="literal">QUERIES</code></td><td><code class="literal">NONE</code></td><td><code class="literal">ALL</code></td></tr><tr><td scope="row"><code class="literal">NONE</code></td><td><code class="literal">NONE</code></td><td><code class="literal">NONE</code></td></tr></tbody></table></div></li></ul></div><h5><a name="idm139979118491808"></a>イベントフィルタリングのレポート</h5><p>
        次のステータス変数の値を調査すると、フィルタリングの結果を確認できます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Audit_log_events</code>: フィルタリングのポリシーに基づいてログに書き込まれたかどうかに関係なく、監査ログプラグインによって処理されたイベントの数。
          </p></li><li class="listitem"><p>
            <code class="literal">Audit_log_events_filtered</code>: フィルタリングのポリシーに基づいて、監査ログプラグインによってフィルタリングされた (ログに書き込まれなかった) イベントの数。
          </p></li><li class="listitem"><p>
            <code class="literal">Audit_log_events_written</code>: 監査ログに書き込まれたイベントの数。
          </p></li></ul></div><p>
        MySQL 5.6.20 の時点では、これらの変数を使用できます。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-plugin-option-variable-reference"></a>6.3.12.5 監査ログプラグインのオプションおよび変数のリファレンス</h4></div></div></div><div class="table"><a name="idm139979118482768"></a><p class="title"><b>表 6.17 監査ログプラグインのオプション/変数のリファレンス</b></p><div class="table-contents"><table summary="監査ログプラグインのオプション/変数のリファレンス" border="1"><colgroup><col class="name"><col class="cmd-line"><col class="option_file"><col class="system_var"><col class="status_var"><col class="var_scope"><col class="dynamic"></colgroup><thead><tr><th scope="col">名前</th><th scope="col">コマンド行</th><th scope="col">オプションファイル</th><th scope="col">システム変数</th><th scope="col">ステータス変数</th><th scope="col">変数スコープ</th><th scope="col">動的</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="security.html#option_mysqld_audit-log">audit-log</a></td><td>はい</td><td>はい</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_buffer_size">audit_log_buffer_size</a></td><td>はい</td><td>はい</td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_connection_policy">audit_log_connection_policy</a></td><td>はい</td><td>はい</td><td>はい</td><td> </td><td>グローバル</td><td>はい</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_current_session">audit_log_current_session</a></td><td> </td><td> </td><td>はい</td><td> </td><td>両方</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_current_size">Audit_log_current_size</a></td><td> </td><td> </td><td> </td><td>はい</td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_event_max_drop_size">Audit_log_event_max_drop_size</a></td><td> </td><td> </td><td> </td><td>はい</td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_events">Audit_log_events</a></td><td> </td><td> </td><td> </td><td>はい</td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_events_filtered">Audit_log_events_filtered</a></td><td> </td><td> </td><td> </td><td>はい</td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_events_lost">Audit_log_events_lost</a></td><td> </td><td> </td><td> </td><td>はい</td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_events_written">Audit_log_events_written</a></td><td> </td><td> </td><td> </td><td>はい</td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_exclude_accounts">audit_log_exclude_accounts</a></td><td>はい</td><td>はい</td><td>はい</td><td> </td><td>グローバル</td><td>はい</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_file">audit_log_file</a></td><td>はい</td><td>はい</td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_flush">audit_log_flush</a></td><td> </td><td> </td><td>はい</td><td> </td><td>グローバル</td><td>はい</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_format">audit_log_format</a></td><td>はい</td><td>はい</td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_include_accounts">audit_log_include_accounts</a></td><td>はい</td><td>はい</td><td>はい</td><td> </td><td>グローバル</td><td>はい</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_policy">audit_log_policy</a></td><td>はい</td><td>はい</td><td>はい</td><td> </td><td>グローバル</td><td>異なる</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_rotate_on_size">audit_log_rotate_on_size</a></td><td>はい</td><td>はい</td><td>はい</td><td> </td><td>グローバル</td><td>はい</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_statement_policy">audit_log_statement_policy</a></td><td>はい</td><td>はい</td><td>はい</td><td> </td><td>グローバル</td><td>はい</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_strategy">audit_log_strategy</a></td><td>はい</td><td>はい</td><td>はい</td><td> </td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_total_size">Audit_log_total_size</a></td><td> </td><td> </td><td> </td><td>はい</td><td>グローバル</td><td>いいえ</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_write_waits">Audit_log_write_waits</a></td><td> </td><td> </td><td> </td><td>はい</td><td>グローバル</td><td>いいえ</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-plugin-options-variables"></a>6.3.12.6 監査ログプラグインのオプションおよびシステム変数</h4></div></div></div><p>
        このセクションでは、監査ログプラグインの操作を制御するコマンドオプションおよびシステム変数について説明します。起動時に指定された値が正しくない場合は、プラグインが正常に初期化できない可能性があり、サーバーでロードされません。この場合、サーバーでその他の監査ログ設定が認識されないため、それに関するエラーメッセージが生成される可能性もあります。
      </p><p>
        <code class="literal">audit_log</code> プラグインのアクティブ化を制御するには、次のオプションを使用します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_audit-log"></a>
            <a class="indexterm" name="idm139979118400288"></a> <a class="indexterm" name="idm139979118398176"></a> <code class="option">--audit-log[=<em class="replaceable"><code>value</code></em>]</code>
          </p><div class="informaltable"><table summary="Options for audit-log" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row"><span class="bold"><strong>コマンド行形式</strong></span></td><td colspan="3"><code class="literal">--audit-log[=value]</code></td></tr><tr><td scope="row" rowspan="6"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">列挙</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" rowspan="4" valign="top"><span class="bold"><strong>有効な値</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">FORCE</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">FORCE_PLUS_PERMANENT</code></td></tr></tbody></table></div><p>
            このオプションは、サーバーの起動時に <code class="literal">audit_log</code> プラグインをロードする方法を制御します。これは、監査ログプラグインが事前に <code class="literal">INSTALL PLUGIN</code> に登録されている場合や、<code class="option">--plugin-load</code> を使用してロードされている場合にのみ指定可能です。<a class="xref" href="security.html#audit-log-plugin-installation" title="6.3.12.1 監査ログプラグインのインストール">セクション6.3.12.1「監査ログプラグインのインストール」</a>を参照してください。
          </p><p>
            <a class="xref" href="server-administration.html#server-plugin-loading" title="5.1.8.1 プラグインのインストールおよびアンインストール">セクション5.1.8.1「プラグインのインストールおよびアンインストール」</a>で説明したように、オプションの値は、プラグインのロードオプションに指定可能な値のいずれかである必要があります。たとえば、<code class="option">--audit-log=FORCE_PLUS_PERMANENT</code> は、プラグインをロードし、それがサーバーの実行時に削除されることを回避するようにサーバーに指示します。
          </p><p>
            このオプションは MySQL 5.6.10 で追加されました。
          </p></li></ul></div><p>
        <code class="literal">audit_log</code> プラグインがインストールされている場合は、ロギングに対する制御を許可する複数のシステム変数が表示されます。これらの変数は、<code class="literal">audit_log</code> プラグインが有効になっている場合にのみ指定可能です。
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'audit_log%';</code></strong>
+-----------------------------+--------------+
| Variable_name               | Value        |
+-----------------------------+--------------+
| audit_log_buffer_size       | 1048576      |
| audit_log_connection_policy | ALL          |
| audit_log_current_session   | ON           |
| audit_log_exclude_accounts  |              |
| audit_log_file              | audit.log    |
| audit_log_flush             | OFF          |
| audit_log_format            | OLD          |
| audit_log_include_accounts  |              |
| audit_log_policy            | ALL          |
| audit_log_rotate_on_size    | 0            |
| audit_log_statement_policy  | ALL          |
| audit_log_strategy          | ASYNCHRONOUS |
+-----------------------------+--------------+
</pre><p>
        これらの変数のいずれも、サーバーの起動時 (一部は実行時) に設定できます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_audit_log_buffer_size"></a>
            <a class="indexterm" name="idm139979118361040"></a> <a class="indexterm" name="idm139979118359488"></a> <code class="literal">audit_log_buffer_size</code>
          </p><div class="informaltable"><table summary="Options for audit_log_buffer_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row"><span class="bold"><strong>コマンド行形式</strong></span></td><td colspan="3"><code class="literal">--audit_log_buffer_size=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_buffer_size">audit_log_buffer_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">いいえ</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>許可されている値</strong></span> (32 ビットプラットフォーム)</td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">数値</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">1048576</code></td></tr><tr><td scope="row"><span class="bold"><strong>最小値</strong></span></td><td colspan="2"><code class="literal">4096</code></td></tr><tr><td scope="row"><span class="bold"><strong>最大値</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>許可されている値</strong></span> (64 ビットプラットフォーム)</td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">数値</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">1048576</code></td></tr><tr><td scope="row"><span class="bold"><strong>最小値</strong></span></td><td colspan="2"><code class="literal">4096</code></td></tr><tr><td scope="row"><span class="bold"><strong>最大値</strong></span></td><td colspan="2"><code class="literal">18446744073709547520</code></td></tr></tbody></table></div><p>
            監査ログプラグインが非同期的にイベントをログに書き込むと、イベントの内容を書き込む前に、バッファーを使用してそれらを格納します。この変数は、そのバッファーのサイズ (バイト単位) を制御します。サーバーは、この値を 4096 の倍数に調整します。このプラグインでは、初期化時に割り当てられ、終了時に削除される単一のバッファーが使用されます。このプラグインは、ロギングが非同期の場合にのみ、このバッファーを割り当てます。
          </p><p>
            この変数は MySQL 5.6.10 で追加されました。
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_connection_policy"></a>
            <a class="indexterm" name="idm139979118317248"></a> <a class="indexterm" name="idm139979118315776"></a> <code class="literal">audit_log_connection_policy</code>
          </p><div class="informaltable"><table summary="Options for audit_log_connection_policy" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.20</td></tr><tr><td scope="row"><span class="bold"><strong>コマンド行形式</strong></span></td><td colspan="3"><code class="literal">--audit_log_connection_policy=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_connection_policy">audit_log_connection_policy</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">はい</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">列挙</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">ALL</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>有効な値</strong></span></td><td colspan="2"><code class="literal">ALL</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">ERRORS</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">NONE</code></td></tr></tbody></table></div><p>
            監査ログプラグインが接続イベントをそのログファイルに書き込む方法を制御するポリシーです。次の表は、許可される値を示しています。
          </p><div class="informaltable"><table summary="この表は、audit_log_connection_policy 変数で許可されている値を示しています。" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">値</th><th scope="col">説明</th></tr></thead><tbody><tr><td scope="row"><code class="literal">ALL</code></td><td>接続イベントのログをすべて記録します</td></tr><tr><td scope="row"><code class="literal">ERRORS</code></td><td>失敗した接続イベントのログのみを記録します</td></tr><tr><td scope="row"><code class="literal">NONE</code></td><td>接続イベントのログを記録しません</td></tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
              <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.12.4 監査ログプラグインのロギング制御">セクション6.3.12.4「監査ログプラグインのロギング制御」</a>で説明したように、<code class="literal">audit_log_policy</code> も指定されている場合は、サーバーの起動時に、<code class="literal">audit_log_connection_policy</code> に明示的に指定された値がオーバーライドされる可能性があります。
            </p></div><p>
            この変数は、MySQL 5.6.20 で追加されました。
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_current_session"></a>
            <a class="indexterm" name="idm139979118269040"></a> <a class="indexterm" name="idm139979118267584"></a> <code class="literal">audit_log_current_session</code>
          </p><div class="informaltable"><table summary="Options for audit_log_current_session" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.20</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_current_session">audit_log_current_session</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル、セッション</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">いいえ</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">ブール</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">depends on filtering policy</code></td></tr></tbody></table></div><p>
            現在のセッションで監査ロギングが有効になっているかどうかを示します。この変数のセッションの値は、読み取り専用です。セッションの開始時に、<code class="literal">audit_log_include_accounts</code> および <code class="literal">audit_log_exclude_accounts</code> システム変数の値に基づいて設定されます。監査ログプラグインはこのセッション値を使用して、そのセッションでイベントを監査するかどうかを決定します。(グローバル値もありますが、このプラグインでは使用されません。)
          </p><p>
            この変数は、MySQL 5.6.20 で追加されました。
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_exclude_accounts"></a>
            <a class="indexterm" name="idm139979118240560"></a> <a class="indexterm" name="idm139979118239088"></a> <code class="literal">audit_log_exclude_accounts</code>
          </p><div class="informaltable"><table summary="Options for audit_log_exclude_accounts" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.20</td></tr><tr><td scope="row"><span class="bold"><strong>コマンド行形式</strong></span></td><td colspan="3"><code class="literal">--audit_log_exclude_accounts=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_exclude_accounts">audit_log_exclude_accounts</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">はい</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">文字列</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">NULL</code></td></tr></tbody></table></div><p>
            イベントのログが記録されないアカウント。この値には、<code class="literal">NULL</code> またはカンマで区切った 1 つ以上のアカウント名のリストを含む文字列を指定するようにしてください。詳細については、<a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.12.4 監査ログプラグインのロギング制御">セクション6.3.12.4「監査ログプラグインのロギング制御」</a>を参照してください。
          </p><p>
            この変数は、MySQL 5.6.20 で追加されました。
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_file"></a>
            <a class="indexterm" name="idm139979118210928"></a> <a class="indexterm" name="idm139979118209424"></a> <code class="literal">audit_log_file</code>
          </p><div class="informaltable"><table summary="Options for audit_log_file" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row"><span class="bold"><strong>コマンド行形式</strong></span></td><td colspan="3"><code class="literal">--audit_log_file=file_name</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_file">audit_log_file</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">いいえ</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">ファイル名</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">audit.log</code></td></tr></tbody></table></div><p>
            監査ログプラグインがイベントを書き込むファイルの名前。デフォルト値は <code class="filename">audit.log</code> です。ファイル名が相対パスの場合、サーバーはデータディレクトリに相対的なパスであると解釈します。セキュリティー上の理由から、監査ログファイルは、MySQL サーバーおよびログを表示する正当な理由を持つユーザーにのみアクセス可能なディレクトリに書き込まれるべきです。
          </p><p>
            この変数は MySQL 5.6.10 で追加されました。
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_flush"></a>
            <a class="indexterm" name="idm139979118181920"></a> <a class="indexterm" name="idm139979118180416"></a> <code class="literal">audit_log_flush</code>
          </p><div class="informaltable"><table summary="Options for audit_log_flush" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_flush">audit_log_flush</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">はい</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">ブール</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table></div><p>
            この変数が有効になるよう (1 または <code class="literal">ON</code>) に設定されている場合、監査ログプラグインはそのログファイルを閉じてから再度開いて、フラッシュします。(この値は、別のフラッシュを実行するために再度有効にする前に、明示的に無効にする必要がないように、<code class="literal">OFF</code> のままになっています。)<code class="literal">audit_log_rotate_on_size</code> が 0 である場合を除いて、この変数を有効にしても効果はありません。
          </p><p>
            この変数は MySQL 5.6.10 で追加されました。
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_format"></a>
            <a class="indexterm" name="idm139979118153360"></a> <a class="indexterm" name="idm139979118151856"></a> <code class="literal">audit_log_format</code>
          </p><div class="informaltable"><table summary="Options for audit_log_format" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.14</td></tr><tr><td scope="row"><span class="bold"><strong>コマンド行形式</strong></span></td><td colspan="3"><code class="literal">--audit_log_format=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_format">audit_log_format</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">いいえ</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>許可されている値</strong></span> (&gt;= 5.6.14)</td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">列挙</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">OLD</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>有効な値</strong></span></td><td colspan="2"><code class="literal">OLD</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">NEW</code></td></tr></tbody></table></div><p>
            監査ログファイルの形式。許可されている値は、<code class="literal">OLD</code> および <code class="literal">NEW</code> (デフォルトは <code class="literal">OLD</code>) です。各形式についての詳細は、<a class="xref" href="security.html#audit-log-file" title="6.3.12.3 監査ログファイル">セクション6.3.12.3「監査ログファイル」</a>を参照してください。
          </p><p>
            <code class="literal">audit_log_format</code> の値を変更する場合は、次の手順を使用して、ある形式のログエントリが別の形式のエントリを含む既存のログファイルに書き込まれることを回避します。
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                サーバーを停止します。
              </p></li><li class="listitem"><p>
                現在の監査ログファイルの名前を手動で変更します。
              </p></li><li class="listitem"><p>
                新しい <code class="literal">audit_log_format</code> の値でサーバーを再起動します。監査ログプラグインによって、選択した形式のログエントリを含む新しいログファイルが作成されます。
              </p></li></ol></div><p>
            この変数は、MySQL 5.6.14 で追加されました。
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_include_accounts"></a>
            <a class="indexterm" name="idm139979118111760"></a> <a class="indexterm" name="idm139979118110288"></a> <code class="literal">audit_log_include_accounts</code>
          </p><div class="informaltable"><table summary="Options for audit_log_include_accounts" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.20</td></tr><tr><td scope="row"><span class="bold"><strong>コマンド行形式</strong></span></td><td colspan="3"><code class="literal">--audit_log_include_accounts=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_include_accounts">audit_log_include_accounts</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">はい</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">文字列</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">NULL</code></td></tr></tbody></table></div><p>
            イベントのログが記録されるアカウント。この値には、<code class="literal">NULL</code> またはカンマで区切った 1 つ以上のアカウント名のリストを含む文字列を指定するようにしてください。詳細については、<a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.12.4 監査ログプラグインのロギング制御">セクション6.3.12.4「監査ログプラグインのロギング制御」</a>を参照してください。
          </p><p>
            この変数は、MySQL 5.6.20 で追加されました。
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_policy"></a>
            <a class="indexterm" name="idm139979118082128"></a> <a class="indexterm" name="idm139979118080624"></a> <code class="literal">audit_log_policy</code>
          </p><div class="informaltable"><table summary="Options for audit_log_policy" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row"><span class="bold"><strong>コマンド行形式</strong></span></td><td colspan="3"><code class="literal">--audit_log_policy=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数 (&lt;= 5.6.19)</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_policy">audit_log_policy</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">はい</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数 (&gt;= 5.6.20)</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_policy">audit_log_policy</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">いいえ</td></tr><tr><td scope="row" rowspan="6"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">列挙</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">ALL</code></td></tr><tr><td scope="row" rowspan="4" valign="top"><span class="bold"><strong>有効な値</strong></span></td><td colspan="2"><code class="literal">ALL</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">LOGINS</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">QUERIES</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">NONE</code></td></tr></tbody></table></div><p>
            監査ログプラグインがイベントをそのログファイルに書き込む方法を制御するポリシーです。次の表は、許可される値を示しています。
          </p><div class="informaltable"><table summary="この表は、audit_log_policy 変数で許可されている値を示しています。" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">値</th><th scope="col">説明</th></tr></thead><tbody><tr><td scope="row"><code class="literal">ALL</code></td><td>イベントのログをすべて記録します</td></tr><tr><td scope="row"><code class="literal">LOGINS</code></td><td>ログインイベントのログのみを記録します</td></tr><tr><td scope="row"><code class="literal">QUERIES</code></td><td>クエリーイベントのログのみを記録します</td></tr><tr><td scope="row"><code class="literal">NONE</code></td><td>ログを何も記録しません (監査ストリームを無効にします)</td></tr></tbody></table></div><p>
            MySQL 5.6.20 の時点で、<code class="literal">audit_log_policy</code> はサーバーの起動時にしか設定できません。実行時は、読み取り専用の変数です。これは、より詳細にロギングポリシーを制御し、起動時または実行時に設定できるその他の 2 つのシステム変数 (<code class="literal">audit_log_connection_policy</code> と <code class="literal">audit_log_statement_policy</code>) が導入されたためです。その他の 2 つの変数の代わりに、起動時に <code class="literal">audit_log_policy</code> を使用し続けると、サーバーはその値を使用して、これらの変数を設定します。ポリシーの変数とそれらの相互作用についての詳細は、<a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.12.4 監査ログプラグインのロギング制御">セクション6.3.12.4「監査ログプラグインのロギング制御」</a>を参照してください。
          </p><p>
            MySQL 5.6.20 よりも前では、<code class="literal">audit_log_connection_policy</code> および <code class="literal">audit_log_statement_policy</code> システム変数が存在しません。<code class="literal">audit_log_policy</code> は、唯一のポリシー制御の変数であり、サーバーの起動時または実行時に設定できます。
          </p><p>
            この変数は MySQL 5.6.10 で追加されました。
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_rotate_on_size"></a>
            <a class="indexterm" name="idm139979118017216"></a> <a class="indexterm" name="idm139979118015648"></a> <code class="literal">audit_log_rotate_on_size</code>
          </p><div class="informaltable"><table summary="Options for audit_log_rotate_on_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row"><span class="bold"><strong>コマンド行形式</strong></span></td><td colspan="3"><code class="literal">--audit_log_rotate_on_size=N</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_rotate_on_size">audit_log_rotate_on_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">はい</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">数値</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table></div><p>
            <code class="literal">audit_log_rotate_on_size</code> 値を 0 よりも大きくした場合は、ファイルへの書き込みによってそのサイズがこの値を超えると、監査ログプラグインはそのログファイルを閉じてから再度開きます。元のファイル名は、タイムスタンプ拡張子が含まれるように変更されます。
          </p><p>
            <code class="literal">audit_log_rotate_on_size</code> 値が 0 の場合、プラグインはサイズに基づいて、そのログを閉じてから再度開きません。代わりに、<code class="literal">audit_log_flush</code> 使用して、要求に応じてログを閉じてから再度開きます。この場合、ファイルをフラッシュする前に、サーバーの外部でファイル名を変更します。
          </p><p>
            監査ログファイルのローテーションおよびタイムスタンプの解釈についての詳細は、<a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.12.4 監査ログプラグインのロギング制御">セクション6.3.12.4「監査ログプラグインのロギング制御」</a>を参照してください。
          </p><p>
            この変数を 4096 の倍数でない値に設定すると、もっとも近い倍数に切り捨てられます。(したがって、4096 未満の値に設定すると、0 (ゼロ) に設定した結果となり、ローテーションは発生しません。)
          </p><p>
            この変数は MySQL 5.6.10 で追加されました。
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_statement_policy"></a>
            <a class="indexterm" name="idm139979117982656"></a> <a class="indexterm" name="idm139979117981184"></a> <code class="literal">audit_log_statement_policy</code>
          </p><div class="informaltable"><table summary="Options for audit_log_statement_policy" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.20</td></tr><tr><td scope="row"><span class="bold"><strong>コマンド行形式</strong></span></td><td colspan="3"><code class="literal">--audit_log_statement_policy=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_statement_policy">audit_log_statement_policy</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">はい</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">列挙</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">ALL</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>有効な値</strong></span></td><td colspan="2"><code class="literal">ALL</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">ERRORS</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">NONE</code></td></tr></tbody></table></div><p>
            監査ログプラグインがステートメントイベントをそのログファイルに書き込む方法を制御するポリシーです。次の表は、許可される値を示しています。
          </p><div class="informaltable"><table summary="この表は、audit_log_statement_policy 変数で許可されている値を示しています。" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">値</th><th scope="col">説明</th></tr></thead><tbody><tr><td scope="row"><code class="literal">ALL</code></td><td>ステートメントイベントのログをすべて記録します</td></tr><tr><td scope="row"><code class="literal">ERRORS</code></td><td>失敗したステートメントイベントのログのみを記録します</td></tr><tr><td scope="row"><code class="literal">NONE</code></td><td>ステートメントイベントのログを記録しません</td></tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
              <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.12.4 監査ログプラグインのロギング制御">セクション6.3.12.4「監査ログプラグインのロギング制御」</a>で説明したように、<code class="literal">audit_log_policy</code> も指定されている場合は、サーバーの起動時に、<code class="literal">audit_log_statement_policy</code> に明示的に指定された値がオーバーライドされる可能性があります。
            </p></div><p>
            この変数は、MySQL 5.6.20 で追加されました。
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_strategy"></a>
            <a class="indexterm" name="idm139979117934352"></a> <a class="indexterm" name="idm139979117932800"></a> <code class="literal">audit_log_strategy</code>
          </p><div class="informaltable"><table summary="Options for audit_log_strategy" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>導入</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row"><span class="bold"><strong>コマンド行形式</strong></span></td><td colspan="3"><code class="literal">--audit_log_strategy=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>システム変数</strong></span></td><td><span class="bold"><strong>名前</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_strategy">audit_log_strategy</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>変数スコープ</strong></span></td><td colspan="2">グローバル</td></tr><tr><td scope="row"><span class="bold"><strong>動的変数</strong></span></td><td colspan="2">いいえ</td></tr><tr><td scope="row" rowspan="6"><span class="bold"><strong>許可されている値</strong></span></td><td><span class="bold"><strong>型</strong></span></td><td colspan="2"><code class="literal">列挙</code></td></tr><tr><td scope="row"><span class="bold"><strong>デフォルト</strong></span></td><td colspan="2"><code class="literal">ASYNCHRONOUS</code></td></tr><tr><td scope="row" rowspan="4" valign="top"><span class="bold"><strong>有効な値</strong></span></td><td colspan="2"><code class="literal">ASYNCHRONOUS</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">PERFORMANCE</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">SEMISYNCHRONOUS</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">SYNCHRONOUS</code></td></tr></tbody></table></div><p>
            監査ログプラグインで使用されるロギング方法。次の表では、許可されている値について説明します。
          </p><div class="table"><a name="idm139979117901168"></a><p class="title"><b>表 6.18 監査ログの戦略</b></p><div class="table-contents"><table summary="監査ログの戦略" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">値</th><th scope="col">意味</th></tr></thead><tbody><tr><td scope="row"><code class="literal">ASYNCHRONOUS</code></td><td>非同期的にログを記録し、出力バッファー内の領域を待機します</td></tr><tr><td scope="row"><code class="literal">PERFORMANCE</code></td><td>非同期的にログを記録し、出力バッファー内の領域が十分でない場合はリクエストを破棄します</td></tr><tr><td scope="row"><code class="literal">SEMISYNCHRONOUS</code></td><td>同期的にログを記録し、オペレーティングシステムによるキャッシュ処理を許可します</td></tr><tr><td scope="row"><code class="literal">SYNCHRONOUS</code></td><td>同期的にログを記録し、各リクエスト後に <code class="filename">sync()</code> を呼び出します</td></tr></tbody></table></div></div><br class="table-break"><p>
            この変数は MySQL 5.6.10 で追加されました。
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-status-variables"></a>6.3.12.7 監査ログプラグインのステータス変数</h4></div></div></div><p>
        監査ログプラグインでは、次のステータス変数がサポートされています。これらは、<code class="literal">audit_log</code> プラグインが有効になっている場合にのみ指定可能です。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_Audit_log_current_size"></a>
            <a class="indexterm" name="idm139979117884320"></a> <a class="indexterm" name="idm139979117882752"></a> <code class="literal">Audit_log_current_size</code>
          </p><p>
            現在の監査ログファイルのサイズ。この値は、イベントがログに書き込まれると増加し、ログがローテーションされると 0 にリセットされます。
          </p><p>
            この変数は、MySQL 5.6.20 で追加されました。
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_event_max_drop_size"></a>
            <a class="indexterm" name="idm139979117877216"></a> <a class="indexterm" name="idm139979117875744"></a> <code class="literal">Audit_log_event_max_drop_size</code>
          </p><p>
            パフォーマンスロギングモードで破棄された最大イベントのサイズ。ロギングモードについては、<a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.12.4 監査ログプラグインのロギング制御">セクション6.3.12.4「監査ログプラグインのロギング制御」</a>を参照してください。
          </p><p>
            この変数は、MySQL 5.6.20 で追加されました。
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_events"></a>
            <a class="indexterm" name="idm139979117869536"></a> <a class="indexterm" name="idm139979117867984"></a> <code class="literal">Audit_log_events</code>
          </p><p>
            フィルタリングのポリシーに基づいてログに書き込まれたかどうかに関係なく、監査ログプラグインによって処理されたイベントの数 (<a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.12.4 監査ログプラグインのロギング制御">セクション6.3.12.4「監査ログプラグインのロギング制御」</a>を参照してください)。
          </p><p>
            この変数は、MySQL 5.6.20 で追加されました。
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_events_filtered"></a>
            <a class="indexterm" name="idm139979117861840"></a> <a class="indexterm" name="idm139979117860368"></a> <code class="literal">Audit_log_events_filtered</code>
          </p><p>
            フィルタリングのポリシーに基づいて、監査ログプラグインによってフィルタリングされた (ログに書き込まれなかった) イベントの数 (<a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.12.4 監査ログプラグインのロギング制御">セクション6.3.12.4「監査ログプラグインのロギング制御」</a>を参照してください)。
          </p><p>
            この変数は、MySQL 5.6.20 で追加されました。
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_events_lost"></a>
            <a class="indexterm" name="idm139979117853984"></a> <a class="indexterm" name="idm139979117852432"></a> <code class="literal">Audit_log_events_lost</code>
          </p><p>
            イベントが使用可能な監査ログバッファー領域よりも大きかったために、パフォーマンスロギングモードで失われたイベントの数。この値は、<code class="literal">audit_log_buffer_size</code> を設定して、パフォーマンスモード用にバッファーのサイズを調整する方法を評価する際に役立つことがあります。ロギングモードについては、<a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.12.4 監査ログプラグインのロギング制御">セクション6.3.12.4「監査ログプラグインのロギング制御」</a>を参照してください。
          </p><p>
            この変数は、MySQL 5.6.20 で追加されました。
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_events_written"></a>
            <a class="indexterm" name="idm139979117844800"></a> <a class="indexterm" name="idm139979117843328"></a> <code class="literal">Audit_log_events_written</code>
          </p><p>
            監査ログに書き込まれたイベントの数。
          </p><p>
            この変数は、MySQL 5.6.20 で追加されました。
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_total_size"></a>
            <a class="indexterm" name="idm139979117837920"></a> <a class="indexterm" name="idm139979117836368"></a> <code class="literal">Audit_log_total_size</code>
          </p><p>
            すべての監査ログファイルに書き込まれたイベントの合計サイズ。<code class="literal">Audit_log_current_size</code> とは異なり、<code class="literal">Audit_log_total_size</code> の値は、ログがローテーションされたときにも増加します。
          </p><p>
            この変数は、MySQL 5.6.20 で追加されました。
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_write_waits"></a>
            <a class="indexterm" name="idm139979117828944"></a> <a class="indexterm" name="idm139979117827392"></a> <code class="literal">Audit_log_write_waits</code>
          </p><p>
            非同期ロギングモードでイベントが監査ログバッファー内の領域を待機する必要があった回数。ロギングモードについては、<a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.12.4 監査ログプラグインのロギング制御">セクション6.3.12.4「監査ログプラグインのロギング制御」</a>を参照してください。
          </p><p>
            この変数は、MySQL 5.6.20 で追加されました。
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-plugin-restrictions"></a>6.3.12.8 監査ログプラグインの制限事項</h4></div></div></div><p>
        監査ログプラグインは、次の制限事項の対象になっています。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            最上位のステートメントのみのログが記録され、トリガーやストアドプロシージャーなどのストアドプログラム内のステートメントのログは記録されません。
          </p></li><li class="listitem"><p>
            <code class="literal">LOAD DATA INFILE</code> などのステートメントから参照されるファイルの内容は、記録されません。
          </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="account-activity-auditing"></a>6.3.13 SQL ベースの MySQL アカウントアクティビティーの監査</h3></div></div></div><p>
      アプリケーションは次のガイドラインを使用することで、データベースアクティビティーを MySQL アカウントに関連付ける SQL ベースの監査を実行できます。
    </p><p>
      MySQL アカウントは、<code class="literal">mysql.user</code> テーブルの行に対応します。クライアントが正常に接続すると、サーバーはこのテーブル内の特定の行にアクセスするクライアントを認証します。この行の <code class="literal">User</code> および <code class="literal">Host</code> カラムの値は、アカウントを一意に識別し、アカウント名が SQL ステートメントに書き込まれる <code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code> 形式に対応します。
    </p><p>
      クライアントを認証する際に使用されるアカウントによって、クライアントが持っている権限が特定されます。通常、<code class="literal">CURRENT_USER()</code> 関数を呼び出すと、このアカウントがどのクライアントユーザー用であるかを特定できます。その値は、アカウントの <code class="literal">user</code> テーブル行の <code class="literal">User</code> および <code class="literal">Host</code> カラムで構成されています。
    </p><p>
      ただし、<code class="literal">CURRENT_USER()</code> 値がクライアントユーザーではなく、別のアカウントに対応するという状況もあります。これは、権限チェックがクライアントのアカウントに基づいて実行されないコンテキストで発生します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">SQL SECURITY DEFINER</code> 特性を使用して定義されたストアドルーチン (プロシージャーおよび関数)
        </p></li><li class="listitem"><p>
          <code class="literal">SQL SECURITY DEFINER</code> 特性を使用して定義されたビュー
        </p></li><li class="listitem"><p>
          トリガーとイベント
        </p></li></ul></div><p>
      このようなコンテキストでは、権限チェックは <code class="literal">DEFINER</code> アカウントと照合して実行され、<code class="literal">CURRENT_USER()</code> はそのアカウントを参照し、ストアドルーチンまたはビューを呼び出したクライアント、またはトリガーをアクティブにしたクライアントのアカウントは参照しません。クライアントおよびクライアントの接続元ホストによって指定された実際のユーザー名を示す値を返す <code class="literal">USER()</code> 関数を呼び出すと、呼び出し元のユーザーを特定できます。ただし、<code class="literal">USER()</code> の値にはワイルドカードが含まれない一方で、(<code class="literal">CURRENT_USER()</code> によって返される) アカウントの値にはユーザー名およびホスト名のワイルドカードが含まれる可能性があるため、この値は必ずしも、<code class="literal">user</code> テーブル内のアカウントに直接対応するとはかぎりません。
    </p><p>
      たとえば、空白のユーザー名は任意のユーザーに一致するため、<code class="literal">''@'localhost'</code> のアカウントを使用すると、クライアントは任意のユーザー名を持つローカルホストから匿名ユーザーとして接続できます。この場合、クライアントがローカルホストから <code class="literal">user1</code> として接続している場合、<code class="literal">USER()</code> と <code class="literal">CURRENT_USER()</code> は別々の値を返します。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+-----------------+----------------+
| USER()          | CURRENT_USER() |
+-----------------+----------------+
| user1@localhost | @localhost     |
+-----------------+----------------+
</pre><p>
      アカウントのホスト名部分にも、ワイルドカードを含めることができます。ホスト名に <code class="literal">'%'</code> または <code class="literal">'_'</code> パターン文字が含まれている場合や、ネットマスク表記が使用されている場合は、複数のホストから接続しているクライアントにそのアカウントを使用できますが、<code class="literal">CURRENT_USER()</code> の値には、どのホストであるのかが示されません。たとえば、アカウント <code class="literal">'user2'@'%.example.com'</code> を使用すると、<code class="literal">user2</code> が <code class="literal">example.com</code> ドメイン内の任意のホストから接続できます。<code class="literal">user2</code> が <code class="literal">remote.example.com</code> から接続すると、<code class="literal">USER()</code> と <code class="literal">CURRENT_USER()</code> は別々の値を返します。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+--------------------------+---------------------+
| USER()                   | CURRENT_USER()      |
+--------------------------+---------------------+
| user2@remote.example.com | user2@%.example.com |
+--------------------------+---------------------+
</pre><p>
      アプリケーションがユーザーを監査するために <code class="literal">USER()</code> を呼び出す必要があるが (たとえば、トリガー内から監査を実行する場合)、<code class="literal">USER()</code> の値を <code class="literal">user</code> テーブル内のアカウントに関連付けることができる必要もある場合は、アカウントの <code class="literal">User</code> または <code class="literal">Host</code> カラムにワイルドカードが含まれることを回避する必要があります。特に、<code class="literal">User</code> を (匿名のユーザーアカウントが作成される) 空にすることは許可しないでください。また、<code class="literal">Host</code> の値に、パターン文字またはネットマスク表記を使用することも許可しないでください。すべてのアカウントには、空でない <code class="literal">User</code> 値とリテラルの <code class="literal">Host</code> 値を含める必要があります。
    </p><p>
      前述の例に関しては、ワイルドカードが使用されないように <code class="literal">''@'localhost'</code> および <code class="literal">'user2'@'%.example.com'</code> アカウントを変更するようにしてください。
    </p><pre class="programlisting">
RENAME USER ''@'localhost' TO 'user1'@'localhost';
RENAME USER 'user2'@'%.example.com' TO 'user2'@'remote.example.com';
</pre><p>
      <code class="literal">user2</code> が <code class="literal">example.com</code> ドメイン内の複数のホストから接続できる必要がある場合は、ホストごとに個別のアカウントにするべきです。
    </p><p>
      <code class="literal">CURRENT_USER()</code> または <code class="literal">USER()</code> の値からユーザー名またはホスト名の部分を抽出するには、<code class="literal">SUBSTRING_INDEX()</code> 関数を使用します。
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT SUBSTRING_INDEX(CURRENT_USER(),'@',1);</code></strong>
+---------------------------------------+
| SUBSTRING_INDEX(CURRENT_USER(),'@',1) |
+---------------------------------------+
| user1                                 |
+---------------------------------------+

mysql&gt; <strong class="userinput"><code>SELECT SUBSTRING_INDEX(CURRENT_USER(),'@',-1);</code></strong>
+----------------------------------------+
| SUBSTRING_INDEX(CURRENT_USER(),'@',-1) |
+----------------------------------------+
| localhost                              |
+----------------------------------------+
</pre></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="server-administration.html">前</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="backup-and-recovery.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">第 5 章 MySQL サーバーの管理 </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> 第 7 章 バックアップとリカバリ</td></tr></table></div><div class="copyright-footer"></div></body></html>
